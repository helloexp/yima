<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>微信公众号_卡券领取码_翼码旺财</title>
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/WX2.css?v=__VR__" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.8.2.min.js?v=__VR__"></script>
<link href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css?v=__VR__" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__" ></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__" ></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
</head>
<body>
	<div id="wrapper" >
        <include file="./Home/Tpl/Public/Public_header.html" />
        <include file="./Home/Tpl/LabelAdmin/Channel_topMenu.html" topmenuid="gongzhonghao"/>
        <div id="container" >
            <div id="main" class="rel">
              <div class="sidenav">
					<include file="LabelAdmin/Batch/WleftMenu" leftmenuid="cardGeneration"/>
                </div>

                <div class="subcon">
                	<div class="main-name fn">
                        <h4><a href="javascript:history.go(-1);" class="back"><i></i> 卡券领取码</a> / 批量制码</h4>
                    </div>
                    <div class="tipNormal">
                        <span>为配合线下发放微信卡券的场景，商家可以提前将微信卡券生成二维码，下载使用。下载的二维码，一般可用于卡券的店内投放、海报投放和传单投放。消费者扫码后即可领取。</span>
                    </div>
                    <form action="" method="POST" name="theform" id="theform" class="mt15">
                    <div class="Gform w1">
                        <ul>
                            <li class="Gname"><span>*</span>&nbsp;批次名称</li>
                            <li class="Ginput"><input name="card_batchname" id="card_batchname" type="text" maxlength="10" class="validate[required,maxSize[10]]" placeholder="例如：2.14活动奖品">
                            <span class="maxTips forInput" data-max="10">0/10</span> 
                            </li>
                        </ul>
                        <ul>
                            <li class="Gname"><span>*</span>&nbsp;选择卡券</li>
                            <li class="Ginput">
                            <div class="Gchoose">
                                <input type="text" value="" class="validate[required]" name="goods_id" id="goods_id"  />
                                <input type="text" value="" class="validate[required]" name="card_id" id="card_id"  />
                                <a href="javascript:void(0)" id='card_name'></a>
                                <a href="javascript:void(0)" id="bind_cj" class="Gbtn-card addAward_btn" title="选择卡券"><i></i></a>
                            </div>
                            <span class="txtTips">仅支持投放类卡券</span>
                            </li>
                        </ul>
                        <ul>
                            <li class="Gname"><span>*</span>&nbsp;数量</li>
                            <li class="Ginput">
                            <input type="text" value="" class="validate[required]" name="goods_quantity" id="goods_quantity"  />
                            <input type="hidden" value="" name="goods_storage" id="goods_storage" />
                            <span class="maxTips forInput">张</span>
                            </li>
                        </ul>
                        <ul>
                            <li class="Gname"><span>*</span>&nbsp;制卡方式</li>
                            <li class="Ginput">
                                <div class="switch">
                                    <input type="radio" name="validate_type" value="3" checked="checked">
                                    <div class="newRadio">
                                        <span class="valfirst hover" data-val="3">一码一券</span>
                                        <!--<span class="vallast" data-val="4">一码多券</span>-->
                                    </div>
<!--
                                    <i class="allAsk" title="<p><strong>一码一券：</strong>每张卡券对应生成一张二维码，每张码只能领取一次。<br /><br /><strong>一码多券：</strong>所有卡券都生成在一张二维码上，每次扫码，领取一张券。领完为止。</p>"></i>
-->
                                    <div class="cl fn"></div>
                                    <div class="newRadio-default">
                                    	<span class="txtTips">每张卡券对应生成一张二维码，每张码只能领取一次。</span>
                                    </div>
<!--                                    <div class="newRadio-input">
                                        <span class="txtTips">所有卡券都生成在一张二维码上，每次扫码，领取一张券。领完为止。</span>
                                    </div>-->
                                    
                                </div>
                            </li>
                        </ul>
                        <ul>
                            <li class="Gname">&nbsp;备注</li>
                            <li class="Ginput">
                                <textarea name="description" class="validate[maxSize[30]]" maxlength="30"></textarea>
                                <span class="maxTips forArea" data-max="30">0/30</span>
                            </li>
                        </ul>
                        <ul>
                            <li class="Gname"></li>
                            <li class="Ginput mt5">
                            <a href="javascript:void(0);" id="smb" class="btn-all">确定</a>
                            <a href="javascript:history.go(-1);" id="reset" class="btn-all-del">取消</a>
                            </li>
                        </ul> 
                    </div>
                    </form>
                </div>
            </div>
        </div>
		<!--开始引入底部-->
        <include file="./Home/Tpl/Public/Public_footer.html" />
    </div>
    <div class="service"></div>
</body>
</html>
<script type="text/javascript">
$(function(){
	$('#bind_cj').click(function(){
            art.dialog.open("{:U('Common/SelectJp/index',array('callback'=>'call_back','show_source'=>'3'))}",{
            width: 800,
            title:'选择卡券'
        })
    });
	
	$("body").on("keyup","input[name='goods_quantity']",function(){
		var inputVal = parseInt($(this).val());
		var remainVal = parseInt($("input[name='goods_storage']").val());
	 	if(inputVal>remainVal){
			Diaerror("卡券数量不能大于库存量！");
			$("input[name='goods_quantity").focus();
			return false;
		}
		if(inputVal<1){
			Diaerror("卡券数量不能小于1！");
			$("input[name='goods_quantity").focus();
			return false;
		}
	});	
	
	$("#smb").click(function(e) {
		var inputVal = parseInt($("input[name='goods_quantity").val());
		var remainVal = parseInt($("input[name='goods_storage']").val());
		if(inputVal>remainVal){
			Diaerror("卡券数量不能大于库存量！");
			$("input[name='goods_quantity").focus();
			return false;
		}
		if(inputVal<1){
			Diaerror("卡券数量不能小于1！");
			$("input[name='goods_quantity").focus();
			return false;
		}
		var d = {};
		var submitResult = template('submitResult', d);
        if($("#theform").validationEngine('validate')){
			
            $("#theform").ajaxSubmit({
                beforeSubmit:function(){
                    dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
                },
                data:$("#theform").serialize(),
                type: "POST",
                url:"{:U('Weixin/doWeixinCardGeneration')}",
                dataType:'json',
                success:function(data){
                    if (data.status == 1){
                        dialog.close();
						art.dialog({
							title: '提交结果',
							width:400,
							content: submitResult,
							ok: function() {
								window.location.href = "{:U('Weixin/Weixin/cardGeneration')}";
							},
							okVal:"查看进度"
						});
                    } else {
                        dialog.close();
                        Diaerror(data.info);
                    }
                }
            });
            return false;
		  }
    });
})

function call_back(datas){
    $("#card_name").html(datas.goods_name);
    $("#goods_id").val(datas.goods_id);
    $("#card_id").val(datas.card_id);
    $("#goods_quantity").val(datas.remain_num);
	$('#goods_storage').val(datas.remain_num);
}
</script>


<script type="text/html" id="submitResult">
<div class='loadTip'>
	<div class='loadStatus ok'>
	<dl>
	<dt>任务创建成功！</dt>
	<dd>批量制作卡券码可能需要一段时间，请稍后下载。</dd>
	</dl>
	</div>
</div>
</script>


