<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>创建商品</title>
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wnumgoods.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wshop.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css?v=__VR__" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC_LOCAL__/Js/ueditor/ueditor.config.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC_LOCAL__/Js/ueditor/ueditor.all.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC_LOCAL__/Js/My97DatePicker/WdatePicker.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/ajaxfileupload.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery-ui-1.11.2.custom/template.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.cookie.js?v=__VR__"></script>
<style type="text/css">
    .img {
        display: block;
        height: 100px;
        margin: 5px;
        width: 160px;
    }
    .edit-area .pic .img {
        display: block;
        margin: 5px;
        width: 160px;
        height: 90px;
    }
    .edit-area .pic {
        position: relative;
        width: 170px;
        height: 135px;
        border: 1px solid #E0E0E0;
        text-align: center;
        overflow: hidden;
    }
    .create-good li .strong {
        display: block;
        width: 120px;
        text-align: right;
        line-height: 28px;
    }
    .ml20 {
        margin-left: 20px;
    }
    .l {
        float: left;
    }
    .create-good li .strong {
        display: block;
        width: 120px;
        text-align: right;
        line-height: 28px;
    }
     .new-btn {
        margin-left: 15px;
        margin-top: -2px;
    }
    
    .Gform li .img { margin: 0;}
    .Gform .pic {
	    position: relative;
	    width: 160px;
	    height: 100px;
	    text-align: center;
	    border: 1px solid #e0e0e0;
	    /*overflow: hidden;*/
		margin-right:10px; margin-bottom:10px; float:left;
	}
	.Gform .pic .btn {
	    display: none;
	    margin: 0 auto;
	    width: 158px;
	    height: 98px;
	    background: #ffffff;
	    text-align: center;
	    line-height: 100px;
	    font-size: 14px;
	    color: #ff8b04;
	    position: absolute;
    	top: 0;
    	left: 0;
    	border: 1px #e0e0e0 dashed;
	    /*border-radius: 3px;*/
	    cursor: pointer;
	}
	.Gform .pic:hover { border: 1px solid #ffffff;}
	.Gform .pic:hover .btn { display: block;}
	.judgeCon-time { width: 510px;}
	.Gform .judgeCon-time p { display: inline-block; line-height: 28px;}
	.Gform .judgeCon-time input { width: 90px;}
	.Gform .btn-all { color: #ffffff;}
</style>
<script>
    function addGoods(e){
        if(e==1){
            $("#line_type").val(e);
        }else{
            $("#line_type").val(e);
        }
    }
var isopencusMsg = "{$startUp}"; //1：设置了短信内容自定义 0：未设置自定义
$(document).ready(function(e){
	if(isopencusMsg==1){
		$(".nocusMsg").hide();
		$(".cusMsg").show();
	}else{
		$(".nocusMsg").show();
		$(".cusMsg").hide();
	}
    $("#selectShop").click(function(e){
        art.dialog.open("{:U('WangcaiPc/NumGoods/shopList')}",{
            title: '选择门店',
            width:'800px'
        });
        //$(".newRadio-default").show();
    });

    $("#editStore").click(function(){
        art.dialog.open("{:U('WangcaiPc/NumGoods/shopList')}",{
            title: '选择门店',
            width:'800px'
        });
    });
	$("#theform").validationEngine();
    var is_submit = false;
    $(".sub_button").click(function(){
        if(is_submit == true)   {$('.sub_button').attr('class','btn-all-del w110');return false;}
    	var dialog;
		var price = [];
		$(".skuTable [name='price']").each(function(index, element) {
            var p = $(this).val();
			var nid = $(this).attr("data-newid").split(",");
			var sid = new Array();
            var n = $(this).closest("tr").find("[name='num']").val();
			if(n==""){n="-1"};
			for(var i=0;i<=nid.length;i++){
				sid.push(nid[i]);
			}
			var arr = {
				newid:sid,
				price:p,
				num:n
			};
			price.push(arr);
        });
		data["price"] = price;
        //console.info(data);return false;
        $('#data_price_info').val(JSON.stringify( data.price ));
        $('#data_name_info').val(JSON.stringify( data.namelist ));
		if($("#theform").validationEngine('validate')){
            $("#theform").ajaxSubmit({
                beforeSubmit:function(arr, $form, options){
                    $form["sku"] = data;
                    is_submit = true;
                    dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
                },
                success:function(data){
                 if(data.status == '1'){
                       is_submit = false;
                       all_art_close();
                       $('#div_content').hide();
                       $('#div_success').show();
                       windowheight();
                       return false;
                  }else{
                       is_submit = false;
                       dialog.time(5).content("<div class='msg-all-error'>"+data.info+"</div>");
                  }
            },
                dataType:'json'
            });
            return false;
        }
    });
    $(".message-show").click(function(){
        var message=$("#mms_text").val();
        var html=
        ['<div class="aipai-iphone">',
          '<div class="aipai-iphone-text">',
              message,
          '</div>',
          '</div>'].join('');
          art.dialog({
            padding: 20,
            title: '短信预览',
            content: html,
            lock: true
        });
    });
    $(".print-show").click(function(){
        var message=$("#mms_text").val();
        var html=['<img src="__PUBLIC__/Image/iphone_bg2_print.png" />'].join('');
          art.dialog({
            padding: 0,
            title: '什么是小票内容？',
            content: html,
			width:690,
			height:450,
            lock: true
        });
    });
})
</script>
</head>
<body>
    <div id="wrapper">
        <include file="./Home/Tpl/Public/Public_header.html" />
		<!--开始载入头部菜单-->
        <div id="container" class="bgfff">
            <div id="main" class="rel">
                <div class="new_sidenav">
                <include file="./Home/Tpl/Integral/Integral/Store_sidenav.html" leftmenuid="mdqd"/>
                </div>
				<div id="div_content" class="subcon fn">
                <div class="shopCon">
                    <div class="main-name fn">
                        <h4>我要创建商品</h4>
                    </div>
                    <div id="store_check">
                        <form method="post" action="<?php echo U('Integral/GoodsInfo/add');?>" id="theform">
                        <div class="Gform l fn <eq name='addStore' value='1'>dn</eq> fistForm" style="width:100%;">
                            <div id="Wform">
                                <ul class="Gtitle">商品基本内容</ul>
                                <ul>
                                    <li class="Gname" ><span class="red">*</span>&nbsp;商品名称</li>
                                    <li class="Ginput"><input name="name" id="name" type="text" class="validate[required]" maxlength="24" /><span class="maxTips forInput" data-max="24">0/24</span><span class="txtTips important"></span></li>
                                </ul>
                                 <ul>
                                         <li class="Gname"><span class="red">*</span>&nbsp;商品图片库</li>
                                         <li class="Ginput">
                                         <div class="pic">
                                             <img src="__PUBLIC__/Image/shop/no-head.png" class="img" id="show1" data-view="src,img1,previewData" />
                                             <input type="hidden" name="resp_img1" id="resp_img1" value="" />
                                             <a class="btn" onclick="return uploadImg('640x320','cb_img_1');" href="javascript:void(0);">+上传</a>
                                         </div>
                                         <div class="pic">
                                             <img src="__PUBLIC__/Image/shop/no-head.png" class="img" id="show2" data-view="src,img2,previewData" />
                                             <input type="hidden" name="resp_img2" id="resp_img2" value="" />
                                             <a class="btn" onclick="return uploadImg('640x320','cb_img_2');" href="javascript:void(0);">+上传</a>
                                         </div>
                                         <div class="pic">
                                             <img src="__PUBLIC__/Image/shop/no-head.png" class="img" id="show3" data-view="src,img3,previewData" />
                                             <input type="hidden" name="resp_img3" id="resp_img3" value="" />
                                             <a class="btn" onclick="return uploadImg('640x320','cb_img_3')" href="javascript:void(0);">+上传</a>
                                         </div>
                                         <div class="pic">
                                             <img src="__PUBLIC__/Image/shop/no-head.png" class="img" id="show4" data-view="src,img4,previewData" />
                                             <input type="hidden" name="resp_img4" id="resp_img4" value="" />
                                             <a class="btn" onclick="return uploadImg('640x320','cb_img_4')" href="javascript:void(0);">+上传</a>
                                         </div>
                                         <div class="pic">
                                             <img src="__PUBLIC__/Image/shop/no-head.png" class="img" id="show5" data-view="src,img5,previewData" />
                                             <input type="hidden" name="resp_img5" id="resp_img5" value="" />
                                             <a class="btn" onclick="return uploadImg('640x320','cb_img_5')" href="javascript:void(0);">+上传</a>
                                         </div>
                                         <div class="cl"></div>
                                         <p class="txtTips">最多上传5张图片</p>
                                         </li>
                                 </ul>
                                <ul>
                                    <li class="Gname"><span class="red">*</span>&nbsp;商品描述</li>
                                    <li class="Ginput"><textarea name="goods_desc" id="goods_desc" class="validate[required,maxSize[200]]"></textarea><span class="maxTips forArea" data-max="200">0/200</span></li>
                                </ul>
                                <ul class="fn">
                                    <li class="Gname"><span class="red">*</span>&nbsp;所属分类</li>
                                    <li class="Ginput">
                                    <select class="selectbox l w120 ml20 validate[required]" name="classify" id="classify" style="width:120px;text-align:center;margin-left: 0px;">
                                        <option value="">请选择</option>
                                        {:show_arr_opt($classify_arr)}
                                    </select>
                                    <a class="btn btn_inner l new-btn" href="javascript:void(0)" style="margin-top: 0px;">新增分类</a>
                                    </li>
                                </ul>
                                <ul class="Gtitle">数量及价格</ul>
                                <ul>
                                <li class="Gname">商品类型</li>
                                <li class="Ginput">
                                    <div class="switch">
                                        <input type="radio" name="issku" value="0" checked="checked" />
                                        <div class="newRadio">
                                            <span class="valfirst hover" data-val="0" id="oneGoods">单一商品</span>
                                            <span class="vallast" data-val="1" id="twoGoods">多规格商品</span>
                                        </div>
                                    </div>
                                </li>
                                </ul>
                                <script>
                                    $("#oneGoods").click(function(){
                                        $("#integralShop").css('display','none');
                                        $(".sku2").css('display','block');
                                        $(".sku1").css('display','none');
                                    });
                                    $("#twoGoods").click(function(){
                                        $("#integralShop").css('display','block');
                                        $(".sku2").css('display','none');
//                                        $(".sku1").css('display','block');
                                    });
                                </script>
                                <ul style="display: none" id="integralShop">
                                    <li class="Gname">&nbsp;商品规格</li>
                                    <li class="Ginput">
                                    	<div class="skuForm">
                                        </div>
                                        <span class="txtTips">商品规格最多添加3个</span>
                                    </li>
                                </ul>
                                <ul class="sku1">
                                    <li class="Gname"><span class="red">*</span>&nbsp;价格与库存</li>
                                    <li class="Ginput">
                                    	<div class="fn skuTable"></div>
                                        <span class="txtTips"></span>
                                    </li>
                                </ul>
                                <ul class="sku2">
                                    <li class="Gname"><span class="red">*</span>&nbsp;{:L('INTEGRAL_NAME')}</li>
                                    <li class="Ginput">
                                        <input name="market_price" type="text"  class="validate[required,custom[number],min[0]]" maxlength="10"/>
                                        <span class="maxTips forInput">{:L('INTEGRAL_NAME')}</span>
                                    </li>
                                </ul>
                                <ul>
                                    <li class="Gname"><span class="red">*</span>&nbsp;商品实际价格</li>
                                    <li class="Ginput">
                                        <div class="switch">
                                            <input type="radio" name="tape_price_type" value="0" checked="checked" />
                                            <div class="newRadio">
                                                <span class="valfirst" data-val="0">不显</span>
                                                <span class="vallast" data-val="1">显示</span>
                                            </div>
                                            <div class="newRadio-input">
                                                <input name="tape_price" type="text" class="validate[required,min[1],custom[integer]]" style="width:150px;"/><span class="maxTips forInput">元</span>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                <ul class="sku2">
                                    <li class="Gname"><span class="red">*</span>&nbsp;商品数量</li>
                                    <li class="Ginput">
                                        <div class="switch">
                                            <input type="radio" name="num_type" value="0" checked="checked" />
                                            <div class="newRadio">
                                                <span class="valfirst" data-val="0">不限</span>
                                                <span class="vallast" data-val="1">限制</span>
                                            </div>
                                            <div class="newRadio-input">
                                                <input name="goods_num" type="text" class="validate[required,min[1],custom[integer]]" style="width:150px;"/><span class="maxTips forInput">份</span>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                <ul class="Gtitle">配送方式</ul>
                               <ul>
                                   <li class="Gname"><span class="red">*</span>&nbsp;配送方式</li>
                                   <li class="Ginput">
                                   		<div class="switch">
                                            <input type="radio" name="delivery_flag" value="1" checked="checked" />
                                            <div class="newRadio">
                                                <span class="valfirst hover" data-val="1" id="delivery_flag1">物流</span>
                                                <span class="vallast" data-val="0" id="delivery_flag2">自提</span>
                                            </div>
                                        </div>

                                       <!--<p class="span l">
                                           <label id="delivery_flag1_label" class="ml20">
                                               <input id="delivery_flag1" class="checkradio" type="radio" checked="checked" value="0" name="delivery_flag">
                                               自提
                                           </label>
                                           <label class="ml20">
                                               <input id="delivery_flag2_label" class="checkradio" type="radio"  value="1" name="delivery_flag">
                                               物流
                                           </label>
                                       </p>-->
                                       <div class="cl"></div>
                            			<!-- <p id="tipStr">
                            			消费者兑换自提商品后，系统将发送一张商品提领卡券至消费者手机。每张卡券将收取{$sendPrice['self']}元卡券下发费用
                            			</p> -->
                                   </li>
                                   <script>
                                       $("#delivery_flag1").click(function(){
                                           $(".GmoreForm").css('display','none');
                                       });
                                       $("#delivery_flag2").click(function(){
                                           $(".GmoreForm").css('display','block');
                                       });
                                   </script>
                               </ul>
                                    <!--<div class="Gbtn-more"><span>更多设置：<i></i></span><p>如果您希望该商品支持到店自提，则需要对相关内容进行设置</p></div>-->
                                    <div class="GmoreForm" style="display:none;">
                                        <ul>
                                            <li class="Gnmae"><span class="red">*</span>&nbsp;可验证门店</li>
                                            <li class="Ginput">
                                                <div class="switch">
                                                    <input type="radio" name="shop" id="shop" value="1" checked="checked" />
                                                    <div class="newRadio">
                                                        <span class="valfirst hover" data-val="1">所有门店</span>
                                                        <span class="vallast" data-val="2" id="selectShop">指定门店</span>
                                                    </div>
                                                    <div class="cl fn"></div>
                                                    <div class="newRadio-input">
                                                        <div class="sweet_tips2" id="htmlss">您总共选择了<span id="number">0</span>家门店&nbsp;&nbsp;<a href="javascript:void(0);" id="editStore"  name="choose_shop">点击查看</a></div>
                                                        <input type="hidden" id="openStores" name="openStores" value=""/>
                                                    </div>
                                                </div>
                                                <p class="txtTips">注：仅限已安装核验终端的门店</p>
                                            </li>
                                        </ul>
                                        <ul class="showSendtype cusMsg dn">
                                    <li class="Gname"><span>*</span>&nbsp;短信内容</li>
                                    <li class="Ginput">
                                        <textarea maxlength="40" name="cusMsg" id="cusMsg"  class="validate[required,maxSize[40]] Gview-cusMsg" placeholder="您收到哈根达斯100元代金券"></textarea>
                                        <span class="maxTips forArea" data-max="40">0/40</span>
                                    </li>
                                </ul>
                                        <ul class="moren sendType">
                                            <li class="Gname"><span>*</span>&nbsp;商品使用说明</li>
                                            <li class="Ginput">
                                                <textarea maxlength="100" name="mms_text"  id="mms_text" class="validate[required,maxSize[100]]" ></textarea>
                                                <img src="__PUBLIC__/Image/prizeConfig_usage.png" class="dn" style="position:absolute; right:160px; bottom:0;"><br />使用说明将显示在短信详情页面

                                            </li>
                                        </ul>
                                        <ul>
                                            <li class="Gname"><span class="red">*</span>&nbsp;打印小票内容</li>
                                            <li class="Ginput">
                                                <textarea name="print_text" id="print_text" class="validate[required,maxSize[100]]"></textarea>
                                                <span class="maxTips forArea" data-max="100">0/100</span>
                                                <span class="txtTips">编辑以上内容，可在消费者自提商品时，在打印小票上添加个性信息。<a href="javascript:void(0)" class="print-show" style="color:#ff971c;">什么是小票内容?</a></span>
                                            </li>
                                         </ul>
                                        <ul id="codeInfo">
                                                <li class="Gname"><span class="red">*</span>&nbsp;商品可兑换时间</li>
                                                <li class="Ginput">
			                                   		<div class="switch">
			                                            <input type="radio" name="verify_time_type" id="verify_time_type1" value="0" checked="checked" />
			                                            <div class="newRadio">
			                                                <span class="valfirst hover" data-val="0" onclick="javascript:$('.judgeCon1').show();$('.judgeCon2').hide();$('#verify_end_date').val('');$('#verify_begin_date').val('');">按日期设置</span>
			                                                <span class="vallast" data-val="1" onclick="javascript:$('.judgeCon2').show();$('.judgeCon1').hide();$('#verify_end_days').val('');$('#verify_begin_days').val('');">按天数设置</span>
			                                            </div>
			                                        </div>
                                                </li>
                                                <li class="Ginput">
                                                        <div class="judgeCon-time judgeCon1">
                                                            <p>使用开始时间</p>
                                                            <input name="verify_begin_date" style="width: 90px;" id="verify_begin_date" type="text" onclick="WdatePicker({minDate:'%y-%M-%d',maxDate:'#F{$dp.$D(\\'verify_end_date\\')}'});" class="validate[condRequired[verify_begin_type1]] textbox w90 ml5" maxlength="8" value="">
                                                            <p class="ml20">使用结束时间</p>
                                                            <input name="verify_end_date" style="width: 90px;" id="verify_end_date" type="text" onclick="WdatePicker({minDate:'#F{$dp.$D(\\'verify_begin_date\\')||\\'%y-%M-%d\\'}'})" class="validate[condRequired[verify_begin_type1]] textbox w90 ml5" maxlength="8" value="">
                                                            <div class="cl pt5"></div>
                                                            <p class="font-12-cc">商户可以自定义验码开始的日期如："4月1号,6月1号";</p>
                                                        </div>
                                                        <div class="judgeCon-time judgeCon2 dn" style="width:auto;">
                                                            <p>发送商品后</p>
                                                            <input name="verify_begin_days" style="width: 90px;" id="verify_begin_days" type="text" class="validate[custom[integer],min[0],condRequired[verify_begin_type2]] textbox w50 ml5" value="">&nbsp;天开始使用
                                                            <p class="ml20">发送商品后</p>
                                                            <input name="verify_end_days" style="width: 90px;" id="verify_end_days" type="text" class="validate[custom[integer],min[0],condRequired[verify_begin_type2]] textbox w50 ml5" value="">&nbsp;天结束使用
                                                            <div class="cl pt5"></div>
                                                            <p class="font-12-cc">商户可以自定义验码时间，如：“发送商品后3天开始使用-发送商品后5天结束使用”</p>
                                                        </div>
                                                </li>
                                        </ul>
                                    </div>
                                <ul class="Gtitle">更多设置</ul>
                                
                                <ul>
                                    <li class="Gname"><span class="red">*</span>&nbsp;商品详情</li>
                                    <li class="Ginput">
                                        <textarea name="wap_info" id="wap_info"    data-view="val,info,previewData" >{$goodsInfoEx.wap_info}</textarea>
                                    </li>
                                </ul>
                               <input type="hidden" value="" name="data_price_info" id="data_price_info" />
                               <input type="hidden" value="" name="data_name_info" id="data_name_info" /> 
                               <input type="hidden" value="" name="count_num" id="count_num" />
                                <input type="hidden" value="" name="line_type" id="line_type" />
                                <ul>
                                    <li class="Gname">&nbsp;</li>
                                    <li class="Ginput">
                                    <a href="javascript:void(0);" class="btn-all w120 sub_button" onclick="addGoods('1')" title="" class="btn-all w110">直接上架</a>
                                    <a href="javascript:void(0);" class="btn-all w120 ml10 sub_button" onclick="addGoods('2')" title="" class="btn-all w110">仅保存至商品库</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        </form>
                    </div>
				</div>
			</div>
            <div class="edit-area dn" id="div_success">
                <div class="fn">
                    <div class="pop-up fn mt40">
                        <dd class="pop-img tc pt40"><img src="__PUBLIC__/Image/Success_icon.png" width="46" height="46" class="mr30" style="vertical-align:middle;">添加成功！</dd>
                        <dd class="pop-hint"></dd>
                        <dd class="pop-btn tc mt40">
                            <a href="{:U('index')}" class="btn-del w110 mr10">返回列表</a>
                            <a class="btn_inner w110 mr10" href="{:U('add')}">继续添加</a>
                        </dd>
                    </div>
                </div>
             </div>
        </div>
     </div>
</div>
<include file="./Home/Tpl/Public/Public_footer.html" />
<div class="integralService"></div>
</body>
</html>
<script>
var newid = 1;
var data = {
	cookiename:"",
	cookielist:"",
	length:function(){
		var l = 0;
		for(var i=0;i<data.namelist.length;i++){
			if(data.namelist[i].list!=""){
				l++;
			}
		}
		if(l==0){l="";}
		return l;
	},
	length2:function(){
		var l = 0;
		for(var i=0;i<data.namelist.length;i++){
			if(data.namelist[i].list!=""){
				l++;
			}
		}
		return l+2;
	},
	length3:function(){
		var l = 0;
		if(data.namelist.length==1){
			l = 0;
		}else if (data.namelist.length==2){
			l = data.namelist[1].list.length;
		}else if (data.namelist.length==3){
			if(data.namelist[2].list.length!=0){
				l = data.namelist[1].list.length*data.namelist[2].list.length;
			}else{
				l = data.namelist[1].list.length;
			}
		}
		if(l==0){l="";}
		return l;
	},
	length4:function(){
		var l = 0;
		if (data.namelist.length==2){
			l = 0;
		}else if (data.namelist.length==3){
			l = data.namelist[2].list.length;
		}
		if(l==0){l="";}
		return l;
	},
	namelist:[],
	price : []
};
//大部分修改预览
$(document).ready(function(e){
	cookie();
	begin(data);
	//输入规则
	$("body").on("change keyup click",".searchInput-edit input[type='text'],.skuRuleAdd input[type='text']",function(e){
		var t = $(this),
			i = t.closest(".input").find(".icon-skuOk"),
			v = t.val(),
			l = t.closest(".input").next("dl"),
			erro = 1;
		v=="" ? i.addClass("erro") : i.removeClass("erro");
		if(e.keyCode != 13){
			l.find("dd:not('.nodata')").each(function(index, element) {
				var text = $(this).text();
				text.indexOf(v)>=0 ? ($(this).removeClass("dn"),erro++) : $(this).addClass("dn");
			});
			erro>=7 ? l.height(200) : l.height(erro*26-26);
			erro==1 ? (l.height(erro*26),l.find(".nodata").removeClass("dn")) : l.find(".nodata").addClass("dn");
		}
		if(e.keyCode == 13){
			i.click();
			return false;
		}
	});
	//设置总库存:检测数值
	$("body").on("change keyup click","input[name='allprice'],input[name='allnum']",function(e){
		var t = $(this),
			i = t.closest("td").find(".icon-skuOk"),
			v = t.val();
		v=="" ? i.addClass("erro") : i.removeClass("erro");
	});
	//设置总库存:确认
	$("body").on("click",".skuOk-allprice:not('.erro'),.skuOk-allnum:not('.erro')",function(e){
		var t = $(this),
			h = t.hasClass("skuOk-allprice"),
			i = t.closest("td").find("input"),
			v = i.val();
		if(h){
			var r = /^[\-\+]?((([0-9]{1,3})([,][0-9]{3})*)|([0-9]+))?([\.]([0-9]+))?$/;
			r = r.test(v);
			if(r){
				$("input[name='price']").val(v);
			}else{
				i.addClass("shopFormBannerAn");
				setTimeout(function(){
					i.removeClass('shopFormBannerAn')
				},1000);
			}
		}else{
			var r = /^[\-\+]?\d+$/;
			r = r.test(v);
			if(r){
				$("input[name='num']").val(v);
                                $('#count_num').val($("input[name='num']").length*v);
				$("#all").text("已设置的总库存为："+$("input[name='num']").length*v+"，不填写库存，则商品库存为不限,总共0处为不限");
			}else{
				i.addClass("shopFormBannerAn");
				setTimeout(function(){
					i.removeClass('shopFormBannerAn')
				},1000);
			}
		}
		t.addClass("erro");
		i.val("");
	});
	//设置总库存:库存总数预览
	$("body").on("change keyup","input[name='num']",function(e){
		var l = 0;
		var t = 0;
		for(var i=0;i<$("input[name='num']").length;i++){
			if($("input[name='num']:eq("+i+")").val()=="" || $("input[name='num']:eq("+i+")").val()=="不限" || $("input[name='num']:eq("+i+")").val()=="-1"){
				t++;
			}else{
				l += parseInt($("input[name='num']:eq("+i+")").val());
			}
		}
                if(t > 0)
                    $('#count_num').val('-1');
                else
                    $('#count_num').val(l);
                //$("#all").text("已设置的总库存为："+l+"，不填写库存，则商品库存为不限,总共"+t+"处为不限");
		$("#all").text("已设置的总库存为："+l+"，不填写库存，则商品库存为不限,总共"+t+"处为不限");
	});
	//下拉菜单:点击dd
	$("body").on("click",".valLsit dd:not('.nodata')",function(e){
		$(".searchInput-edit").hide();
		var t = $(this),
			v = t.text(),
			i = t.closest(".valLsit").prev(".input").find("input"),
			ok = t.closest(".valLsit").prev(".input").find(".icon-skuOk");
			i.val(v);
			ok.removeClass("erro").click();
	});
	//下拉菜单:关闭
	$("body").on("click",".valLsitclose",function(e){
		$(this).closest(".searchInput-edit").hide();
		$(this).closest(".skuRuleAdd").removeClass("edit");
	});
	//修改规则
	$("body").on("click",".searchInput .icon-skuEdit,.searchInput>span",function(e){
		$(".searchInput-edit").hide();
		var t = $(this),
			s = t.closest(".searchInput").find(".searchInput-edit"),
			i = t.closest(".searchInput").find(".searchInput-edit input[type='text']");
			s.show();
			i.focus();
	});
	//规则删除
	$("body").on("click",".icon-skuDel",function(e){
		var t = $(this),
			c = $(this).closest(".skuList"),
			cid = parseInt(c.attr("data-newid"));
		for(var i=0;i<data.namelist.length;i++){
			if(data.namelist[i].newid == cid ){
				data.namelist = data.namelist.slice(0,i).concat(data.namelist.slice(i+1,data.namelist.length))
			}
		}
		begin(data);
	});
	//规则类别删除
	$("body").on("click",".skuRuleItem i",function(e){
		var t = $(this),
			c = $(this).closest(".skuList"),
			s = $(this).closest(".skuRuleItem"),
			cid = parseInt(c.attr("data-newid")),
			sid = parseInt(s.attr("data-newid"));
		for(var i=0;i<data.namelist.length;i++){
			if(data.namelist[i].newid == cid ){
				for(var j=0;j<data.namelist[i].list.length;j++){
					if(data.namelist[i].list[j].newid == sid ){
						data.namelist[i].list = data.namelist[i].list.slice(0,j).concat(data.namelist[i].list.slice(j+1,data.namelist[i].list.length))
					}
				}
			}
		}
		begin(data);
	});
	//规则类别添加
	$("body").on("click",".skuRuleAdd .skuRuleBtn",function(e){
		$(".skuRuleAdd").removeClass("edit");
		$(this).closest(".skuRuleAdd").addClass("edit");
		$(this).closest(".skuRuleAdd").find("input").focus();
	});
	//规则确定
	$("body").on("click",".searchInput-edit .icon-skuOk:not('.erro')",function(e){
		var t = $(this),
			e = t.closest(".searchInput-edit")
			s = t.closest(".searchInput").find("span"),
			i = t.closest(".input").find("input"),
			v = i.val().replace(/\s/,""),
			cid = parseInt($(this).closest(".skuList").attr("data-newid"));
		if(v!=""){
			s.text(v);
			t.addClass("erro");
			i.val("");
			e.find("dl,dd").attr("style","");
		};
		e.hide();
		for(var i=0;i<data.namelist.length;i++){
			if(data.namelist[i].newid == cid ){
				data.namelist[i].name = v
			}
		}
		cookie(v,1);
		begin(data);
	});
	//类别确定
	$("body").on("click",".skuRuleAdd .icon-skuOk:not('.erro')",function(e){
		var t = $(this),
			c = $(this).closest(".skuRuleAdd"),
			i = c.find("input"),
			v = i.val().replace(/\s/,""),
			cid = parseInt($(this).closest(".skuList").attr("data-newid"));
			t.addClass("erro");
			c.removeClass("edit");
			i.val("");

			var pushList = {
				id:"0",
				val:v
			}
			for(var i=0;i<data.namelist.length;i++){
				if(data.namelist[i].newid == cid ){
					data.namelist[i].list.push(pushList)
				}
			}
			cookie(v,2);
			begin(data);
	});
	//添加规则
	$("body").on("click",".addsku",function(e){
		if(data.namelist.length>=3){
			return false;
		}else{
			var pushList = {
				id:"0",
				name:"",
				list:[]
			}
			data.namelist.push(pushList);
			begin(data);
			$(".skuList:last").find(".searchInput .icon-skuEdit").click();
			$(".skuList").each(function(index, element) {
				var z = 10-index;
				$(this).css("z-index",z);
			});
		}
	});
	$("body").on("focus","input[name='price']",function(){
		$("input[name='price']").prev(".formError").remove();
	});
});
function cookie(v,type){
	if(v){var v=v}else{var v="";};
	var cookiename = "颜色,尺寸,尺码,规格,款式,净含量,种类,内存";
	var cookielist = "";
	if(!$.cookie('shopsku')){
		$.cookie('shopsku',cookiename+"||"+cookielist, { expires: 365 });
		cookiename = $.cookie('shopsku').split("||")[0].split(",");
		cookielist = $.cookie('shopsku').split("||")[1].split(",");
		data.cookiename = cookiename;
		data.cookielist = cookielist;
	}else{
		cookiename = $.cookie('shopsku').split("||")[0];
		cookielist = $.cookie('shopsku').split("||")[1];
		if(v){
			if(type==1){
				if(cookiename.indexOf(v)<0){
					cookiename = cookiename + "," + v
				};
			}else{
				if(cookielist.indexOf(v)<0){
					if(cookielist!=""){
						cookielist = cookielist + "," + v;
					}else{
						cookielist = v;
					}
				}
			}
			$.cookie('shopsku',cookiename+"||"+cookielist, { expires: 365 });
		};
		cookiename = $.cookie('shopsku').split("||")[0].split(",");
		cookielist = $.cookie('shopsku').split("||")[1].split(",");
		data.cookiename = cookiename;
		data.cookielist = cookielist;
	};
}
function begin(data){
	if(data.namelist!=""){
		$(".sku1").show();
		$(".sku2").hide();
		for(var i=0;i<data.namelist.length;i++){
			var namelist = data.namelist[i];
			namelist["newid"] = newid;
			newid++;
			if(namelist.list!=""){
				for(var j=0;j<namelist.list.length;j++){
					var list = namelist.list[j];
					list["newid"] = newid;
					newid++;
				}
			}
		}
	}else{
		$(".sku1").hide();
		$(".sku2").show();
	}
	var html = template("skuList",data);
	var html2 = template("skuTable",data);
	$(".skuForm").html(html);
	$(".skuTable").html(html2);
	$(".skuList").each(function(index, element) {
		var z = 10-index;
        $(this).css("z-index",z);
    });
	$("input[name='price']").each(function(index, element) {
		var t = $(this),
			id = t.attr("data-id");
		for(var i=0;i<data.price.length;i++){
			if(data.price[i].id.toString()==id){
				t.val(data.price[i].price);
				data.price[i]["newid"]=t.attr("data-newid");
			}
		}
    });
	$("input[name='num']").each(function(index, element) {
		var t = $(this),
			id = t.attr("data-id");
		for(var i=0;i<data.price.length;i++){
			if(data.price[i].id.toString()==id){
				t.val(data.price[i].num);
			}
		}
    });
	var l = 0;
	var t = 0;
	for(var i=0;i<$("input[name='num']").length;i++){
		if($("input[name='num']:eq("+i+")").val()=="" || $("input[name='num']:eq("+i+")").val()=="不限" || $("input[name='num']:eq("+i+")").val()=="-1"){
			t++;
		}else{
			l += parseInt($("input[name='num']:eq("+i+")").val());
		}
	}
        if(t > 0)
            $('#count_num').val('-1');
        else
            $('#count_num').val(l);
	$("#all").text("已设置的总库存为："+l+"，不填写库存，则商品库存为不限,总共"+t+"处为不限");
	if(data.namelist.length>=3){
		$(".addsku").addClass("hide");
	}else{
		$(".addsku").removeClass("hide");
	}
}
</script>

<script id="skuList" type="text/html">
{{each namelist}}
<div class="skuList" data-id="{{value.id}}" data-newid="{{value.newid}}">
	<div class="skuListHead fn">
		<i class="icon-skuDel r"><a href="javascript:void(0)" class="a-hide">删除</a></i>
		<div class="searchInput">
			<span data-id="{{value.id}}" data-newid="{{value.newid}}">{{value.name}}</span>
			<i class="icon-skuEdit">
				<a href="javascript:void(0)" class="a-hide">修改</a>
			</i>
			<div class="searchInput-edit dn">
				<div class="input">
				<input type="text" maxlength="6">
					<i class="icon-skuOk erro">
						<a href="javascript:void(0)" class="a-hide">修改</a>
					</i>
				</div>
				<dl class="valLsit">
					{{each cookiename}}
					<dd>{{value}}</dd>
					{{/each}}
					<dd class="nodata dn">"回车"创建临时规格</dd>
				</dl>
				<div class="valLsitclose"></div>
			</div>
		</div>
	</div>
	<div class="skuCon fn">
		<div class="skuRule">
			{{each value.list}}
			<div class="skuRuleItem" data-id="{{value.id}}" data-newid="{{value.newid}}">{{value.val}}<i></i></div>
			{{/each}}
			<div class="skuRuleAdd">
				<div class="input">
                                    <input type="text" maxlength="8">
					<i class="icon-skuOk erro">
						<a href="javascript:void(0)" class="a-hide">修改</a>
					</i>
				</div>
				<dl class="valLsit">
					{{each cookielist}}
					<dd>{{value}}</dd>
					{{/each}}
					<dd class="nodata dn">"回车"创建临时类别</dd>
				</dl>
				<div class="valLsitclose"></div>
				<div class="skuRuleBtn">
					<i></i>添加类型
				</div>
			</div>
		</div>
	</div>
</div>
{{/each}}
<div class="addsku">
	<i></i>
	<span>添加规格</span>
</div>
</script>

<script id="skuRuleItem" type="text/html">
<div class="skuRuleItem">{{name}}<i></i></div>
</script>

<script id="skuTable" type="text/html">
{{if namelist.length >= 1 && namelist[0].list!="" }}
<table cellpadding="0" cellspacing="0" class="sku-table">
	<tr>
	{{each namelist}}
		{{if value.list!=""}}<th data-id="{{value.id}}" data-newid="{{value.newid}}">{{value.name}}</th>{{/if}}
	{{/each}}
		<th width="123" >{:L('INTEGRAL_NAME')}</th>
		<th width="123" >商品总数</th>
	</tr>
	<tr>
		<td colspan="{{length}}" class="top">批量设置</td>
		<td class="top"><input type="text" name="allprice" /><i class="icon-skuOk skuOk-allprice erro"><a href="javascript:void(0)" class="a-hide">确定</a></i></td>
		<td class="top"><input type="text" name="allnum" placeholder="请输入数字" /><i class="icon-skuOk skuOk-allnum erro"><a href="javascript:void(0)" class="a-hide">确定</a></i></td>
	</tr>
	
	{{if namelist.length == 1}}
	{{if namelist[0].list!=""}}
		{{each namelist[0].list as value j}}
		<tr>
			<td rowspan="{{length3}}" data-id="{{value.id}}" data-newid="{{value.newid}}">{{value.val}}</td>
			<td><input type="text" name="price" class="validate[required,custom[number],min[0]]" data-id="{{value.id}}"  data-newid="{{value.newid}}" /></td>
			<td><input type="text" name="num" class="validate[custom[number],max[99999]]" data-id="{{value.id}}"  data-newid="{{value.newid}}" /></td>
		</tr>
		{{/each}}
	{{/if}}
	{{/if}}
	
	{{if namelist.length == 2}}
	{{if namelist[0].list!=""}}
		{{each namelist[0].list as value j}}
		<tr>
			<td rowspan="{{length3}}" data-id="{{value.id}}" data-newid="{{value.newid}}">{{value.val}}</td>
			{{if namelist[1].list!=""}}
				{{each namelist[1].list as value1 j}}
					<td rowspan="{{length4}}" data-id="{{value1.id}}" data-newid="{{value1.newid}}">{{value1.val}}</td>
					<td><input type="text" name="price" class="validate[required,custom[number],min[0]]" data-id="{{value.id}},{{value1.id}}"  data-newid="{{value.newid}},{{value1.newid}}" /></td>
					<td><input type="text" name="num" class="validate[custom[number],max[99999]]" data-id="{{value.id}},{{value1.id}}"  data-newid="{{value.newid}},{{value1.newid}}" /></td>
					</tr>
				{{/each}}
			{{else}}
				<td><input type="text" name="price" class="validate[required,custom[number],min[0]]" data-id="{{value.id}}"  data-newid="{{value.newid}}" /></td>
				<td><input type="text" name="num" class="validate[custom[number],max[99999]]" data-id="{{value.id}}"  data-newid="{{value.newid}}" /></td>
				</tr>
			{{/if}}
		{{/each}}
	{{else if namelist[1].list!=""}}
		{{each namelist[1].list as value1 j}}
			<td rowspan="{{length4}}" data-id="{{value1.id}}" data-newid="{{value1.newid}}">{{value1.val}}</td>
			<td><input type="text" name="price" class="validate[required,custom[number],min[0]]" data-id="{{value1.id}}"  data-newid="{{value1.newid}}" /></td>
			<td><input type="text" name="num" class="validate[custom[number],max[99999]]" data-id="{{value1.id}}"  data-newid="{{value1.newid}}" /></td>
			</tr>
		{{/each}}
	{{/if}}
	{{/if}}
	
	{{if namelist.length == 3}}
	{{if namelist[0].list!=""}}
		{{each namelist[0].list as value j}}
		<tr>
			<td rowspan="{{length3}}" data-id="{{value.id}}" data-newid="{{value.newid}}">{{value.val}}</td>
			{{if namelist[1].list!=""}}
				{{each namelist[1].list as value1 j}}
					<td rowspan="{{length4}}" data-id="{{value1.id}}" data-newid="{{value1.newid}}">{{value1.val}}</td>
					{{if namelist[2].list!=""}}
						{{each namelist[2].list as value2 j}}
							<td data-id="{{value2.id}}" data-newid="{{value2.newid}}">{{value2.val}}</td>
							<td><input type="text" name="price" class="validate[required,custom[number],min[0]]" data-id="{{value.id}},{{value1.id}},{{value2.id}}"  data-newid="{{value.newid}},{{value1.newid}},{{value2.newid}}" /></td>
							<td><input type="text" name="num" class="validate[custom[number],max[99999]]" data-id="{{value.id}},{{value1.id}},{{value2.id}}"  data-newid="{{value.newid}},{{value1.newid}},{{value2.newid}}" /></td>
							</tr>
						{{/each}}
					{{else}}
						<td><input type="text" name="price" class="validate[required,custom[number],min[0]]" data-id="{{value.id}},{{value1.id}}"  data-newid="{{value.newid}},{{value1.newid}}" /></td>
						<td><input type="text" name="num" class="validate[custom[number],max[99999]]" data-id="{{value.id}},{{value1.id}}"  data-newid="{{value.newid}},{{value1.newid}}" /></td>
						</tr>
					{{/if}}
				{{/each}}
			{{else if namelist[2].list!=""}}
				{{each namelist[2].list as value2 j}}
					<td rowspan="{{length4}}" data-id="{{value2.id}}" data-newid="{{value2.newid}}">{{value2.val}}</td>
					<td><input type="text" name="price" class="validate[required,custom[number],min[0]]" data-id="{{value.id}},{{value2.id}}"  data-newid="{{value.newid}},{{value2.newid}}" /></td>
					<td><input type="text" name="num" class="validate[custom[number],max[99999]]" data-id="{{value.id}},{{value2.id}}"  data-newid="{{value.newid}},{{value2.newid}}" /></td>
					</tr>
				{{/each}}
			{{else}}
				<td><input type="text" name="price" class="validate[required,custom[number],min[0]]" data-id="{{value.id}}"  data-newid="{{value.newid}}" /></td>
				<td><input type="text" name="num" class="validate[custom[number],max[99999]]" data-id="{{value.id}}"  data-newid="{{value.newid}}" /></td>
				</tr>
			{{/if}}
		{{/each}}
	{{else if namelist[1].list!=""}}
		{{each namelist[1].list as value1 j}}
			<td rowspan="{{length4}}" data-id="{{value1.id}}" data-newid="{{value1.newid}}">{{value1.val}}</td>
			{{if namelist[2].list!=""}}
				{{each namelist[2].list as value2 j}}
					<td data-id="{{value2.id}}" data-newid="{{value2.newid}}">{{value2.val}}</td>
					<td><input type="text" name="price" class="validate[required,custom[number],min[0]]" data-id="{{value1.id}},{{value2.id}}"  data-newid="{{value1.newid}},{{value2.newid}}" /></td>
					<td><input type="text" name="num" class="validate[custom[number],max[99999]]" data-id="{{value1.id}},{{value2.id}}"  data-newid="{{value1.newid}},{{value2.newid}}" /></td>
					</tr>
				{{/each}}
			{{else}}
				<td><input type="text" name="price" class="validate[required,custom[number],min[0]]" data-id="{{value1.id}}"  data-newid="{{value1.newid}}" /></td>
				<td><input type="text" name="num" class="validate[custom[number],max[99999]]" data-id="{{value1.id}}"  data-newid="{{value1.newid}}" /></td>
				</tr>
			{{/if}}
		{{/each}}
	{{else if namelist[2].list!=""}}
		{{each namelist[2].list as value2 j}}
			<td data-id="{{value2.id}}" data-newid="{{value2.newid}}">{{value2.val}}</td>
			<td><input type="text" name="price" class="validate[required,custom[number],min[0]]" data-id="{{value2.id}}"  data-newid="{{value2.newid}}" /></td>
			<td><input type="text" name="num" class="validate[custom[number],max[99999]]" data-id="{{value2.id}}"  data-newid="{{value2.newid}}" /></td>
			</tr>
		{{/each}}
	{{/if}}
	{{/if}}
	<tr>
		<td colspan="{{length2}}" id="all">{{allnum}}</span></td>
	</tr>
</table>
{{/if}}
</script>
<script>
    $(".new-btn").click(function(){
        var html=[
            '<form method="post" action="">',
            '<div class="addlist-con">',
            '<div class="fn">',
            '<p class="l"><span class="red">*</span>分类名称</p><div><input type="text" name="new_classifyName" id="new_classifyName" class="shoplist-input" maxlength="8"/></div>',
            '</div>',
            '<div class="fn mt20">',
            // '<p class="l">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*排序:</p><div><input type="text" name="new_classifySort" id="new_classifySort" class="shoplist-input w50" value="'+length+'" /></div>',
            '</div>',
            '</div>',
            '</form>'].join('');

        art.dialog({
            title: '添加分类',
            id: 'new_classify',
            content: html,
            fixed:true,
            lock:true,
            width:240,
            okVal: '确认',
            ok: function () {
                var dialog;
                dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
                var req_data = {
                    name: $('#new_classifyName').val()
                }
                $.post("{:U('Integral/FenLei/classAdd')}", req_data, function(data){
                    if(data.status == '1'){
                        dialog.time(1).content("<div class='msg-all-succeed'>"+data.info+"</div>");
                        $('#classify').append('<option value="'+data.id+'">'+$('#new_classifyName').val()+'</option>').val(data.id);
                        setTimeout(function(){
                            art.dialog.list['new_classify'].close();
                        }, 1000);
                    }
                    else{
                        dialog.time(2).content("<div class='msg-all-error'>"+data.info+"</div>");
                    }
                }, 'json');
                return false;
            },
            cancel: true
        });
    })
    function uploadImg(cropPresets,callback) {
        var opt = {
            cropPresets:cropPresets,
            callback:callback
        };
        open_img_uploader(opt);
		
		
    }
    /*获取图片路径中的图片名*/
    function base_name(url){
        var urlList = url.split('/');
        var a = urlList[urlList.length-1];
        return a;
    }

    function cb_img_1(data){cb_img(1, data); }
    function cb_img_2(data){cb_img(2, data); }
    function cb_img_3(data){cb_img(3, data); }
    function cb_img_4(data){cb_img(4, data); }
    function cb_img_5(data){cb_img(5, data); }
    function cb_img(n, data){
        //填充缩略图
        $('#show'+n).attr('src', data.src).show();
        //上传用
        $('#resp_img'+n).val(data.savename);
    }
    var _check_class_arr = {
        goods_id : 'validate[required]'
        ,begin_date : 'validate[required,funcCall[fc_begin_date]]'
        ,end_date : 'validate[required,funcCall[fc_end_date]]'
        ,batch_amt : 'validate[required,custom[number],min[0],required]'
        ,market_price : 'validate[required,custom[number],min[0],required]'
        // ,storage_num : 'validate[required,custom[number],min[0],condRequired[storage_type]]'
        ,day_buy_num : 'validate[required,custom[number],min[0],condRequired[day_buy_num_flag]]'
        ,person_buy_num : 'validate[required,custom[number],min[0],condRequired[person_buy_num_flag]]'
        ,goods_desc : 'validate[required,maxSize[200]]'
        ,wap_info : 'validate[required]'
    };
    var _codeInfo_check_class_arr = {
        mms_title : 'validate[required,maxSize[10],condRequired[delivery_flag1]]'
        ,mms_info : 'validate[required,maxSize[100],condRequired[delivery_flag1]]'
        ,verify_begin_date : 'validate[condRequired[verify_time_type1]]'
        ,verify_end_date : 'validate[condRequired[verify_time_type1]]'
        ,verify_begin_days : 'validate[condRequired[verify_time_type2]]'
        ,verify_end_days : 'validate[condRequired[verify_time_type2]]'
    };
    function _setformcheck(){
        for(d in _check_class_arr)
            $('#'+d).addClass(_check_class_arr[d]);
    }
    function subform(ue){
        var dialog;
        var type = $("input[name='type']:checked").val();
        if($("#theform").validationEngine('validate')){
            if(!ue.getContent()){
                $('#wap_tip').validationEngine('showPrompt', '不能为空','error','topRight',true);
                return false;
            }else{
                $('#wap_tip').validationEngine('hide');
            }
            //取得sku价格表
            var sellprice = [];
            $(".skuTable [name='price']").each(function(index, element) {
                var p = $(this).val();
                var nid = $(this).attr("data-id");
                var n = $(this).closest("tr").find("[name='num']").val();
                var sp = $(this).closest("tr").find("[name='price']").val();
                var arr = {
                    newid:nid,
                    price:sp,
                    num:n
                };
                sellprice.push(arr);
            });
            data["price"] = sellprice;
            $('#data_price_info').val(JSON.stringify( data.price ));
            $('#rgoods_ids').val(cb_rgoodsinit().join(','));
            $("#theform").ajaxSubmit({
                beforeSubmit:function(){
                    dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
                },
                success:function(data){
                    if(data.status == '1'){
                        all_art_close();
                        $('#div_content').hide();
                        $('#div_success').show();
                        windowheight();
                        return false;
                    }else{
                        dialog.time(5).content("<div class='msg-all-error'>"+data.info+"</div>");
                    }
                },
                dataType:'json'
            });
            return false;
        }
    }
    $(document).ready(function(e) {
//        _setformcheck();
        var ue = UE.getEditor('wap_info', {
            imageUrl: "{:U('LabelAdmin/Upfile/editoImageSave')}",
            imagePath: "__UPLOAD__",
            catcherUrl: "{:U('LabelAdmin/Upfile/getRemoteImage')}",
            catcherPath: "__UPLOAD__",
            initialFrameWidth: 340,
            initialFrameHeight: 280,
            autoFloatEnabled: false
        });


        //预览用
        $("#btn_preview").click(function () {

            if (!$("#theform").validationEngine('validate'))
                return false;

            ue.sync();
            if (!ue.getContent()) {
                $('#wap_tip').validationEngine('showPrompt', '不能为空', 'error', 'topRight', true);
                return false;
            } else {
                $('#wap_tip').validationEngine('hide');
            }

            art.dialog.open("{:U('putOnPreview')}", {
                title: false,
                lock: true,
                padding: "0 0 0 2px",
                fixed: true,
                width: "350px",
                height: "625px",
                cancel: true,
                ok: function () {
                    //手动提交需要手动同步编辑器数据
                    ue.sync();
                    subform(ue);
                    return false;
                }
            });
        })

        $('#smb').click(function () {
            //手动提交需要手动同步编辑器数据
            ue.sync();
            subform(ue);
        });
    });
</script>
<script>
function cjSendtype(t){
    var val = t.attr("data-val");
    if(val=="0"){
        $(".sendType").show();
		$(".shortMsgImg").css("display","block");
    }
    if(val=="1"){
        $(".sendType").hide();
		$(".shortMsgImg").css("display","none");
    }
}
$(function(){
    $("#shortMsg_config").focus(function(){
        $(this).next().removeClass("dn");
    })
    $("#shortMsg_config").blur(function(){
        $(this).next().addClass("dn");
    })

    $("#mms_text").focus(function(){
        $(this).next().removeClass("dn");
    })
    $("#mms_text").blur(function(){
        $(this).next().addClass("dn");
    })
})
</script>