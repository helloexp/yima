<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>中国石油广西销售商家注册</title>
    <meta name="Keywords" content="{:C('SITE_KEYWORDS')}" />
    <link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/Wshop.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/Wgxsy.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css?v=__VR__" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine-zh_CN.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/citycode.js?v=__VR__"></script>
    <style type="text/css">
    .link a {
        color: #666666;
    }
    
    .main-name h5 {
        line-height: 22px;
        margin-bottom: 15px;
        font-size: 16px;
        color: #595959;
    }
    
    .main-name h5 i {
        width: 22px;
        height: 22px;
        margin-right: 8px;
        vertical-align: bottom;
        background: url(__PUBLIC__/Image/Whdm/icon-hdm.png) -14px -14px no-repeat;
    }
    
    .subcon .limitBox p {
        width: 100%;
        float: left;
        font-size: 14px;
        line-height: 20px;
        color: #a3a3a3;
        padding: 0;
        margin: 4px 0 15px 0;
    }
    
    .subcon .tbtn.btn-red {
        margin: 2px 15px 0 15px;
        border: 1px #ed3f41 solid;
        background: #ed3f41;
    }
    
    .subcon .limitBox .tabs {
        line-height: 26px;
        border: 1px #cccccc solid;
        float: left;
    }
    
    .subcon .tabs .tabList {
        padding: 5px 11px;
        margin: 0;
        line-height: 18px;
        background: #ffffff;
        color: #6e6e6e;
        cursor: pointer;
    }
    
    .subcon .tabs .tabList.active {
        background: #ff8a00;
        color: #ffffff;
    }
    
    .subcon .tabList.active:after {
        display: none;
    }
    
    .subcon .classify {
        border: solid 1px #e3e2e2;
        border-top: solid 0px #e3e2e2;
    }
    
    .subcon .classify li {
        text-align: center;
        background: #eeeeee;
        border-top: solid 1px #e3e2e2;
    }
    
    .subcon .classify li .list {
        height: 40px;
    }
    
    .subcon .classify li .list span {
        display: inline-block;
        width: 30%;
        font-size: 14px;
        line-height: 38px;
    }
    
    .subcon .classify li .last a {
        margin-right: 10px;
    }
    
    .subcon .classify li .list i.downArrow {
        cursor: pointer;
        font-size: 16px;
        width: 0;
        height: 0;
        margin-left: 10px;
        border-left: 6px transparent solid;
        border-right: 6px transparent solid;
        border-top: 6px transparent solid;
        border-top-color: #afafaf;
    }
    
    .subcon .classify li .list.level-1 {
        background: #f7f7f7;
    }
    
    .subcon .classify li .list.level-1 .js_orderdetail {
        color: #b2b2b2;
        pointer-events: none;
        cursor: no-drop;
    }
    
    .subcon .classify li .list.level-2 {
        /* display: none;*/
        background: #ffffff;
    }
    
    .subcon .classify li .list.level-2 .tbtn.btn-add {
        background: #c8cace;
        pointer-events: none;
        border-color: #c8cace;
    }
    
    .subcon .classify li .list.level-2 .js_orderdetail {
        color: #3d86ba;
        pointer-events: auto;
        cursor: pointer;
    }
    
    .subcon .classify li i.downArrow.active {
        -webkit-transform: rotate(180deg);
        -ms-transform: rotate(180deg);
        -o-transform: rotate(180deg);
        transform: rotate(180deg);
    }
    
    .subcon .classify li .active.level-2 {
        display: none;
    }
    
    .subcon .Gname span {
        color: #ed3f41;
    }
    </style>
    <style>
    .correct {
        visibility: hidden;
        margin-right: 20px;
        color: #51dc14;
        font-size: 20px;
        font-weight: bold;
    }
    </style>
    <script type="text/javascript">
    String.prototype.getBytes = function() {
        var cArr = this.match(/[^\x00-\xff]/ig);
        return this.length + (cArr == null ? 0 : cArr.length);
    }
    </script>
    <script type="text/javascript">
    $(function() {
        //省市区初始化
	CityCode({
		province:$("#province_code"),//省
		city:$("#city_code"),//市
		town:$("#town_code"),//区
		business:$("#business_code"),//商圈
		selected:"21{:$info['city_code'].$info['town_code'].$info['business_code']}",//默认选中的省市区代号
		url:"{:U('LabelAdmin/AjaxCity/index')}"//数据查询页
	});
        
        $("#parent_id").change(function() {
            loadCatalog($("#parent_id option:selected").val());
        });

        function loadCatalog(parentid) {
            $.ajax({
                url: "{:U('Integral/FenLei/AjaxCatalog')}&parent_id=" + parentid,
                type: 'POST',
                dataType: 'JSON',
                timeout: 5000,
                error: function() {
                    alert('Error loading data!');
                },
                success: function(msg) {
                    $("#catalog_id").empty();
                    $("<option value=''>请选择</option>").appendTo($("#catalog_id"));
                    $.each(eval(msg), function(i, item) {
                        $("<option value='" + item.id + "'>" + item.catalog_name + "</option>").appendTo($("#catalog_id"));
                    });
                }
            });
        }
    })
    </script>
</head>

<body>
    <div id="wrapper" class="login-bg">
        <div id="headerTwo" style="z-index: 999">
            <include file="Login:loginHeader" />
            <!--开始载入头部菜单-->
            <include file="./Home/Tpl/Ecshop/Shop_nav.html" navmenuid="Navshop" />
        </div>
        <div id="container" class="bgfff">
            <div id="main">
                <!--开始引入左菜单-->
                <div class="sidenav">
                    <include file="./Home/Tpl/Ecshop/Shop_menu.html" leftmenuid="shlb" />
                </div>
                <div class="subcon fn">
                    <div class="main-name fn" style="padding-top: 50px;">
                        <h4>新增商户</h4>
                        <form id="regform" action="{:U('Integral/FenLei/nodeadd')}" method="POST" name="regform" onkeydown="if (event.keyCode == 13) {return false;}">
                            <input type="hidden" name="nodeok" id="nodeok" value="" />
                            <div class="Gform">
                                <div class="steps">商户信息</div>
                                <ul>
                                    <li class="Gname"><span>*&nbsp;</span>商户名称</li>
                                    <li class="Ginput reg-item-tip">
                                        <input type="text" class="textbox validate[required,ajax[ajaxCheckCompanyName]]" maxlength="30" placeholder="请填写营业执照上的名称" name="merchant_name" id="merchant_name" value="<?php if($_SESSION['merchant_name']!=''){?><?php echo $_SESSION['merchant_name'];?><?php }?>" /><span class="maxTips forInput" data-max="30">0/30</span><span class="correct">√</span>
                                        <p>商户认证信息</p>
                                    </li>
                                </ul>
                                <ul>
                                    <li class="Gname"><span>*&nbsp;</span>商户简称</li>
                                    <li class="Ginput reg-item-tip">
                                        <input type="text" class="textbox validate[required]" maxlength="20" placeholder="请填写商户简称" name="merchant_short_name" data-rel="" id="merchant_short_name" value="<?php if($_SESSION['merchant_short_name']!=''){?><?php echo $_SESSION['merchant_short_name'];?><?php }?>" /><span class="maxTips forInput" data-max="20">0/20</span><span class="correct">√</span>
                                        <p>商户简称为显示在中国石油广西销售前端信息</p>
                                    </li>
                                </ul>
                                <ul>
                                    <li class="Gname"><span>*&nbsp;</span>商户图片</li>
                                    <li class="Ginput reg-item-tip">
                                        <a href="javascript:void(0);" title="上传" class="btn btn_primary" onclick="log_add()" style="vertical-align:top;">上传</a>
                                        <br/>
                                        <img id="img_logo_show" src="" style="margin-left: 10px;" />
                                        <input type="hidden" name="image_link" id="image_link" vale="" />
                                        <script>
                                        function log_add() {
                                            var opt = {
                                                obj: $("#img_resp_show"),
                                                height: 160,
                                                width: 160,
                                                cropPresets: false,
                                                callback: function(data) {
                                                    $('#img_logo_show').attr('src', data['src']);
                                                    $('#img_logo_show').show();
                                                    $('#image_link').val(data['savename']);
                                                }
                                            };
                                            open_img_uploader(opt);
                                        }
                                        </script>
                                    </li>
                                </ul>
                                <ul>
                                    <li class="Gname"><span>*&nbsp;</span>所属分类</li>
                                    <li class="Ginput reg-item-tip">
                                        <select name="parent_id" id="parent_id" class="validate[required]">
                                            <option value="">请选择</option>
                                            <php>
                                                $parentArr = array_valtokey($parentInfo,'id','catalog_name');
                                            </php>
                                            {:show_arr_opt($parentArr,$_SESSION['parent_id'])}
                                        </select>
                                        <select name="catalog_id" id="catalog_id" class="catalog_id validate[required]">
                                            <option value="">请选择</option>
                                        </select>
                                    </li>
                                </ul>
                                <ul>
                                    <li class="Gname"><span>*&nbsp;</span>门店所属区域：</li>
                                    <li class="Ginput reg-item-tip">
                                        <select class=" validate[required] dn " name="province_code" id="province_code" disabled="disabled">
                                            <option value="">选择省</option>
                                        </select>
                                        <select class="validate[required] selectbox ml10" name="city_code" id="city_code">
                                            <option value="">选择市</option>
                                        </select>
                                        <select class="validate[required] selectbox ml10" style="width:101px;"name="town_code" id="town_code">
                                            <option value="">选择区</option>
                                        </select>
                                    </li>
                                </ul>
                                <ul>
                                    <li class="Gname"><span>*&nbsp;</span>门店详细地址：</li>
                                    <li class="Ginput reg-item-tip"><input name="address" id="address" type="text" onkeyup="check_lenght(50,'name_text',this);" class="validate[required,maxSize[50]] textbox w380" placeholder="指引消费者到店，如“昌平路653号”"/>
                                    <!--<p class="font-12-cc" style="font-size:12px;">用于指引消费者到店,需填写门店详细地址，精确到门牌号，如“昌平路653号”</p>-->
                                    </li>
                                </ul>
                                <ul>
                                    <li class="Gname"><span>*&nbsp;</span>服务热线</li>
                                    <li class="Ginput reg-item-tip">
                                        <input type="text" class="textbox validate[required,custom[phone]]" maxlength="12" placeholder="请填写正确的号码" name="hot_line_tel" id="hot_line_tel" data-rel="" value="<?php if($_SESSION['hot_line_tel']!=''){?><?php echo $_SESSION['hot_line_tel'];?><?php }?>" />
                                        <p>格式：13945698521 座机：021-45216352</p>
                                    </li>
                                </ul>
                                <ul>
                                    <li class="Gname"><span>*&nbsp;</span>负责人</li>
                                    <li class="Ginput reg-item-tip">
                                        <input name="contact_name" id="contact_name" class="textbox validate[required]" type="text" maxlength="20" placeholder="请填写负责人的姓名" value="<?php if($_SESSION['contact_name']!=''){?><?php echo $_SESSION['contact_name'];?><?php }?>" data-rel="" /><span class="correct">√</span>
                                    </li>
                                </ul>
                                <ul>
                                    <li class="Gname"><span>*&nbsp;</span>手机号码</li>
                                    <li class="Ginput reg-item-tip">
                                        <input name="contact_phone" id="contact_phone" type="tel" maxlength="11" placeholder="请填写正确的手机号码" class="textbox validate[required,custom[phone]]" value="<?php if($_SESSION['mobile']!=''){?><?php echo $_SESSION['mobile'];?><?php }?>" data-rel="" />
                                    </li>
                                </ul>
                                <ul>
                                    <li class="Gname"><span>*&nbsp;</span>商户简介</li>
                                    <li class="Ginput reg-item-tip">
                                        <textarea class="textbox validate[required,minSize[1]]" maxlength="200" placeholder="&nbsp;字数限制200字" name="description" data-rel=""></textarea>
                                        <!--<span class="maxTips forInput" data-max="200">0/200</span>-->
                                    </li>
                                </ul>
                            </div>
                            <!-- 注册信息结束 -->
                            <div class="Gform">
                                <ul>
                                    <li class="Ginput" style="padding: 0 0 0 150px; width: 280px;">
                                        <input type="button" value="注册" id="sub_button" class="btn btn_primary" />
                                        <input type="reset" value="取消" class="btn btn_del ml15" />
                                    </li>
                                </ul>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <include file="./Home/Tpl/Public/Public_footer.html" />
        <include file="Public:login" />
    </div>
</body>

</html>
<script>
$(document).ready(function() {

    $.validationEngineLanguage.allRules['ajaxCheckCompanyName'] = {
        "url": "{:U('Integral/FenLei/queryName')}",
        "alertText": "此商户名称已存在！"
    };
    $('#regform').validationEngine({
        promptPosition: "topLeft:30,0",
    });

    $('input,select').bind('jqv.field.result', function(event, field, isError, promptText) {
        if (!isError) {
            $(this).parent().parent().find('.reg-item-tip .correct').css('visibility', 'visible');
            if ($(field).attr('id') == 'parent_id') {
                if (!$('#catalog_id').val()) {
                    $(this).parent().parent().find('.reg-item-tip .correct').css('visibility', 'hidden');
                }
            }
            if ($(field).attr('id') == 'catalog_id') {
                if (!$('#parent_id').val()) {
                    $(this).parent().parent().find('.reg-item-tip .correct').css('visibility', 'hidden');
                }
            }
        } else {
            $(this).parent().parent().find('.reg-item-tip .correct').css('visibility', 'hidden');
        }
    });
});
</script>
<script>
$(function() {
    $form = $("#regform");
    $('#sub_button').click(function() {
        var user_name = $("input[name=user_name]").val();

        var nodeisok = $('#nodeok').val();

        var node_name = $("#merchant_name").val();
        var contact_name = $("#contact_name").val();
        var contact_phone = $("#contact_phone").val();



        if (node_name == "") {
            alert("商户名称不能为空！");
            return false;
        }
        if (contact_name == "") {
            alert("负责人不能为空！");
            return false;
        }
        if (contact_phone == "") {
            alert("手机不能为空！");
            return false;
        }
        var text = /^1\d{10}$/;
        if (!text.test(contact_phone)) {
            alert("手机号只能输入11位数字");
            return false;
        }
        if (node_name.getBytes() < 6) {
            alert("商户名称不能小于6字节或三个汉字");
            return false;
        }
        if (contact_name.getBytes() < 2) {
            alert("负责人姓名不能小于2字节或一个汉字");
            return false;
        }


        var dialog, btn = $(this);
        if ($form.validationEngine('validate')) {
            btn.attr('disabled', 'disabled');
            $form.ajaxSubmit({
                beforeSubmit: function() {
                    dialog = art.dialog({
                        title: false,
                        content: "<div class='msg-all-succeed'>正在提交...</div>",
                        fixed: true,
                        padding: 0
                    });
                },
                success: function(data) {
                    btn.removeAttr('disabled');
                    if (data.status == '1') {
                        dialog.time(2).content("<div class='msg-all-succeed'>" + data.info + "</div>");
                        window.location.href = "{:U('Integral/FenLei/index')}";
                    } else {
                        dialog.time(5).content("<div class='msg-all-error'>" + data.info + "</div>");
                    }
                },
                dataType: 'json'
            });
            return false;
        }
    });
});
</script>
