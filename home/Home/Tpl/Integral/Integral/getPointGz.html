<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>{:L('INTEGRAL_NAME')}获取规则</title>
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wshop.css?v=__VR__" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC_LOCAL__/Js/My97DatePicker/WdatePicker.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<style type="text/css">
	.W-table td { background: #ffffff;}
	.W-table tr.active td span { color: #ed3f41; font-weight: bold;}
	.W-table tr td.textLeft { text-align: left; padding: 15px;}
	.W-table tbody tr td { background: #f7f7f7;}
	.W-table tbody tr.bgfff td { background: #ffffff;}
    table.W-table td a { margin: 0;}
    .addlist-con p {
        margin-right: 5px;
    }
    .Diacheck { padding-left: 40px; background: url(__PUBLIC__/Image/sips_ans.png) no-repeat left 5px;}
</style>
<script>
$(document).ready(function(e){
	$("#sub_button").click(function(){
        $("#theform").submit();
    });
//  $(".shopTable tbody tr:odd").addClass("bgf7f7f7");
});
</script>
</head>

<body class="bgfff">
<div id="wrapper">
        <include file="./Home/Tpl/Public/Public_header.html" />
        <div id="container" class="bgfff">
            <div id="main" class="rel">
                <div class="new_sidenav">
                    <include file="./Home/Tpl/Integral/Integral/Store_sidenav.html" leftmenuid="jfgz"/>
                </div>
                <div id="div_content" class="subcon fn">
				<div class="shopCon">
                	<div class="main-name fn">
                        <h4>{:L('INTEGRAL_NAME')}获取规则</h4>
                    </div>
                <div class="fn">
                    <table cellpadding="0" cellspacing="0" class="W-table">
                        <thead>
                        <tr class="th" style="border-bottom: solid 1px #e3e2e2;">
                            <th class="first" width="20%">条件</th>
                            <th width="35%">详述</th>
                            <th>获取{:L('INTEGRAL_NAME')}</th>
                            <th>单次获取上限</th>
                            <th>状态</th>
                            <th class="last">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr class="<php>if($list['shop_online_flag']=='1'){echo 'active bgfff';}</php>">
                            <td class="first">在线商城购物支付1元</td>
                            <td class="textLeft">消费者通过旺财小店或单品销售下单购物并支付成功，每支付1元即获取对应{:L('INTEGRAL_NAME')}。</td>
                            <td><span>{$list.shop_online_rate}</span></td>
                            <php>if($list['one_online_rate_flag'] =='1'){</php>
                            <td><span>{$list.one_online_rate}</span></td>
                            <php>}else{</php>
                            <td><span>不限</span></td>
                            <php>}</php>
                            <php>if($list['shop_online_flag']=='1'){</php>
                            <td><span>执行中</span></td>
                            <php>}else{</php>
                            <td><span>未执行</span></td>
                            <php>}</php>
                            <td class="last">
                                <php>if($list['shop_online_flag']=='1'){</php>
                                    <a href="javascript:void(0);" onclick="integralChangeStatus('0','1');">&nbsp;停用</a>
                                <php>}elseif($list['shop_online_rate']!='' || $list['one_online_rate_flag']!='0' || $list['one_online_rate']!=''){</php>
                                    <a href="javascript:void(0);" onclick="integralChangeStatus('1','1');">&nbsp;启用</a>
                                <php>}</php>
                                
                                <a href="javascript:void(0);" onclick="integralPointEdit('1','{$list.shop_online_rate}','{$list.one_online_rate}','{$list.one_online_rate_flag}');">&nbsp;编辑</a>
                                 <!--<a href="javascript:void(0);" onclick="integralEdit('1','{$list.shop_online_rate}','{$list.one_online_rate}');">&nbsp;编辑</a>-->
                            </td>
                        </tr>
                        <tr class="<php>if($list['shop_line_flag']=='1'){echo 'active bgfff';}</php>">
                            <td class="first">线下消费1元</td>
                            <td class="textLeft">消费者在门店消费并提供手机号码，店员在终端输入消费金额后，每消费1元即获取对应{:L('INTEGRAL_NAME')}。</td>
                            <td><span>{$list.shop_line_rate}</span></td>
                            <php>if($list['one_line_rate_flag'] =='1'){</php>
                            <td><span>{$list.one_line_rate}</span></td>
                            <php>}else{</php>
                            <td><span>不限</span></td>
                            <php>}</php>
                            <php>if($list['shop_line_flag']=='1'){</php>
                            <td><span>执行中</span></td>
                            <php>}else{</php>
                            <td><span>未执行</span></td>
                            <php>}</php>
                            <td class="last">
                                <php>if($list['shop_line_flag']=='1'){</php>
                                <a href="javascript:void(0);" onclick="integralChangeStatus('0','2');">&nbsp;停用</a>
                                <php>}elseif($list['shop_line_rate']!='' || $list['one_line_rate_flag']!='0' || $list['one_line_rate']!=''){</php>
                                <a href="javascript:void(0);" onclick="integralChangeStatus('1','2');">&nbsp;启用</a>
                                <php>}</php>
                                
                                <a href="javascript:void(0);" onclick="integralPointEdit('2','{$list.shop_line_rate}','{$list.one_line_rate}','{$list.one_line_rate_flag}');">&nbsp;编辑</a>
                            </td>
                        </tr>
                        <tr class="<php>if($list['day_sign_flag']=='1'){echo 'active bgfff';}</php>">
                            <td class="first">每日签到1次</td>
                            <td class="textLeft">消费者登录会员中心，并完成签到动作。每签到1次即获取对应{:L('INTEGRAL_NAME')}。</td>
                            <td><span>{$list.day_sign_rate}</span></td>
                            <td><span>无</span></td>
                            <php>if($list['day_sign_flag']=='1'){</php>
                            <td><span>执行中</span></td>
                            <php>}else{</php>
                            <td><span>未执行</span></td>
                            <php>}</php>
                            <td class="last">
                                <php>if($list['day_sign_flag']=='1'){</php>
                                <a href="javascript:void(0);" onclick="integralChangeStatus('0','3');">&nbsp;停用</a>
                                <php>}elseif($list['day_sign_rate']!=''){</php>
                                <a href="javascript:void(0);" onclick="integralChangeStatus('1','3');">&nbsp;启用</a>
                                <php>}</php>
                                
                                <a href="javascript:void(0);" onclick="integralEdit('3','{$list.day_sign_rate}','');">&nbsp;编辑</a>
                            </td>
                        </tr>
                        <tr class="<php>if($list['7day_sign_flag']=='1'){echo 'active bgfff';}</php>">
                            <td class="first">连续7天完成每日签到</td>
                            <td class="textLeft">消费者连续7天登录会员中心，并完成签到动作，即额外获取对应{:L('INTEGRAL_NAME')}。第8天起，系统重新开始计算连续签到天数。。</td>
                            <td><span>{$list.7day_sign_rate}</span></td>
                            <td><span>无</span></td>
                            <php>if($list['7day_sign_flag']=='1'){</php>
                            <td><span>执行中</span></td>
                            <php>}else{</php>
                            <td><span>未执行</span></td>
                            <php>}</php>
                            <td class="last">
                                <php>if($list['7day_sign_flag']=='1'){</php>
                                <a href="javascript:void(0);" onclick="integralChangeStatus('0','4');">&nbsp;停用</a>
                                <php>}elseif($list['7day_sign_rate']!=''){</php>
                                <a href="javascript:void(0);" onclick="integralChangeStatus('1','4');">&nbsp;启用</a>
                                <php>}</php>
                                
                                <a href="javascript:void(0);" onclick="integralEdit('4','{$list.7day_sign_rate}','');">&nbsp;编辑</a>
                            </td>
                        </tr>
                        <tr class="<php>if($list['weixin_payment_flag']=='1'){echo 'active bgfff';}</php>">
                            <td class="first">微信条码支付1元</td>
                            <td class="textLeft">消费者在门店使用微信条码支付付款，支付1元即获取对应{:L('INTEGRAL_NAME')}。</td>
                            <td><span>{$list.weixin_payment_rate}</span></td>
                            <php>if($list['one_weixin_flag'] =='1'){</php>
                                 <td><span>{$list.one_weixin_payment_rate}</span></td>
                            <php>}else{</php>
                                 <td><span>不限</span></td>
                            <php>}</php>
                            <php>if($list['weixin_payment_flag']=='1'){</php>
                            <td><span>执行中</span></td>
                            <php>}else{</php>
                            <td><span>未执行</span></td>
                            <php>}</php>
                            <td class="last">
                                <php>if($list['weixin_payment_flag']=='1'){</php>
                                <a href="javascript:void(0);" onclick="integralChangeStatus('0','5');">&nbsp;停用</a>
                                <php>}elseif($list['weixin_payment_rate']!='' || $list['one_weixin_payment_rate']!='' || $list['one_weixin_flag']!='0'){</php>
                                <a href="javascript:void(0);" onclick="integralChangeStatus('1','5');">&nbsp;启用</a>
                                <php>}</php>
                                
                                <a href="javascript:void(0);" onclick="integralPointEdit('3','{$list.weixin_payment_rate}','{$list.one_weixin_payment_rate}','{$list.one_weixin_flag}');">&nbsp;编辑</a>
                            </td>
                        </tr>
                        <tr class="<php>if($list['zhifubao_payment_flag']=='1'){echo 'active bgfff';}</php>">
                            <td class="first">支付宝条码支付1元</td>
                            <td class="textLeft">消费者在门店使用支付宝条码支付付款，支付1元即获取对应{:L('INTEGRAL_NAME')}。</td>
                            <td><span>{$list.zhifubao_payment_rate}</span></td>
                            <php>if($list['one_zhifubao_flag'] =='1'){</php>
                            <td><span>{$list.one_zhifubao_payment_rate}</span></td>
                            <php>}else{</php>
                            <td><span>不限</span></td>
                            <php>}</php>
                            <php>if($list['zhifubao_payment_flag']=='1'){</php>
                            <td><span>执行中</span></td>
                            <php>}else{</php>
                            <td><span>未执行</span></td>
                            <php>}</php>
                            <td class="last">
                                <php>if($list['zhifubao_payment_flag']=='1'){</php>
                                <a href="javascript:void(0);" onclick="integralChangeStatus('0','6');">&nbsp;停用</a>
                                <php>}elseif($list['zhifubao_payment_rate']!='' || $list['one_zhifubao_payment_rate']!='' || $list['one_zhifubao_flag']!='0'){</php>
                                <a href="javascript:void(0);" onclick="integralChangeStatus('1','6');">&nbsp;启用</a>
                                <php>}</php>

                                <a href="javascript:void(0);" onclick="integralPointEdit('4','{$list.zhifubao_payment_rate}','{$list.one_zhifubao_payment_rate}','{$list.one_zhifubao_flag}');">&nbsp;编辑</a>
                            </td>
                        </tr>

                        <tr class="<php>if($list['weixin_guanzhu_flag']=='1'){echo 'active bgfff';}</php>">
                            <td class="first">关注微信公众号</td>
                            <td class="textLeft">消费者首次关注公众号后即获取对应{:L('INTEGRAL_NAME')}。<br /><a href="http://www.wangcaio2o.com/index.php?g=Home&m=Help&a=helpDetails&newsId=1506&classId=76" target="_blank">查看如何配置引导消息</a></td>
                            <td><span>{$list.weixin_guanzhu_rate}</span></td>
                            <td><span>无</span></td>
                            <php>if($list['weixin_guanzhu_flag']=='1'){</php>
                            <td><span>执行中</span></td>
                            <php>}else{</php>
                            <td><span>未执行</span></td>
                            <php>}</php>
                            <td class="last">
                                <php>if($list['weixin_guanzhu_flag']=='1'){</php>
                                <a href="javascript:void(0);" onclick="integralChangeStatus('0','7');">&nbsp;停用</a>
                                <php>}elseif($list['weixin_guanzhu_rate']!=''){</php>
                                <a href="javascript:void(0);" onclick="integralChangeStatus('1','7');">&nbsp;启用</a>
                                <php>}</php>
                                
                                <a href="javascript:void(0);" onclick="integralEdit('7','{$list.weixin_guanzhu_rate}','');">&nbsp;&nbsp;编辑</a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="page"><?php echo $page;?>&nbsp;&nbsp;</div>
                </div>
			</div>
                </div>
		</div>
	</div>
</div>
<div class="integralService"></div>
</body>
<script type="text/javascript">
function createGoods(){
    var goUrl = $(".btn-add").attr("gourl");
    window.location.href=goUrl;
}
//type为停用启用,integral_type为第几个设置
function integralChangeStatus(type,integral_type){
    if(type==0){
        var title="您确认停用该"+"{:L('INTEGRAL_NAME')}"+"规则？";
    }else{
        var title="您确认启用该"+"{:L('INTEGRAL_NAME')}"+"规则？";
    }
    art.dialog.confirm(title,function(){
        $.post("{:U('Integral/Integral/integralChangeStatus')}",{"type":type,"integral_type":integral_type},function(data){
            if(data.status==1){
                art.dialog({title:false,content:"<div class='msg-all-succeed'>"+data.info+"</div>",fixed: true,padding:0,time:2});
                window.location.reload();
            }else{
                art.dialog({title:false,content:"<div class='msg-all-error'>"+data.info+"</div>",fixed: true,padding:0,time:2});
            }
        },"json");
    });
}
function integralDel(id){
    var title="您确认要删除该商品？";
    art.dialog.confirm(title,function(){
        $.post("{:U('Integral/GoodsInfo/delLine')}",{"id":id},function(data){
            if(data.status==1){
                art.dialog({title:false,content:"<div class='msg-all-succeed'>删除成功</div>",fixed: true,padding:0,time:2});
                window.location.reload();
            }else{
                art.dialog({title:false,content:"<div class='msg-all-error'>"+data.info+"</div>",fixed: true,padding:0,time:2});
            }
        },"json");
    });
}
//小店，线上，线下设置，限制
function integralPointEdit(type,rate,one_rate,flag){
    art.dialog.open("{:U('Integral/integralSet')}"+"&type="+type+"&rate="+rate+"&one_rate="+one_rate+"&flag="+flag,{
        id:"EnterpriseNo",
        title:"配置规则设置",
        width:500
    });
}
function integralEdit(type,getpoint,maxpoint){
    var title="配置规则设置";
    if(type=='1' || type=='2' || type=='5'|| type=='6'){
        var html=[
            "<form id='editform' method='post' action='{:U('Integral/Integral/integralChangeData')}'>",
            "<input type='hidden'  name='type' value='"+type+"'/>",
            "<div class='addlist-con'>",
            "<div class='fn'>",
            "<p class='l'><span class='red'>*</span>获取{:L('INTEGRAL_NAME')}:</p><div><input type='text' name='getpoint' class='shoplist-input' maxlength='6' value='"+getpoint+"'/></div>",
            "<p class='l'><span class='red'>*</span>单次最大:</p><div><input type='text' name='maxpoint' class='shoplist-input' maxlength='6' value='"+maxpoint+"'/></div>",
            "</div>",
            "</div>",
            "</form>"].join('');
    }else{
        var html=[
            "<form id='editform' method='post' action='{:U('Integral/Integral/integralChangeData')}'>",
            "<input type='hidden'  name='type' value='"+type+"'/>",
            "<div class='addlist-con'>",
            "<div class='fn'>",
            "<p class='l'><span class='red'>*</span>获取{:L('INTEGRAL_NAME')}:</p><div><input type='text' name='getpoint' class='shoplist-input' maxlength='6' value='"+getpoint+"'/></div>",
            "</div>",
            "</div>",
            "</form>"].join('');
    }
    art.dialog({
        title: title,
        content: html,
        width:400,
//      height:auto,
        okVal: '启用',
        ok: function () {
                $("#editform").ajaxSubmit({
                    success: function (data) {
                        if (data.status == '1') {
//                            artDialog.close();
                            artDialog.tips("<div class='msg-all-succeed'>" + data.info + "</div>");
                            parent.location.reload();
                        } else {
                            artDialog.tips("<div class='msg-all-error'>" + data.info + "</div>");
                        }
                    },
                    url: "{:U('Integral/Integral/integralChangeData')}",
                    dataType: 'json'
                });
                return false;
        },
        cancel: true
    });
    
}
</script>