<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>商城配置</title>
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<load href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css?v=__VR__" />
<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__" ></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__" ></script>
<style>
body{ min-height:auto; min-height:500px; overflow:hidden}
.RegForm .Wcanal-tab .Wcanal-tab-list {border-top: solid 2px #e5e5e5;margin-top: -2px;}
.RegForm .Wcanal-tab .Wcanal-tab-title p{ margin-left:0; border:0px #dfdfdf solid; border-left:0; font-size:16px; height:38px; line-height:38px; padding:0; background:url(__PUBLIC__/Image/eTicket/line.png) center right no-repeat;}
.RegForm .spreadLogin { margin:0 auto; /*margin-top:40px;*/ padding:30px 0px 20px 0px; width:458px; height:auto; overflow:hidden; background:#fff; border:solid 1px #eee; border:0}
.spreadLogin:after,.spreadLogin ul:after,.spreadLogin ul li:after {visibility:hidden;display:block;font-size:0;content:"";clear:both;height:0px;}
.RegForm .spreadLogin ul { width:100%; position:relative;}
.RegForm .spreadLogin .name { width:100px; text-align:right; line-height:28px; position:absolute; top:8px; left:0; font-size:14px; color:#666;}
.RegForm .spreadLogin .input { padding:8px 0 8px 100px; position:relative;}
.RegForm .spreadLogin .input .txt-tips { display:block;line-height: 16px; padding:6px 0 0 0; font-size:12px; color:#ccc; font-family:"宋体";}
.RegForm .spreadLogin .input .textbox { width:240px;}
.RegForm .spreadLogin .input select { width:120px; margin:0; height:30px; line-height:30px;}
.RegForm .spreadLogin .input select.ml { margin-left:7px;}
.RegForm .spreadLogin ul li.btn { text-align:left; padding-top:20px;}
.RegForm .spreadLogin ul li a.btn-zc { margin-left:99px; display:inline-block; *display:inline; *zoom:1; padding:10px 90px; font-size:18px; background:#ff5a5a; color:#fff; border-radius:2px;}
.RegForm .spreadLogin ul li a.btn-zc:hover { text-decoration:none; background:#fd4949;}
.RegForm .spreadLogin ul li.btn span { display:block;  text-align:center; line-height:50px; font-size:14px;}
.RegForm .spreadLogin ul li.btn span em { color:#ff0000;}
.RegForm .login-form{width:50%;}
.RegForm .input-box{position:relative;}
.RegForm .input-box i{display:block;width:20px;height:20px;position:absolute;left:20px;background-image:url(__PUBLIC__/Image/icon-extension.png);background-repeat:no-repeat;}
.RegForm .input-box .login-icon{top:19px;background-position:0 -16px;}
.RegForm .input-box .pwd-icon{top:26px;background-position:0 -70px;}
.RegForm .login-box{position:relative;width:458px;height:386px;border:1px solid #e9e9e9; border-top:0;background-color:#fff;}
.RegForm .login-box form{width:350px;padding-top:40px;margin:0 auto;font-family:'宋体';color:#999;font-size:14px;}
.RegForm .login-box form input[type=text],.RegForm .login-box input[type=password]{border-width:1px;border-style:solid;border-color:#dedede;height:20px; padding:18px 50px;line-height:20px;-webkit-transition:border-color 0.5s,box-shadow 0.5s;-o-transition:border-color 0.5s,box-shadow 0.5s;-moz-transition:border-color 0.5s,box-shadow 0.5s;transition:border-color 0.5s,box-shadow 0.5s;}
.RegForm .login-box form input:focus{border-color:#aaa;box-shadow:0 0 1px rgba(0,0,0,0.6);}
.RegForm .u-name{width:248px;padding:16px 34px 16px 66px;}
.RegForm .pwd{width:248px;padding:16px 34px 16px 66px;}
.RegForm .verify{width:134px;padding:16px 20px;}
.RegForm .btn-sub{width:350px;height:42px;background-color:#ff5a5a;color:#fff;text-align:center;line-height:40px;font-size:16px;border:1px solid #ff0303;cursor:pointer;border-radius:2px;}
.RegForm .btn-sub:hover{background-color:#fd4949;}

.Gform .Gname.w100 { width: 100px;}
.Gform .Ginput { padding-left: 110px;}
#logo_show1 { float: left; margin-top: 20px; width: 100%;}
.Diabody .Gform .Ginput .maxTips.forArea, .Diabody .Gform .Ginput .maxTips.forInput { left: 350px;}
</style>
</head>
<body>
<div class="RegForm">
<div class="Wcanal-tab" id="Wcanal-tabon" name="Wcanal-tabon">
<div class="spreadLogin Gform">
    <form action="" method="POST" name="theform" id="theform" enctype="multipart/form-data">
    <ul>
        <li class="Gname w100">商城名称</li>
        <li class="Ginput pl100">
            <input name="integral_shop_name" type="text" class="textbox validate[required,maxlength[8]]" maxlength='8' value="{$list['integral_shop_name']}" placeholder="商城名称">
        </li>
    </ul>
        <ul>
            <li class="Gname w100">商城LOGO</li>
            <li class="Ginput pl100">
                <div class="switch">
                    <php>if($list['logo_flag']==1){</php>
                    <input type="radio" checked="checked" value="1" name="logo_flag" />
                    <php>}else{</php>
                    <input type="radio" checked="checked" value="0" name="logo_flag" />
                    <php>}</php>
                    <div class="newRadio">
                        <span class="valfirst" data-val="0" data-checkbefor="" id="logo_show">企业默认LOGO</span>
                        <span class="vallast"  data-val="1" data-checkbefor="" id="logo_hide">商城专属LOGO</span>
                    </div>
                    <div id="logo_show1" <php>if($list['logo_flag']==1){echo "class='dn'";}</php>>
                        <php>if($head_photo){</php>
                        <div class="logo_hide"> <img src="__UPLOAD__/{$head_photo}" class="img"  data-view="src,img1,previewData" /></div>
                        <php>}else{</php>
                        <div class="logo_hide"> <img src="__PUBLIC__/Image/dog.png" class="img"  data-view="src,img1,previewData" /></div>
                        <php>}</php>
                    </div>
                    <div class="newRadio-input" style="width: 100%;">
                        <ul>
                            <li class="Ginput" style="padding-left: 0;">
                                <div class="pic l">
                                    <php>if($list['logo_path']){</php>
                                         <img src="__UPLOAD__/{$list['logo_path']}" class="img" id="show1" data-view="src,img1,previewData" style="width:100px;height: 80px;"/>
                                    <php>}else{</php>
                                         <img src="__PUBLIC__/Image/shop/no-head.png" class="img" id="show1" data-view="src,img1,previewData" style="width:100px;height: 80px;"/>
                                    <php>}</php>
                                    <input type="hidden" name="resp_img1" id="resp_img1" value="" />
                                    <a class="btn_inner" style="display: block;" onclick="return uploadImg('640x320','cb_img_1');" href="javascript:void(0);">上传图片</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </li>
        </ul>
    <!--<ul>-->
        <!--<li class="name">商城描述：</li>-->
        <!--<li class="input">-->
            <!--<textarea class="Gview-textarea" maxlength="20"></textarea>-->
            <!--<input name="integral_memo" type="password" class="textbox validate[required,maxSize[200]]" value=""  placeholder="商城描述，用户微信分享使用">-->
        <!--</li>-->
    <!--</ul>-->
        <ul>
            <li class="Gname w100">分享描述</li>
            <li class="Ginput">
                <textarea maxlength="140" class="Gview-textarea" name="integral_describe">{$list['integral_describe']}</textarea><span class="maxTips forArea" data-max="140">0/140</span>
            </li>
        </ul>
        <ul>
            <li class="Gname w100">分享图标</li>
            <li class="Ginput">
                <div class="Gchoose Gview-img">
                    <input type="text" value="{$list['integral_sharpic']}" name="integral_sharpic">
                    <a href="javascript:void(0)" class="Gbtn-pic" title="选择图片" data-rel="{width:160,height:160}"><i></i></a>
                    <div class="Gchoose-opr an" style="display: none;"><div class="Gchoose-opr-img"><img src="" style="width:100px;"></div><div class="Gchoose-opr-opr"><a href="javascript:void(0)" class="Gchoose-opr-edit"></a><a href="javascript:void(0)" class="Gchoose-opr-del"></a></div><span class="Gchoose-opr-jt"></span></div><div class="Gchoose-oprbg"></div></div>
            </li>
        </ul>
        <div class="fn" style="margin-left: 200px;">
            <div class="Ubutton">
                <div class="Ubutton-con">
                    <a class="btn-Wangcai btn-all">保存</a>
                </div>
            </div>
        </div
    ></form>
</div>
</div>
</div>
</div>
</body>
</html>

<script>
var requestLoginError = function() {
    $.ajax({
           type: "POST",
           url: "{:U('Home/Login/ajaxLoginError')}",
           success: callbackLoginError,
           dataType:"json"
    });
}
var callbackLoginError = function(data) {
    if (data['loginError'] != -1) {
        var verifyImgSrc = "{:U('Home/Verifycode/verify',array('_t'=>time()))}";
        $('#verify_div').html('<input style="padding:18px 20px;" type="text" class="verify mt10 validate[required]" placeholder="验证码" name="verify" id="verify" value="" maxlength="4" /><img id="verifyImg" src="'+verifyImgSrc+'" onclick="fleshVerify()" class="ml10" style="vertical-align:middle; height:32px;cursor:pointer;" />');
    }
}

var callbackLogin = function(data) {
    if (typeof(data['success']) != 'undefined' && data['success'] == 0) {
        art.dialog({title:false,time:5,content:"<div class='msg-all-error' style='color:red'>"+data['error_msg']+"</div>",fixed: true,padding:0});
        var verifyImgSrc = "{:U('Home/Verifycode/verify',array('_t'=>time()))}";
        $('#verify_div').html('<input style="padding:18px 20px;" type="text" class="verify mt10 validate[required]" placeholder="验证码" name="verify" id="verify" value="" maxlength="4" /><img id="verifyImg" src="'+verifyImgSrc+'" onclick="fleshVerify()" class="ml10" style="vertical-align:middle; height:32px;cursor:pointer;" />');
        $('#verifyImg').click();
    } else {
        top.location.href = data['redirectUrl'];
    }
}

function fleshVerify(){ 
    //重载验证码
    var time = new Date().getTime();
        document.getElementById('verifyImg').src= '{:U("Home/Verifycode/verify")}&time='+time;
 }

function rfun() {
    top.location.href = "{:U('Home/ForgetPwd/index')}";
}

$(document).ready(function(e) {
    $(".btn-Wangcai").click(function(){
//        $("#theform").validationEngine('validate');
        if($("#theform").validationEngine('validate')) {
            $("#theform").ajaxSubmit({
                beforeSubmit: function () {
                   dialog = art.dialog({
                        title: false,
                        content: "<div class='msg-all-succeed'>正在提交...</div>",
                        fixed: true,
                        lock: true,
                        padding: 0
                    });
                },
                success: function (data) {
                    if (data.status == '1') {
                        art.dialog.tips(data.info, 2);
                        parent.location.reload();
                        art.dialog.close();
                    } else {
                        art.dialog.tips("<div class='msg-all-error'>" + data.info + "</div>", 2);
                    }
                },
                url: "{:U('Integral/Integral/integralSetConfig')}",
                dataType: 'json'
            });
            return false;
        }
    });

});
//绑定事件
$("body").on("click", ".Gform .switch .newRadio span", function() {
    var t = $(this), s = t.closest(".switch"), type = t.closest(".newRadio").prev("input").attr("type"), n = s.find(".newRadio span"), a = s.hasClass("disabled"), b = s.hasClass("hover"), c = t.hasClass("hover"), i = s.find("input:eq(0)"), ii = s.find("input[name='checkswitch']");
    if (a) {
        return false;
    };
    if ( typeof (t.attr("data-checkbefor")) == "undefined" || t.attr("data-checkbefor") == "") {
        if (s.attr("data-before")) {
            if (s.attr("data-before") != "") {
                var callbefore = "undefined";
                var Gformbefore = s.attr("data-before");
                var callbefore = window[Gformbefore].call(this, t);
                var callbefore = typeof (callbefore) == "undefined" ? true : callbefore;
                if (!callbefore) {
                    return false;
                };
                return false;
            }
        };
    };
    t.attr("data-checkbefor", "");
    if (type == "radio") {
        if (c) {
            return false;
        };
        var val = t.attr("data-val");
        if (val == 1)
            $('.key_pid').show();
        if (val == 0)
            $('.key_pid').hide();
        n.removeClass("hover");
        t.addClass("hover");
        b ? (s.removeClass("hover"), i.val(val), ii ? ii.attr("checked", false) : ii) : ($(this).addClass("hover"), s.addClass("hover"), i.val(val), ii ? ii.attr("checked", true) : ii);
    } else if (type == "checkbox") {
        c ? (t.removeClass("hover")) : (t.addClass("hover"));
        var check = s.find(">input[type='checkbox']");
        check.attr("checked", false);
        $(n).each(function(index) {
            if ($(this).hasClass("hover")) {
                var name = $(this).attr("data-name");
                var val = $(this).attr("data-val");
                if (name) {
                    var check = s.find(">input[name='" + name + "']");
                } else {
                    var check = s.find(">input[type='checkbox']:eq(" + index + ")");
                }
                check.attr("checked", true);
            }
        });
    }
    if (s.attr("data-show") != "") {
        var showid = s.attr("data-show");
        if ($("[data-show='" + showid + "']").length > 1) {
            var isshow = false;
            $("[data-show='" + showid + "']").each(function() {
                if ($(this).hasClass("hover")) {
                    isshow = true
                }
            });
            isshow ? $("#" + showid).show() : $("#" + showid).hide();
        } else {
            s.find(".newRadio span:eq(0)").hasClass("hover") ? $("#" + showid).hide() : $("#" + showid).show();
        }
    }
    if (s.attr("data-callback")) {
        if (s.attr("data-callback") != "") {
            var Gformcallback = s.attr("data-callback");
            window[Gformcallback].call(this, t)
        }
    }
})
function uploadImg(cropPresets,callback) {
    var opt = {
        cropPresets:cropPresets,
        callback:callback
    };
    open_img_uploader(opt);

}
/*获取图片路径中的图片名*/
function base_name(url){
    var urlList = url.split('/');
    var a = urlList[urlList.length-1];
    return a;
}

function cb_img_1(data){cb_img(1, data); }
function cb_img_2(data){cb_img(2, data); }
function cb_img_3(data){cb_img(3, data); }
function cb_img_4(data){cb_img(4, data); }
function cb_img_5(data){cb_img(5, data); }
function cb_img(n, data){
    //填充缩略图
    $('#show'+n).attr('src', data.src).show();
    //上传用
    $('#resp_img'+n).val(data.savename);
}
$("#logo_hide").click(function(){
    $(".logo_hide").css('display','none');
});
$("#logo_show").click(function(){
    $("#logo_show1").css('display','block');
    $(".logo_hide").css('display','block');
});
$("body").on("click", ".Gbtn-pic", function() {
    var data = $(this).attr("data-rel");
    var obj, maxlength, upload;
    if ($(this).hasClass("Gbtn-pic")) {
        obj = $(this).closest(".Gchoose");
        maxlength = false;
        upload = "upload";
    } else if ($(this).hasClass("Gbtn-picmore")) {
        obj = $(this).closest(".Gchoosemore");
        maxlength = 21;
        upload = "uploadmore";
    } else if ($(this).hasClass("Gchoosemore-edit")) {
        obj = $(this).closest(".Gchoosemore-list");
        maxlength = false;
        upload = "editmore";
    }
    var defaults = {
        obj : obj, //对象
        Gform : true, //是否Gform
        type : 0, //图片用处类型，用于删选
        width : 640, //建议宽度
        height : 320, //建议高度
        //uploadUrl:"http:\\192.168.0.35:8080\index.php?g=ImgResize&m=Resize&a=uploadFile1",//上传地址
        menuType : 1, //美图秀秀版本
        animate : 0, //是否动画
        resizeFlag : "", //是否动画
        txtmsg : "", //备注
        callback : "GdataImg", //callback
        maxlength : maxlength, //是否多张
        GdataImg : upload//上传类型(upload:单张,uploadmore:多张,editmore:多张修改)
    }
    var imguploadData = $.extend(true, {}, defaults, eval('(' + data + ')'));
    open_img_uploader(imguploadData);
    return;
})
</script>