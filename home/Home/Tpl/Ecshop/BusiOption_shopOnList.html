<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>	
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>翼码旺财业务配置</title>
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/Css/main.css?v=__VR__" />
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/Css/layout.css?v=__VR__" />
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/Css/module.css?v=__VR__" />
		<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>

		<style>
		.shopCity {}
		.shopCityCon { position:relative; height:auto; overflow:hidden;}
		.shopCityCon>i.icon-add { position:absolute; top:50%; margin-top:-15px; left:50%; margin-left:-15px; width:30px; height:30px;background:url(__PUBLIC__/Image/shop/icon-shopCityList.png) no-repeat 0px 0px;}
		.shopCityCon .title { padding-left:15px; height:30px; color:#333; font-size:14px; line-height:30px;}
		.shopCityCon .shopCityList .title{padding-left:0 ;width:100% ;}
		.shopCityCon .shopCityList .title input{display: block;width: 100%;line-height:24px ;padding-left:15px ;}
		.shopCityCon .shopCityList .title input:hover{border: none;width: 100%;}
		.shopCityCon .shopCityList .title input:focus{border: none;width: 100%;box-shadow:none}
		.shopCityList { float:left; width:300px; height:360px; border:solid 1px #d1d1d1; }
		.shopCityChoose { float:right; width:300px; height:360px; border:solid 1px #d1d1d1; margin-top:1px;border-top:solid 2px #ed3f41;}
		.shopCityListCon,.shopCityChooseCon { padding:10px; height:310px; overflow:hidden; overflow-y:auto;}
		.shopCitytree { height:auto; overflow:hidden;}
		.shopCitytree .shopCitytreeT { line-height:24px;}
		.shopCitytree a { padding-left:19px; display:block; height:auto; overflow:hidden;}
		/*.shopCitytree a:hover { background:#f7f7f7;}*/
		.shopCitytree.close .shopCitytreeT a {background-image:url(__PUBLIC__/Image/shop/icon-tree.png); background-repeat:no-repeat; background-position:0px -24px;}
		.shopCitytree.open .shopCitytreeT a {background-image:url(__PUBLIC__/Image/shop/icon-tree.png); background-repeat:no-repeat; background-position:0px 0px;}
		.shopCitytree a span { float:left; font-size:14px; line-height:24px; color:#666;}
		.shopCitytree.close .shopCitytreeC { display:none;}
		.shopCitytree.open .shopCitytreeC { display:block;}
		.shopCitytree .shopCitytreeC { padding-left:18px;}
		.shopCitytree .shopCitytreeC .shopCitytreeA.close a{background-image:url(__PUBLIC__/Image/shop/icon-tree.png); background-repeat:no-repeat; background-position:0px -24px; }
		.shopCitytree .shopCitytreeC .shopCitytreeA.open a{background-image:url(__PUBLIC__/Image/shop/icon-tree.png); background-repeat:no-repeat; background-position:0px -24px; }
		.shopCitytree .shopCitytreeC .shopCitytreeB.close a{background-image:url(__PUBLIC__/Image/shop/icon-tree.png); background-repeat:no-repeat; background-position:0px -24px; }
		.shopCitytree .shopCitytreeC .shopCitytreeB.open a{background-image:url(__PUBLIC__/Image/shop/icon-tree.png); background-repeat:no-repeat; background-position:0px -24px; }
		.shopCitytree .shopCitytreeC.close .shopCitytreeA{ display:none;}
		.shopCitytree .shopCitytreeC.open .shopCitytreeA{ display:block;}
		
		.shopCitytree i.input { float:left; margin:5px 10px 0 0; width:14px; height:14px;background:url(__PUBLIC__/Image/shop/icon-inputcheck.png); background-repeat:no-repeat;}
		.shopCitytree i.input input { display:none;}
		.shopCitytree i.input { background-position:0 0;}
		.shopCitytree i.input:hover { background-position:-14px 0px;}
		.shopCitytree i.input.dcheck { background-position:0px -14px;}
		.shopCitytree i.input.dcheck:hover { background-position:-14px -14px;}
		.shopCitytree i.input.check { background-position:0px -28px;}
		.shopCitytree i.input.check:hover { background-position:-14px -28px;}
		.shopCityChooseCon {}
		.shopCityChooseCon .p { font-size:14px; line-height:24px;}
		.shopCityChooseCon .p span { font-size:14px;color:#333;}
		.shopCityChooseCon .p span.t:hover { text-decoration:line-through; cursor:pointer;}
		.shopCityChooseCon .p span em { font-size:14px; color:#666;}
		.shopCityChooseCon .p span em:hover { text-decoration:line-through; cursor:pointer;}
		
		.shopCityListCon::-webkit-scrollbar {width:5px; height:5px;}
		.shopCityListCon::-webkit-scrollbar-track-piece {background-color: #fff;}
		.shopCityListCon::-webkit-scrollbar-thumb {background-color: #ccc; border-radius: 5px;}
		.shopCityListCon::-webkit-scrollbar-thumb:hover { background-color: #ccc;}
		.shopCityListCon::-webkit-scrollbar-thumb:active {background-color: #ccc;}
		.shopCityChooseCon::-webkit-scrollbar {width:5px; height:5px;}
		.shopCityChooseCon::-webkit-scrollbar-track-piece {background-color: #fff;}
		.shopCityChooseCon::-webkit-scrollbar-thumb {background-color: #ccc; border-radius: 5px;}
		.shopCityChooseCon::-webkit-scrollbar-thumb:hover { background-color: #ccc;}
		.shopCityChooseCon::-webkit-scrollbar-thumb:active {background-color: #ccc;}
		
		.shopSaleItem { height:auto; overflow:hidden;}
		.shopSaleItem .shopSaleList { padding:25px 0; border-bottom:dashed 1px #aaa;}
		.shopSaleItem .shopSaleList img { float:left; width:110px; height:110px; margin-right:20px;}
		.shopSaleItem .shopSaleCon { margin-left:130px;}
		.shopSaleItem .shopSaleCon table { width:80%; font-size:14px; color:#333;}
		.shopSaleItem .shopSaleCon table td { padding-bottom:15px;}
		.shopSaleItem .shopSaleCon table span { color:#999;}
		.shopSaleItem .shopSaleCon table em { color:#ed3f41;}
		.shopSaleItem .shopSaleOpr { height:auto; overflow:hidden; background:#f7f7f7; padding:5px 0;}
		.shopSaleItem .shopSaleOpr ul {}
		.shopSaleItem .shopSaleOpr ul li { float:left; width:15%; height:30px; line-height:30px; color:#666; padding:0 5px;}
		.shopSaleItem .shopSaleOpr ul li a { display:block; color:#666; font-size:14px;}
		.shopSaleItem .shopSaleOpr ul li a i { display:inline-block; *display:inline; *zoom:1; width:30px; height:30px; vertical-align:middle;background-image:url(__PUBLIC__/Image/icon-shop2.png);}
		.shopSaleItem .shopSaleOpr ul li:hover a { color:#ed3f41; text-decoration:none;}
		.shopSaleItem .shopSaleOpr ul li a i.icon-down { background-position:-30px -180px;}
		.shopSaleItem .shopSaleOpr ul li a i.icon-list { background-position:-60px -180px;}
		.shopSaleItem .shopSaleOpr ul li a i.icon-change { background-position:-90px -180px;}
		.shopSaleItem .shopSaleOpr ul li a i.icon-look { background-position:-30px -240px;}
		.shopSaleItem .shopSaleOpr ul li a i.icon-edit { background-position:-60px -240px;}
		.shopSaleItem .shopSaleOpr ul li a i.icon-stop { background-position:-90px -240px;}
		.shopSaleItem .shopSaleOpr ul li a i.icon-start { background-position:-30px -300px;}
		.shopSaleItem .shopSaleOpr ul li:hover a i.icon-down { background-position:-30px -210px;}
		.shopSaleItem .shopSaleOpr ul li:hover a i.icon-list { background-position:-60px -210px;}
		.shopSaleItem .shopSaleOpr ul li:hover a i.icon-change { background-position:-90px -210px;}
		.shopSaleItem .shopSaleOpr ul li:hover a i.icon-look { background-position:-30px -270px;}
		.shopSaleItem .shopSaleOpr ul li:hover a i.icon-edit { background-position:-60px -270px;}
		.shopSaleItem .shopSaleOpr ul li:hover a i.icon-stop { background-position:-90px -270px;}
		.shopSaleItem .shopSaleOpr ul li:hover a i.icon-start { background-position:-30px -330px;}
		</style>
		<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.2.min.js?v=__VR__"></script>
		<script type="text/javascript" src="__PUBLIC__/Js/jquery-ui-1.11.2.custom/template.js?v=__VR__"></script>
		<script>
			var addshopFreight;
			            var data;
			            $(document).ready(function (e) {
			                addshopFreight = art.dialog.data('addshopFreight');
			                //点击左边展开
			                $(".shopCitytreeT").click(function (e) {
			                    e.stopPropagation();
			                    var t = $(this).closest(".shopCitytree");
			                    if (t.hasClass("close")) {
			                        t.removeClass("close").addClass("open");
			                    } else {
			                        t.removeClass("open").addClass("close");
			                    }
			                });
                            // 二级
			                 $(".shopCitytreeA").click(function (e) {
			                    e.stopPropagation();
			                    var t = $(this).closest(".shopCitytreeA");
			                    if (t.hasClass("close")) {
			                        t.removeClass("close").addClass("open");
			                    } else {
			                        t.removeClass("open").addClass("close");
			                    }
			                });
			                //点击左边选中
			                $(".shopCitytreeT a i.input").click(function (e) {
			                    e.stopPropagation();
			                    var t = $(this),
			                            tc = t.closest(".shopCitytreeT").next(".shopCitytreeC").find("a i.input");
			                    if (t.hasClass("check")) {
			                        t.removeClass("check").find("input").attr("checked", false);
			                        tc.each(function (index, element) {
			                            $(this).removeClass("check").find("input").attr("checked", false);
			                        });
			                    } else {
			                        t.removeClass("dcheck").addClass("check").find("input").attr("checked", true);
			                        tc.each(function (index, element) {
			                            $(this).removeClass("dcheck").addClass("check").find("input").attr("checked", true);
			                        });
			                    }
			                    shopCityChooseCon();
			                });
			                $(".shopCitytreeC a i.input").click(function (e) {
			                    e.stopPropagation();
			                    var t = $(this),
			                            tc = t.closest(".shopCitytreeC").find("a i.input"),
			                            tt = t.closest(".shopCitytreeC").prev(".shopCitytreeT").find("a i.input"),
			                            tclength = 0;
			                    if (t.hasClass("check")) {
			                        t.removeClass("check").find("input").attr("checked", false);
			                        tc.each(function (index, element) {
			                            if ($(this).hasClass("check") || $(this).hasClass("dcheck")) {
			                                tclength++;
			                            }
			                        });
			                        if (tclength == 0) {
			                            tt.removeClass("check").removeClass("dcheck").find("input").attr("checked", false);
			                        } else {
			                            tt.removeClass("check").addClass("dcheck").find("input").attr("checked", true);
			                        }
			                    } else {
			                        t.removeClass("dcheck").addClass("check").find("input").attr("checked", true);
			                        tc.each(function (index, element) {
			                            if ($(this).hasClass("check") || $(this).hasClass("dcheck")) {
			                                tclength++;
			                            }
			                        });
			                        if (tclength == tc.length) {
			                            tt.removeClass("dcheck").addClass("check").find("input").attr("checked", true);
			                        } else {
			                            tt.removeClass("check").addClass("dcheck").find("input").attr("checked", true);
			                        }
			                    }
			                    shopCityChooseCon();
			                });
			                //点击右边数据删除
			                $("body").on("click", ".shopCityChooseCon .p em", function (e) {
			                    e.stopPropagation();
			                    var cityid = $(this).attr("data-id");
			                    $(".shopCitytree").find("[data-id='" + cityid + "']").click();
			                    shopCityChooseCon();
			                });
			                $("body").on("click", ".shopCityChooseCon .p span.t", function (e) {
			                    e.stopPropagation();
			                    var cityid = $(this).attr("data-id");
			                    var t = $(".shopCitytree").find("[data-id='" + cityid + "']");
			                    t.removeClass("dcheck").removeClass("check").find("input").attr("checked", false);
			                    t.closest(".shopCitytreeT").next(".shopCitytreeC").find("a i.input").each(function (index, element) {
			                        $(this).removeClass("check").removeClass("dcheck").find("input").attr("checked", false);
			                    });
			                    shopCityChooseCon();
			                });
			                shopCityChooseCon();
			
			                $("#save").click(function () {
			                    var callback = addshopFreight.callback;
			                    var text = '';
			                    var rel = '';
			                    var cityCode = '';
			                    var uniqueCode = '{$key}';
			                    $(".shopCityChooseCon .p").each(function (index, element) {
			                        var addText = $(this).text();
			                        text = text + $(this).text();
			                    });
			                    
			                    $(".shopCityChooseCon .p span em").each(function(index, element){
			                        if(index == 0){
			                            cityCode = cityCode + $(this).attr('data-id');
			                            if(uniqueCode == '' || uniqueCode == '-1'){
			                                uniqueCode = $('.shopCityChooseCon .p span').attr('data-id') + cityCode;
			                            }
			                        }else{
			                            cityCode = cityCode + "," + $(this).attr('data-id');
			                        }
			                    });
			                    if(cityCode != ''){
			                        $.post("{:U('Ecshop/BusiOption/saveForCashe')}",{'key':uniqueCode,'val':cityCode}, function(){
			                            if (typeof (callback) == 'string') {
			                                art.dialog.opener[callback].call(this, data, text);
			                                art.dialog.close();
			                            } else {
			                                callback.call(this, data, text, cityCode, uniqueCode);
			                                art.dialog.close();
			                            }
			                        });
			                    }else{
			                        art.dialog.close();
			                    }
			                })
			            });
			            //生成右边数据
			            function shopCityChooseCon() {
			                data = {
			                    list: []
			                }
			                $(".shopCitytree").find(".shopCitytreeT a i.input.check,.shopCitytreeT a i.input.dcheck").each(function (index, element) {
			                    var t = $(this).closest(".shopCitytree");
			                    var province = {
			                        province: t.find(".shopCitytreeT a span").text(),
			                        id: $(this).attr("data-id"),
			                        list: []
			                    };
			                    if (t.find(".shopCitytreeC").length >= 1) {
			                        t.find(".shopCitytreeC").find("a i.input.check").each(function (index, element) {
			                            var citylist = {
			                                city: $(this).closest("a").find("span").text(),
			                                id: $(this).attr("data-id"),
			                            }
			                            province.list.push(citylist);
			                        });
			                    }
			                    data.list.push(province);
			                });
			                var html = template("shopCityChooseCon", data);
			                $(".shopCityChooseCon").html(html);
			            }  
			            
		</script>
	</head>

	<body>
		<div class="shopCity">
            <div class="shopCityCon">
                <div class="shopCityList">
                    <div class="title"><input placeholder="选择城市" /></div>
                    <div class="shopCityListCon">
                            <div class="shopCitytree open" data-id="11">
                                <div class="shopCitytreeT">
                                    <a href="javascript:void(0)">
                                        <i class="input">
                                            <input type="checkbox" name='1' value='1'/>
                                        </i><span>全部</span>
                                    </a>
                                </div>
                                <div class="shopCitytreeC">
                                 
                                        <div class="shopCitytreeA close" data-id="11">
                                            <volist name="allType" id="vo" empty="暂时没有数据" >
                                            <div class="shopCitytreeD">
                                                <a href="javascript:void(0)">
                                                    <i class="input">
                                                        <input type="checkbox" name='storeType[]' value='{$vo.id}'/>
                                                    </i><span>{$vo.name}</span>
                                                </a>
                                                <!--  小店分类 -->
                                                <if condition="$vo.id eq '31'">
                                                    <div class="shopCitytreeE" style="padding-left: 19px;">
                                                        <!-- 小店分组 -->
                                                        <volist name="allGroup" id="info" empty="暂时没有数据" >
                                                            <div class="shopCitytreeB close" data-id="{$info.id}">
						                                <div class="shopCitytreeF">
						                                    <a href="javascript:void(0)">
						                                        <i class="input">
						                                            <input type="checkbox" name='classify[]' value='{$info.id}'/>
						                                        </i><span>{$info.class_name}</span>
						                                    </a>
						                                </div>                                                                                    
						                                <div class="shopCitytreeG" style="padding-left: 19px;">
                                                            <eq name="vo.ecshop_classify"  vale="$info.id">
                                                                <!-- 小店分组商品 -->
                                                                <php>
                                                                    $id = $vo["id"];
                                                                    foreach($goodsInfo[$id] as $val):
                                                                </php>
                                                                <a href="javascript:void(0)" data-mid='<php>echo $val["m_id"];</php>' data-bid='<php>echo $val["b_id"];</php>'><i class="input"></i><span><php>echo $val["goods_name"];</php></span></a>
                                                                <php>
                                                                    endforeach;
                                                                </php>
                                                            </eq>
						                                </div>
						                            </div>
                                                        </volist>
			                                        			                                   
			                                </div>
			                                <div class="shopCitytreeE" style="padding-left: 19px;">	
                                                <else />
                                                    <!-- 单品 -->
                                                    <div class="shopCitytreeG" style="padding-left: 19px;">
                                                        <eq name="vo.ecshop_classify"  vale="$info.id">
                                                            <!-- 小店分组商品 -->
                                                            <php>
                                                                $id = $vo["id"];
                                                                if($vo["id"] == '27'):
                                                                    $id .= '_' . $vo["is_new"];
                                                                endif;
                                                                foreach($goodsInfo[$id] as $val):
                                                            </php>
                                                            <a href="javascript:void(0)" data-mid='<php>echo $val["m_id"];</php>' data-bid='<php>echo $val["b_id"];</php>'><i class="input"></i><span><php>echo $val["name"];</php></span></a>
                                                            <php>
                                                                endforeach;
                                                            </php>
                                                        </eq>
                                                    </div>
                                                </if>
                                            </div>
                                            </volist>    			                                   
                                        </div>


                                    </div>
                                   
                                </div>
                            </div>
                       
                    </div>
                </div>
                <i class="icon-add"></i>
                <div class="shopCityChoose">
                    <div class="title">已选择商品 <a class="r mr15">清空</a></div>
                    <div class="shopCityChooseCon">
                    </div>
                </div>
            </div>
            <!--<div >
            	<a href="javascript:void(0)" class="Diabtn-all" id="save">确定</a>
                <a href="javascript:art.dialog.close();" class="Diabtn-all-del" id="cancel">取消</a>
            </div>-->
        </div>
	</body>

	<script id="shopCityChooseCon" type="text/html">
		{{each list as value i}}
		<div class="p">
			<span class="t" data-id="{{value.id}}">{{value.province}}{{if value.list.length>=1}}({{/if}}</span>
			<span>{{each value.list as city j}}<em data-id="{{city.id}}">&nbsp;{{city.city}};</em>{{/each}}</span> {{if value.list.length>=1}}<span>)</span>{{/if}}
		</div>
		{{/each}}
	</script>

</html>