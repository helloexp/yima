<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>创建商品_旺财小店_翼码旺财</title>
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wnumgoods.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wshop.css?v=__VR__" rel="stylesheet" type="text/css" />
<load href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css" />
<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery-ui-1.11.2.custom/template.js?v=__VR__"></script>
</head>
<body>
    <div id="wrapper" class="nomalCon">
        <include file="./Home/Tpl/Public/Public_header.html" />
		<!--开始载入头部菜单--> 
        <include file="Shop/nav" navmenuid="Navproduct"/>
        <div id="container" class="bgfff">
            <div id="main" class="rel">
                <div class="shopCon">
                    <div class="main-name fn">
                        <h4 class="bd-b-565656">商品详情</h4>
                    </div>
                    <div id="store_check">
                        <div class="Gform l w700 <eq name='addStore' value='1'>dn</eq> fistForm">
                            <div id="Wform">
                                <ul>
                                    <li class="Gname">商品名称：</li>
                                    <li class="Ginput"><p class="Gtext">{$goodsinfo['goods_name']}</p></li>
                                </ul>
                                <php>if($goodsinfo['node_id']==C('df.node_id')){</php>
                                <ul>
                                    <li class="Gname">商品编号：</li>
                                    <li class="Ginput"><p class="Gtext">{$goodsinfo['batch_no']}</p></li>
                                </ul>
                                <php>}</php>
                                 <ul>
                                        <li class="Gname">商品图片：</li>
                                        <li class="Ginput">
                                            <img src="<?php echo get_upload_url($goodsinfo['goods_image'])?>" id="img_resp_show" width="150" class="mt10"/>
                                        </li>
                                 </ul>
                                 <ul>
                                    <li class="Gnmae">*&nbsp;开启订购功能：</li>
                                    <li class="Ginput">
                                        <p><if condition="$goodsinfo.is_order eq 2">开启<else />关闭</if></p>
                                    </li>
                                </ul>
                                <div id="openOrder" class="<if condition="$goodsinfo.is_order eq 2"><else />dn</if>">
                                    <ul>
                                        <li class="Gnmae">*&nbsp;配送周期：</li>
                                        <li class="Ginput">
                                            <p id="pszq">&nbsp;</p>
                                        </li>
                                    </ul>
                                    <ul>
                                        <li class="Gnmae">*&nbsp;订购周期：</li>
                                        <li class="Ginput">
                                            <div class="skuOrderRule fn">
                                                
                                            </div>
                                        </li>
                                    </ul>
                                    <ul style="margin-top:-10px;">
                                        <li class="Gnmae">*&nbsp;短信通知：</li>
                                        <li class="Ginput">
                                        	<p><if condition="$cycleInfo['cycle_notice_falg'] eq '1'">开启系统自动发送送货通知短信服务<span class="red">（收费标准 0.1 元/条）</span><else />未开启系统自动发送送货通知短信服务</if></p>
                                            <if condition="$cycleInfo['cycle_notice_falg'] eq '1'">
                                            <div class="cl"></div>
                                            配送前<if condition="$cycleInfo.cycle_notice_before_day">{$cycleInfo.cycle_notice_before_day}</if>天，发送发货通知短信
                                            </if>
                                        </li>
                                    </ul>
                                </div>
				<ul class='not_skuinfos'>
                                    <li class="Gname">商品价格：</li>
                                    <li class="Ginput"><p class="Gtext">{$goodsinfo['market_price']}&nbsp;元</p></li>
                                </ul>
                                <ul class='not_skuinfos'>
                                    <li class="Gname">商品数量：</li>
                                    <li class="Ginput"><p class="Gtext"><if condition="$goodsinfo['storage_type'] eq 0">不限<else />{$goodsinfo['storage_num']}</if></p></li>
                                </ul>
                                <ul class='sku_infos'>
                                    <li class="Gname">商品价格：</li>
                                    <li class="Ginput">
                                        <div class="judgeCon-time" style="width:680px; padding-bottom:10px;">
                                                <div class="skuTable"></div>
                                        </div>
                                    </li>    
                                </ul>
                                
				<ul class='not_skuinfos'>
                                    <li class="Gname">剩余数量：</li>
                                    <li class="Ginput"><p class="Gtext"><if condition="$goodsinfo['storage_type'] eq 0">不限<else />{$goodsinfo['remain_num']}</if></p></li>
                                </ul>
                                <php>if($is_cnpc_gx){</php>
                                <ul>
                                    <li class="Gname">所属商户：</li>
                                    <li class="Ginput"><p class="Gtext">{$merchant[$goodsinfo['goods_id']]}</p></li>
                                </ul>
                                <php>}</php>
								<ul>
                                    <li class="Gname">商品描述：</li>
                                    <li class="Ginput"><p class="Gtext">{$goodsinfo['goods_desc']|nl2br}</p></li>
                                </ul>
                                <ul>
                                    <li class="Gname">可验证门店：</li>
                                    <li class="Ginput"><p class="Gtext">
                                                                <if condition="$goodsinfo['pos_group_type'] eq 1">
                                                                    所有门店可用
                                                                    <else />
                                                                    <volist name="storeList" id="vo"  key="k">
                                                                        <dl>
                                                                            <dt><p>门店名：{$vo.store_name}</p></dt>
                                                                            <dd>门店地址：{$vo.address}<br>门店店长：{$vo.principal_name}<br>门店热线：<a href="tel:{$vo.store_phone}">{$vo.store_phone}</a></dd>
                                                                        </dl>
                                                                        <br />
                                                                    </volist>
                                                                </if></p></li>
                                </ul>
<!--								<ul>
									<li class="Gname">&nbsp;彩信标题：</li>
									<li class="Ginput"><p class="Gtext">{$goodsinfo['mms_title']}</p></li>
								</ul>
								<ul>
									<li class="Gname">&nbsp;彩信内容：</li>
									<li class="Ginput"><p class="Gtext">{$goodsinfo['mms_text']}</p></li>
								</ul>-->
								<ul>
									<li class="Gname">&nbsp;打印内容：</li>
									<li class="Ginput"><p class="Gtext">{$goodsinfo['print_text']}</p></li>
								</ul>
								<ul>
									<li class="Gname">&nbsp;</li>
									<li class="Ginput"><a href="javascript:history.go(-1);" id="sub_button" class="btn-all w110">返回</a></li>
								</ul>
                            </div>
                        </div>
                    </div>
                </div>
             </div>
        </div>
        <include file="./Home/Tpl/Public/Public_footer.html" />
    </div>
    <div class="service"></div>
</body>
</html>
<script>
var newid = 1;
var data = {
	cookiename:"",
	cookielist:"",
	length:function(){
		var l = 0;
		for(var i=0;i<data.namelist.length;i++){
			if(data.namelist[i].list!=""){
				l++;
			}
		}
		if(l==0){l="";}
		return l;
	},
	length2:function(){
		var l = 0;
		for(var i=0;i<data.namelist.length;i++){
			if(data.namelist[i].list!=""){
				l++;
			}
		}
		return l+2;
	},
	length3:function(){
		var l = 0;
		if(data.namelist.length==1){
			l = 0;
		}else if (data.namelist.length==2){
			l = data.namelist[1].list.length;
		}else if (data.namelist.length==3){
			if(data.namelist[2].list.length!=0){
				l = data.namelist[1].list.length*data.namelist[2].list.length;
			}else{
				l = data.namelist[1].list.length;
			}
		}
		if(l==0){l="";}
		return l;
	},
	length4:function(){
		var l = 0;
		if (data.namelist.length==2){
			l = 0;
		}else if (data.namelist.length==3){
			l = data.namelist[2].list.length;
		}
		if(l==0){l="";}
		return l;
	},
	namelist: [{$skutype}],
	price : [{$skudetail}]
};
//大部分修改预览
$(document).ready(function(e){
        var is_sku = '{$isSku}';
        if( false == is_sku ){
            $('.not_skuinfos').show();
            $('.sku_infos').hide();
        }else{
            $('.sku_infos').show();
            $('.not_skuinfos').hide();
        }
	begin(data);
	//设置总库存:检测数值
	$("body").on("change keyup click","input[name='allprice'],input[name='allnum'],input[name='allsellprice']",function(e){
		var t = $(this),
			i = t.closest("td").find(".icon-skuOk"),
			v = t.val();
		v=="" ? i.addClass("erro") : i.removeClass("erro");
	});
	//设置总库存:确认
	$("body").on("click",".skuOk-allprice:not('.erro'),.skuOk-allnum:not('.erro'),.skuOk-allsellprice:not('.erro')",function(e){
		var t = $(this),
			h = t.hasClass("skuOk-allprice"),
			i = t.closest("td").find("input"),
			v = i.val();
		if(t.hasClass("skuOk-allprice")){
			h="allprice";
		}else if(t.hasClass("skuOk-allnum")){
			h="allnum";
		}else if(t.hasClass("skuOk-allsellprice")){
			h="allsellprice";
		}else{h= false;}
		if(h=="allprice"){
			var r = /^[\-\+]?((([0-9]{1,3})([,][0-9]{3})*)|([0-9]+))?([\.]([0-9]+))?$/;
			r = r.test(v);
			if(r){
				$("input[name='price']").val(v);
			}else{
				i.addClass("shopFormBannerAn");
				setTimeout(function(){
					i.removeClass('shopFormBannerAn')
				},1000);
			}
		}else if(h=="allnum"){
			var r = /^[\-\+]?\d+$/;
			r = r.test(v);
			if(r){
				$("input[name='num']").val(v);
				$("#all").text("已设置的总库存为："+$("input[name='num']").length*v+"，不填写库存，则商品库存为不限,总共0处为不限");
			}else{
				i.addClass("shopFormBannerAn");
				setTimeout(function(){
					i.removeClass('shopFormBannerAn')
				},1000);
			}
		}else if(h=="allsellprice"){
			var r = /^[\-\+]?((([0-9]{1,3})([,][0-9]{3})*)|([0-9]+))?([\.]([0-9]+))?$/;
			r = r.test(v);
			if(r){
				$("input[name='sellprice']").val(v);
			}else{
				i.addClass("shopFormBannerAn");
				setTimeout(function(){
					i.removeClass('shopFormBannerAn')
				},1000);
			}
		}
		t.addClass("erro");
		i.val("");
	});
	//设置总库存:库存总数预览
	$("body").on("change keyup","[name='num']",function(e){
		var l = 0;
		var t = 0;
		for(var i=0;i<$("[name='num']").length;i++){
			if($("[name='num']:eq("+i+")").text()=="" || $("[name='num']:eq("+i+")").text()=="不限"){
				t++;
			}else{
				l += parseInt($("[name='num']:eq("+i+")").text());
			}
		}
		$("#all").text("已设置的总库存为："+l+"，不填写库存，则商品库存为不限,总共"+t+"处为不限");
	});
});
function findorder(){
	var isorder = false;
	for(var i=0;i<data.namelist.length;i++){
		if(data.namelist[i].ordertype){
			if(data.namelist[i].ordertype==0){
				data.namelist[i].ordertype=false;
			}else{
				isorder = i
				break;
			}
		}
	}
	return isorder
}
function begin(data){
	var isorder = findorder();
	if(data.namelist.length!=0){
		$(".sku1").show();
		$(".sku2").hide();
		for(var i=0;i<data.namelist.length;i++){
			var namelist = data.namelist[i];
			namelist["newid"] = newid;
			newid++;
			if(namelist.list!=""){
				for(var j=0;j<namelist.list.length;j++){
					var list = namelist.list[j];
					list["newid"] = newid;
					newid++;
				}
			}
		}
		if(isorder!=false || isorder===0){
			var pszq = ["月","周","日"];
			$("#pszq").text(pszq[isorder]);
			var newdata = data.namelist;
			data.namelist = data.namelist.slice(0,isorder).concat(data.namelist.slice(isorder+1,data.namelist.length));
			data.namelist.push(newdata[isorder]);
		}
	}else{
		$(".sku1").hide();
		$(".sku2").show();
	};
	isorder = findorder();
	data["erromsg"] = "";
	for(var i=0;i<data.namelist.length;i++){
		if(data.namelist[i]){
			if(data.namelist[i].name == ""){
				data["erromsg"] = "您的第"+i+"项sku未设置，无法显示价格与库存";
				if(data.namelist[i].ordertype){
					data["erromsg"] = "您的订购周期未设置，无法显示价格与库存";
				}
				break;
			}else{
				if(data.namelist[i].list.length == 0){
					data["erromsg"] = '您的"'+data.namelist[i].name+'"未设置，无法显示价格与库存';
					if(data.namelist[i].ordertype){
						data["erromsg"] = "您的订购周期未设置，无法显示价格与库存";
					}
					break;
				}
			}
		}
	}
	var html = template("skuList",data);
	var html2 = template("skuTable",data);
	if(isorder!=false || isorder===0){
		var html3 = template("skuOrderRule",data.namelist[isorder]);
		$(".skuOrderRule").html(html3);
	}
	$(".skuForm").html(html);
	$(".skuTable").html(html2);
	$(".skuList").each(function(index, element) {
		var z = 10-index;
        $(this).css("z-index",z);
    });
	$("[name='price']").each(function(index, element) {
		var t = $(this),
			id = t.attr("data-id");
		for(var i=0;i<data.price.length;i++){
			if(data.price[i].id.toString()==id){
				t.text(data.price[i].price);
				//t.next("span").text(t.val());
				data.price[i]["newid"]=t.attr("data-newid");
			}
		}
    });
	$("[name='num']").each(function(index, element) {
		var t = $(this),
			id = t.attr("data-id");
		for(var i=0;i<data.price.length;i++){
			if(data.price[i].id.toString()==id){
				if(Number(data.price[i].num)>=0){
					t.text(data.price[i].num);
					t.next("span").text(data.price[i].remain_num);
					var up_num = data.price[i].num - data.price[i].remain_num;
					t.next("span").next("span").text(up_num);
					t.attr("class","validate[required,custom[number],min[0],max["+data.price[i].num+"]]");
				}else if(Number(data.price[i].num)==-1){
					t.text("不限");
					t.next("span").text(t.text());
                                        t.next("span").next("span").text(t.text());
				}
			}
		}
    });
	$("[name='sellprice']").each(function(index, element) {
		var t = $(this),
			id = t.attr("data-id");
		for(var i=0;i<data.price.length;i++){
			if(data.price[i].id.toString()==id){
				t.text(data.price[i].sellprice);
				data.price[i]["newid"]=t.attr("data-newid");
			}
		}
    });
	if(isorder!=false || isorder===0){
		$("[name='allnum']").attr("disabled",true);
		$("[name='num']").attr("disabled",true);
                $('#count_num').val('-1');
		$("#all").html("<p class='red'>开启订购功能后，商品库存全部为不限</p>");
	}else{
		var l = 0;
		var t = 0;
		for(var i=0;i<$("input[name='num']").length;i++){
			if($("input[name='num']:eq("+i+")").val()=="" || $("input[name='num']:eq("+i+")").val()=="不限" || $("input[name='num']:eq("+i+")").val()=="-1"){
				t++;
			}else{
				l += parseInt($("input[name='num']:eq("+i+")").val());
			}
		}
			if(t > 0)
				$('#count_num').val('-1');
			else
				$('#count_num').val(l);
		$("#all").text("已设置的总库存为："+l+"，总共"+t+"处为不限");
	}
	if(data.namelist.length>=3){
		$(".addsku").addClass("hide");
	}else{
		$(".addsku").removeClass("hide");
	}
}
</script>

<script id="skuList" type="text/html">
{{each namelist}}
{{if !value.ordertype}}
<div class="skuList" data-id="{{value.id}}" data-newid="{{value.newid}}">
	<div class="skuListHead fn">
		<i class="icon-skuDel r"><a href="javascript:void(0)" class="a-hide">删除</a></i>
		<div class="searchInput">
			<span data-id="{{value.id}}" data-newid="{{value.newid}}">{{value.name}}</span>
			<i class="icon-skuEdit">
				<a href="javascript:void(0)" class="a-hide">修改</a>
			</i>
			<div class="searchInput-edit dn">
				<div class="input">
				<input type="text" maxlength="6">
					<i class="icon-skuOk erro">
						<a href="javascript:void(0)" class="a-hide">修改</a>
					</i>
				</div>
				<dl class="valLsit">
					{{each cookiename}}
					<dd>{{value}}</dd>
					{{/each}}
					<dd class="nodata dn">"回车"创建临时规格</dd>
				</dl>
				<div class="valLsitclose"></div>
			</div>
		</div>
	</div>
	<div class="skuCon fn">
		<div class="skuRule" data-newid="{{value.newid}}">
			{{each value.list}}
			<div class="skuRuleItem" data-id="{{value.id}}" data-newid="{{value.newid}}">{{value.val}}<i></i></div>
			{{/each}}
			<div class="skuRuleAdd">
				<div class="input">
					<input type="text" maxlength="8" class="validate[required,funcCall[checkorder]] orderAddinput">
					<i class="icon-skuOk erro">
						<a href="javascript:void(0)" class="a-hide">修改</a>
					</i>
				</div>
				<dl class="valLsit">
					{{each cookielist}}
					<dd>{{value}}</dd>
					{{/each}}
					<dd class="nodata dn">"回车"创建临时类别</dd>
				</dl>
				<div class="valLsitclose"></div>
				<div class="skuRuleBtn">
					<i></i>添加类型
				</div>
			</div>
		</div>
	</div>
</div>
{{/if}}
{{/each}}
<div class="addsku">
	<i></i>
	<span>添加规格</span>
</div>
</script>

<script id="skuRuleItem" type="text/html">
<div class="skuRuleItem">{{name}}<i></i></div>
</script>


<script id="skuTable" type="text/html">
{{if erromsg!=""}}
	<p class="erro">{{erromsg}}</p>
{{else}}
	<table cellpadding="0" cellspacing="0" class="sku-table big">
		<tr>
		{{each namelist}}
			{{if value.list!=""}}<th data-id="{{value.id}}" data-newid="{{value.newid}}">{{if value.ordertype}}订购周期{{else}}{{value.name}}{{/if}}</th>{{/if}}
		{{/each}}
			<th width="100" >原价(元)</th>
			<th width="200" >商品总数&nbsp;|&nbsp;库存&nbsp;|&nbsp;出售数量</th>
		</tr>
		<tr>
		{{if namelist.length == 1}}
			{{each namelist[0].list as value j}}
			<tr>
				<td rowspan="{{length3}}" data-id="{{value.id}}" data-newid="{{value.newid}}">{{value.val}}{{if namelist[0].ordertype}}{{if namelist[0].ordertype==1}}个{{/if}}{{namelist[0].name}}{{/if}}</td>
				<td class="tl"><em name="price" class="validate[required,custom[number],min[0]]" data-id="{{value.id}}"  data-newid="{{value.newid}}"></em></td>
				<td class="tl"><em name="num" class="validate[custom[number],min[0]]" data-id="{{value.id}}"  data-newid="{{value.newid}}"></em><span>&nbsp;</span><span>&nbsp;</span></td>
			</tr>
			{{/each}}
		{{/if}}
		
		{{if namelist.length == 2}}
			{{each namelist[0].list as value j}}
			<tr>
				<td rowspan="{{length3}}" data-id="{{value.id}}" data-newid="{{value.newid}}">{{value.val}}{{if namelist[0].ordertype}}{{if namelist[0].ordertype==1}}个{{/if}}{{namelist[0].name}}{{/if}}</td>
					{{each namelist[1].list as value1 j}}
						<td rowspan="{{length4}}" data-id="{{value1.id}}" data-newid="{{value1.newid}}">{{value1.val}}{{if namelist[1].ordertype}}{{if namelist[1].ordertype==1}}个{{/if}}{{namelist[1].name}}{{/if}}</td>
						<td class="tl"><em name="price" class="validate[required,custom[number],min[0]]" data-id="{{value.id}},{{value1.id}}"  data-newid="{{value.newid}},{{value1.newid}}"></em></td>
						<td class="tl"><em name="num" class="validate[custom[number],min[0]]" data-id="{{value.id}},{{value1.id}}"  data-newid="{{value.newid}},{{value1.newid}}"></em><span>&nbsp;</span><span>&nbsp;</span></td>
						</tr>
					{{/each}}
			{{/each}}
		{{/if}}
		
		{{if namelist.length == 3}}
			{{each namelist[0].list as value j}}
			<tr>
				<td rowspan="{{length3}}" data-id="{{value.id}}" data-newid="{{value.newid}}">{{value.val}}{{if namelist[0].ordertype}}{{if namelist[0].ordertype==1}}个{{/if}}{{namelist[0].name}}{{/if}}</td>
					{{each namelist[1].list as value1 j}}
						<td rowspan="{{length4}}" data-id="{{value1.id}}" data-newid="{{value1.newid}}">{{value1.val}}{{if namelist[1].ordertype}}{{if namelist[1].ordertype==1}}个{{/if}}{{namelist[1].name}}{{/if}}</td>
							{{each namelist[2].list as value2 j}}
								<td data-id="{{value2.id}}" data-newid="{{value2.newid}}">{{value2.val}}{{if namelist[2].ordertype}}{{if namelist[2].ordertype==1}}个{{/if}}{{namelist[2].name}}{{/if}}</td>
								<td class="tl"><em name="price" class="validate[required,custom[number],min[0]]" data-id="{{value.id}},{{value1.id}},{{value2.id}}"  data-newid="{{value.newid}},{{value1.newid}},{{value2.newid}}"></em></td>
								<td class="tl"><em name="num" class="validate[custom[number],min[0]]" data-id="{{value.id}},{{value1.id}},{{value2.id}}"  data-newid="{{value.newid}},{{value1.newid}},{{value2.newid}}"></em><span>&nbsp;</span><span>&nbsp;</span></td>
								</tr>
							{{/each}}
					{{/each}}
			{{/each}}
		{{/if}}
		<tr>
			<td colspan="{{length2}}" id="all">{{allnum}}</span></td>
		</tr>
	</table>
{{/if}}
</script>

<script id="skuOrderRule" type="text/html">
<div class="skuRule" data-newid="{{newid}}">
	{{each list as value i}}
	<div class="skuRuleItem" data-id="{{value.id}}" data-newid="{{value.newid}}">{{value.val}}{{if ordertype==1}}个{{/if}}{{name}}</div>
	{{/each}}
</div>
</script>