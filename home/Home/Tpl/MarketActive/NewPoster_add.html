<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>电子海报_营销活动_翼码旺财</title>
<meta name="Keywords" content="{:C('SITE_KEYWORDS')}">
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/Css/Wposter2.css?v=__VR__" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css" />
<link rel="stylesheet" href="__PUBLIC__/Js/umeditor/themes/poster/css/umeditor.css" />
<script type="text/javascript" src="__PUBLIC__/Js/jquery-2.1.1.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery-ui-1.11.2.custom/jquery-ui.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery-ui-1.11.2.custom/template.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/angularjs/angular.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/angularjs/angular-sanitize.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery-ui-1.11.2.custom/jquery.hotkeys.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/Wposter2.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/Wposterdata.js?v=__VR__"></script>
<link href="__PUBLIC__/Js/jscolor/spectrum.css?v=__VR__" rel="stylesheet" type="text/css">
<script type="text/javascript" src="__PUBLIC__/Js/jscolor/spectrum.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/umeditor/umeditor.config.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/umeditor/umeditor.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__"></script>
</head>
<!--[if IE]><div class="IEallerro"><a href="https://www.baidu.com/s?wd=chrome&rsv_spt=1&rsv_iqid=0xeb4be7aa00008a34&issp=1&f=8&rsv_bp=0&rsv_idx=2&ie=utf-8&tn=baiduhome_pg&rsv_enter=1&rsv_sug3=3&rsv_sug1=3&rsv_sug7=100" target="_blank">前去下载</a></div><![endif]-->
<body ng-app="app" ng-cloak>
    <!-- 先体验后注册 增加遮罩层 开始 -->

    <div id="wrapper" ng-controller="poster" ng-model="ModChecked" class="no" ui-hotkey>

    <div class="Mask"  ng-show="Mask">
        <div class="MaskBg"></div>
        <div class="MaskInfo">
            <div class="top"></div>
            <div class="left"></div>
            <div class="right"></div>
            <div class="body">
                <a class="tiyan" ng-click="tiyan()" href="javascript:void(0)"></a>
                <a class="reg" ng-click="reg()" data-type="reg" href="javascript:void(0)"></a>
            </div>
        </div>
    </div>
    <!-- 先体验后注册 增加遮罩层 结束 -->
    	<eq name="isTempUser" value="1">
    	<include file="./Home/Tpl/Public/Public_temp_node_header.html" />
    	<else />
    	<include file="./Home/Tpl/Public/Public_header.html" />
        </eq>
        <form action="{:U('MarketActive/NewPoster/add')}" method="post" name="theform" id="theform" enctype="multipart/form-data">
        <input type="hidden" id="batch_id" name="batch_id" value="{$batch_id}">
        <input type="hidden" id="batch_type" name="batch_type" value="{$batch_type}">
        <input type="hidden" id="memo" name="memo" value="">
        <input type="hidden" id="autoSave" name="autoSave" value="0">
        <input type="hidden" id="isPreview" name="isPreview" value="0">
        <input type="hidden" id="m_id" name="id" value="{$id}">
        <div id="container" class="p0">
        	<!--[if IE]><div class="IEmsgerro">您的浏览器无法使用该模块功能,请使用<span>Chrome谷歌浏览器</span>或切换至<span>极速模式</span>/<span>高速模式</span>进行操作</div><![endif]-->
            <div class="Pheader">
            	<div class="GheaderTitle">
                	<a href="javascript:void(0)" class="btn-close">电子海报</a>
                </div>
                <div class="GheaderAdd">
                    <div class="GheaderAddItem" ng-repeat="value in classmod" ng-if="value.type!='svg'" ui-adddraggable ng-click="value.data.length || adddraggable(value)" data-mod="{{value.type}}" ng-class="{disabled:value.data.length,height:value.data.length}">
                    	<div class="GheaderAddHandle"><i class="font-icon" ng-class="value.icon"></i>{{value.name}}</div>
                        <div class="GheaderAddItemNav" ng-if="value.data.length">
                        	<div class="arrow"><i class="line9"></i><i class="line7"></i><i class="line5"></i><i class="line3"></i><i class="line1"></i><i class="line0"></i></div>
                        	<ul>
                            	<li ng-repeat="v in value.data" ng-click="adddraggable(v)"><i class="font-icon" ng-class="v.icon"></i>{{v.name}}</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="GheaderOpr">
                    <a href="javascript:void(0)" id="btn-basic"><i class="font-icon icon-cog"></i>基础设置</a>
                    <a href="javascript:void(0)" id="btn-view" ng-click="saveview()"><i class="font-icon icon-qrcode"></i>预览</a>
                    <a href="javascript:void(0)" id="btn-save" ng-click="save('','1')"><i class="font-icon icon-floppy-1"></i>保存</a>
                                        
                    <a ng-if="isTempUser" href="/index.php?g=Home&m=Wservice&a=windex&wserver_id=2" target="_blank"><i class="font-icon icon-tags"></i>定制</a>
                    <a ng-if="isTempUser" href="javascript:void(0)" class="btn-close"><i class="font-icon icon-left-big"></i>返回</a>
                </div>
            </div>
        	<div id="main" class="rel">
            	<div class="sidebar">
                    <div class="market">
                        <div class="marketTit">
                            <p>页面模板</p>
                        </div>
                        <div class="marketCon">
                        	<div class="marketNav">
                            	<ul>
                                	<li ng-repeat="value in moddata" ng-class="{hover:value==mymoddata}" ng-click="marketNav(value)"><a href="javascript:void(0)">{{value.type}}</a></li>
                                </ul>
                            </div>
                        	<div class="marketList">
                            	<dl>
                                	<dt>
                                    	<a href="javascript:void(0)" ng-repeat="value in mymoddata.list" ng-class="{hover:value==mymoddatalist,dn:value.type==''}" ng-click="marketList(value)">{{value.type}}</a>
                                    </dt>
                                    <dd ng-repeat="value in mymoddatalist.list">
                                    	<div class="marketListItem" ng-if="value.viewimg" ng-click="choosemarket(value.data)"><img ng-src="{{value.viewimg}}"></div>
                                    	<div class="marketListItem" ng-if="!value.viewimg" ng-click="choosemarket(value.data)">
                                    		<div class="marketListItemDel" ng-if="mymoddata.id==4" ng-click="delmoddata(value)" title="删除模板"><i class="icon-trash-empty"></i></div>
                                        	<div class="swrapperCon-bgCon"><div class="swrapperCon-bg an{{value.data.backgroundAn}}" ng-style="{'background-image':'url('+value.data.backgroundImg+')','background-color':value.data.backgroundColor}"></div></div>
                                        	<div ng-repeat="value in value.data.mod" ng-show="value.beginAn || value.animation.delay===0" class="Modlist" ng-style="{'top':value.top/4+'px','left':value.left/4+'px','z-index':value.zIndex,'width':value.width+'px','height':value.height+'px'}" style="-webkit-transform:scale(0.25,0.25);transform:scale(0.25,0.25); -webkit-transform-origin:left top;transform-origin:left top;">
                                                <div class="ModlistCon" ng-style="{'opacity':1-value.opacity/100,'background-color':value.data.backgroundColor,'-webkit-transform':'rotate('+value.rotate+'deg)'}">
                                                    <div class="ModlistBox" ng-switch="value.name" ng-style="{'background-image':'url('+value.backgroundImg+')','background-color':value.backgroundColor,'opacity':1-value.opacity/100,'border-width':value.borderWidth+'px','border-color':value.borderColor,'border-style':value.borderStyle,'border-radius':value.borderRadius+'px','box-shadow':value.boxShadowX+'px '+value.boxShadowY+'px '+value.boxShadowV+'px '+value.boxShadowColor+' '+value.boxShadowT,'text-shadow':value.textShadowX+'px '+value.textShadowY+'px '+value.textShadowV+'px '+value.textShadowColor,'-webkit-animation':value.animation.name=='fadeOut' || value.animation.name=='fadeOutLeft' || value.animation.name=='fadeOutRight' || value.animation.name=='fadeOutDown' || value.animation.name=='fadeOutUp' || value.animation.name=='flipOutX' || value.animation.name=='flipOutY' || value.animation.name=='zoomOut' || value.animation.name=='rotateOut' || value.animation.name=='lightSpeedOut' ? value.animation.name+' '+value.animation.duration+'s '+value.animation.delay+'s '+value.animation.count+' none':value.animation.name+' '+value.animation.duration+'s '+value.animation.count+' forwards'}">
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="text">
                                                            <div class="ueditorFix" ng-bind-html="value.text | toHtml"></div>
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="img">
                                                            <img ng-src="{{value.src}}" />
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="button">
                                                            <a href="javascript:void(0)" data-url="{{value.button.link}}"><span ng-style="{'color':value.button.color,'font-size':value.button.size+'px','line-height':value.height+'px'}">{{value.button.text}}</span></a>
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="imglist">
                                                            <div class="imglistFlash" data-length="{{value.imglist.length}}" ui-flash>
                                                                <ul>
                                                                    <li ng-repeat="v in value.imglist" style="background-image:url({{v.src}})"></li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="tel">
                                                            <a href="tel:{{value.tel.tel}}"><span ng-style="{'color':value.tel.color,'font-size':value.tel.size+'px','line-height':value.height+'px'}">{{value.tel.text}}</span></a>
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="input" data-id="{{value.input.form}}">
                                                            <div class="ModlistBox-form-input"><span ng-style="{'line-height':value.height+'px'}"><em ng-show="value.input.must" ng-hide="!value.input.must">*</em>{{value.input.text}}</span></div>
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="formbtn" data-id="{{value.formbtn.form}}">
                                                            <a href="javascript:void(0)"><span ng-style="{'color':value.formbtn.color,'font-size':value.formbtn.size+'px','line-height':value.height+'px'}">{{value.formbtn.text}}</span></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="submain">
                    <div class="subconFix subconFix1" ng-click="swrapperCon()" ng-show="!isfouce" ng-hide="!isfouce" ng-style="{'height':foucefixed.top+myMod.top}">1</div>
                    <div class="subconFix subconFix2" ng-click="swrapperCon()" ng-show="!isfouce" ng-hide="!isfouce" ng-style="{'top':foucefixed.top+myMod.top+myMod.height+2}"></div>
                    <div class="subconFix subconFix3" ng-click="swrapperCon()" ng-show="!isfouce" ng-hide="!isfouce" ng-style="{'width':foucefixed.left+myMod.left}"></div>
                    <div class="subconFix subconFix4" ng-click="swrapperCon()" ng-show="!isfouce" ng-hide="!isfouce" ng-style="{'left':foucefixed.left+myMod.left+myMod.width+4}"></div>
                    <div class="subcon">
                        <div class="Mcon" ng-style="{'margin-right':!isTempUser ? 0 : 50+'px'}" ng-model="myPage" ui-selectable ng-click="swrapperCon()">
                        	<div class="mypage">
                                <div class="mypageTit">
                                    <p>页面管理</p>
                                </div>
                                <div class="mypageCon">
                                    <div class="mypageList">
                                        <dl ng-model="pages" ui-sortable>
                                            <dd ng-repeat="value in pages" ng-class="{hover:value==myPage}" ng-click="choose(value)">
                                            	<div class="em">{{ $index+1 }}</div>
                                                <div class="tit"><span>{{ value.name }}</span><p><input type="text" ng-model="value.name" value="{{ value.name }}"></p><div class="bgfixed"></div></div>
                                                <div class="opr">
                                                	<i class="font-icon icon-docs" ng-click="copypage(value,$index)" title="复制一个"></i>
                                                    <i class="font-icon icon-trash-empty" ng-click="delpage($index)" title="删除"></i>
                                                    <i class="font-icon icon-floppy" ng-click="savenew(value)" title="保存至我的模板"></i>
                                                </div>
                                            </dd>
                                        </dl>
                                    </div>
                                    <div ng-model="pages" class="addmypage" ng-click="addpage()"><i class="font-icon icon-plus-squared-alt"></i>新增页面</div>
                                </div>
                            </div>
                            <div id="phone">
                                <div class="phonetitle"><span class="pagetitle" ng-model="basicData">{{ basicData.title }}</span></div>
                                <div class="leftopr">
                                  <i class="font-icon icon-reply" title="撤销(Ctrl+z)" data-placement="left" ng-class="{ok:history.nowhistory!=0}" ng-click="goHistory('prev')"></i>
                                  <i class="font-icon icon-forward" title="恢复(Ctrl+y)" data-placement="left" ng-class="{ok:history.nowhistory!=history.history.length-1}" ng-click="goHistory('next')"></i>
                                  <i class="font-icon icon-eraser" ng-click="clearpage(myPage)" ng-class="{ok:myPage.mod.length!=0 || myPage.backgroundColor!='' || myPage.backgroundImg!=''}" title="清空当前页面内容Ctrl+z" data-placement="left"></i>
                                  <i class="font-icon icon-play-circled ok" ng-click="rechoose(myPage)" title="动画重放" data-placement="left"></i>
                                  <i class="font-icon icon-th" ng-click="changeth()" ng-class="{ok:line!=0}" title="网格及辅助线" data-placement="left"></i>
                                </div>
                                <div class="rightopr">
                               	  <div class="bgopr" title="更换背景" ng-click="changebg()" data-placement="right">背<br>景<i class="font-icon icon-cog"></i></div>
                                  <div class="bgoprCon">
                                    <i class="font-icon icon-blank" ng-class="{ok:myPage.backgroundColor!=''}" ng-click="changebgcolor()" title="更换背景色" data-placement="right"></i>
                                    <div class="bgoprcolor" ng-class="{show:display==15}" ng-mousedown="$event.stopPropagation();" ng-click="$event.stopPropagation();"><input type="color" ng-model="myPage.backgroundColor" ui-spectrum><input type="text" ng-model="myPage.backgroundColor"></div>
                                   	<i class="font-icon icon-rocket" ng-class="{ok:myPage.backgroundAn!=0}" ng-click="backgroundAn()" title="开启动画背景" data-placement="right"></i>
                                   	<i class="font-icon icon-trash" ng-class="{ok:myPage.backgroundImg!='' ||myPage.backgroundColor!=''}" ng-click="myPage.backgroundImg ='';myPage.backgroundColor =''" title="删除背景" data-placement="right"></i>
                                  </div>

                                  <div class="bgopr mt20" title="更换音乐" id="btn-music" data-placement="right">音<br>乐<i class="font-icon icon-music"></i></div>
                                  <div class="bgoprCon">
                                    <i class="font-icon icon-trash" ng-class="{ok:basicData.music !=''}" id="delbtn-music" title="删除音乐" data-placement="right"></i>
                                  </div>
                                </div>
                                <div id="phoneCon" on-finish-render>
                                    <div class="swiperAll" data-id="{{myPage.id}}" ng-contextmenu="checkCopy()">
                                        <div class="swrapperCon-bgCon"><div class="swrapperCon-bg an{{myPage.backgroundAn}}" ng-style="{'background-image':'url('+myPage.backgroundImg+')','background-color':myPage.backgroundColor}"></div></div>
                                        <div class="swrapperCon">
                                        	<div ng-repeat="value in myPage.mod" ng-mouseDown="ModChecked.length>=2 || choosemyModMouseDown(value)" ng-click="choosemyMod(value)" ng-contextmenu="choosemyMod(value,true)" ng-dblclick="myModedit(value)" ng-model="value" ui-draggable class="Modlist" ng-class="{modlistan:value.addan,editing:value==myMod || value.ModChecked,uidisable:value==myMod,lock:value.lock || value.lock==1}" ng-style="{'top':value.top+'px','left':value.left+'px','z-index':value.zIndex,'width':value.width+'px','height':value.height+'px','-webkit-transform':'rotate('+value.rotate+'deg)'}" ng-show="value.hide==''" ng-hide="value.hide==1">
                                            	<div class="ModlistCon" ng-style="{'opacity':1-value.opacity/100}">
                                                    <div class="ModlistBox" ng-show="value.beginAn || value.animation.delay===0" ng-model="value" ng-switch="value.name" ng-style="{'background-image':'url('+value.backgroundImg+')','background-color':value.backgroundColor,'border-width':value.borderWidth+'px','border-color':value.borderColor,'border-style':value.borderStyle,'border-radius':value.borderRadius+'px','box-shadow':value.boxShadowX+'px '+value.boxShadowY+'px '+value.boxShadowV+'px '+value.boxShadowColor+' '+value.boxShadowT,'text-shadow':value.textShadowX+'px '+value.textShadowY+'px '+value.textShadowV+'px '+value.textShadowColor,'-webkit-animation':value.animation.name=='fadeOut' || value.animation.name=='fadeOutLeft' || value.animation.name=='fadeOutRight' || value.animation.name=='fadeOutDown' || value.animation.name=='fadeOutUp' || value.animation.name=='flipOutX' || value.animation.name=='flipOutY' || value.animation.name=='zoomOut' || value.animation.name=='rotateOut' || value.animation.name=='lightSpeedOut' ? value.animation.name+' '+value.animation.duration+'s '+value.animation.delay+'s '+value.animation.count+' none':value.animation.name+' '+value.animation.duration+'s '+value.animation.count+' forwards'}">
                                                        <div class="ModlistBox-{{value.name}}" ng-model="value.text" my-mod="value" ng-switch-when="text" ng-class="{showueditorFix:display==10}">
                                                        <div class="ueditorFix"></div>
                                                        <div class="fn" ng-model="value" id="{{value.edui.ue}}" ng-ueditor></div>
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-model="value.text" ng-switch-when="textsmall">
                                                        <p ng-style="{'line-height':value.text.lineheight+'em','font-size':value.text.fontsize+'px','color':value.text.color,'font-weight':value.text.fontweight,'text-align':value.text.textalign,'background-color':value.backgroundcolor}">{{value.text.text}}</p>
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="img">
                                                            <img ng-src="{{value.src}}" />
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="button">
                                                            <a href="javascript:void(0)" data-url="{{value.button.link}}"><span ng-style="{'color':value.button.color,'font-size':value.button.size+'px','line-height':value.height+'px'}">{{value.button.text}}</span></a>
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="imglist">
                                                            <div class="imglistFlash" data-length="{{value.imglist.length}}" ui-flash>
                                                                <ul>
                                                                    <li ng-repeat="v in value.imglist" style="background-image:url({{v.src}})"></li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="svg" ng-model="value.svg" my-svg>
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="tel">
                                                            <a data-href="tel:{{value.tel.tel}}"><span ng-style="{'color':value.tel.color,'font-size':value.tel.size+'px','line-height':value.height+'px'}">{{value.tel.text}}</span></a>
                                                        </div>
                                                        <!--div class="ModlistBox-{{value.name}}" ng-switch-when="form">
                                                            <ul>
                                                                <li ng-repeat="v in value.form.list"><div class="ModlistBox-form-input {{v.class}}">{{!v.must || "*"}}{{v.name}}</div></li>
                                                                <li><a class="b">{{value.button}}</a></li>
                                                            </ul>
                                                        </div-->
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="input" data-id="{{value.input.form}}">
                                                            <div class="ModlistBox-form-input"><span ng-style="{'line-height':value.height+'px'}"><em ng-show="value.input.must" ng-hide="!value.input.must">*</em>{{value.input.text}}</span></div>
                                                        </div>
                                                        <div class="ModlistBox-{{value.name}}" ng-switch-when="formbtn" data-id="{{value.formbtn.form}}">
                                                            <a href="javascript:void(0)"><span ng-style="{'color':value.formbtn.color,'font-size':value.formbtn.size+'px','line-height':value.height+'px'}">{{value.formbtn.text}}</span></a>
                                                        </div>
                                                    </div>
                                                    <div class="dn">
                                                        <input type="text" ng-model="value.top" data-position="top">
                                                        <input type="text" ng-model="value.left" data-position="left">
                                                        <input type="text" ng-model="value.width" data-position="width">
                                                        <input type="text" ng-model="value.height" data-position="height">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="swrapperCon-line2" ng-show="line==1">
                                            <div id="guideC"></div>
                                        </div>
                                        <div class="swrapperCon-line">
                                            <div id="guide"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="phone2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="editMenu" ng-show="display==1" ng-hide="display!=1">
            <dl>
                <dd ng-hide="modtype=='copy'"><a href="javascript:void(0)" ng-click="myModedit()"><i class="font-icon icon-edit"></i><span>编辑</span></a></dd>
                <!--dd ng-hide="modtype=='copy'"><a href="javascript:void(0)" ng-click="display=3"><i class="font-icon icon-th-large"></i><span>样式</span></a></dd>
                <dd ng-hide="modtype=='copy'"><a href="javascript:void(0)" ng-click="display=4"><i class="font-icon icon-paper-plane"></i><span>动画</span></a></dd-->
                <!--<dd><a href="javascript:void(0)" ng-click="display=5"><i class="font-icon icon-music"></i><span>音效</span></a></dd>-->
                <dd ng-hide="modtype=='copy'"><a href="javascript:void(0)" ng-click="fnpaste()"><i class="font-icon icon-docs"></i><span>复制</span></a></dd>
                <dd ng-show="copy.length>0" ng-hide="copy.length==0"><a href="javascript:void(0)" ng-click="fncopy()"><i class="font-icon icon-doc-text-inv"></i><span>黏贴</span></a></dd>
                <dd ng-hide="modtype=='text' || modtype=='tel' || modtype=='button' || modtype=='imglist' || modtype=='form' || modtype=='copy' || modtype=='input' || modtype=='formbtn'"><a href="javascript:void(0)" ng-click="myModlink()"><i class="font-icon icon-link"></i><span>链接</span></a></dd>
                <dd ng-hide="modtype=='copy'"><a href="javascript:void(0)" ng-click="delMod(myMod)"><i class="font-icon icon-trash-empty"></i><span>删除</span></a></dd>
            </dl>
        </div>
        <div class="editTxt" ng-show="display==10" ng-hide="display!=10" ui-move>
            <dl ng-show="modtype=='text'" ng-hide="modtype!='text'">
                <dd>
                    <a href="javascript:void(0)" title="字体"><i class="font-icon icon-vine"></i></a>
                    <div class="editTxtlist fontfamily">
                        <li style="font-family:'微软雅黑';" ng-click="edui1(myMod.edui.fontfamily,'默认字体')">默认字体</li>
                        <li style="font-family:'宋体';" ng-click="edui1(myMod.edui.fontfamily,'宋体')">宋体</li>
                        <li style="font-family:'方正静蕾简体';" ng-click="edui1(myMod.edui.fontfamily,'方正静蕾简体')">方正静蕾简体</li>
                        <li style="font-family:'方正正黑简体';" ng-click="edui1(myMod.edui.fontfamily,'方正正黑简体')">方正正黑简体</li>
                        <li style="font-family:'汉仪菱心简体';" ng-click="edui1(myMod.edui.fontfamily,'汉仪菱心简体')">汉仪菱心简体</li>
                        <li style="font-family:'Arial';" ng-click="edui1(myMod.edui.fontfamily,'Arial')">ArialArial</li>
                        <li style="font-family:'BRADHITC';" ng-click="edui1(myMod.edui.fontfamily,'BRADHITC')">BRADHITC</li>
                        <li style="font-family:'BRUSHSCI';" ng-click="edui1(myMod.edui.fontfamily,'BRUSHSCI')">BRUSHSCI</li>
                        <li style="font-family:'CASTELAR';" ng-click="edui1(myMod.edui.fontfamily,'CASTELAR')">CASTELAR</li>
                        <li style="font-family:'IMPACT';" ng-click="edui1(myMod.edui.fontfamily,'IMPACT')">IMPACT</li>
                        <li style="font-family:'KUNSTLER';" ng-click="edui1(myMod.edui.fontfamily,'KUNSTLER')">KUNSTLER</li>
                    </div>
                </dd>
                <dd>
                    <a href="javascript:void(0)" title="文字大小"><i class="font-icon icon-font"></i></a>
                    <div class="editTxtlist fontsize">
                        <li ng-click="edui1(myMod.edui.fontsize,12)">12px</li>
                        <li ng-click="edui1(myMod.edui.fontsize,16)">16px</li>
                        <li ng-click="edui1(myMod.edui.fontsize,18)">18px</li>
                        <li ng-click="edui1(myMod.edui.fontsize,24)">24px</li>
                        <li ng-click="edui1(myMod.edui.fontsize,32)">32px</li>
                        <li ng-click="edui1(myMod.edui.fontsize,48)">48px</li>
                        <!--li ng-click="edui1(myMod.edui.fontsize,62)">62px</li>
                        <li ng-click="edui1(myMod.edui.fontsize,78)">78px</li-->
                    </div>
                </dd>
                <dd>
                    <a href="javascript:void(0)" title="文字颜色"><i class="font-icon icon-th-large"></i></a>
                    <div class="editTxtlist color">
                        <div class="editTxtlistInput">
                            <input type="color" ng-model="myMod.edui.umiput.forecolor" ui-spectrum  ng-change="edui1(myMod.edui.forecolor,myMod.edui.umiput.forecolor)">
                            <input type="text" ng-model="myMod.edui.umiput.forecolor">
                        </div>
                        <div class="editTxtlistColor">
                            <ul ng-repeat="value in color">
                                <li ng-repeat="v in value" ng-style="{'background-color':v}" ng-click="edui1(myMod.edui.forecolor,v)"></li>
                            </ul>
                        </div>
                        <div class="editTxtlistLinkfixed"></div>
                    </div>
                </dd>
                <dd>
                    <a href="javascript:void(0)" title="文字背景色"><i class="font-icon icon-blank"></i></a>
                    <div class="editTxtlist color">
                        <div class="editTxtlistInput">
                            <input type="color" ng-model="myMod.edui.umiput.backcolor" ui-spectrum  ng-change="edui1(myMod.edui.backcolor,myMod.edui.umiput.backcolor)">
                            <a href="javascript:void(0)" ng-click="edui1(myMod.edui.backcolor,'')" title="透明背景" data-placement="bottom"></a>
                            <input type="text" ng-model="myMod.edui.umiput.backcolor">
                        </div>
                        <div class="editTxtlistColor">
                            <ul ng-repeat="value in color">
                                <li ng-repeat="v in value" ng-style="{'background-color':v}" ng-click="edui1(myMod.edui.backcolor,v)"></li>
                            </ul>
                        </div>
                        <div class="editTxtlistLinkfixed"></div>
                    </div>
                </dd>
                <dd><a href="javascript:void(0)" title="文字加粗" ng-click='edui1(myMod.edui.bold)'><i class="font-icon icon-bold"></i></a></dd>
                <dd><a href="javascript:void(0)" title="居左" ng-click='edui1(myMod.edui.justifyleft)'><i class="font-icon icon-align-left"></i></a></dd>
                <dd><a href="javascript:void(0)" title="居中" ng-click='edui1(myMod.edui.justifycenter)'><i class="font-icon icon-align-center"></i></a></dd>
                <dd><a href="javascript:void(0)" title="居右" ng-click='edui1(myMod.edui.justifyright)'><i class="font-icon icon-align-right"></i></a></dd>
                <dd>
                    <a href="javascript:void(0)" title="行高"><i class="font-icon icon-indent-left"></i></a>
                    <div class="editTxtlist fontsize">
                        <li ng-click="edui1(myMod.edui.lineheight,1)">1</li>
                        <li ng-click="edui1(myMod.edui.lineheight,2)">2</li>
                        <li ng-click="edui1(myMod.edui.lineheight,3)">3</li>
                        <li ng-click="edui1(myMod.edui.lineheight,4)">4</li>
                        <li ng-click="edui1(myMod.edui.lineheight,5)">5</li>
                        <li ng-click="edui1(myMod.edui.lineheight,6)">6</li>
                        <li ng-click="edui1(myMod.edui.lineheight,7)">7</li>
                        <div class="editTxtlistLinkfixed"></div>
                    </div>
                </dd>
                <dd>
                    <a href="javascript:void(0)" title="添加超链接"><i class="font-icon icon-link"></i></a>
                    <div class="editTxtlist link">
                        <div class="editTxtlistLink Gform">
                            <p>网站地址</p>
                            <ul>
                                <li class="Ginput" style="padding:0">
                                    <div ng-if="isTempUser" class="switch" ng-class="{'hover':myMod.edui.umiput.link.title!=''}">
                                        <input name="urlType" type="radio" value="myMod.edui.umiput.link.type" checked="checked">
                                        <div class="newRadio">
                                            <span data-val="-1" ng-class="{'hover':myMod.edui.umiput.link.title==''}" ng-click="myMod.edui.umiput.link.title='';myMod.edui.umiput.link.href=''" data-checkbefor="">其他</span>
                                            <span data-val="4" ng-class="{'hover':myMod.edui.umiput.link.title!=''}" data-checkbefor="">模块</span>
                                        </div>
                                        <div class="newRadio-default">
                                            <input placeholder="http://" type="text" ng-model="myMod.edui.umiput.link.href"  style="width:194px;padding-right:6px;">
                                        </div>
                                        <div class="newRadio-input">
                                            <div class="Gchoose" style="width:170px;">
                                                <input type="text" ng-model="myMod.edui.umiput.link.href">
                                                <a href="{{myMod.edui.umiput.link.href}}" id="linktitle" target="_blank">{{myMod.edui.umiput.link.title}}</a>
                                                <a href="javascript:void(0)" class="Gbtn-url" title="选择地址" ng-click="selectActivity()"><i></i></a>
                                            </div>
                                        </div>
                                    </div>
                                    <input ng-if="!isTempUser" name="urlType" type="hidden" value="myMod.edui.umiput.link.type" checked="checked">
                                    <input ng-if="!isTempUser" placeholder="http://" type="text" ng-model="myMod.edui.umiput.link.href"  style="width:300px;padding-right:6px;">
                                </li>
                            </ul>
                        </div>
                        <a href="javascript:void(0)" class="btn_inner" ng-click='edui1(myMod.edui.link,myMod.edui.umiput.link)'>确定</a>
                        <div class="editTxtlistLinkfixed"></div>
                    </div>
                </dd>
                <dd><a href="javascript:void(0)" title="清除超链接" ng-click='edui1(myMod.edui.unlink)'><i class="font-icon icon-unlink"></i></a></dd>
                <dd><a href="javascript:void(0)" title="清除样式" ng-click='edui1(myMod.edui.removeformat)'><i class="font-icon icon-circle-notch"></i></a></dd>
            </dl>
        </div>
        <div class="editLayer" ng-class="{close:displayLayer==0}" ng-show="myPage.mod.length>=1" ng-hide="myPage.mod.length==0" ui-move>
            <div class="editLayerBtn" ng-show="displayLayer==0" ng-click="displayLayer=1" title="图层工具"><i class="font-icon icon-folder"></i></div>
            <div class="border" ng-hide="displayLayer==0"><a href="javascript:void(0)" ng-click="displayLayer=0"><i class="font-icon icon-cancel"></i></a></div>
            <div class="editLayerList" ng-hide="displayLayer==0">
                <dl ng-model="myPage.mod" ui-sortable="editLayerList">
                    <dd ng-repeat="value in myPage.mod | orderBy:'zIndex':true" ng-model="value" ng-class="{editing:value==myMod || value.ModChecked}">
                        <div class="editLayerView"><i class="icon-eye" ng-click="myModhide(value)" ng-class="{'erro':value.hide==1}"></i></div>
                        <div class="editLayerName" ng-click="choosemyMod(value)" ng-contextmenu="choosemyMod(value,true)" ng-dblclick="myModedit(value)">
                            <div class="editLayerPic">
                                <div class="editLayerPicCon" ng-style="{'top':value.top/15+'px','left':value.left/15+5+'px','z-index':value.zIndex,'width':value.width+'px','height':value.height+'px'}" style="-webkit-transform:scale(0.06,0.06);transform:scale(0.06,0.06); -webkit-transform-origin:left top;transform-origin:left top;">
                                    <div class="ModlistCon" ng-style="{'opacity':1-value.opacity/100,'background-color':value.data.backgroundColor,'-webkit-transform':'rotate('+value.rotate+'deg)'}">
                                        <div class="ModlistBox" ng-switch="value.name" ng-style="{'background-image':'url('+value.backgroundImg+')','background-color':value.backgroundColor,'opacity':1-value.opacity/100,'border-width':value.borderWidth+'px','border-color':value.borderColor,'border-style':value.borderStyle,'border-radius':value.borderRadius+'px','box-shadow':value.boxShadowX+'px '+value.boxShadowY+'px '+value.boxShadowV+'px '+value.boxShadowColor+' '+value.boxShadowT,'text-shadow':value.textShadowX+'px '+value.textShadowY+'px '+value.textShadowV+'px '+value.textShadowColor}">
                                            <div class="ModlistBox-{{value.name}}" ng-switch-when="text">
                                                <div class="ueditorFix" ng-bind-html="value.text | toHtml"></div>
                                            </div>
                                            <div class="ModlistBox-{{value.name}}" ng-switch-when="img">
                                                <img ng-src="{{value.src}}" />
                                            </div>
                                            <div class="ModlistBox-{{value.name}}" ng-switch-when="button">
                                                <a href="javascript:void(0)" data-url="{{value.button.link}}"><span ng-style="{'color':value.button.color,'font-size':value.button.size+'px','line-height':value.height+'px'}">{{value.button.text}}</span></a>
                                            </div>
                                            <div class="ModlistBox-{{value.name}}" ng-switch-when="imglist">
                                                <div class="imglistFlash" data-length="{{value.imglist.length}}" ui-flash>
                                                    <ul>
                                                        <li ng-repeat="v in value.imglist" style="background-image:url({{v.src}})"></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="ModlistBox-{{value.name}}" ng-switch-when="tel">
                                                <a href="tel:{{value.tel.tel}}"><span ng-style="{'color':value.tel.color,'font-size':value.tel.size+'px','line-height':value.height+'px'}">{{value.tel.text}}</span></a>
                                            </div>
                                            <div class="ModlistBox-{{value.name}}" ng-switch-when="input" data-id="{{value.input.form}}">
                                                <div class="ModlistBox-form-input"><span ng-style="{'line-height':value.height+'px'}"><em ng-show="value.input.must" ng-hide="!value.input.must">*</em>{{value.input.text}}</span></div>
                                            </div>
                                            <div class="ModlistBox-{{value.name}}" ng-switch-when="formbtn" data-id="{{value.formbtn.form}}">
                                                <a href="javascript:void(0)"><span ng-style="{'color':value.formbtn.color,'font-size':value.formbtn.size+'px','line-height':value.height+'px'}">{{value.formbtn.text}}</span></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <span>
                                {{value.zIndex}}
                                {{(value.name=='text'&&'文字')||(value.name=='img'&&'图片')||(value.name=='imglist'&&'图集')||(value.name=='tel'&&'电话')||(value.name=='button'&&'按钮')||(value.name=='input'&&'输入框')||(value.name=='formbtn'&&'提交按钮')}}
                            </span>
                        </div>
                        <div class="editLayerLock"><i class="icon-lock" ng-click="myModlock(value)" ng-class="{'erro':value.lock=='','erro':!value.lock}"></i></div>
                    </dd>
                </dl>
            </div>
        </div>
        <div class="editClass" ng-show="display==3&&ModChecked.length<=1 || display==4&&ModChecked.length<=1 || display==1&&ModChecked.length<=1 " ng-hide="display!=3 || display!=4 || display!=1 || ModChecked.length>=2" ui-move>
            <div class="border"><a href="javascript:void(0)" ng-click="display=0"><i class="font-icon icon-cancel"></i></a></div>
            <div class="editClassNav">
                <ul>
                    <li ng-class="{hover:display==3 || display==1}" ng-click="display=3"><a href="javascript:void(0)">样式</a></li>
                    <li ng-class="{hover:display==4}" ng-click="display=4"><a href="javascript:void(0)">动画</a></li>
                </ul>
            </div>
            <div class="editClassList" ng-show="display==3 || display==1" ng-hide="display!=3 || display!=1">
                <dl class="hover">
                    <dt>基础样式<i></i></dt>
                    <!--
                    <dd>
                        <label>长度</label>
                        <div class="ListInput"><input type="range" min="10" max="320" ng-model="myMod.width"><input type="text" ng-model="myMod.width"></div>
                    </dd>
                    <dd>
                        <label>高度</label>
                        <div class="ListInput"><input type="range" min="10" max="320" ng-model="myMod.height"><input type="text" ng-model="myMod.height"></div>
                    </dd>
                    -->
                    <dd>
                        <label>背景色</label>
                        <div class="ListInput"><input type="color" ng-model="myMod.backgroundColor" ui-spectrum><input type="text" ng-model="myMod.backgroundColor"></div>
                    </dd>
                    <div ng-if="modtype=='svg'">
                        {{myMod.svg.color}}
                    <dd ng-repeat="value in myMod.svg.color">
                        <label>形状颜色{{ $index+1 }}</label>
                        <div class="ListInput"><input type="color" ng-model="value[0]" ui-spectrum><input type="text" ng-model="value[0]"></div>
                    </dd>
                    </div>
                    <dd ng-show="modtype=='button'" ng-hide="modtype!='button'">
                        <label>文字颜色</label>
                        <div class="ListInput"><input type="color" ng-model="myMod.button.color" ui-spectrum><input type="text" ng-model="myMod.button.color"></div>
                    </dd>
                    <dd ng-show="modtype=='button'" ng-hide="modtype!='button'">
                        <label>文字大小</label>
                        <div class="ListInput"><input type="range" min="12" max="60" ng-model="myMod.button.size"><input type="text" ng-model="myMod.button.size"></div>
                    </dd>
                    <dd ng-show="modtype=='tel'" ng-hide="modtype!='tel'">
                        <label>文字颜色</label>
                        <div class="ListInput"><input type="color" ng-model="myMod.tel.color" ui-spectrum><input type="text" ng-model="myMod.tel.color"></div>
                    </dd>
                    <dd ng-show="modtype=='tel'" ng-hide="modtype!='tel'">
                        <label>文字大小</label>
                        <div class="ListInput"><input type="range" min="12" max="60" ng-model="myMod.tel.size"><input type="text" ng-model="myMod.tel.size"></div>
                    </dd>
                    <dd>
                        <label>透明度</label>
                        <div class="ListInput"><input type="range" min="0" max="100" ng-model="myMod.opacity"><input type="text" ng-model="myMod.opacity"></div>
                    </dd>
                    <dd>
                        <label>旋转</label>
                        <div class="ListInput"><input type="range" min="0" max="360" ng-model="myMod.rotate"><input type="text" ng-model="myMod.rotate"></div>
                    </dd>
                </dl>
                <dl>
                    <dt>边框样式<i></i></dt>
                    <dd>
                        <label>边框尺寸</label>
                        <div class="ListInput"><input type="range" min="0" max="20" ng-model="myMod.borderWidth"><input type="text" ng-model="myMod.borderWidth"></div>
                    </dd>
                    <dd>
                        <label>边框弧度</label>
                        <div class="ListInput"><input type="range" min="0" max="{{myMod.width}}" ng-model="myMod.borderRadius"><input type="text" ng-model="myMod.borderRadius"></div>
                    </dd>
                    <dd>
                        <label>边框样式</label>
                        <div class="ListInput">
                            <select ng-model="myMod.borderStyle">
                                <option value="solid">直线</option>
                                <option value="dashed">破折线</option>
                                <option value="dotted">点状线</option>
                                <option value="double">双划线</option>
                                <option value="groove">3D凹槽</option>
                                <option value="ridge">3D垄状</option>
                                <option value="inset">3D内嵌</option>
                                <option value="outset">3D外嵌</option>
                            </select>
                        </div>
                    </dd>
                    <dd>
                        <label>边框颜色</label>
                        <div class="ListInput"><input type="color" ng-model="myMod.borderColor" ui-spectrum><input type="text" ng-model="myMod.borderColor"></div>
                    </dd>
                </dl>
                <dl>
                    <dt>边框阴影<i></i></dt>
                    <dd>
                        <label>左侧投影</label>
                        <div class="ListInput"><input type="range" min="-10" max="10" ng-model="myMod.boxShadowX"><input type="text" ng-model="myMod.boxShadowX"></div>
                    </dd>
                    <dd>
                        <label>顶部投影</label>
                        <div class="ListInput"><input type="range" min="-10" max="10" ng-model="myMod.boxShadowY"><input type="text" ng-model="myMod.boxShadowY"></div>
                    </dd>
                    <dd>
                        <label>模糊</label>
                        <div class="ListInput"><input type="range" min="0" max="20" ng-model="myMod.boxShadowV"><input type="text" ng-model="myMod.boxShadowV"></div>
                    </dd>
                    <dd>
                        <label>颜色</label>
                        <div class="ListInput"><input type="color" ng-model="myMod.boxShadowColor" ui-spectrum><input type="text" ng-model="myMod.boxShadowColor"></div>
                    </dd>
                    <dd>
                        <label>投影类型</label>
                        <div class="ListInput">
                            <select ng-model="myMod.boxShadowT">
                                <option value="">外阴影</option>
                                <option value="inset">内阴影</option>
                            </select>
                        </div>
                    </dd>
                </dl>
                <dl ng-show="modtype=='button' || modtype=='tel' || modtype=='formbtn' || modtype=='textsmall'" ng-hide="modtype!='button' && modtype!='tel' && modtype!='formbtn' && modtype!='text'">
                    <dt>文字阴影<i></i></dt>
                    <dd>
                        <label>左侧投影</label>
                        <div class="ListInput"><input type="range" min="-10" max="10" ng-model="myMod.textShadowX"><input type="text" ng-model="myMod.textShadowX"></div>
                    </dd>
                    <dd>
                        <label>顶部投影</label>
                        <div class="ListInput"><input type="range" min="-10" max="10" ng-model="myMod.textShadowY"><input type="text" ng-model="myMod.textShadowY"></div>
                    </dd>
                    <dd>
                        <label>模糊</label>
                        <div class="ListInput"><input type="range" min="0" max="20" ng-model="myMod.textShadowV"><input type="text" ng-model="myMod.textShadowV"></div>
                    </dd>
                    <dd>
                        <label>颜色</label>
                        <div class="ListInput"><input type="color" ng-model="myMod.textShadowColor" ui-spectrum><input type="text" ng-model="myMod.textShadowColor"></div>
                    </dd>
                </dl>
                <div class="editClassOpr"><a href="javascript:void(0)" class="btn-all" ng-click="display=0">确定</a><a href="javascript:void(0)" class="btn-all-del" ng-click="clearClass(myMod)">清除样式</a></div>
            </div>
            <div class="editClassList" ng-show="display==4" ng-hide="display!=4">
                <dl class="hover">
                    <dt>动画<i></i></dt>
                    <dd>
                        <label>入场方式</label>
                        <div class="ListInput">
                            <select ng-model="myMod.animation.name">
                                <option value="0">无</option>
                                <optgroup label="进入">
                                    <option value="fadeIn">淡入</option>
                                    <option value="fadeInLeft">左移入</option>
                                    <option value="fadeInRight">右移入</option>
                                    <option value="fadeInDown">上移入</option>
                                    <option value="fadeInUp">下移入</option>
                                    <option value="flipInX">水平翻转进入</option>
                                    <option value="flipInY">垂直翻转进入</option>
                                    <option value="zoomIn">中心放大</option>
                                    <option value="rotateIn">翻滚进入</option>
                                    <option value="lightSpeedIn">光速进入</option>
                                </optgroup>
                                <optgroup label="退出">
                                    <option value="fadeOut">淡出</option>
                                    <option value="fadeOutLeft">左移出</option>
                                    <option value="fadeOutRight">右移出</option>
                                    <option value="fadeOutDown">上移出</option>
                                    <option value="fadeOutUp">下移出</option>
                                    <option value="flipOutX">水平翻转消失</option>
                                    <option value="flipOutY">垂直翻转消失</option>
                                    <option value="zoomOut">中心缩小</option>
                                    <option value="rotateOut">翻滚退出</option>
                                    <option value="lightSpeedOut">光速退出</option>
                                </optgroup>
                                <optgroup label="强调">
                                    <option value="bounce">跳跃</option>
                                    <option value="flash">闪光</option>
                                    <option value="pulse">放大</option>
                                    <option value="rubberBand">橡皮筋</option>
                                    <option value="shake">摇动</option>
                                    <option value="swing">悬摆</option>
                                    <option value="tada">放大抖动</option>
                                    <option value="wobble">晃动</option>
                                </optgroup>
                            </select>
                        </div>
                    </dd>
                    <dd>
                        <label>时间曲线</label>
                        <div class="ListInput">
                            <select ng-model="myMod.animation.timingFunction">
                                    <option value="linear">匀速</option>
                                    <option value="ease">匀加速</option>
                                    <option value="ease-in">低速开始</option>
                                    <option value="ease-out">低速结束</option>
                                    <option value="ease-in-out">低速开始和结束</option>
                            </select>
                        </div>
                    </dd>
                    <dd>
                        <label>动画时间</label>
                        <div class="ListInput"><input type="range" ng-model="myMod.animation.duration"><input type="text" ng-model="myMod.animation.duration"></div>
                    </dd>
                    <dd>
                        <label>延时播放</label>
                        <div class="ListInput"><input type="range" ng-model="myMod.animation.delay"><input type="text" ng-model="myMod.animation.delay"></div>
                    </dd>
                    <dd>
                        <label>播放次数</label>
                        <div class="ListInput"><input type="range" ng-model="myMod.animation.count"><input type="text" ng-model="myMod.animation.count"></div>
                    </dd>
                </dl>
                <div class="editClassOpr"><a href="javascript:void(0)" class="btn-all" ng-click="display=0">确定</a><a href="javascript:void(0)" class="btn-all-del" ng-click="clearAnimation(myMod)">清除动画</a></div>
            </div>
        </div>
        
        <div class="editClass" ng-show="ModChecked.length>=2" ui-move>
            <div class="border"><a href="javascript:void(0)" ng-click="display=0"><i class="font-icon icon-cancel"></i></a></div>
            <div class="editClassAlign" ng-show="ModChecked.length>=2">
                <dl>
                    <dd><i class="icon-align-left" data-placement="top" title="左对齐" ng-click="modAlign(1)"></i></dd>
                    <dd><i class="icon-align-center" data-placement="top" title="水平居中对齐" ng-click="modAlign(2)"></i></dd>
                    <dd><i class="icon-align-right" data-placement="top" title="右对齐" ng-click="modAlign(3)"></i></dd>
                    <dd><i class="icon-align-left roate" data-placement="top" title="上对齐" ng-click="modAlign(4)"></i></dd>
                    <dd><i class="icon-align-center roate" data-placement="top" title="垂直居中对齐" ng-click="modAlign(5)"></i></dd>
                    <dd><i class="icon-align-right roate" data-placement="top" title="下对齐" ng-click="modAlign(6)"></i></dd>
                </dl>
                <dl>
                    <dd><i class="icon-docs" data-placement="bottom" title="复制" ng-click="modAlign(7)"></i></dd>
                    <dd><i class="icon-doc-text-inv" data-placement="bottom" title="黏贴" ng-class="{erro:copy.length==0}" ng-click="modAlign(8)"></i></dd>
                    <dd><i class="icon-trash" data-placement="bottom" title="删除" ng-click="modAlign(9)"></i></dd>
                </dl>
            </div>
        </div>
        <div id="helpMsg" ui-flash="fadeIn" ui-time="{{helpMsg.time}}" data-length="{{helpMsg.helpMsg.length}}">
            <ul>
                <li ng-repeat="value in helpMsg.helpMsg" ng-class="{show:$index==0}"><a href="http://www.wangcaio2o.com/index.php?=Home&m=Help&a=helpDetails&newsId=1477&classId=73" target="_blank"><span>({{ $index+1 }}/{{helpMsg.helpMsg.length}})</span>{{value}}</a></li>
            </ul>
        </div>
        </form>
        <div ng-hide="!isTempUser" ng-show="isTempUser" class="service"></div>
    </div>
    <include file="./Home/Tpl/Public/Public_footer.html" />
</body>
</html>
<script type="text/javascript">
//1是临时用户，2不是临时用户
var isTempUser = '{$isTempUser}';
var userid = '{$node_id}';
var urltiyan = "";
var isAdd = true;
var app = angular.module('app', ['ngSanitize','ui.sortable','ui.draggable','ui.move','ui.selectable','ui.adddraggable','spectrum',"ng.ueditor","ng.contextmenu","ui.hotkey","ui.flash","my.svg"]);
app.config(["$sceProvider",function($sceProvider){
    $sceProvider.enabled(false);
}]);


app.controller('poster',['$scope','$timeout', function($scope,$timeout) {
    /*先体验后注册*/
    if(isTempUser==2){
        $scope.Mask=false;
        $scope.isTempUser=true;
        $scope.userid = false;

    }else{
        $scope.Mask=true;
        $scope.isTempUser=false;
        $scope.userid = userid;
        $(".headerNav,.headerMsg,service").addClass('dn');
    }
    $scope.tiyan=function(){
        $scope.Mask=false;
        urltiyan = "./index.php?g=Home&m=Land&a=regwfx&landname=dzhb&from_user_id=9000";
    }
    $scope.reg=function(){
    	urltiyan = "./index.php?g=Home&m=Land&a=regwfx&landname=dzhbdirect&from_user_id=9000";
    	$scope.save();
        urltiyan = "./index.php?g=Home&m=Land&a=regwfx&landname=dzhbdirect&from_user_id=9000";
        art.dialog.open(urltiyan, {
            id : "EnterpriseNo",
            title : false,
            width : "500px",
            height : "596px"
        });
        
    }
    $scope.login=function(){
    	urltiyan = "./index.php?g=Home&m=Land&a=regwfx&landname=dzhbdirect&from_user_id=9000&reg_login=1";
    	$scope.save();
        urltiyan = "./index.php?g=Home&m=Land&a=regwfx&landname=dzhbdirect&from_user_id=9000&reg_login=1";
        art.dialog.open(urltiyan, {
            id : "EnterpriseNo",
            title : false,
            width : "500px",
            height : "596px"
        });
        
    }
    /*先体验后注册*/
    $scope.basicData = basicData;
    $scope.moddata = moddata;
    $scope.moddata.push({
        id:4,
        type:"我的",
        list:[{
            id:"",
            type:"",
            list:[{$posterPage}]
        }]
    });
    $scope.foucefixed = {
        top:$("#phone").position().top-313+85,
        left:$("#phone").position().left-160
    }
    $scope.mymoddata = $scope.moddata[0];
    $scope.mymoddatalist = $scope.mymoddata.list[0];
    $scope.color = [
                    ["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646"],
                    ["#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada"],
                    ["#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5"],
                    ["#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#92cddc","#fac08f"],
                    ["#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#31859b","#e36c09"],
                    ["#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#205867","#974806"],
                    ["#c00000","#ff0000","#ffc000","#ffff00","#92d050","#00b050","#00b0f0","#0070c0","#002060","#7030a0"]
                ];
    $scope.umiput = {
        backcolor:"rgba(255,255,255)",
        forecolor:"#333",
        link:{
            href:"http://",
            title:""
        }
    }
    $scope.classmod = [
    {
        icon:"icon-font",
        name:"文本",
        type:"text",
        data:{
            id:10001,
            ModChecked:false,
            beginAn:true,
            name:"text",
            zIndex:1,
            top:100,
            left:10,
            width:300,
            height:40,
            rotate:0,
            text:"<p style='line-height:3em;'><span style='font-size:18px;'>点击此处编辑</span></p>",
            backgroundColor:"",
            backgroundImg:"",
            opacity:0,
            borderWidth:"0",
            borderRadius:"0",
            borderColor:"rgb(255, 255, 255)",
            borderStyle:"solid",
            boxShadowColor:"rgba(0, 0, 0,0.5)",
            boxShadowX:"0",
            boxShadowY:"0",
            boxShadowV:"0",
            boxShadowT:"",
            textShadowX:"0",
            textShadowY:"0",
            textShadowV:"0",
            textShadowColor:"rgba(0, 0, 0,0.5)",
            animation:{
                name:"",
                duration:1,
                timingFunction:"linear",
                delay:0,
                count:1,
                fillMode:"forwards"
            },
            edui:{}
        }
    },{
        icon:"icon-picture",
        name:"图片",
        type:"img",
        data:{
            id:10002,
            ModChecked:false,
            beginAn:true,
            name:"img",
            zIndex:1,
            top:100,
            left:80,
            width:160,
            height:160,
            rotate:0,
            src:"__PUBLIC__/Image/poster/160x160.png",
            link:"",
            backgroundColor:"",
            backgroundImg:"",
            opacity:0,
            borderWidth:"0",
            borderRadius:"0",
            borderColor:"rgb(255, 255, 255)",
            borderStyle:"solid",
            boxShadowColor:"rgba(0, 0, 0,0.5)",
            boxShadowX:"0",
            boxShadowY:"0",
            boxShadowV:"0",
            boxShadowT:"",
            animation:{
                name:"",
                duration:1,
                timingFunction:"linear",
                delay:0,
                count:1,
                fillMode:"forwards"
            }
        }
    },{
        icon:"icon-collapse",
        name:"按钮",
        type:"button",
        data:{
            id:10003,
            ModChecked:false,
            beginAn:true,
            name:"button",
            zIndex:1,
            top:100,
            left:100,
            width:120,
            height:30,
            rotate:0,
            button:{
                text:"这是个按钮",
                link:"",
                color:"rgba(255,255,255,1)",
                size:14
            },
            backgroundColor:"rgba(237,63,65,1)",
            backgroundImg:"",
            opacity:0,
            borderWidth:"0",
            borderRadius:3,
            borderColor:"rgb(255, 255, 255)",
            borderStyle:"solid",
            boxShadowColor:"rgba(0,0,0,.5)",
            boxShadowX:0,
            boxShadowY:2,
            boxShadowV:5,
            boxShadowT:"",
            textShadowX:"0",
            textShadowY:"0",
            textShadowV:"0",
            textShadowColor:"rgba(0, 0, 0,0.5)",
            animation:{
                name:"",
                duration:1,
                timingFunction:"linear",
                delay:0,
                count:1,
                fillMode:"forwards"
            }
        }
    },{
        icon:"icon-picture-1",
        name:"图集",
        type:"imglist",
        data:{
            id:10004,
            ModChecked:false,
            beginAn:true,
            name:"imglist",
            zIndex:1,
            top:100,
            left:60,
            width:200,
            height:200,
            rotate:0,
            imglist:[{
                src:"__PUBLIC__/Image/poster/200x200.png"
            },{
                src:"__PUBLIC__/Image/poster/200x200.png"
            },{
                src:"__PUBLIC__/Image/poster/200x200.png"
            }],
            backgroundColor:"",
            backgroundImg:"",
            opacity:0,
            borderWidth:"0",
            borderRadius:"0",
            borderColor:"rgb(255, 255, 255)",
            borderStyle:"solid",
            boxShadowColor:"rgba(0, 0, 0,0.5)",
            boxShadowX:"0",
            boxShadowY:"0",
            boxShadowV:"0",
            boxShadowT:"",
            animation:{
                name:"",
                duration:1,
                timingFunction:"linear",
                delay:0,
                count:1,
                fillMode:"forwards"
            }
        }
    },{
        icon:"icon-star",
        name:"形状",
        type:"svg",
        data:{
            id:10004,
            ModChecked:false,
            beginAn:true,
            name:"svg",
            zIndex:1,
            top:100,
            left:60,
            width:200,
            height:200,
            rotate:0,
            svg:{
                svg:'__PUBLIC__/Image/poster/svg/6.svg',
                color:[]
            },
            backgroundColor:"",
            backgroundImg:"",
            opacity:0,
            borderWidth:"0",
            borderRadius:"0",
            borderColor:"rgb(255, 255, 255)",
            borderStyle:"solid",
            boxShadowColor:"rgba(0, 0, 0,0.5)",
            boxShadowX:"0",
            boxShadowY:"0",
            boxShadowV:"0",
            boxShadowT:"",
            animation:{
                name:"",
                duration:1,
                timingFunction:"linear",
                delay:0,
                count:1,
                fillMode:"forwards"
            }
        }
    },{
        icon:"icon-phone",
        name:"电话",
        type:"tel",
        data:{
            id:10005,
            ModChecked:false,
            beginAn:true,
            name:"tel",
            zIndex:1,
            top:100,
            left:100,
            width:120,
            height:40,
            rotate:0,
            tel:{
                text:"呼叫",
                tel:"",
                color:"rgba(255,255,255,1)",
                size:14
            },
            backgroundColor:"rgba(8,161,239,1)",
            backgroundImg:"",
            opacity:0,
            borderWidth:"0",
            borderRadius:3,
            borderColor:"rgb(255, 255, 255)",
            borderStyle:"solid",
            boxShadowColor:"rgba(0,0,0,.5)",
            boxShadowX:0,
            boxShadowY:2,
            boxShadowV:5,
            boxShadowT:"",
            textShadowX:"0",
            textShadowY:"0",
            textShadowV:"0",
            textShadowColor:"rgba(0,0,0,.5)",
			animation:{
				name:"",
				duration:12,
				timingFunction:"linear",
				delay:0,
				count:1,
				fillMode:"forwards"
			}
		}
	},{
		icon:"icon-user",
		name:"表单",
		type:"form",
		data:[{
			icon:"icon-th-list",
			name:"组合表单",
			type:"form",
			data:[{
				id:"",
				ModChecked:false,
				beginAn:true,
				name:"input",
				zIndex:1,
				top:100,
				left:60,
				width:200,
				height:35,
				rotate:0,
				input:{
					text:"姓名",
					type:"text",
					must:true,
					order:"",
					form:""
				},
				backgroundColor:"rgb(255, 255, 255)",
				backgroundImg:"",
				opacity:0,
				borderWidth:1,
				borderRadius:3,
				borderColor:"rgb(221, 221, 221)",
				borderStyle:"solid",
				boxShadowColor:"rgba(0, 0, 0,0.5)",
				boxShadowX:"0",
				boxShadowY:"0",
				boxShadowV:"0",
				boxShadowT:"rgba(0,0,0,.5)",
				animation:{
					name:"",
					duration:1,
					timingFunction:"linear",
					delay:0,
					count:1,
					fillMode:"forwards"
				}
			},{
				id:"",
				ModChecked:false,
				beginAn:true,
				name:"input",
				zIndex:1,
				top:140,
				left:60,
				width:200,
				height:35,
				rotate:0,
				input:{
					text:"电话",
					type:"tel",
					must:true,
					order:"",
					form:""
				},
				backgroundColor:"rgb(255, 255, 255)",
				backgroundImg:"",
				opacity:0,
				borderWidth:1,
				borderRadius:3,
				borderColor:"rgb(221, 221, 221)",
				borderStyle:"solid",
				boxShadowColor:"rgba(0, 0, 0,0.5)",
				boxShadowX:"0",
				boxShadowY:"0",
				boxShadowV:"0",
				boxShadowT:"rgba(0,0,0,.5)",
				animation:{
					name:"",
					duration:1,
					timingFunction:"linear",
					delay:0,
					count:1,
					fillMode:"forwards"
				}
			},{
				id:"",
				ModChecked:false,
				beginAn:true,
				name:"formbtn",
				zIndex:1,
				top:180,
				left:60,
				width:200,
				height:35,
				rotate:0,
				formbtn:{
					text:"确认",
					color:"rgba(255,255,255,1)",
					size:14,
					order:"",
					form:""
				},
				backgroundColor:"rgba(237,63,65,1)",
				backgroundImg:"",
				opacity:0,
				borderWidth:"0",
				borderRadius:3,
				borderColor:"rgb(255, 255, 255)",
				borderStyle:"solid",
				boxShadowColor:"rgba(0,0,0,.5)",
				boxShadowX:0,
				boxShadowY:2,
				boxShadowV:5,
				boxShadowT:"",
                textShadowX:"0",
                textShadowY:"0",
                textShadowV:"0",
                textShadowColor:"rgba(0,0,0,.5)",
				animation:{
					name:"",
					duration:12,
					timingFunction:"linear",
					delay:0,
					count:1,
					fillMode:"forwards"
				}
			}]
		},{
			icon:"icon-text-width",
			name:"输入框",
			type:"input",
			data:{
				id:"",
				ModChecked:false,
				beginAn:true,
				name:"input",
				zIndex:11,
				top:100,
				left:60,
				width:200,
				height:35,
				rotate:0,
				input:{
					text:"姓名",
					type:"text",
					must:true,
					order:"",
					form:""
				},
				backgroundColor:"rgb(255, 255, 255)",
				backgroundImg:"",
				opacity:0,
				borderWidth:1,
				borderRadius:3,
				borderColor:"rgb(221, 221, 221)",
				borderStyle:"solid",
				boxShadowColor:"rgba(0, 0, 0,0.5)",
				boxShadowX:"0",
				boxShadowY:"0",
				boxShadowV:"0",
				boxShadowT:"rgba(0,0,0,.5)",
				animation:{
					name:"",
					duration:1,
					timingFunction:"linear",
					delay:0,
					count:1,
					fillMode:"forwards"
				}
			}
		},{
			icon:"icon-up-circled2",
			name:"提交按钮",
			type:"formbtn",
			data:{
				id:"",
				ModChecked:false,
				beginAn:true,
				name:"formbtn",
				zIndex:1,
				top:180,
				left:60,
				width:200,
				height:35,
				rotate:0,
				formbtn:{
					text:"确认",
					color:"rgba(255,255,255,1)",
					size:14,
					order:"",
					form:""
				},
				backgroundColor:"rgba(237,63,65,1)",
				backgroundImg:"",
				opacity:0,
				borderWidth:"0",
				borderRadius:3,
				borderColor:"rgb(255, 255, 255)",
				borderStyle:"solid",
				boxShadowColor:"rgba(0,0,0,.5)",
				boxShadowX:0,
				boxShadowY:2,
				boxShadowV:5,
				boxShadowT:"",
                textShadowX:"0",
                textShadowY:"0",
                textShadowV:"0",
                textShadowColor:"rgba(0,0,0,.5)",
				animation:{
					name:"",
					duration:12,
					timingFunction:"linear",
					delay:0,
					count:1,
					fillMode:"forwards"
				}
			}
		}]
	}
	];

    $scope.pages = {$pages};
	//$scope.pages = jsonData;
    $.each($scope.pages,function(i,n){
        delete n.$$hashKey
        $.each(n.mod,function(z,c){
            delete c.$$hashKey;//删除节点
        });
    });
	if(!$scope.pages[0]){
		$scope.pages = [{name:"第1页",backgroundImg:"",backgroundColor:"",backgroundAn:0,mod:[]}];
	}
    $.each($scope.pages,function(i,n){
        $.each(n.mod,function(z,c){
            if(!c.zIndex){
                c["zIndex"] = z;
            }
        });
    });
	$scope.myPage = $scope.pages[0];
	if(!$scope.myPage.mod){ $scope.myPage.mod = [];}
	$scope.myMod = "";
	$scope.ModChecked = [];
	$scope.modtype = "";
	$scope.copy = [];
	$scope.Ctrl = false;
	$scope.display = 0;
	$scope.line = 1;
    $scope.isfouce = false;
    $scope.$watch('myPage.mod.length', function() {
        if($scope.myPage.mod){
            if($scope.myPage.mod.length==0){
               $scope.helpMsg = {helpMsg:helpMsg.stop[0],time:helpMsg.stop[1]};
            }else if($scope.myPage.mod.length==1){
               $scope.helpMsg = {helpMsg:helpMsg.hasmod[0],time:helpMsg.hasmod[1]};
            }else if($scope.myPage.mod.length>=5){
               $scope.helpMsg = {helpMsg:helpMsg.hasmodall[0],time:helpMsg.hasmodall[1]};
            }
        }
    });
    $scope.$watch('ModChecked.length', function() {
        if($scope.ModChecked.length==0){
           $scope.helpMsg = {helpMsg:helpMsg.hasmod[0],time:helpMsg.hasmod[1]};
        }if($scope.ModChecked.length==1){
           $scope.helpMsg = {helpMsg:helpMsg.checkedmod[0],time:helpMsg.checkedmod[1]};
        }else if($scope.ModChecked.length>=2){
           $scope.helpMsg = {helpMsg:helpMsg.checkedmods[0],time:helpMsg.checkedmods[1]};
        }else if($scope.myPage.mod.length>=5){
           $scope.helpMsg = {helpMsg:helpMsg.hasmodall[0],time:helpMsg.hasmodall[1]};
        }
    });
    $scope.helpMsgfn = function(type){
        if($scope.myMod.name=="text"){
           $scope.helpMsg = {helpMsg:helpMsg.text[0],time:helpMsg.text[1]};
        }else if($scope.myMod.name=="img"){
           $scope.helpMsg = {helpMsg:helpMsg.img[0],time:helpMsg.img[1]};
        }else if($scope.myMod.name=="imglist"){
           $scope.helpMsg = {helpMsg:helpMsg.imglist[0],time:helpMsg.imglist[1]};
        }else if($scope.myMod.name=="button"){
           $scope.helpMsg = {helpMsg:helpMsg.button[0],time:helpMsg.button[1]};
        }else if($scope.myMod.name=="tel"){
           $scope.helpMsg = {helpMsg:helpMsg.tel[0],time:helpMsg.tel[1]};
        }else if($scope.myMod.name=="input"){
           $scope.helpMsg = {helpMsg:helpMsg.form[0],time:helpMsg.form[1]};
        }else if($scope.myMod.name=="formbtn"){
           $scope.helpMsg = {helpMsg:helpMsg.form[0],time:helpMsg.form[1]};
        }
        if($scope.myMod.name!="text"){
           $("#helpMsg").addClass("fixed");
        }
        if(type){
           $("#helpMsg").removeClass("fixed");
        }
    }

	$scope.history = {nowhistory:0,allhistory:0,history:[angular.copy($scope.myPage)]};
    $scope.goHistory = function(type){
        if(event){
            event.stopPropagation();
        }
        if(type=="prev"){
            if($scope.history.nowhistory==0){
                return false;
            }
            $scope.history.nowhistory --;
            var newhistory = angular.copy($scope.history.history[$scope.history.nowhistory]);
                $scope.myPage.mod = newhistory.mod;
                $scope.myPage.backgroundImg = newhistory.backgroundImg;
                $scope.myPage.backgroundColor = newhistory.backgroundColor;
        }else if(type=="next"){
            if($scope.history.nowhistory==$scope.history.allhistory){
                return false;
            }
            $scope.history.nowhistory ++;
            var newhistory = angular.copy($scope.history.history[$scope.history.nowhistory]);
            $scope.myPage.mod = newhistory.mod;
            $scope.myPage.backgroundImg = newhistory.backgroundImg;
            $scope.myPage.backgroundColor = newhistory.backgroundColor;
        }else{
            $timeout(function() {
                $scope.history.allhistory = $scope.history.nowhistory;
                $scope.history.history.splice($scope.history.allhistory+1,$scope.history.history.length-$scope.history.allhistory);
                $scope.history.nowhistory++;
                $scope.history.allhistory = $scope.history.nowhistory;
                $scope.history.history.push(angular.copy($scope.myPage));
                $.each($scope.history.history[$scope.history.history.length-1].mod,function(i,n){
                    n.addan = false;
                });
            },50);
        }
    };
	$scope.marketNav = function(value){
		$scope.mymoddata = value;
		$scope.mymoddatalist = $scope.mymoddata.list[0];
	};
	$scope.marketList = function(value){
		$scope.mymoddatalist = value;
	};
	$scope.choosemarket = function(value){
		art.dialog({
            width:400,
            minHeight:100,
            title: "提示",
            content:'<div class="Diawarning"><p>页面模板会覆盖当前已有内容，若想保留内容，您可以先添加一页，是否继续？</p></div>',
            okVal:"覆盖",
			ok:function(){
				if($scope.pages.length==0){
					$scope.pages = [{name:"第一页",backgroundImg:"",backgroundColor:"",backgroundAn:0,mod:[]}];
					$scope.myPage = $scope.pages[0];
				}
				$scope.$apply(function() {
					$scope.myPage.mod = angular.copy(value.mod);
					$scope.myPage.backgroundImg = angular.copy(value.backgroundImg);
					$scope.myPage.backgroundColor = angular.copy(value.backgroundColor);
                    $.each($scope.myPage.mod,function(i,n){
                        var id = "formid" + Date.parse(new Date());
                        if(n.name=="input"){
                            n.input.form = id;
                        }else if(n.name=="formbtn"){
                            n.formbtn.form = id;
                        }
                    })
				});
                $scope.goHistory();
                $scope.clearbeginAn();
			},
            button: [{
                name:'新增一页',
                callback: function () {
                    $scope.$apply(function(){
                        $scope.addpage();
                    })
                    if($scope.pages.length==0){
                        $scope.pages = [{name:"第一页",backgroundImg:"",backgroundColor:"",backgroundAn:0,mod:[]}];
                        $scope.myPage = $scope.pages[0];
                    }
                    $scope.$apply(function() {
                        $scope.myPage.mod = angular.copy(value.mod);
                        $scope.myPage.backgroundImg = angular.copy(value.backgroundImg);
                        $scope.myPage.backgroundColor = angular.copy(value.backgroundColor);
                        $.each($scope.myPage.mod,function(i,n){
                            var id = "formid" + Date.parse(new Date());
                            if(n.name=="input"){
                                n.input.form = id;
                            }else if(n.name=="formbtn"){
                                n.formbtn.form = id;
                            }
                        })
                    });
                    $scope.goHistory();
                    $scope.clearbeginAn();
                }
            }]
		});
	};
	$scope.delmoddata = function(value){
		event.stopPropagation();
		Diamsg({
			content:'确定要删除您保存的模板么？',
			ok:function(){
				$.each($scope.moddata[3].list[0].list,function(i,n){
					if(n==value){
						$scope.$apply(function(){
							//删除模板
							var page_id = n.id || "";
                            if (page_id) { //删除指定模板
                                $.post("{:U('MarketActive/NewPoster/deletePosterPage')}",{ id:'{$id}',page_id:page_id},function(data){
                                    if (typeof data.status != 'undefined' && data.status == 1) {
                                        $scope.$apply(function() {
                                            $scope.moddata[3].list[0].list.splice(i,1);
                                        });
                                        Diasucceed(data.info,"","",false);
                                    } else {
                                        Diamsg({
                                            content:data.info,
                                            ok:true
                                        });
                                    }
                                },"json");
                            }
						});
                        return false;
					}
				});
			},
			cancel:true
		});
	};
	$scope.choose = function(page){
		$scope.myPage = page;
        $scope.history = {nowhistory:0,allhistory:0,history:[angular.copy($scope.myPage)]};
		$scope.clearbeginAn();
	};
	$scope.rechoose = function(page){
		$scope.clearbeginAn();
		$timeout(function() {
			$scope.myPage = [];
			$timeout(function() {
				$scope.myPage = page;
			},10);
		},100);
	};
	$scope.clearbeginAn = function(){
		$.each($scope.myPage.mod,function(i,n){
			n['beginAn'] = false;
			if(n.animation.delay){
                var specialAnimation = ["fadeOut","fadeOutLeft","fadeOutRight","fadeOutDown","fadeOutUp","flipOutX","flipOutY","zoomOut","rotateOut","lightSpeedOut"];
                if($.inArray(n.animation.name,specialAnimation)!=-1){
                    n.beginAn = true;
                }else{
                    $timeout(function() {
                        n.beginAn = true;
                    },n.animation.delay*1000);
                }
			}else{
				n.beginAn = true;
			}
		});
	};
	$scope.clearbeginAn();
	$scope.clearModChecked = function(){
		$scope.ModChecked = [];
		$.each($scope.myPage.mod,function(i,n){
			n["ModChecked"] = false;
		});
	}
	$scope.choosemyMod = function(page,type){
		if(!page){
			page = $scope.myPage.mod[0];
            if(page.name!="text"){
                $scope.goHistory();
            }else{
                $timeout(function() {
                    $scope.goHistory();
                },200)
            }
		}
        event.stopPropagation();
		if($scope.display == 10){
			return false;
		}
		$scope.display = 3;
		if(type){
			$scope.display = 1;
		}
		if(!$scope.Ctrl){
			$scope.clearModChecked();
			page.ModChecked = true;
			$scope.myMod = page;
			$scope.ModChecked = [page];
			$scope.modtype = $scope.myMod.name;
			$(".editMenu").css({
				left:event.pageX+20,
				top:event.pageY-10
			})
		}else{
			if(!page.ModChecked){
				page.ModChecked = true;
				$scope.myMod = page;
				$scope.ModChecked.push(page);
				$scope.modtype = $scope.myMod.name;
			}else{
				$.each($scope.ModChecked,function(i,n){
					if(n == page){
						$scope.ModChecked.splice(i,1);
					}
				});
				page.ModChecked = false;
				if($scope.ModChecked.length==0){
					$scope.myMod = [];
				}
			}
		}
	};
	$scope.choosemyModMouseDown = function(page,type){
		if(!page){
			page = $scope.myPage.mod[$scope.myPage.mod.length-1];
		}
        if($scope.isfouce && page != $scope.myMod){
            $scope.swrapperCon();
        }
		event.stopPropagation();
		if($scope.display == 10){
			return false;
		}
		$scope.display = 3;
		if(type){
			$scope.display = 1;
		}
		if(!$scope.Ctrl){
			$scope.clearModChecked();
			page.ModChecked = true;
			$scope.myMod = page;
			$scope.ModChecked = [page];
			$scope.modtype = $scope.myMod.name;
			$(".editMenu").css({
				left:event.pageX+20,
				top:event.pageY-10
			})
		}
	}
	$scope.checkCopy = function(){
		if($scope.copy.length){
			$scope.modtype = "copy";
			$scope.display = 1;
			$(".editMenu").css({
				left:event.pageX+20,
				top:event.pageY-10
			})
			return false;
		}
	};
	$scope.addpage = function(){
		var index = $scope.pages.length+1;
		$scope.pages.push({
			name:"第"+index+"页",
			backgroundImg:"",
			backgroundColor:"",
			mod:[]
		});
        $scope.myPage = $scope.pages[$scope.pages.length-1];
	};
	$scope.copypage = function(page,index){
		$scope.pages.splice(index+1,0,angular.copy(page));
	};
	$scope.delpage = function(page){
        event.stopPropagation();
        Diamsg({
            content:'您确定删除吗？',
            ok:function(){
                if($scope.myPage == page){
                    $scope.$apply(function(){
                        $scope.pages.splice(page,1);
                    })
                }else{
                    $scope.$apply(function(){
                        $scope.pages.splice(page,1);
                        if($scope.pages.length==0){
                            $scope.addpage();
                        }
                        $scope.myPage = $scope.pages[0];
                    })
                }
            },
            cancel:true
        });
	};
    $scope.clearpage = function(){
        event.stopPropagation();
        $scope.myPage.backgroundColor = "";
        $scope.myPage.backgroundImg = "";
        $scope.myPage.mod = [];
        $scope.goHistory();
    };
	$scope.editLayerList = {
		stop: function(e, ui) {
            $.each($scope.myPage.mod,function(i,n){
                n.zIndex = $scope.myPage.mod.length - i;
            });
		}
	};
	$scope.adddraggable = function(page){
        if($scope.pages.length==0){
            $scope.addpage();
        }
		var newdata = angular.copy(page.data) ? angular.copy(page.data) : angular.copy(page) ;
            newdata['addan'] = true;
		if(page.type=="form" || page.type=="input" || page.type=="formbtn"){
			var id = "formid" + Date.parse(new Date());
            var hasbtn = false;
			$.each($scope.myPage.mod,function(i,n){
				if(n.input){
					id = n.input.form;
				}else if(n.formbtn){
					id = n.formbtn.form;
				}
			});
            $.each($scope.myPage.mod,function(i,n){
                if(n.formbtn){
                    hasbtn = true;
                }
            });
            if(page.type=="input"){
                newdata.input.form = id;
                $scope.myPage.mod.unshift(newdata);
            }else if(page.type=="formbtn"){
                if(!hasbtn){
                    newdata.formbtn.form = id;
                    $scope.myPage.mod.unshift(newdata);
                }else{
                    Diamsg({content:"当前页面的提交按钮已经存在，请不要重复添加"});
                }
            }else if(page.type=="form"){
    			$.each(newdata,function(i,n){
    				if(n.input){
    					n.input.form = id;
    					$scope.myPage.mod.unshift(n);
    				}else if(n.formbtn){
    					if(!hasbtn){
    						n.formbtn.form = id;
    						$scope.myPage.mod.unshift(n);
    					}else{
                            Diamsg({content:"当前页面的提交按钮已经存在，已帮您自动删除"});
                        }
    				}
    			});
            }
		}else{
			$scope.myPage.mod.unshift(newdata);
		}
        $scope.editLayerList.stop();
        $scope.choosemyMod();
        $timeout(function() {
            newdata['addan'] = false;
        },1000);
	};
	$scope.changeZindex = function(type){
		if(type){
            var maxzindex = $scope.myPage.mod.length;
            $.each($scope.myPage.mod,function(i,n){
                maxzindex = Math.max(maxzindex,n.zIndex);
            });
            if($scope.myMod.zIndex<maxzindex){
                $scope.myMod.zIndex=maxzindex+1;
            }
		}else{
			$scope.myMod.zIndex--;
			if($scope.myMod.zIndex==1){
                $.each($scope.myPage.mod,function(i,n){
                    n.zIndex++;
                });
                $scope.myMod.zIndex=0;
            }else if($scope.myMod.zIndex<1){
                $scope.myMod.zIndex=0;
            }
		}
	};
	$scope.delMod = function(page){
		for(var i=0;i<=$scope.myPage.mod.length;i++){
			if(page == $scope.myPage.mod[i]){
				var index = i;
			}
		}
		$scope.myPage.mod.splice(index,1);
		$scope.display = 0;
	};
	$scope.swrapperCon = function(){
        if($scope.myMod.edui){
            var myUM = UM.getEditor($scope.myMod.edui.ue);
            if (myUM) {
                myUM.blur();
                $scope.isfouce = false;
                myUM.setDisabled('fullscreen');
                $scope.goHistory();
            }
        }
        $(".Modlist.ui-draggable-disabled").draggable("enable");
		$scope.display = 0;
		$scope.myMod = "";
		$scope.clearModChecked();
	};
	$scope.myModedit = function(page,$e){
		$scope.display = 0;
		if($scope.myMod.name!="text" && $scope.myMod.name!="textsmall"){
			$scope.fnmyModeditt();
		}else{
			$scope.display = 10;
			var t = $(".Modlist.editing").offset().top;
			var l = $(".Modlist.editing").offset().left;
			$(".editTxt").show().css({
				left:l-80,
				top:t-50
			});
			$("#edui_fixedlayer").css({
				left:l-80,
				top:t-17
			});
            var myUM = UM.getEditor($scope.myMod.edui.ue);
            myUM.setEnabled();
            myUM.focus(true);
            if($($scope.myMod.text).text()=="点击此处编辑"){
                myUM.execCommand( 'selectall' );
            }
            $scope.isfouce = true;
            $timeout(function() {
                $(".Modlist").each(function(){
                    if($(this).find(".showueditorFix").length>=1){
                        $(this).draggable("disable");
                    }
                })
            },100);
		}
        $scope.helpMsgfn();
        return false;
	};
    $scope.myModhide = function(page){
        event.stopPropagation;
        if(!page.hide || page.hide==""){
            page.hide =1;
        }else{
            page.hide ="";
        }
    }
    $scope.myModlock = function(page){
        event.stopPropagation;
        if(!page.lock || page.lock==""){
            page.lock =1;
        }else{
            page.lock ="";
        }
    }
	$scope.myModlink = function(){
		$scope.display = 0;
		var data = {link:$scope.myMod.link,linktype:$scope.myMod.linktype,linktitle:$scope.myMod.linktitle,isTempUser:$scope.isTempUser};
		var html = template("tempLink", data);
		art.dialog({
			title: '编辑链接',
			width:400,
			content:html,
			ok:function(){
				$scope.$apply(function() {
                    var linktype = $("[name='urlType']").val();
                    if(linktype=='-1'){
                        $scope.myMod["link"] = $("input[name='buttonlink']").val();
                        $scope.myMod["linktype"] = linktype;
                        $scope.myMod["linktitle"] = "";
                    }
                    if(linktype=='4'){
                        $scope.myMod["link"] = $("input[name='buttonlink2']").val();
                        $scope.myMod["linktype"] = linktype;
                        $scope.myMod["linktitle"] = $("#linktitle").text();
                    }
				});
			},
			cancel:true
		});
        Gformbegin();
	};
	$scope.fnmyModeditt = function(){
		var data,html;
			switch($scope.myMod.name){
				case "img":
					open_img_uploader({
                        width:true,
                        height:true,
                        userid:$scope.isTempUser?false:$scope.userid,
						callback:function(opt){
                            $scope.$apply(function() {
                                $scope.myMod.src = opt.src;
                                opt.width = parseInt(opt.width);
                                opt.height = parseInt(opt.height);
                                var size = opt.width>=opt.height;
                                if(size){
                                    if(opt.width<=640){
                                        $scope.myMod.width = opt.width/2;
                                        $scope.myMod.height = opt.height/2;
                                    }else if(opt.width>640){
                                        $scope.myMod.width = 320;
                                        $scope.myMod.height = 320/opt.width*opt.height;
                                    }
                                }else{
                                    if(opt.height<=960){
                                        $scope.myMod.width = opt.width/2;
                                        $scope.myMod.height = opt.height/2;
                                    }else if(opt.height>960){
                                        $scope.myMod.width = 480/opt.height*opt.width;
                                        $scope.myMod.height = 480;
                                    }
                                }
                            });
                            $scope.goHistory();
                        }
					});
					break;
				case "imglist":
					open_img_uploader({
                        width:true,
                        height:true,
                        maxlength:6,
                        userid:$scope.isTempUser?false:$scope.userid,
						callback:function(opt){
                            $scope.$apply(function() {
                                $.each($scope.myMod.imglist,function(i,n){
                                    if(n.src=="__PUBLIC__/Image/poster/200x200.png"){
                                        $scope.myMod.imglist = [];
                                    }
                                })
                                if(typeof(opt.src)!="string"){
                                    $scope.myMod.imglist = [] ;
                                    for(var i=0;i<opt.src.length;i++){
                                        var src = {
                                                    src:opt.src[i]
                                                }
                                        $scope.myMod.imglist.push(src);
                                    }
                                }else{
                                    if($scope.myMod.imglist.length>=6){
                                        Diaerror('图集最多只能传6张',"","",false);
                                        return false;
                                    }
                                    var src = {
                                                src:opt.src
                                            }
                                    $scope.myMod.imglist.push(src);
                                    if($scope.myMod.imglist.length>1){
                                        return false;
                                    }
                                }
                                opt.width = parseInt(opt.width);
                                opt.height = parseInt(opt.height);
                                var size = opt.width>=opt.height;
                                if(size){
                                    if(opt.width<=640){
                                        $scope.myMod.width = opt.width/2;
                                        $scope.myMod.height = opt.height/2;
                                    }else if(opt.width>640){
                                        $scope.myMod.width = 320;
                                        $scope.myMod.height = 320/opt.width*opt.height;
                                    }
                                }else{
                                    if(opt.height<=960){
                                        $scope.myMod.width = opt.width/2;
                                        $scope.myMod.height = opt.height/2;
                                    }else if(opt.height>960){
                                        $scope.myMod.width = 480/opt.height*opt.width;
                                        $scope.myMod.height = 480;
                                    }
                                }
                                $(".imglistFlash").each(function(){
                                    $(this).find("ul").css("margin-left",0)
                                })
                            });
                            $scope.goHistory();
                        }
					});
					break;
				case "button":
					data = {text:$scope.myMod.button.text,link:$scope.myMod.button.link,linktype:$scope.myMod.button.linktype,linktitle:$scope.myMod.button.linktitle,isTempUser:$scope.isTempUser};
					html = template("tempButton", data);
					art.dialog({
						title: '编辑按钮',
						width:400,
						content:html,
						ok:function(){
							$scope.$apply(function() {
                                var linktype = $("[name='urlType']").val();
                                $scope.myMod.button.text = $("input[name='buttontext']").val();
                                if(linktype=='-1'){
    								$scope.myMod.button.link = $("input[name='buttonlink']").val();
                                    $scope.myMod.button["linktype"] = linktype;
                                    $scope.myMod.button["linktitle"] = "";
                                }
                                if(linktype=='4'){
                                    $scope.myMod.button.link = $("input[name='buttonlink2']").val();
                                    $scope.myMod.button["linktype"] = linktype;
                                    $scope.myMod.button["linktitle"] = $("#linktitle").text();
                                }
							});
                            $scope.goHistory();
						},
                        close:function(){
                            $scope.helpMsgfn(1);
                        },
						cancel:true
					});
                    Gformbegin();
					break;
				case "tel":
					data = {text:$scope.myMod.tel.text,tel:$scope.myMod.tel.tel};
					html = template("tempTel", data);
					art.dialog({
						title: '编辑电话',
						width:400,
						content:html,
						ok:function(){
							$scope.$apply(function() {
								$scope.myMod.tel.text = $("input[name='text']").val();
								$scope.myMod.tel.tel = $("input[name='tel']").val();
							});
                            $scope.goHistory();
						},
                        close:function(){
                            $scope.helpMsgfn(1);
                        },
						cancel:true
					});
					break;
				case "input":
                    data = {text:$scope.myMod.input.text,type:$scope.myMod.input.type,must:$scope.myMod.input.must};
                    html = template("tempInput", data);
                    art.dialog({
                        title: '编辑输入框',
                        width:400,
                        content:html,
                        ok:function(){
                            if($("[name='inputtext']").validationEngine('validate')){
                                return false;
                            }
                            $scope.$apply(function() {
                                $scope.myMod.input.text = $("input[name='inputtext']").val();
                                $scope.myMod.input.type = $("input[name='inputtype']:checked").val();
                                $scope.myMod.input.must = $("input[name='inputmust']:checked").val()=="1" ? true : false;
                            });
                            $scope.goHistory();
                        },
                        close:function(){
                            $scope.helpMsgfn(1);
                        },
                        cancel:true
                    });
                    $("[name='inputtext']").validationEngine();
                    break;
                case "formbtn":
                    data = {text:$scope.myMod.formbtn.text};
                    html = template("tempFormbtn", data);
                    art.dialog({
                        title: '编辑提交按钮',
                        width:400,
                        content:html,
                        ok:function(){
                            $scope.$apply(function() {
                                $scope.myMod.formbtn.text = $("input[name='btntext']").val();
                            });
                            $scope.goHistory();
                        },
                        close:function(){
                            $scope.helpMsgfn(1);
                        },
                        cancel:true
                    });
                    break;
                case "svg":
                    open_svg_uploader({
                        width:true,
                        height:true,
                        callback:function(opt){
                            $scope.$apply(function() {
                                $scope.myMod.src = opt.src;
                                opt.width = parseInt(opt.width);
                                opt.height = parseInt(opt.height);
                                var size = opt.width>=opt.height;
                                if(size){
                                    if(opt.width<=640){
                                        $scope.myMod.width = opt.width/2;
                                        $scope.myMod.height = opt.height/2;
                                    }else if(opt.width>640){
                                        $scope.myMod.width = 320;
                                        $scope.myMod.height = 320/opt.width*opt.height;
                                    }
                                }else{
                                    if(opt.height<=960){
                                        $scope.myMod.width = opt.width/2;
                                        $scope.myMod.height = opt.height/2;
                                    }else if(opt.height>960){
                                        $scope.myMod.width = 480/opt.height*opt.width;
                                        $scope.myMod.height = 480;
                                    }
                                }
                            });
                            $scope.goHistory();
                        }
                    });
                    break;
            }
    }
    $scope.fnpaste = function(){
        $scope.display = 0;
        $scope.copy = angular.copy($scope.ModChecked);
        DiasucceedNew("复制成功，Ctrl+y进行黏贴");
    }
    $scope.fncopy = function(){
        if($scope.copy.length){
            $.each($scope.copy,function(i,n){
                if(n.name == "text"){n.edui = "";}
                n.top += 20;
                n.left += 20;
                $scope.adddraggable(n);
			});
			$scope.copy = angular.copy($scope.copy);
			DiasucceedNew("黏贴成功");
			return false;
		}
		DiasucceedNew("没有复制内容");
	};
	$scope.clearClass = function(){
		$scope.myMod["opacity"] = 0;
		$scope.myMod["borderWidth"] = 0;
		$scope.myMod["borderRadius"] = 0;
		$scope.myMod["borderColor"] = rgb(255, 255, 255);
		$scope.myMod["borderStyle"] = "solid";
		$scope.myMod["boxShadowColor"] = "rgba(0, 0, 0,0.5)";
		$scope.myMod["boxShadowX"] = 0;
		$scope.myMod["boxShadowY"] = 0;
		$scope.myMod["boxShadowT"] = 0;
		$scope.myMod["rotate"] = 0;
        $scope.myMod["textShadowColor"] = "rgba(0, 0, 0,0.5)";
        $scope.myMod["textShadowX"] = 0;
        $scope.myMod["textShadowY"] = 0;
        $scope.myMod["textShadowT"] = 0;
	};
	$scope.clearAnimation = function(){
		$scope.myMod.animation = {name:"",duration:2,timingFunction:"linear",delay:0,count:1,fillMode:"forwards"};
	};
	
	$scope.modAlign = function(type){
		var left = $scope.ModChecked[0].left;
		var top = $scope.ModChecked[0].top;
		var width = $scope.ModChecked[0].width;
		var height = $scope.ModChecked[0].height;
		switch(type){
			case 1:
				$.each($scope.ModChecked,function(i,n){
					left = Math.min(left,n.left);
				});
				$.each($scope.ModChecked,function(i,n){
					n.left = left;
				});
				break;
			case 2:
				var newleft;
				$.each($scope.ModChecked,function(i,n){
					left = Math.min(left,n.left);
				});
				$.each($scope.ModChecked,function(i,n){
					n.left = left;
				});
				$.each($scope.ModChecked,function(i,n){
					width = Math.max(width,n.width);
					newleft = n.left;
				});
				$.each($scope.ModChecked,function(i,n){
					n.left = (width - n.width)/2 + newleft;
				});
				break;
			case 3:
				left = left + width;
				$.each($scope.ModChecked,function(i,n){
					left = Math.max(left,n.left+n.width);
				});
				$.each($scope.ModChecked,function(i,n){
					n.left = left - n.width;
				});
				break;
			case 4:
				$.each($scope.ModChecked,function(i,n){
					top = Math.min(top,n.top);
				});
				$.each($scope.ModChecked,function(i,n){
					n.top = top;
				});
				break;
			case 5:
				var newtop;
				$.each($scope.ModChecked,function(i,n){
					top = Math.min(top,n.top);
				});
				$.each($scope.ModChecked,function(i,n){
					n.top = top;
				});
				$.each($scope.ModChecked,function(i,n){
					height = Math.max(height,n.height);
					newtop = n.top;
				});
				$.each($scope.ModChecked,function(i,n){
					n.top = (height - n.height)/2 + newtop;
				});
				break;
			case 6:
				$.each($scope.ModChecked,function(i,n){
					top = Math.max(top,n.top+n.height);
				});
				$.each($scope.ModChecked,function(i,n){
					n.top = top - n.height;
				});
				break;
			case 7:
				$scope.fnpaste();
				break;
			case 8:
				$scope.fncopy();
				break;
			case 9:
				$.each($scope.ModChecked,function(i,n){
					for(var i=0;i<=$scope.myPage.mod.length;i++){
						if(n == $scope.myPage.mod[i]){
							$scope.myPage.mod.splice(i,1);
							break;
						}
					}
				});
				break;
		} 
	};
	$scope.edui1 = function(n,opt){
        n(opt);
		//$EDITORUI[n]._onArrowClick();
	};
	$scope.edui2 = function(n,$e,t){
        n(opt);
		//return $EDITORUI[n]._onClick($e,t);
	};
	$scope.changeth = function(){
		if($scope.line == 1){
			$scope.line = 0;
		}else{
			$scope.line = 1;
		}
	};
	$scope.changebg = function(){
		open_img_uploader({
            width:640,
            height:1190,
            userid:$scope.isTempUser?false:$scope.userid,
			callback:function(opt){
                $scope.$apply(function() {
                    $scope.myPage.backgroundImg = opt.src;
                    $scope.goHistory();
                });
            }
		});
	};
    $scope.changebgcolor = function(){
        event.stopPropagation();
        $(".tooltip ").remove();
        $scope.display=15;
    };
	
	$scope.backgroundAn = function(){
		if($scope.myPage.backgroundAn<2){
			$scope.myPage.backgroundAn++;
		}else{
			$scope.myPage.backgroundAn = 0;
		}
	};
    $scope.selectActivity = function(){
        art.dialog.data('callback',function(d){
            var batchId = d.batch_id;
            var batchType = d.batch_type;
            $.ajax({
               type: "GET",
               url: "{:U('MarketActive/NewPoster/ajaxGetLabelId')}&batchId="+batchId+"&batchType="+batchType,
               success: function(da){
                    $scope.$apply(function() {
                        $scope.myMod.edui.umiput.link.href = "http://"+window.location.hostname+"{:U('Label/Label/index')}&id="+ da.info;
                        console.log($scope.myMod.edui.umiput.link.href)
                    });
               },
               dataType: "json"
            });
            $scope.$apply(function() {
                $scope.myMod.edui.umiput.link.title = d.info;
            });
        });
        art.dialog.open("{:U('LabelAdmin/SelectBatches/index',array('filterType'=>'dzhb'))}", {
            width: 800,
            title: '选择互动模块',
            id: 'selectjp'
        });
    }
    //我的模板
    $scope.savenew = function(value){
        //我的
        if($scope.issavenew){Diaerror('正在保存中，请不要频繁操作',"","",false);return false;}
        Diasucceed('正在保存中，请稍后',"","",false);
        $scope.issavenew = true;
        var newmod = {data:angular.copy(value)};
        $.each(newmod.data.mod,function(z,c){
            delete c.addan;
        });
        //存newmod
        $.post("{:U('MarketActive/NewPoster/savePosterPage')}",{"memo":JSON.stringify(newmod)},function(data){
             $scope.issavenew = false;
            if (typeof data.status != 'undefined' && data.status == 1) {
                //新增的newmod id
                Diasucceed('保存成功',"","",false);
                newmod["id"] = data.data;
                $scope.moddata[3].list[0].list.push(newmod);
            } else {
                Diaerror('模板已存在',"","",false);
            }
        },"json");

    };
	
	$scope.save = function(isview, isSaveBtn){
        
		$.each($scope.pages,function(i,n){
			$.each(n.mod,function(i,n){
				n["ModChecked"] = false;
			});
		});
        var autoSaveVal = $('#autoSave').val();
        var preview       =  $('#isPreview').val();
        if (typeof $scope.oldPages != 'undefined' && $scope.oldPages == $scope.pages && preview !== 1 && autoSaveVal == 1) { //最近没有修改 不需要自动保存
            $('#autoSave').val(0);
            return false;
        }
        var saveBtn = $('#btn-save');
        saveBtn.attr('disabled', true);

        var theFormObj = $('#theform');
        var currentAction = theFormObj.attr('action');

        if (autoSaveVal == 1) {
            currentAction = "{:U('MarketActive/NewPoster/autoSaveDraft')}";
        }

        if (preview == 1) { //预览
            currentAction = "{:U('MarketActive/NewPoster/preview')}";
        }

        if ($(this).attr('id') == 'btn-red') {
            is_publish = '1';
        } else {
            is_publish = '0';
        }
        if($scope.pages.length == 0 && autoSaveVal == 0){
            Diamsg({content:"您没有编辑任何内容~",okVal:"返回编辑",cancelVal:"返回列表",cancel:function(){history.go(-1);}});
            return false;
        }
        if($scope.pages.length == 0 && autoSaveVal == 1){
            return false;
        }
        $.each($scope.pages,function(i,n){
            delete n.$$hashKey;
            $.each(n.mod,function(z,c){
                delete c.$$hashKey;//删除节点
                delete c.addan;
            });
        });
        $("#memo").val(JSON.stringify($scope.pages));
        if (autoSaveVal == 1) {
            if(isview){
                Diasucceed("正在保存并生成预览，请稍后...");
            }
        }else{
            Diasucceed("正在保存，请稍后...");
        }
        theFormObj.ajaxSubmit({
            beforeSubmit:function(){
            },
            success:function(data){
                saveBtn.attr('disabled', false);
                if (autoSaveVal == 1) {
                    $('#autoSave').val(0);
                    if(data.status == '1'){ //自动保存成功
                        if (preview == 1) {
                            $('#isPreview').val(0);
                            if (typeof data.url != 'undefined') {
                                art.dialog.open(data.url,{
                                    width:1000,
                                    height:690,
                                    title:'预览'
                                });
                                return false;
                            }
                        }
                        Dianotice("自动保存成功");
                    } else { //自动保存失败
                        $scope.oldPages = $scope.pages;
                    }
                    return false;
                }
                 if(isTempUser==1) return false;
                if(data.status == '1'){
                    Diasucceed("保存成功,正在跳转...");
                     /*保存前先判断用户类型  isTempUser==1是临时用户，isTempUser==2不是临时用户*/
                    
                    if (is_publish == 0) {
                        setTimeout("window.location.href='{:U('MarketActive/NewPoster/saveSuccess')}&batch_id="+data.m_id+"';",100);
                    } else {
                        setTimeout("window.location.href='{:U('LabelAdmin/BindChannel/index')}&batch_type=37&batch_id="+data.m_id+"';",100);
                    }
                    return false;
                } else {
                    Diaerror(data.info);
                }
            },
            error:function(data) {
                if (autoSaveVal == 1) {
                    $('#autoSave').val(0);
                    $('#isPreview').val(0);
                }
                saveBtn.attr('disabled', false);
            },
            url:currentAction,
            dataType:'json',
            type:'post'
        });
        //临时用户，并且不是预览时，需要跳注册框,isSaveBtn表示是从保存按钮点进来的
        if (isSaveBtn && isTempUser==1) {
        	urltiyan = './index.php?g=Home&m=Land&a=regwfx&landname=dzhb&from_user_id=9000';
        }
        if(isTempUser==1 && preview != 1){
            art.dialog.open(urltiyan, {
                id : "EnterpriseNo",
                title : false,
                width : "500px",
                height : "596px"
            });
            return ;
        }
       


        return false;

        
	};

    $scope.saveview = function() { //预览
        $('#autoSave').val(1);
        $('#isPreview').val(1);
        $scope.save(true);
//        show('{$batch_id}', '{$batch_type}', autoSave);
        //autoSave(); //这种为什么不行。。。。
        return false;
    }
}]);
app.filter('toHtml', ['$sce', function ($sce) {
	return function (text) {
		return $sce.trustAsHtml(text);
	};
}]);
$("body").on("click",".btn-close", function() {
    if(isTempUser==1) return;
    artDialog.confirm('离开当前页面，如果没有保存，所做的修改会丢失，您确定要离开?',function () {
            var m_id = $('#m_id').val();
            $.ajax({ type: "GET",
                url: "{:U('MarketActive/NewPoster/removePosterData',array('id' => $id))}",
                success: function(data) {
                    if (data.status == '1') {
                        location.href = "{:U('MarketActive/NewPoster/index')}";
                    }
                },
                dataType: "json"
            });
        });
});

//自动保存 start
if(isTempUser!=1){
  setInterval("autoSave()", 1000*60*5);//50s保存一次  
}

function autoSave(){
    $('#autoSave').val(1);
    $('#btn-save').click();
}
//自动保存 end

function getPreviewUrl() {
    $.get("{:U('MarketActive/NewPoster/getPreviewUrl')}", {}, function (data) {

    }, 'JSON');
}
function open_svg_uploader(opt) {
    var defaults = {
        obj : '', //对象
        callback : false,
        maxlength : false, //是否多张
        inputname : '',
        GdataImg : 'upload'//上传类型(upload:单张,uploadmore:多张,editmore:多张修改)
    }
    var imguploadData = $.extend(true, {}, defaults, opt);

    var height;
    imguploadData.maxlength ? height = 650 : height = 500;
    art.dialog.data('imguploadData', imguploadData);
    var _thumb = '';
    if (opt.thumb == 1)
        _thumb = '&thumb=' + opt.thumb;
    if(imguploadData.user==0){
        art.dialog.open('index.php?g=ImgResize&m=Meitulogin&a=index' + _thumb, {
            id : 'art_upload',
            title : "上传图片",
            lock : true,
            width : 700,
            height : height,
            close : function() {
                if (ue) {//百度编辑器
                    $("#edui1_iframeholder").show();
                    $(".Preview-mainCon-contenter-bg").show();
                }
                $("#helpMsg").removeClass("fixed");
            }
        });
    }else{
        art.dialog.open('index.php?g=ImgResize&m=Upload&a=index' + _thumb, {
            id : 'art_upload',
            title : "上传图片",
            lock : true,
            width : 700,
            height : height,
            close : function() {
                if (ue) {//百度编辑器
                    $("#edui1_iframeholder").show();
                    $(".Preview-mainCon-contenter-bg").show();
                }
                $("#helpMsg").removeClass("fixed");
            }
        });
    };
}
function select_activity(obj) {
    var _this = $(obj);
    var url = "{:U('LabelAdmin/SelectBatches/index',array('filterType'=>'dzhb'))}";
    var title = '选择互动模块';
    art.dialog.data('callback', "");
    art.dialog.data('_this', _this);
    art.dialog.open(url, {
        width: 800,
        title: title,
        id: 'selectjp'
    });
}
function selectActivityCallback(d) {
    $('[name="linktitle"]').val(d.info);
    $('#linktitle').html(d.info);
    var batchId = d.batch_id;
    var batchType = d.batch_type;
    $.ajax({
       type: "GET",
       url: "{:U('MarketActive/NewPoster/ajaxGetLabelId')}&batchId="+batchId+"&batchType="+batchType,
       success: function(da){
            var url2 = "http://"+window.location.hostname+"{:U('Label/Label/index')}&id="+ da.info;
            $('[name="buttonlink2"]').val(url2);
            $('#linktitle').attr('href', url2);
       },
       dataType: "json"
    });
}
/*
var UnloadConfirm = {};
UnloadConfirm.msg = "数据尚未保存，离开后可能会导致数据丢失";
UnloadConfirm.set = function(a) {
    window.onbeforeunload = function(b) {
        b = b || window.event;
        b.returnValue = a;
        return a
    }
};
UnloadConfirm.clear = function() {
    fckDraft.delDraftById();
    window.onbeforeunload = function() {
    }
};
UnloadConfirm.set(UnloadConfirm.msg);*/
</script>

<script id="tempButton" type="text/html">
<div class="Gform fn">
	<ul>
		<li class="Gname">按钮名称：</li>
		<li class="Ginput"><input type="text" name="buttontext" class="validate[required]" maxlength="10" value="{{text}}" placeholder="查看详情"></li>
	</ul>
	<ul>
		<li class="Gname">链接地址：</li>
		<li class="Ginput">
            {{if isTempUser}}
            <div class="switch">
                <input name="urlType" type="radio" value="{{if linktype}}{{linktype}}{{else}}-1{{/if}}" checked="checked">
                <div class="newRadio">
                    <span data-val="-1" data-checkbefor="">其他</span>
                    <span data-val="4" data-checkbefor="">模块</span>
                </div>
                <div class="newRadio-default">
                   <input type="text" name="buttonlink" style="width:194px;padding-right:6px;" value="{{link}}" placeholder="http://">
                </div>
                <div class="newRadio-input">
                    <div class="Gchoose" style="width:170px;">
                        <input name="buttonlink2" type="text" value="{{link}}">
                        <input name="linktitle" type="hidden" value="{{linktitle}}">
                        <a href="{{link}}" id="linktitle" target="_blank">{{linktitle}}</a>
                        <a href="javascript:void(0)" class="Gbtn-url" title="选择地址" onclick="select_activity(this)"><i></i></a>
                    </div>
                </div>
            </div>
            {{else}}
                <input name="urlType" type="hidden" value="{{if linktype}}{{linktype}}{{else}}-1{{/if}}" checked="checked">
                <input type="text" name="buttonlink" value="{{link}}" placeholder="http://">
            {{/if}}
            <p class="Gtext"><a href="http://dwz.cn/" target="_blank">生成短链</a></p>
        </li>
	</ul>
</div>
</script>

<script id="tempLink" type="text/html">
<div class="Gform fn">
	<ul>
		<li class="Gname">链接地址：</li>
		<li class="Ginput">
            {{if isTempUser}}
            <div class="switch">
                <input name="urlType" type="radio" value="{{if linktype}}{{linktype}}{{else}}-1{{/if}}" checked="checked">
                <div class="newRadio">
                    <span data-val="-1" data-checkbefor="">其他</span>
                    <span data-val="4" data-checkbefor="">模块</span>
                </div>
                <div class="newRadio-default">
                   <input type="text" name="buttonlink" style="width:194px;padding-right:6px;" value="{{link}}" placeholder="http://">
                </div>
                <div class="newRadio-input">
                    <div class="Gchoose" style="width:170px;">
                        <input name="buttonlink2" type="text" value="{{link}}">
                        <input name="linktitle" type="hidden" value="{{linktitle}}">
                        <a href="{{link}}" id="linktitle" target="_blank">{{linktitle}}</a>
                        <a href="javascript:void(0)" class="Gbtn-url" title="选择地址" onclick="select_activity(this)"><i></i></a>
                    </div>
                </div>
            </div>
            {{else}}
                <input name="urlType" type="hidden" value="{{if linktype}}{{linktype}}{{else}}-1{{/if}}" checked="checked">
                <input type="text" name="buttonlink" value="{{link}}" placeholder="http://">
            {{/if}}
            <p class="Gtext"><a href="http://dwz.cn/" target="_blank">生成短链</a></p>
        </li>
	</ul>
</div>
</script>
<script id="tempTel" type="text/html">
<div class="Gform fn w400">
	<ul>
		<li class="Gname">按钮名称：</li>
		<li class="Ginput"><input type="text" name="text" class="validate[required]" maxlength="10" value="{{text}}" placeholder="呼叫"></li>
	</ul>
	<ul>
		<li class="Gname">手机/电话：</li>
		<li class="Ginput"><input type="text" name="tel" class="validate[required]" maxlength="11" value="{{tel}}"></li>
	</ul>
</div>
</script>

<script id="tempInput" type="text/html">
<div class="Gform fn w400">
    <ul>
        <li class="Gname"><span>*</span>输入框名称：</li>
        <li class="Ginput"><input type="text" name="inputtext" class="validate[required]" maxlength="10" value="{{text}}" placeholder="呼叫"></li>
    </ul>
    <ul>
        <li class="Gname"><span>*</span>输入框类型：</li>
        <li class="Ginput">
            <label><input type="radio" name="inputtype" value="text" {{if type=="text"}}checked{{/if}}>文本</label>
            <label><input type="radio" name="inputtype" value="tel" {{if type=="tel"}}checked{{/if}}>手机号</label>
            <label><input type="radio" name="inputtype" value="email" {{if type=="email"}}checked{{/if}}>邮箱</label>
        </li>
    </ul>
    <ul>
        <li class="Gname"><span>*</span>是否必填：</li>
        <li class="Ginput">
            <label><input type="radio" name="inputmust" value="1" {{if must}}checked{{/if}}>是</label>
            <label><input type="radio" name="inputmust" value="2" {{if !must}}checked{{/if}}>否</label>
        </li>
    </ul>
</div>
</script>

<script id="tempFormbtn" type="text/html">
<div class="Gform fn w400">
    <ul>
        <li class="Gname">按钮名称：</li>
        <li class="Ginput"><input type="text" name="btntext" class="validate[required]" maxlength="10" value="{{text}}"></li>
    </ul>
</div>
</script>

<include file="./Home/Tpl/MarketActive/NewPoster_basicInfo.html" />