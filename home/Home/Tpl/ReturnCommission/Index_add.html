<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>配置全民营销_全民营销_翼码旺财</title>
    <link rel="stylesheet" href="__PUBLIC__/Css/main.css?v=__VR__" />
    <link rel="stylesheet" href="__PUBLIC__/Css/module.css?v=__VR__" />
    <link rel="stylesheet" href="__PUBLIC__/Css/layout.css?v=__VR__" />
    <link rel="stylesheet" href="__PUBLIC__/Css/Wmarketing.css?v=__VR__" />
    <link rel="stylesheet" href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css?v=__VR__" />
    <script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC_LOCAL__/Js/My97DatePicker/WdatePicker.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/ajaxfileupload.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__"></script>
</head>
<body>
    <div id="wrapper">
        <include file="./Home/Tpl/Public/Public_header.html" />
        <include file="./Home/Tpl/ReturnCommission/market-nav.html" />
        <div id="container" class="bgfff">
            <div id="main" class="rel">

                <div class="phone-set">
                    <div class="content">
                        <img style="width:100%;margin-bottom:3px;" src="__PUBLIC__/Image/m-phonenav.png" alt="" />
                        <div style="height: 340px;overflow-y:scroll;">
                            <div class="m-share">
                            <div class="m-share-bonus">
                                <div id="phone_view">
                                    <p>1.他人通过您转发的链接参与该活动后，您可获得5元现金。</p>
                                    <p>2.最高可获50元现金，请预先在“我的返佣”中绑定支付宝账号。</p>
                                    <p>3.核实返佣信息后，将在10个工作日内自动发放。</p>
                                    <p>4.由上海第一佳鸡排全权负责，我们保留对此活动的解释权。</p>
                                </div>
                                <a class="btn" href="javascript:;">查看我的奖励</a>
                            </div>
                        </div>
                            <div class="m-gap"></div>
                        <div class="m-share">
                            <h1 class="tit">分享到下列平台</h1>
                            <div class="fn" style="padding-left:4px;">
                                <div class="icon mr2">
                                    <a href="javascript:;">
                                        <img src="__PUBLIC__/Label/Image/s-wx.png" alt="分享到微信"></a>
                                    <p>微信</p>
                                </div>
                                <div class="icon mr2">
                                    <a href="javascript:;">
                                        <img src="__PUBLIC__/Label/Image/s-wb.png" alt="分享到新浪微博"></a>
                                    <p>新浪微博</p>
                                </div>
                                <div class="icon mr2">
                                    <a href="javascript:;">
                                        <img src="__PUBLIC__/Label/Image/s-qq.png" alt="分享到QQ空间"></a>
                                    <p>QQ空间</p>
                                </div>
                                <div class="icon mr2">
                                    <a href="javascript:;">
                                        <img src="__PUBLIC__/Label/Image/s-twb.png" alt="分享到腾讯微博"></a>
                                    <p>腾讯微博</p>
                                </div>
                                <div class="icon">
                                    <a href="javascript:;">
                                        <img src="__PUBLIC__/Label/Image/s-rr.png" alt="分享到人人网"></a>
                                    <p>人人网</p>
                                </div>
                            </div>
                            <div class="url">
                                <p>复制以上地址分享到其他平台，当有用户通过该地址参与活动，您也可以获得可以获得可以获得可以获得返佣！</p>
                                <p>
                                    <span>http://t.cn/RhkyO1x</span>
                                </p>
                            </div>
                            <p class="p">复制以上地址分享到其他平台，当有用户通过该地址参与活动，您也可以获得奖励！</p>
                        </div>
                            <div class="m-gap"></div>
                        <div class="m-share">
                            <img class="code" src="__PUBLIC__/Label/Image/share-code.png" alt="扫码">
                            <div class="tips vt">
                                <p class="sign">您的专属推广二维码</p>
                                <p>给身边的朋友扫一扫吧，</p>
                                <p>长按可保存到手机相册。</p>
                            </div>
                        </div>
                            
                        </div>
                        
                        
                        
                    </div>
                </div>
                <div class="subcon fn" style="width:787px;padding-left:0;margin-left:0;margin-right:310px;">
                    <div class="main-name fn">
                        <h4> <i class="icon-edit mr5"></i>
                            配置全民营销
                        </h4>
                    </div>
                    <div id="store_check">
                        <form method="post" id="theform" action="">
                            <input type="hidden" name="backurl" id="backurl" value="{:urldecode(I('backurl'))}"/>
                            <input type="hidden" name="return_condition" id="return_condition"/>
                            <input type="hidden" name="return_condition_num" id="return_condition_num"/>

                            <div class="global-input6 fn bgfbfbfb">
                                <ul class="global-input-title mt0">全民营销推广对象</ul>
                                <ul>
                                    <li class="global-input6-name"></li>
                                    <li class="global-input6-input">
                                        <p class="l mr10"> <b id="marketing_name"></b>
                                        </p>
                                        <input type="hidden" style="width:1px;" readonly="readonly" name="m_id" id="m_id" value="<?php echo I('id', 0, 'intval')?>"></li>
                                </ul>
                                <ul class="global-input-title">设置返佣条件</ul>
                                <ul class="set-condition">
                                    <div class="content fn">
                                        <php>if(!$tongbaozhai_flag){</php>
                                        <li style="margin-left:0;border-color:#f94f58;" id="forwarding" onclick="change_selected('forwarding');"> <i class="corner-icon" style="display:block;"></i>
                                            <div class="up">
                                                <h4>
                                                    <i class="icon1 icon icon-hover"></i>
                                                    <span>推广转发</span>
                                                </h4>
                                                <p class="p">以转发成功记录为准。目前支持新浪微博及腾讯微博的转发数据。</p>
                                            </div>
                                            <div class="down" style="display:block;" onclick="show_dialog('{:U('Home/ReturnCommission/Index/forwarding_rule',array(id=>
                                                1,sales=>$sales))}',event);">
                                                <a class="btn" href="javascript:;">配置返佣奖励</a>
                                                <label id="notice_1"></label>
                                            </div>

                                            <input name="is_selected[]" id="is_selected_forwarding" style="display: none" type="checkbox" checked="checked" value="1"/>
                                            <input name="rule_data_1" id="rule_data_1" type="hidden" value=""/>
                                        </li>
                                        <php>}</php>
                                        <php>if(!$tongbaozhai_flag){</php>
                                        <li id="getseo" onclick="change_selected('getseo');">
                                            <i class="corner-icon"></i>
                                            <div class="up">
                                                <h4>
                                                    <i class="icon2 icon"></i>
                                                    <span>宣传引流</span>
                                                </h4>
                                                <p class="p">通过消费者宣传带来的访问量称为引流数。以当日新访客的IP为准。</p>
                                            </div>
                                            <div class="down" style="display:none;" onclick="show_dialog('{:U('Home/ReturnCommission/Index/getseo_rule',array(id=>
                                                2,sales=>$sales))}',event);">
                                                <a class="btn" href="javascript:;">配置返佣奖励</a>
                                                <label id="notice_2"></label>
                                            </div>

                                            <input name="is_selected[]" id="is_selected_getseo" style="display: none" type="checkbox" value="2"/>
                                            <input name="rule_data_2" id="rule_data_2" type="hidden" value=""/>
                                        </li>
                                        <php>}</php>
                                        <php>if($sales == 1||$tongbaozhai_flag){</php>
                                        <li id="buyproduct" onclick="change_selected('buyproduct');">
                                            <i class="corner-icon"></i>

                                            <div class="up">
                                                <h4>
                                                    <i class="icon3 icon"></i>
                                                    <span>购买商品</span>
                                                </h4>
                                                <p class="p">以购买支付到账为准，退货不返还佣金。</p>
                                            </div>
                                            <div class="down" style="display:none;" onclick="show_dialog('{:U('Home/ReturnCommission/Index/buyproduct_rule',array(id=>
                                                3,sales=>$sales))}',event);">
                                                <a class="btn" href="javascript:;">配置返佣奖励</a>
                                                <label id="notice_3"></label>
                                            </div>

                                            <input name="is_selected[]" id="is_selected_buyproduct" style="display: none" type="checkbox" value="3"/>
                                            <input name="rule_data_3" id="rule_data_3" type="hidden" value=""/>
                                        </li>
                                        <php>}</php>
                                        <php>if($sales != 1 && !$tongbaozhai_flag){</php>
                                        <li id="joinactivities" onclick="change_selected('joinactivities');">
                                            <i class="corner-icon"></i>
                                            <div class="up">
                                                <h4>
                                                    <i class="icon5 icon"></i>
                                                    <span>参与活动</span>
                                                </h4>
                                                <p class="p">参与抽奖的唯一有效手机号码为准。</p>
                                            </div>
                                            <div class="down" style="display:none;" onclick="show_dialog('{:U('Home/ReturnCommission/Index/joinactivities_rule',array('id'=>
                                                4,'sales'=>$sales))}',event);">
                                                <a class="btn" href="javascript:;">配置返佣奖励</a>
                                                <label id="notice_4"></label>
                                            </div>

                                            <input name="is_selected[]" id="is_selected_joinactivities" style="display: none" type="checkbox" value="4"/>
                                            <input name="rule_data_4" id="rule_data_4" type="hidden" value=""/>
                                        </li>
                                        <php>}</php>
                                        <li>
                                            <i class="corner-icon"></i>
                                            <div class="up">
                                                <h4>
                                                    <i class="icon4 icon"></i>
                                                    <span>接入接口</span>
                                                </h4>
                                                <p class="p">APP下载、推荐注册可通过对外接口实现，请拨打客服热线400-882-7770咨询。</p>
                                            </div>
                                            <div class="down" style="display:none;" onclick="show_dialog('{:U('Home/ReturnCommission/Index/forwarding_rule')}');">
                                                <a class="btn" href="javascript:;">配置返佣奖励</a>
                                            </div>
                                        </li>
                                    </div>
                                </ul>
                                <ul class="global-input-title">设置返佣基本信息</ul>
                                <ul class="dn">
                                    <li class="global-input6-name">*&nbsp;返佣名称：</li>
                                    <li class="global-input6-input">
                                        <input type="text" id="batch_name" class="textbox w380" value="自动生成：活动名称+返佣内容" disabled="disabled" />
                                    </li>
                                </ul>
                                <ul>
                                    <li class="global-input6-name">
                                        *&nbsp;返佣规则：
                                        <br>
                                        <a href="javascript:commission_rule_gen();">自动生成返佣规则</a>
                                        &nbsp;&nbsp;&nbsp;&nbsp;
                                    </li>
                                    <li class="global-input6-input">
                                        <textarea name="commission_rule" id="commission_rule" onkeyup="check_lenght(300, 'rule', this);" class="texttextarea w380 h140 l mr10"></textarea>
                                        <span class="font-12-cc">
                                            点击左侧的“自动生成返佣规则”，将根据您的返佣配置自动编写返佣规则，您可以在此基础上进行修改。详细的返佣规则有助于提升消费者对本活动的信任。
                                        </span>
                                        <div class="cl pt5"></div>
                                        <span class="font-12-cc" id="rule">还可以输入300个字</span>
                                    </li>
                                </ul>
                                <ul>
                                    <li class="global-input6-name">&nbsp;分享描述：</li>
                                    <li class="global-input6-input">
                                        <input name="share_note[]" id="share_note1" type="text" onkeyup="check_lenght(50, 'shareText1', this);" class="textbox w380" maxlength="50" />
                                        <span class="font-12-cc" id="shareText1">还可以输入50个字</span>
                                        <div class="cl pt5"></div>
                                        <input name="share_note[]" id="share_note2" type="text" onkeyup="check_lenght(50, 'shareText2', this);" class="textbox w380" maxlength="50" />
                                        <span class="font-12-cc" id="shareText2">还可以输入50个字</span>
                                        <div class="cl pt5"></div>
                                        <input name="share_note[]" id="share_note3" type="text" onkeyup="check_lenght(50, 'shareText3', this);" class="textbox w380" maxlength="50" />
                                        <span class="font-12-cc" id="shareText3">还可以输入50个字</span>
                                        <div class="cl pt5"></div>
                                        <input name="share_note[]" id="share_note4" type="text" onkeyup="check_lenght(50, 'shareText4', this);" class="textbox w380" maxlength="50" />
                                        <span class="font-12-cc" id="shareText4">还可以输入50个字</span>
                                        <div class="cl pt5"></div>
                                        <input name="share_note[]" id="share_note5" type="text" onkeyup="check_lenght(50, 'shareText5', this);" class="textbox w380" maxlength="50" />
                                        <span class="font-12-cc" id="shareText5">还可以输入50个字</span>
                                        <div class="cl pt5"></div>
                                        <span class="font-12-cc">
                                            分享描述将随机抽取展示一条,消费者分享时将同时复制描述及链接发送给好友。
                                            <br />
                                            示例1：十一后接到电话，原来是抽奖中了个ipad air！一个字！爽！来比比谁的运气好呀~
                                            <br />
                                            示例2：预定2014年新米啦！淳朴山东农民自产自销无农药无除草剂绿色健康有机大米！我才尝过香喷喷哦，你也来看看吧！
                                        </span>
                                    </li>
                                </ul>
                                <ul class="global-input-title">设置“分享得佣金”入口样式</ul>
                                <!--ul>
                                <li class="global-input6-name">&nbsp;分享显示图片：</li>
                                <li class="global-input6-input">
                                    <div class="rel l">
                                        <input type="hidden" value="" name="img_resp" id="img_resp">
                                        <a href="javascript:void(0);" title="上传" id="img_resp_show_upload" class="btn-all w60">上传</a>
                                        <span class="font-12-cc ml20">分享图片必须上传尺寸为300px*300px的图片，否则微信分享时图片无法显示</span>
                                    </div>
                                    <div class="cl"></div>
                                    <img src="" id="img_resp_show" width="90" class="mt10">
                                    <div class="cl"></div>
                                </li>
                            </ul-->
                            <ul>
                                <li class="global-input6-name">按钮位置：</li>
                                <li class="global-input6-input">
                                    <div class="judgeDiv">
                                        <label>
                                            <input type="radio" name="share_button_position" value="1" checked>固定于活动页面右侧中部</label>
                                        <label class="ml20">
                                            <input type="radio" name="share_button_position" value="2">固定于活动页面右侧底部</label>
                                    </div>
                                </li>
                            </ul>
                            <ul>
                                <li class="global-input6-name" style="margin-top:70px;">按钮样式：</li>
                                <li class="global-input6-input">
                                    <div class="judgeDiv">
                                        <label class="radio_share_button">
                                            <input type="radio" name="share_button_image" value="1" checked>默认按钮</label>
                                        <img style="width:59px;height:175px;" src="__PUBLIC__/Image/share-btn.png" alt="" />
                                        <label class="radio_share_button ml20">
                                            <input type="radio" name="share_button_image" value="2">自定义上传</label>
                                        <img id="custom_img_resp_show"/>
                                        <input name="custom_image" id="custom_image" type="hidden"/>
                                        <a href="javascript:void(0);" title="上传" class="btn-all w60" id="custom-upload-image" style="display: none;">上传</a>
                                    </div>

                                </li>
                            </ul>
                            <ul>
                                <li class="global-input6-name">&nbsp;</li>
                                <li class="global-input6-input tc">
                                    <!-- <a href="javascript:;" id="btn_preview" class="btn-all-del w120">预览分享页</a>
                                -->
                                <a href="javascript:void(0)" class="btn-all w120 ml10" id="smb">确定</a>
                            </li>
                        </ul>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</div>
<include file="./Home/Tpl/Public/Public_footer.html" />
<div class="service"></div>

<script>
window._global = {
    'tongbaozhai_flag' : {$tongbaozhai_flag}
};

var _batch_info = <empty name="_batch_info">null<else/>{$_batch_info}</empty>, _goods_info = null, _rules = {}, _set_rules = {}, _notice_tpl = '{$notice_tpl}',
_commission_rule_tpl = [
'1、他人通过您转发的链接#act_type#后，您可获得#return_prize#一份。\n'+
'2、#return_limit#。\n'+
'3、核实返佣信息后，将自动发放到您的手机。\n'+
'4、由{$userInfo.node_name}全权负责，我们保留对此活动的解释权。',
'','',
'1、他人通过您转发的链接#act_type#后，您可获得#return_price#现金。\n'+
'2、#return_limit#，请预先在“我的返佣”中绑定支付宝账号。\n'+
'3、核实返佣信息后，将在10个工作日内自动发放。\n'+
'4、由{$userInfo.node_name}全权负责，我们保留对此活动的解释权。'
],
_tbz_item_tpl = [
'<ul id="" class="tbz_item">',
    '<li class="global-input6-name"><a href="javascript:;" class="tbz_del">删除</a>&nbsp;&nbsp;*&nbsp;<p class="item_name">比率</p>设置：</li>',
    '<li class="global-input6-input">',
        '<div class="judgeDiv">',
            '<input name="tbz_rate[]" id="" type="text"  class="textbox w120"/>&nbsp;<p class="item_unit">%</p>',
            '&nbsp;&nbsp;*&nbsp;手机号码： <input name="tbz_phone[]" id="" type="text"  class="textbox w120 validate[required,custom[chinamobile]]"/>',
        '</div>',
    '</li>',
'</ul>'
].join('');

_rules = {
    m_id : 'validate[required]',
    commission_rule : 'validate[required,maxSize[300]]',
    share_note1 : 'validate[maxSize[50]]',
    share_note2 : 'validate[maxSize[50]]',
    share_note3 : 'validate[maxSize[50]]',
    share_note4 : 'validate[maxSize[50]]',
    share_note5 : 'validate[maxSize[50]]'
};
// 0-卡券 1-Q币 2-话费 3-现金
_set_rules = [{
    goods_id : 'validate[required]',
    mms_title : 'validate[required,maxSize[10]]',
    mms_info : 'validate[required,maxSize[100]]',
    verify_begin_date : 'validate[condRequired[verify_time_type1]]',
    verify_end_date : 'validate[condRequired[verify_time_type1]]',
    verify_begin_days : 'validate[condRequired[verify_time_type2]]',
    verify_end_days : 'validate[condRequired[verify_time_type2]]',
    phone_limit_num : 'validate[required,maxSize[100],condRequired[phone_limit_flag]]'
},{},{},{
    return_money : 'validate[custom[number],min[0],condRequired[return_money_type1]]',
    return_rate : 'validate[custom[number],min[0],max[100],condRequired[return_money_type2]]',
    phone_limit_num : 'validate[required,maxSize[100],condRequired[phone_limit_flag]]',
    return_money_limit : 'validate[custom[number],min[0.01],condRequired[return_money_limit_flag]]',
}];
_tbz_return_rules = ['validate[required,custom[number],min[0],max[100]]', 
                'validate[required,custom[number],min[0]]']
function _setformcheck(rules){
    for(d in rules)
        $('#'+d).addClass(rules[d]);
}


//营销活动选择的回调函数
function selectActivityCallback(data){
    
    $.post('{:U('verify_marketinginfo')}', {id:data.batch_id}, function(resp){
        if(resp.status == 0){
            alert(resp.info);
        }else{
            $('#marketing_name').html(data.batch_type_name + ' ＞ ' + data.name);
            $('#m_id').val(data.batch_id);
            $('.marketCondition-Item').show();
            var mCond0 = $('.marketCondition-Item:eq(0)'),mCond1 = $('.marketCondition-Item:eq(1)');

            if(data.batch_type == '26' || data.batch_type == '27'){
                $('#return_money_type2').removeAttr('disabled');
                mCond1.addClass('erro');
                mCond1.find(".erroMsg").show();
                mCond1.find(".okMsg").hide();
                mCond0.removeClass('erro');
                mCond0.find(".erroMsg").hide();
                mCond0.find(".okMsg").show();
                mCond0.trigger('click');


                if(_global.tongbaozhai_flag){
                    if(data.batch_type == '26' ||data.batch_type == '27'){
                        $('.add_return').show();
                        $('.marketCondition-Item:gt(0)').hide();
                    }
                    else{
                        $('.add_return').hide();
                    }
                }
            }else{
                $('#return_money_type2').attr('disabled', 'disabled');
                $('#return_money_type1').trigger('click');

                mCond0.addClass('erro');
                mCond0.find(".erroMsg").show();
                mCond0.find(".okMsg").hide();
                mCond1.removeClass('erro');
                mCond1.find(".erroMsg").hide();
                mCond1.find(".okMsg").show();
                mCond1.trigger('click');
            }

            _batch_info = data;
            $('#send_notice_content').val(_notice_tpl.replace('#MARKETING_INFO_NAME#', _batch_info.name));
            set_batch_name();
        }
    }, 'json');

    
}
//卡券选择的回调函数
function selectJpcallback(data){
    console.log(data);
    if(data.storage_type != 0){
        alert('请选择不限库存的卡券');
        return false;
    }
    _goods_info = data;
    set_batch_name();
    $('#goods_name').html(data.goods_name);
    $('#goods_id').val(data.goods_id);
    $('#mms_title').val(data.mms_title);
    $('#mms_info').val(data.mms_text);
    
    all_art_close();
}
function set_batch_name(){
    if(_batch_info == null) return ;
    var arr = [], type = $(':radio[name="commission_type"][checked]').val();
    arr.push(_batch_info.name);
    if(type == '0'){
        if(_goods_info != null)
            arr.push(_goods_info.goods_name);
    }
    else if(type == '3'){
        arr.push('现金');
    }
    if(arr)
        $('#batch_name').val(arr.join('-返'));
}
function preview_data(){
    var type = $(':radio[name="commission_type"][checked]').val(), prize = '';
    if(type == '0')
        prize = _goods_info.goods_name;
    if(type == '3'){
        var return_money_type = $(':radio[name="return_money_type"][checked]').val(),
            prize = return_money_type == '0' ? $('#return_money').val() + '元' : '订单金额的'+$('#return_rate').val()+'%';
    }

    return {
        'batch_name' : _batch_info.name,
        'prize' : prize,
        'rule' : $('#commission_rule').val()
    };
}
function getConType(){
    var arr = $('.marketCondition-Item').map(function(){
        if(!$(this).hasClass('erro') && $(this).hasClass('hover'))  return this;
    }), con = $(arr[0]);
    return {
        type : con.data('value'),
        num : con.find('select').val()
    };
}
$(document).ready(function(e) {
    $.fn.remove_vacls = function(){
        var arr = $(this).attr('class').split(' ');
        for(i = 0; i < arr.length; i++){
            if(arr[i].indexOf('validate[') == 0)
                $(this).removeClass(arr[i]);
        }
        if(arguments.length == 1)
            $(this).addClass(arguments[0]);

        return this;
    }
    _setformcheck(_rules);
    _setformcheck(_set_rules[0]);
    //限制与不限
    $(".judgeDiv label").live("click",function(){
        var _val=$(this).find(".labelInput").length ? true : false ;
        if(_val){
            $(this).find(".labelInput").css("display","inline-block");
            $(this).find("input[type='text'],textarea").focus();
        }else{
            $(this).closest(".judgeDiv").find(".labelInput").hide();
        }
    });

    $(":radio[name='commission_type']").change(function(){
        var id=$(this).val();
        $("#Wform0,#Wform1,#Wform2,#Wform3").hide();
        $("#Wform"+id).show();
        $('#rebateType_notice').hide();
        if(id==0){
            $('#notice_ul, .return_money_limit').hide();
            $('#rebateType_notice li:eq(1)').html('库存属性为无限的卡券才能被选用，其使用有效期必须覆盖活动有效期。');
            $('#rebateType_notice').show();
        };
        if(id==1){
        };
        if(id==2){
        };
        if(id==3){
            $('#rebateType_notice li:eq(1)').html(
                ['1、如需开启现金返佣，需保证您的账户余额不少于2000元；',
                '2、现金返佣由翼码公司通过支付宝统一代发；',
                '3、返佣奖励将在消费者符合返佣条件后的10个工作日内发出；',
                '4、上海翼码将在您的账户中扣除返佣金额及对应手续费；',
                '5、上海翼码不负责向您提供现金返佣金额、手续费金额的发票。'].join('<br>'));

            $('#notice_ul, #rebateType_notice, .return_money_limit').show()
        };
        set_batch_name();
        //设置rule——class
        for(d in _set_rules){
            if(d == id)
                _setformcheck(_set_rules[d]);
            else{
                for(dd in _set_rules[d]){
                    obj = $('#'+dd);
                    if(obj) obj.remove_vacls();
                }
            }
        }
    });
    $(".priceType").change(function(){
        var id=$(this).val();
        $("#price0,#price1").hide();
        $("#price"+id).show();
    })
    $('#btn_choose_batch').click(function(){
        art.dialog.open('{:U('Common/SelectMarketing/return_commission')}', {
            lock:true,
            height:600,
            width:850
        });
    });
    $('#bind_cj').click(function(){
        var  name = '&callback=selectJpcallback';
        art.dialog.open("{:U('Common/SelectJp/index')}"+name,{
            id: 'closeJp',
            width: 800,
            height: 600,
            title:'选择卡券',
            lock: true
        })
    });

    //表单提交
    $('#smb').click(function(){
        if(confirm('确认提交？提交后即开始启用，如有用户参与数据，则全民营销配置不可修改。'))
    {
        var btn = $(this);
        btn.attr('disabled', 'disabled');

        var info = getConType();
        $('#return_condition').val(info.type);
        $('#return_condition_num').val(info.num);

        if($("#theform").validationEngine('validate')){
            $("#theform").ajaxSubmit({
                beforeSubmit:function(){
                    dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
                },
                success:function(data){
                     if(data.status == '1'){
                           dialog.time(2).content("<div class='msg-all-succeed'>"+data.info+"</div>");
                           setTimeout(function(){
                                var backurl = $('#backurl').val();
                                location.href = backurl == '' ? '{:U('marketing_activities_running')}' : backurl;
                           }, 2000);
                           return false;
                      }else{
                            btn.removeAttr('disabled');
                            dialog.time(5).content("<div class='msg-all-error'>"+data.info+"</div>");
                      }
                },
                dataType:'json'
            });
        }
      return true;
  }else{
      return false;
    }
        
    });

    //预览用
    $("#btn_preview").click(function(){
        
        if(!$("#theform").validationEngine('validate'))
            return false;

        art.dialog.open("{:U('preview')}",{
            title:false,
            lock:true,
            padding:"0 0 0 2px",
            fixed:true,
            width:"350px",
            height:"625px",
            // cancel:true,
            ok:function(){
                //手动提交需要手动同步编辑器数据
                // ue.sync();
                // subform(ue);
                // return false;
            }
        });
    })

    <notempty name="_batch_info">selectActivityCallback({$_batch_info});</notempty>
    
    //设置返佣条件
    $(".marketCondition-Item").click(function(){
        if($(this).hasClass("erro")){
            if($(this).hasClass("hover")){
                $(this).removeClass("hover");
                $(this).find(".marketCondition-input").animate({height:0},200);
                return false;
            }
            $(this).addClass("hover");
            $(this).find(".marketCondition-input").animate({height:60},200);
            return false;
        }
        $(".marketCondition-Item").removeClass("hover");
        $(this).addClass("hover");
        $(".marketCondition-Item").find(".marketCondition-input").not($(this).find(".marketCondition-input")).animate({height:0},200);
        $(this).find(".marketCondition-input").animate({height:60},200);
    })
    $(".icon-marketCondition6").mouseover(function(){
        var top = $(this).offset().top-5;
        var left = $(this).offset().left+26;
        var html = "<em class='msg' style='top:"+top+"px;left:"+left+"px;'><p>此处设置，发放一份返佣品需要达成返佣条件的次数</p><i></i></em>";
        $("body").append(html);
    })
    $(".icon-marketCondition6").mouseout(function(){
        $("em.msg").remove();
    })
    
    $(".add_return").click(function(){
        var return_type = $(':radio[name="return_money_type"][checked]').val(), 
            obj = $(_tbz_item_tpl);
        obj.find(':input[name="tbz_rate[]"]').addClass(_tbz_return_rules[return_type]);
        obj.appendTo('#Wform3');
        $(':radio[name=return_money_type][checked]').trigger('change');
    });
    $('#Wform3').on('click', '.tbz_del', function(){
        $(this).closest('ul').remove();
    })

    $(':radio[name=return_money_type]').change(function(){
        $('.tbz_item')
            .find(':input[name="tbz_rate[]"]').remove_vacls(_tbz_return_rules[this.value]).end()
            .find('.item_name').html(['金额','比率'][this.value]).end()
            .find('.item_unit').html(['元','%'][this.value]);
    });
});
</script>
</body>
</html>
<script>
    $(document).ready(function(){
        $("#custom-upload-image").click(function(){
            var opt = {
                obj:$("#custom_img_resp_show"),
                height:160,
                width:160,
                inputname:"#custom_image",
            };
            open_img_uploader(opt);
        });
        $("#img_resp_show_upload").click(function(){
            var opt = {
                obj:$("#img_resp_show"),
                height:160,
                width:160,
                inputname:"#img_resp",
            };
            open_img_uploader(opt);
        });
        
        $(".radio_share_button").click(function(){
            var val=$('input:radio[name="share_button_image"]:checked').val();
            if(val==2){
                $("#custom-upload-image").show();
            }
            if(val==1){
                $("#custom-upload-image").hide();
            }
        });

    });

    function change_selected(domid)
    {
        var down = $('#'+domid).find('.down');
        var li = $('#'+domid);
        var icon = $('#'+domid).find('.corner-icon');
        var is_selected = $('#'+domid).find('#is_selected_'+domid);

        if(icon.css('display')=='block')
        {
            icon.hide();
            down.hide();
            $('#'+domid).find('label').html('');
            li.css('border-color','#e1e1e1');
            is_selected.removeAttr("checked");
        }else{
            icon.show();
            down.show();
            li.css('border-color','#f94f58');
            is_selected.attr("checked",'checked');
        }
    }

    function show_dialog(url,event){
        art.dialog.open(url,{
            title:"配置返佣奖励",
            width:787,
            height:650,
            lock:true
        });
        event.stopPropagation();
    }

    function cb_rule_data(id, data, notice){
        $('#rule_data_'+id).val(data);
        $('#notice_'+id).html(notice);
    }
    function parser_urlparam(str){
        var result = {};
        if(str.length>0)
        {
            var arr = str.split('&');
            for(i in arr){
                var ar = arr[i].split('=');
                result[ar[0]] = (ar.length==2)?ar[1]:'';
            }
        }else{
            return null;
        }
        return result;
    }

    //根据模板生成返佣规则
    function commission_rule_gen(){
        var cnt="达到以下情况可获得返佣：\n";
        if($("#is_selected_forwarding").attr("checked")=="checked")
        {
            var id=$("#is_selected_forwarding").val();
            var rule_data=$('#rule_data_'+id).val();
            if(rule_data != ''){
                var data = parser_urlparam(rule_data);
                if(data['commission_type']==0)
                {
                    cnt +="你转发该活动"+data['low_times_limit']+"次，你可获得"+decodeURI(data['goods_name'])+"\n";
                }
                if(data['commission_type']==3)
                {
                    cnt +="你转发该活动"+data['low_times_limit']+"次，你可获得现金"+data['return_money']+"元\n";
                }
                
            }
        }
        if($("#is_selected_getseo").attr("checked")=="checked")
        {
            var id=$("#is_selected_getseo").val();
            var rule_data=$('#rule_data_'+id).val();
            if(rule_data != ''){
                var data = parser_urlparam(rule_data);
                if(data['commission_type']==0)
                {
                    cnt +="他人通过你转发的链接访问该活动"+data['low_times_limit']+"次，你可获得"+decodeURI(data['goods_name'])+"\n";
                }
                if(data['commission_type']==3)
                {
                    cnt +="他人通过你转发的链接访问该活动"+data['low_times_limit']+"次，你可获得现金"+data['return_money']+"元\n";
                }
            }
        }
        if($("#is_selected_buyproduct").attr("checked")=="checked")
        {
            var id=$("#is_selected_buyproduct").val();
            var rule_data=$('#rule_data_'+id).val();
            if(rule_data != ''){
                var data = parser_urlparam(rule_data);
                if(data['commission_type']==0)
                {
                    cnt +="他人通过你转发的链接购买商品"+data['low_times_limit']+"次，你可获得"+decodeURI(data['goods_name'])+"\n";
                }
                if(data['commission_type']==3)
                {
                    if(data['return_money_type']==0)
                    {
                        cnt +="他人通过你转发的链接购买商品"+data['low_times_limit']+"次，你可获得现金"+data['return_money']+"元\n";
                    }
                    if(data['return_money_type']==1)
                    {
                        cnt +="他人通过你转发的链接购买商品"+data['low_times_limit']+"次，你可获得订单金额的"+data['return_rate']+"%\n";
                    }
                    
                }
            }
        }
        if($("#is_selected_joinactivities").attr("checked")=="checked")
        {
            var id=$("#is_selected_joinactivities").val();
            var rule_data=$('#rule_data_'+id).val();
            if(rule_data != ''){
                var data = parser_urlparam(rule_data);
                if(data['commission_type']==0)
                {
                    cnt +="他人通过你转发的链接参与该活动"+data['low_times_limit']+"次，你可获得"+decodeURI(data['goods_name'])+"\n";
                }
                if(data['commission_type']==3)
                {
                    cnt +="他人通过你转发的链接参与该活动"+data['low_times_limit']+"次，你可获得现金"+data['return_money']+"元\n";
                }

            }
        }
        cnt +="由#商户名称#全权负责，我们保留对此活动的解释权。\n";
        cnt = cnt.replace('#商户名称#','{$nodename}');
        $('#commission_rule').val(cnt);

        cnt = cnt.replace('\n','<br/>');
        $('#phone_view').html(cnt);
    }
    $(document).bind('propertychange input', function () {  
        var  cnt= $("#commission_rule").val();
       cnt = cnt.replace('\n','<br/>');
       cnt = cnt.replace(/[\r\n]/g,"<br/>")//去掉回车换行
       $('#phone_view').html(cnt);
});

</script>
</body>
</html>