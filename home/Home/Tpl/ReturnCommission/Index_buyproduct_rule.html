<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>全民营销</title>
    <link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/Wmarketing.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css?v=__VR__" />
    <script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC_LOCAL__/Js/My97DatePicker/WdatePicker.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/ajaxfileupload.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__"></script>
    <meta name="save" content="history">
    <style>.edit-wrap{padding: 30px 0;}</style>
</head>
<body>
    <div class="edit-wrap">
        <form id="theform">
            <div class="global-input6 fn">
                <ul>
                    <li class="global-input6-name fn">*&nbsp;返佣类型：</li>
                    <li class="global-input6-input">
                        <label>
                            <input name="commission_type" value="0" checked="checked" type="radio" class="vm rebateType" />
                            <p class="ml5 vm">卡券</p>
                        </label>
                        <!--<label class="ml20">
                        <input name="commission_type" value="1" type="radio" class="vm rebateType" />
                        <p class="ml5">Q币</p>
                    </label>
                    -->
                    <!--<label class="ml20">
                    <input name="commission_type" value="2" type="radio" class="vm rebateType" />
                    <p class="ml5">手机话费</p>
                </label>
                -->
                <label class="ml20">
                    <input name="commission_type" value="3" type="radio" class="vm rebateType" />
                    <p class="ml5 vm">现金</p>
                </label>
            </li>
        </ul>
        <ul id="rebateType_notice">
            <li class="global-input6-name red">注意：</li>
            <li class="global-input6-input red mt5">库存属性为无限的卡券才能被选用，其使用有效期必须覆盖活动有效期。</li>
        </ul>
        <ul>
            <li class="global-input6-name">*&nbsp;最低购买次数：</li>
            <li class="global-input6-input">
                <select id="low_times_limit" name="low_times_limit">
                    <option value="1">1次</option>
                    <option value="2">2次</option>
                    <option value="3">3次</option>
                    <option value="4">4次</option>
                    <option value="5">5次</option>
                    <option value="6">6次</option>
                    <option value="7">7次</option>
                    <option value="8">8次</option>
                    <option value="9">9次</option>
                    <option value="10">10次</option>
                </select>
            </li>
        </ul>
        <ul>
            <li class="global-input6-name">*&nbsp;单用户最高返佣次数：</li>
            <li class="global-input6-input">
                <div class="switch" id="user_return_price_flag_div">
                    <input name="user_return_price_flag" id="user_return_price_flag" type="radio" checked="checked" value="0"/>
                    <div class="newRadio"> <i></i>
                        <span class="value1" data-rel="0">不限制</span>
                        <span class="value2" data-rel="1">限制</span>
                    </div>
                    <div class="newRadio-input">
                        <input name="user_return_price_time" id="user_return_price_time" type="text" class="textbox ml10" />
                        <span class="maxTips forInput">次</span>
                    </div>
                </div>
        </li>
    </ul>
    <ul class="return_money_limit dn">
        <li class="global-input6-name">*&nbsp;返佣总金额限制：</li>
        <li class="global-input6-input">
            <div class="switch" id="return_money_limit_flag_div">
                <input type="radio" name="return_money_limit_flag" id="return_money_limit_flag" checked="checked" value="0"/>
                <div class="newRadio"> <i></i>
                    <span class="value1" data-rel="0">不限制</span>
                    <span class="value2" data-rel="1">限制</span>
                </div>
                <div class="newRadio-input">
                    <input type="text" name="return_money_limit" id="return_money_limit" class="textbox ml10" />
                    <span class="maxTips forInput">元</span>
                </div>
            </div>
    </li>
</ul>
<ul class="return_money_limit dn">
    <li class="global-input6-name red">注意：</li>
    <li class="global-input6-input red mt5">当总发放返佣金额超过限额，立刻停止该返佣活动。</li>
</ul>

<!--卡券-->
<div id="Wform0">
    <ul>
        <li class="global-input6-name">*&nbsp;选择卡券：</li>
        <li class="global-input6-input">
            <p class="l mr10"> <b id="goods_name"></b>
            </p>
            <a class="btn-all l w90" id="bind_cj" href="javascript:void(0)">选择卡券</a>
            <input type="hidden" name="goods_id" id="goods_id" value="">
            <input type="hidden" name="goods_name" id="goods_name_input" value=""></li>
    </ul>
    <!-- <ul>
    <li class="global-input6-name">*&nbsp;返佣数量：</li>
    <li class="global-input6-input">
        <input name="return_qcoint_num" type="text"  class="validate[custom[number],required,min[0]] textbox w120"/>
        &nbsp;份
    </li>
</ul>
-->
<ul>
    <li class="global-input6-name">*&nbsp;使用卡券时间：</li>
    <li class="global-input6-input">
        <div class="judgeDiv pt5">
            <label class="ml5" onclick="javascript:$('.judgeCon1').show();$('.judgeCon2').hide();">
                <input type="radio" name="verify_time_type" value="0" id="verify_begin_type1"/>
                <span class="ml5">按日期设置</span>
            </label>
            <label class="ml10" onclick="javascript:$('.judgeCon2').show();$('.judgeCon1').hide();">
                <input type="radio" name="verify_time_type" value="1" id="verify_begin_type2"/>
                <span class="ml5">按天数设置</span>
            </label>
        </div>
        <div class="judgeCon-time judgeCon1 dn">
            <p class="ml5">使用开始时间</p>
            <input name="verify_begin_date" id="verify_begin_date" type="text" onclick="WdatePicker({minDate:'%y-%M-%d',maxDate:'#F{$dp.$D(\\'verify_end_date\\')}'})" class="textbox w90 ml5" value=""/>
            <div class="cl pt5"></div>
            <p class="ml5">使用结束时间</p>
            <input name="verify_end_date" id="verify_end_date" type="text" onclick="WdatePicker({minDate:'#F{$dp.$D(\\'verify_begin_date\\')||\\'%y-%M-%d\\'}'})" class="textbox w90 ml5" maxlength="8" value="" />
            <div class="cl"></div>
            <p class="font-12-cc">商户可以自定义验码开始的日期如："4月1号,6月1号";</p>
        </div>
        <div class="judgeCon-time judgeCon2 dn">
            <p class="ml5">发送卡券后</p>
            <input name="verify_begin_days" id="verify_begin_days" type="text" class="textbox w50 ml5" value="" />
            &nbsp;天开始使用
            <div class="cl pt5"></div>
            <p class="ml5">发送卡券后</p>
            <input name="verify_end_days" id="verify_end_days" type="text" class="textbox w50 ml5" value="" />
            &nbsp;天结束使用
            <div class="cl"></div>
            <p class="font-12-cc">商户可以自定义验码时间，如：“发送卡券后3天开始使用-发送卡券后5天结束使用”</p>
        </div>
    </li>
</ul>
<ul>
    <li class="global-input6-name">*&nbsp;彩信标题：</li>
    <li class="global-input6-input">
        <input id="mms_title" name="mms_title" type="text" onkeyup="check_lenght(10,'title_text',this);"  class="textbox w380 validate[required]"/>
        <br />
        <p class="font-12-cc" id="title_text">还可以输入10个字</p>
    </li>
</ul>
<ul>
    <li class="global-input6-name">*&nbsp;彩信内容：</li>
    <li class="global-input6-input">
        <textarea name="mms_info" id="mms_info" onkeyup="check_lenght(100,'text',this);" class="texttextarea w380"></textarea>
        <br />
        <span class="font-12-cc" id="text">还可以输入100个字</span>
    </li>
</ul>
</div>
<!--卡券-->

<!--Q币-->
<!--<div id="Wform1" class="dn">
<ul>
<li class="global-input6-name">*&nbsp;返Q币数：</li>
<li class="global-input6-input">
    <input name="return_qcoint_num" type="text"  class="textbox w120"/>
    &nbsp;Q币
</li>
</ul>
<ul>
<li class="global-input6-name">&nbsp;手机号码返币限制：</li>
<li class="global-input6-input">
    <div class="judgeDiv">
        <label>
            <input type="radio" name="" value="0" checked="checked">不限制</label>
        <label class="ml20">
            <input type="radio" name="" value="1">
            限制
            <div class="labelInput dn">
                <input type="text" class="textbox w50 ml5" value="2">&nbsp;Q币</div>
        </label>
    </div>
</li>
</ul>
</div>
-->
<!--Q币结束-->
<!--手机话费-->
<!--<div id="Wform2" class="dn">
<ul>
<li class="global-input6-name">*&nbsp;返话费数：</li>
<li class="global-input6-input">
<input name="return_phone_charge" type="text"  class="textbox w120"/>
&nbsp;元
</li>
</ul>
<ul>
<li class="global-input6-name">&nbsp;手机号码返话费限制：</li>
<li class="global-input6-input">
<div class="judgeDiv">
    <label>
        <input type="radio" name="" value="0" checked="checked">不限制</label>
    <label class="ml20">
        <input type="radio" name="" value="1">
        限制
        <div class="labelInput dn">
            <input type="text" class="textbox w50 ml5" value="2">&nbsp;Q币</div>
    </label>
</div>
</li>
</ul>
</div>
-->
<!--手机话费结束-->

<!--现金-->
<div id="Wform3" class="dn">
<ul>
<li class="global-input6-name">*&nbsp;返佣金额类型：</li>
<li class="global-input6-input">
<label>
    <input name="return_money_type" id="return_money_type1" value="0" type="radio" class="vm priceType" checked="checked" />
    <p class="ml5 vm">金额</p>
</label>
<label class="ml20">
    <input name="return_money_type" id="return_money_type2" <?php if(!$sales && !$tongbaozhai_flag){?>
    disabled="disabled"
    <?php }?>
    value="1" type="radio" class="vm priceType" />
    <p class="ml5">订单价格比率</p>
</label>
</li>
</ul>
<?php if($tongbaozhai_flag && $sales){?>
<ul id="price0">
<li class="global-input6-name">*&nbsp;销售员金额设置：</li>
<li class="global-input6-input">
<div class="judgeDiv">
    <input name="return_money" id="return_money" type="text"  class="textbox w120"/>
    &nbsp;元
    <a href="javascript:;" class="add_return">+增加返佣对象</a>
</div>
</li>
</ul>
<ul id="price1" class="dn">
<li class="global-input6-name">*&nbsp;销售员比率设置：</li>
<li class="global-input6-input">
<div class="judgeDiv">
    <input name="return_rate" id="return_rate" type="text"  class="textbox w120"/>
    &nbsp;%
    <a href="javascript:;" class="add_return">+增加返佣对象</a>
</div>
</li>
</ul>
<?php }else{?>
<ul id="price0">
<li class="global-input6-name">*&nbsp;金额设置：</li>
<li class="global-input6-input">
<div class="judgeDiv">
    <input name="return_money" id="return_money" type="text"  class="validate[,condRequired[return_money_type1],required] textbox w120"/>
    &nbsp;元
</div>
</li>
</ul>
<ul id="price1" class="dn">
<li class="global-input6-name">*&nbsp;比率设置：</li>
<li class="global-input6-input">
<div class="judgeDiv">
    <input name="return_rate" id="return_rate" type="text"  class="validate[,condRequired[return_money_type2],required] textbox w120"/>
    &nbsp;%
</div>
</li>
</ul>
<?php }?></div>
<ul id="notice_ul" class="dn">
<li class="global-input6-name">&nbsp;是否发送通知短信：</li>
<li class="global-input6-input">
<div class="judgeDiv">
<label>
    <input type="radio" name="send_notice_flag"  value="0">不发送</label>
<label class="ml20">
    <input type="radio" name="send_notice_flag" checked="checked" value="1">
    发送
    <div class="cl"></div>
    <div class="labelInput">
        <textarea name="send_notice_content" id="send_notice_content" class="texttextarea w380">{$notice_tpl}</textarea>
        <br>
        <span class="font-12-cc">
            为免打扰个人日常生活，短信通知将在达成返佣条件后的第二天上午10点后发送。
            <br>如发生多条返佣，将金额合并为一条短信通知发送。</span>
    </div>
</label>
</div>
</li>
</ul>
<!--现金-->
<php>if(I('act')!='edit'||I('is_have_data')==0){</php>
<ul>
<li class="global-input6-name">&nbsp;</li>
<li class="global-input6-input">
<a class="btn-all w200" id="save" href="javascript:void(0);" onclick="javascript:save();">确定</a>
</li>
</ul>
<php>}</php>
</div>
</form>
</div>
</body>
</html>
<script>
    window._global = {
        'tongbaozhai_flag' : {$tongbaozhai_flag}
    };

    var _batch_info = <empty name="_batch_info">null<else/>{$_batch_info}</empty>, _goods_info = null, _rules = {}, _set_rules = {}, _notice_tpl = '{$notice_tpl}',

            _tbz_item_tpl = [
                '<ul id="" class="tbz_item">',
                '<li class="global-input6-name"><a href="javascript:;" class="tbz_del">删除</a>&nbsp;&nbsp;*&nbsp;<p class="item_name">比率</p>设置：</li>',
                '<li class="global-input6-input">',
                '<div class="judgeDiv">',
                '<input name="tbz_rate[]" id="" type="text"  class="textbox w120"/>&nbsp;<p class="item_unit">%</p>',
                '&nbsp;&nbsp;*&nbsp;手机号码： <input name="tbz_phone[]" id="" type="text"  class="textbox w120 validate[required,custom[chinamobile]]"/>',
                '</div>',
                '</li>',
                '</ul>'
            ].join('');

    _rules = {
        m_id : 'validate[required]',
        commission_rule : 'validate[required,maxSize[300]]',
        share_note1 : 'validate[maxSize[50]]',
        share_note2 : 'validate[maxSize[50]]',
        share_note3 : 'validate[maxSize[50]]',
        share_note4 : 'validate[maxSize[50]]',
        share_note5 : 'validate[maxSize[50]]'
    };
    // 0-卡券 1-Q币 2-话费 3-现金
    _set_rules = [{
        goods_id : 'validate[required]',
        mms_title : 'validate[required,maxSize[10]]',
        mms_info : 'validate[required,maxSize[100]]',
        verify_begin_date : 'validate[condRequired[verify_time_type1]]',
        verify_end_date : 'validate[condRequired[verify_time_type1]]',
        verify_begin_days : 'validate[condRequired[verify_time_type2]]',
        verify_end_days : 'validate[condRequired[verify_time_type2]]',
        phone_limit_num : 'validate[required,maxSize[100],condRequired[phone_limit_flag]]'
    },{},{},{
        return_money : 'validate[custom[number],min[0],condRequired[return_money_type1]]',
        return_rate : 'validate[custom[number],min[0],max[100],condRequired[return_money_type2]]',
        phone_limit_num : 'validate[required,maxSize[100],condRequired[phone_limit_flag]]',
        return_money_limit : 'validate[custom[number],min[0.01],condRequired[return_money_limit_flag]]',
    }];
    _tbz_return_rules = ['validate[required,custom[number],min[0],max[100]]',
        'validate[required,custom[number],min[0]]']
    function _setformcheck(rules){
        for(d in rules)
            $('#'+d).addClass(rules[d]);
    }

    //卡券选择的回调函数
    function selectJpcallback(data){
        console.log(data);
        console.log(data);
        if(data.storage_type != 0){
            alert('请选择不限库存的卡券');
            return false;
        }
        _goods_info = data;
        set_batch_name();
        $('#goods_name').html(data.goods_name);
        $('#goods_name_input').val(data.goods_name);
        $('#goods_id').val(data.goods_id);
        $('#mms_title').val(data.mms_title);
        $('#mms_info').val(data.mms_text);
        
        all_art_close();
    }
    function set_batch_name(){
        if(_batch_info == null) return ;
        var arr = [], type = $(':radio[name="commission_type"][checked]').val();
        arr.push(_batch_info.name);
        if(type == '0'){
            if(_goods_info != null)
                arr.push(_goods_info.goods_name);
        }
        else if(type == '3'){
            arr.push('现金');
        }
        if(arr)
            $('#batch_name').val(arr.join('-返'));
    }
    function preview_data(){
        var type = $(':radio[name="commission_type"][checked]').val(), prize = '';
        if(type == '0')
            prize = _goods_info.goods_name;
        if(type == '3'){
            var return_money_type = $(':radio[name="return_money_type"][checked]').val(),
                    prize = return_money_type == '0' ? $('#return_money').val() + '元' : '订单金额的'+$('#return_rate').val()+'%';
        }

        return {
            'batch_name' : _batch_info.name,
            'prize' : prize,
            'rule' : $('#commission_rule').val()
        };
    }
    function getConType(){
        var arr = $('.marketCondition-Item').map(function(){
            if(!$(this).hasClass('erro') && $(this).hasClass('hover'))  return this;
        }), con = $(arr[0]);
        return {
            type : con.data('value'),
            num : con.find('select').val()
        };
    }

    function save(){
        var commission_type = $(':radio[name="commission_type"][checked]').val();
        if($("#goods_name_input").val()=="" &&commission_type=='0')
        {
            var title="提示";
            art.dialog({
                "title":title,
                content:"请选择卡券！"
            });
            return false;

        }
        if($("#theform").validationEngine('validate')){
        var data = $('#theform').serialize();
        var return_item = commission_type == '0' ? $('#goods_name').html() : $('#return_money').val();
        var notice = "<p>交易<span>"+$("#low_times_limit option:selected").val()+"</span> 次，返<span>"+return_item+"</span></p>";
        var win = art.dialog.opener;
        win['cb_rule_data'].call(this, <?php echo I('id')?>, data, notice);
        var title="提示";
        art.dialog({
            "title":title,
            content:"规则已经提交成功！",
            ok:function(){
                var api = art.dialog.open.api;
                api && api.close();
            }
        });
    }


    }

    $(document).ready(function(e) {
        $.fn.remove_vacls = function(){
            var arr = $(this).attr('class').split(' ');
            for(i = 0; i < arr.length; i++){
                if(arr[i].indexOf('validate[') == 0)
                    $(this).removeClass(arr[i]);
            }
            if(arguments.length == 1)
                $(this).addClass(arguments[0]);

            return this;
        }
        _setformcheck(_rules);
        _setformcheck(_set_rules[0]);
        //限制与不限
        $(".judgeDiv label").live("click",function(){
            var _val=$(this).find(".labelInput").length ? true : false ;
            if(_val){
                $(this).find(".labelInput").css("display","inline-block");
                $(this).find("input[type='text'],textarea").focus();
            }else{
                $(this).closest(".judgeDiv").find(".labelInput").hide();
            }
        });

        $(":radio[name='commission_type']").change(function(){
            var id=$(this).val();
            $("#Wform0,#Wform1,#Wform2,#Wform3").hide();
            $("#Wform"+id).show();
            $('#rebateType_notice').hide();
            if(id==0){
                $('#notice_ul, .return_money_limit').hide();
                $('#rebateType_notice li:eq(1)').html('库存属性为无限的卡券才能被选用，其使用有效期必须覆盖活动有效期。');
                $('#rebateType_notice').show();
            };
            if(id==1){
            };
            if(id==2){
            };
            if(id==3){
                $('#rebateType_notice li:eq(1)').html(
                        ['1、如需开启现金返佣，需保证您的账户余额不少于2000元；',
                            '2、现金返佣由翼码公司通过支付宝统一代发；',
                            '3、返佣奖励将在消费者符合返佣条件后的10个工作日内发出；',
                            '4、上海翼码将在您的账户中扣除返佣金额及对应手续费；',
                            '5、上海翼码不负责向您提供现金返佣金额、手续费金额的发票。'].join('<br>'));

                $('#notice_ul, #rebateType_notice, .return_money_limit').show()
            };
            set_batch_name();
            //设置rule——class
            for(d in _set_rules){
                if(d == id)
                    _setformcheck(_set_rules[d]);
                else{
                    for(dd in _set_rules[d]){
                        obj = $('#'+dd);
                        if(obj) obj.remove_vacls();
                    }
                }
            }
        });
        $(".priceType").change(function(){
            var id=$(this).val();
            $("#price0,#price1").hide();
            $("#price"+id).show();
        })
        $('#btn_choose_batch').click(function(){
            art.dialog.open('{:U('Common/SelectMarketing/return_commission')}', {
                lock:true,
                height:600,
                width:850
            });
        });
        $('#bind_cj').click(function(){
            var  name = '&callback=selectJpcallback';
            art.dialog.open("{:U('Common/SelectJp/index')}"+name,{
                id: 'closeJp',
                width: 800,
                height: 600,
                title:'选择卡券',
                lock: true
            })
        });

        //表单提交
        $('#smb').click(function(){
            var btn = $(this);
            btn.attr('disabled', 'disabled');

            var info = getConType();
            $('#return_condition').val(info.type);
            $('#return_condition_num').val(info.num);

            if($("#theform").validationEngine('validate')){
                $("#theform").ajaxSubmit({
                    beforeSubmit:function(){
                        dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
                    },
                    success:function(data){
                        if(data.status == '1'){
                            dialog.time(2).content("<div class='msg-all-succeed'>"+data.info+"</div>");
                            setTimeout(function(){
                                var backurl = $('#backurl').val();
                                location.href = backurl == '' ? '{:U('index')}' : backurl;
                            }, 2000);
                            return false;
                        }else{
                            btn.removeAttr('disabled');
                            dialog.time(5).content("<div class='msg-all-error'>"+data.info+"</div>");
                        }
                    },
                    dataType:'json'
                });
            }
        });





            //设置返佣条件
        $(".marketCondition-Item").click(function(){
            if($(this).hasClass("erro")){
                if($(this).hasClass("hover")){
                    $(this).removeClass("hover");
                    $(this).find(".marketCondition-input").animate({height:0},200);
                    return false;
                }
                $(this).addClass("hover");
                $(this).find(".marketCondition-input").animate({height:60},200);
                return false;
            }
            $(".marketCondition-Item").removeClass("hover");
            $(this).addClass("hover");
            $(".marketCondition-Item").find(".marketCondition-input").not($(this).find(".marketCondition-input")).animate({height:0},200);
            $(this).find(".marketCondition-input").animate({height:60},200);
        })
        $(".icon-marketCondition6").mouseover(function(){
            var top = $(this).offset().top-5;
            var left = $(this).offset().left+26;
            var html = "<em class='msg' style='top:"+top+"px;left:"+left+"px;'><p>此处设置，发放一份返佣品需要达成返佣条件的次数</p><i></i></em>";
            $("body").append(html);
        })
        $(".icon-marketCondition6").mouseout(function(){
            $("em.msg").remove();
        })

        $(".add_return").click(function(){
            var return_type = $(':radio[name="return_money_type"][checked]').val(),
                    obj = $(_tbz_item_tpl);
            obj.find(':input[name="tbz_rate[]"]').addClass(_tbz_return_rules[return_type]);
            obj.appendTo('#Wform3');
            $(':radio[name=return_money_type][checked]').trigger('change');
        });
        $('#Wform3').on('click', '.tbz_del', function(){
            $(this).closest('ul').remove();
        })

        $(':radio[name=return_money_type]').change(function(){
            $('.tbz_item')
                    .find(':input[name="tbz_rate[]"]').remove_vacls(_tbz_return_rules[this.value]).end()
                    .find('.item_name').html(['金额','比率'][this.value]).end()
                    .find('.item_unit').html(['元','%'][this.value]);
        });
    });
</script>
</body>
</html>
<script>
    $(document).ready(function(){
        $(".switch").click(function(){
            if($(this).hasClass("disabled")){return false;}
            if($(this).hasClass("hover")){
                $(this).removeClass("hover");
                $(this).find("input[type='radio']").val($(this).find(".value1").attr("data-rel"));
                $(this).find("input[type='text']").val("");
            }else{
                $(this).addClass("hover");
                $(this).find("input[type='radio']").val($(this).find(".value2").attr("data-rel"));
            };
        })
        $(".switch input").click(function(event){
            event.stopPropagation();
        });
        var data_str=$("#rule_data_<?php echo I('id')?>",parent.document).val();
        data = {};
        parse_str(data_str, data);
        /*赋值给表单*/
        /*if (data['goods_name'] !== undefined)
        {
            alert(decodeURI(data['goods_name']));
        }*/
        var commission_type=data['commission_type'];
        /*if(commission_type>0)
        {
            $('input:radio[name="commission_type"]').attr("checked",'+commission_type+');
            $('input:radio[name="commission_type"][value='+commission_type+']').trigger('change');
        }*/
        $('input:radio[name="commission_type"][value='+commission_type+']').trigger('click');
        if(parseInt(data['return_money_limit_flag'])==1)
        {
            $('#return_money_limit_flag_div').trigger('click');
            $('#return_money_limit').val(data['return_money_limit']);
        }
        if(parseInt(data['user_return_price_flag'])==1)
        {
            $('#user_return_price_flag_div').trigger('click');
            $('#user_return_price_time').val(data['user_return_price_time']);
        }
        $('#low_times_limit').val(data['low_times_limit']);
        $('#return_money').val(data['return_money']);
        $('#return_rate').val(data['return_rate']);

        $('input:radio[name="send_notice_flag"][value='+data['send_notice_flag']+']').trigger('click');
        if(decodeURI(data['send_notice_content'])!='undefined')
        {
            $('#send_notice_content').val(decodeURI(data['send_notice_content']));
        }

        /*卡券*/
        $('#goods_id').val(data['goods_id']);
        if(decodeURI(data['goods_name'])!='undefined')
        {
            $('#goods_name_input').val(decodeURI(data['goods_name']));
            $('#goods_name').html(decodeURI(data['goods_name']));
        }
        if(decodeURI(data['mms_title'])!='undefined')
        {
            $('#mms_title').val(decodeURI(data['mms_title']));
        }
        if(decodeURI(data['mms_info'])!='undefined')
        {
            $('#mms_info').val(decodeURI(data['mms_info']));
        }
        

        $('input:radio[name="verify_time_type"][value='+data['verify_time_type']+']').trigger('click');
        $('#verify_begin_days').val(data['verify_begin_days']);
        $('#verify_end_days').val(data['verify_end_days']);

        $('#verify_begin_date').val(data['verify_begin_date']);
        $('#verify_end_date').val(data['verify_end_date']);
        /*通宝斋逻辑*/
        tbz_phone=data['tbz_phone'];
        tbz_rate=data['tbz_rate'];
        for (key in tbz_phone){
            var _tbz_item_tpl = [
                '<ul id="" class="tbz_item">',
                '<li class="global-input6-name"><a href="javascript:;" class="tbz_del">删除</a>&nbsp;&nbsp;*&nbsp;<p class="item_name">比率</p>设置：</li>',
                '<li class="global-input6-input">',
                '<div class="judgeDiv">',
                '<input name="tbz_rate[]" id="" type="text"  class="textbox w120" value="'+tbz_rate[key]+'"/>&nbsp;<p class="item_unit">%</p>',
                '&nbsp;&nbsp;*&nbsp;手机号码： <input name="tbz_phone[]" id="" type="text"  class="textbox w120 validate[required,custom[chinamobile]]" value="'+tbz_phone[key]+'"/>',
                '</div>',
                '</li>',
                '</ul>'
            ].join('');
            var return_type = data['return_money_type'],
                    obj = $(_tbz_item_tpl);
            obj.find(':input[name="tbz_rate[]"]').addClass(_tbz_return_rules[return_type]);
            obj.appendTo('#Wform3');
            $('input:radio[name="return_money_type"][value='+data['return_money_type']+']').trigger('click');
        }





    });
</script>