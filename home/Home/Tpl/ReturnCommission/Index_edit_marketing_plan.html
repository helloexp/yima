<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>编辑旺财小店推广计划_全民营销_翼码旺财</title>
    <link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/Wmarketing.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css" />
    <script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC_LOCAL__/Js/My97DatePicker/WdatePicker.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/ajaxfileupload.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__"></script>
    <meta name="save" content="history">
</head>
<body>
<div class="edit-wrap">
    <form action="{:U()}" method="post" name="theform" id="theform">
                        <input type="hidden" name="g" id="g" value="{$Think.const.GROUP_NAME}"/>
                        <input type="hidden" name="m" id="m" value="{$Think.const.MODULE_NAME}"/>
                        <input type="hidden" name="a" id="a" value="{$Think.const.ACTION_NAME}"/>
    <div class="global-input6 fn">
        <div id="Wform3" class="">
            <ul>
                <li class="global-input6-name">*&nbsp;推广时间：</li>
                <li class="global-input6-input">
                    <div class="judgeDiv">
                                开始时间<input name="return_commission_start_time" id="return_commission_start_time" type="text" disabled="disabled" value="<?php echo dateformat($marketing_ecommerce['return_commission_start_time'], 'Y-m-d');?>" onclick="WdatePicker({minDate:'%y-%M-%d',maxDate:'#F{$dp.$D(\\'return_commission_start_time\\')}'})"  class="textbox w120"/>
                                结束时间<input name="return_commission_end_time" id="return_commission_end_time" type="text" disabled="disabled" value="<?php echo dateformat($marketing_ecommerce['return_commission_end_time'], 'Y-m-d');?>" onclick="WdatePicker({minDate:'%y-%M-%d',maxDate:'#F{$dp.$D(\\'return_commission_end_time\\')}'})"  class="textbox w120"/>
                    </div>自定义本次推广的时间，到期后自动停止。
                </li>
            </ul>
            <ul>
                <li class="global-input6-name">*&nbsp;最低交易次数：</li>
                <li class="global-input6-input">
                    <select id="low_times_limit" name="low_times_limit" disabled="disabled">
                        <option value="1" <php>if((int)$marketing_ecommerce['return_condition_num']==1){echo 'selected="selected"';}</php>>1次</option>
                        <option value="2" <php>if((int)$marketing_ecommerce['return_condition_num']==2){echo 'selected="selected"';}</php>>2次</option>
                        <option value="3" <php>if((int)$marketing_ecommerce['return_condition_num']==3){echo 'selected="selected"';}</php>>3次</option>
                        <option value="4" <php>if((int)$marketing_ecommerce['return_condition_num']==4){echo 'selected="selected"';}</php>>4次</option>
                        <option value="5" <php>if((int)$marketing_ecommerce['return_condition_num']==5){echo 'selected="selected"';}</php>>5次</option>
                        <option value="6" <php>if((int)$marketing_ecommerce['return_condition_num']==6){echo 'selected="selected"';}</php>>6次</option>
                        <option value="7" <php>if((int)$marketing_ecommerce['return_condition_num']==7){echo 'selected="selected"';}</php>>7次</option>
                        <option value="8" <php>if((int)$marketing_ecommerce['return_condition_num']==8){echo 'selected="selected"';}</php>>8次</option>
                        <option value="9" <php>if((int)$marketing_ecommerce['return_condition_num']==9){echo 'selected="selected"';}</php>>9次</option>
                        <option value="10" <php>if((int)$marketing_ecommerce['return_condition_num']==10){echo 'selected="selected"';}</php>>10次</option>
                    </select>
                </li>
            </ul>
            <ul>
                <li class="global-input6-name">*&nbsp;返佣金额类型：</li>
                <li class="global-input6-input">
                    <label><input name="return_money_type" id="return_money_type1" value="0" type="radio" class="vm priceType" <php>if((int)$marketing_ecommerce['return_money_type']==0){echo 'checked="checked"';}</php> <php>if($is_start){echo 'disabled="disabled"';}</php>/><p class="ml5 vm">金额</p></label>
                    <label class="ml20"><input name="return_money_type" id="return_money_type2" value="1" type="radio" class="vm priceType" <php>if((int)$marketing_ecommerce['return_money_type']==1){echo 'checked="checked"';}</php> <php>if($is_start){echo 'disabled="disabled"';}</php>/><p class="ml5">订单价格比率</p></label>
                </li>
            </ul>
                <ul id="price0" class="<php>if((int)$marketing_ecommerce['return_money_type']==1){echo "dn";}</php>">
                    <li class="global-input6-name">*&nbsp;金额设置：</li>
                    <li class="global-input6-input">
                        <div class="judgeDiv">
                            <input name="return_money" id="return_money" type="text"  class="textbox w120" value="<?php echo $marketing_ecommerce['return_money'];?>" <php>if($is_start){echo 'disabled="disabled"';}</php>/>&nbsp;元
                        </div>
                    </li>
                </ul>
                <ul id="price1" class="<php>if((int)$marketing_ecommerce['return_money_type']==0){echo "dn";}</php>">
                    <li class="global-input6-name">*&nbsp;比率设置：</li>
                    <li class="global-input6-input">
                        <div class="judgeDiv">
                            <input name="return_rate" id="return_rate" type="text"  class="textbox w120" value="<?php echo $marketing_ecommerce['return_money'];?>" <php>if($is_start){echo 'disabled="disabled"';}</php>/>&nbsp;%
                        </div>
                    </li>
                </ul>
            
        </div>
        <ul>
            <li class="global-input6-name">*&nbsp;单用户最高返佣次数：</li>
            <li class="global-input6-input">
                <div class="switch disabled" id="user_return_price_flag_div">
                    <div class="newRadio">
                        <i></i>
                        <span class="value1" data-rel="1"><?php
                        if((int)$marketing_ecommerce['phone_limit_flag']==0)
                        {
                        echo "不限制";
                        }
                        if((int)$marketing_ecommerce['phone_limit_flag']==1)
                        {
                        echo "限制";
                        }
                        ?></span>
                    </div>
                    <?php if((int)$marketing_ecommerce['phone_limit_flag']==1){?>
                    <div class="newRadio">
                        <input disabled="disabled" value="<?php echo $marketing_ecommerce['phone_limit_num'];?>次" type="text" class="textbox ml10" />
                        
                    </div>
                    <?php }?>
                </div>
            </li>
        </ul>
        <ul class="return_money_limit">
            <li class="global-input6-name">*&nbsp;返佣总金额限制：</li>
            <li class="global-input6-input">
                <div class="switch disabled" id="return_price_flag_div">
                    <div class="newRadio">
                        <i></i>
                        <span class="value1" data-rel="1"><?php
                        if((int)$marketing_ecommerce['return_money_limit_flag']==0)
                        {
                        echo "不限制";
                        }
                        if((int)$marketing_ecommerce['return_money_limit_flag']==1)
                        {
                        echo "限制";
                        }
                        ?></span>
                    </div>
                    <?php if((int)$marketing_ecommerce['return_money_limit_flag']==1){?>
                    <div class="newRadio">
                        <input disabled="disabled" value="<?php echo $marketing_ecommerce['return_money_limit'];?>元" type="text" class="textbox ml10" />
                    </div>
                    <?php }?>
                </div>
            </li>
        </ul>
        

        <!--现金-->
        
        <ul id="notice_ul" class="">
            <li class="global-input6-name">&nbsp;是否发送通知短信：</li>
            <li class="global-input6-input">
                <div class="judgeDiv">
                    <label class="ml20">
                        <?php
                        if((int)$marketing_ecommerce['send_notice_flag']==0)
                        {
                        echo "不发送";
                        }
                        if((int)$marketing_ecommerce['send_notice_flag']==1)
                        {
                        echo "第二天10点发送";
                        }
                        if((int)$marketing_ecommerce['send_notice_flag']==2)
                        {
                        echo "立即发送";
                        }
                        ?>
                    </label>
                    <br/>
                    <textarea name="send_notice_content" id="send_notice_content" disabled="disabled" class="texttextarea w380">{$notice_tpl}</textarea>
                </div>
            </li>
        </ul>
        <ul>
            <li class="global-input6-name">*&nbsp;返佣规则：<br><a href="javascript:commission_rule_gen();">自动生成返佣规则</a></li>
            <li class="global-input6-input">
                <textarea name="commission_rule" id="commission_rule" onkeyup="check_lenght(300, 'rule', this);" class="texttextarea w380 h140 l mr10"><?php echo $marketing_ecommerce['commission_rule'];?></textarea>
                
                <div class="cl pt5"></div>
                <span class="font-12-cc" id="rule">还可以输入300个字</span>
            </li>
        </ul>
        <!--现金-->
        <ul>
            <li class="global-input6-name">&nbsp;</li>
            <li class="global-input6-input"><a href="javascript:;" class="btn-all w200" id="save">确定</a></li>
        </ul>
    </div>
    <input name="id" type="hidden" value="<php>echo I('id');</php>"/>
    </form>
</div>
</body>
</html>
<script>
    function commission_rule_gen(){
        var return_money_type = $(':radio[name="return_money_type"][checked]').val();
        prize = return_money_type == '0' ? $('#return_money').val() + '元' : '订单金额的'+$('#return_rate').val()+'%';
        cnt = "他人通过你转发的链接购买商品"+$("#low_times_limit option:selected").val()+"次，你可获得"+prize+"\n";
        cnt +="由#商户名称#全权负责，我们保留对此活动的解释权。\n";
        cnt = cnt.replace('#商户名称#','{$nodename}');
        $('#commission_rule').val(cnt);
    }
    $(document).ready(function(e) {
        //限制与不限
        $(".judgeDiv label").live("click",function(){
            var _val=$(this).find(".labelInput").length ? true : false ;
            if(_val){
                $(this).find(".labelInput").css("display","inline-block");
                $(this).find("input[type='text'],textarea").focus();
            }else{
                $(this).closest(".judgeDiv").find(".labelInput").hide();
            }
        });
        $('#save').click(function(){
            $('#a').val('edit_marketing_plan');
            $("#theform").ajaxSubmit({
            beforeSubmit:function(){
                dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
            },
            success:function(data){
                if(data.status == '1'){
                    dialog.time(2).content("<div class='msg-all-succeed'>"+data.info+"</div>");
                    setTimeout(function(){
                        var backurl = '<?php echo U('Home/ReturnCommission/Index/marketing_ecommerce')?>';
                        art.dialog.opener.location.reload();
                    }, 2000);
                    return false;
                }else{
                    $('#save').removeAttr('disabled');
                    dialog.time(5).content("<div class='msg-all-error'>"+data.info+"</div>");
                }
            },
            dataType:'json'
            });
        });
    });
    
</script>

<script>
    $(document).ready(function(){
        $(".switch").click(function(){
            if($(this).hasClass("disabled")){return false;}
            if($(this).hasClass("hover")){
                $(this).removeClass("hover");
                $(this).find("input[type='radio']").val($(this).find(".value1").attr("data-rel"));
                $(this).find("input[type='text']").val("");
            }else{
                $(this).addClass("hover");
                $(this).find("input[type='radio']").val($(this).find(".value2").attr("data-rel"));
            };
        })
        $(".switch input").click(function(event){
            event.stopPropagation();
        });
        
        $("#return_money_type1").click(function(){
            return_money_type_change();
        });
        $("#return_money_type2").click(function(){
            return_money_type_change();
        });
        function return_money_type_change()
        {
            var money_type=$('input:radio[name="return_money_type"][checked]').val();
            if(money_type==0)
            {
                $('#price0').show();
                $('#price1').hide();
            }
            if(money_type==1)
            {
                $('#price0').hide();
                $('#price1').show();
            }
        }
    });

</script>
</body>
</html>