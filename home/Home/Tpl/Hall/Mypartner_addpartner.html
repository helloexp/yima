<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>卡券分销助手-合作关系绑定</title>
<meta name="Keywords" content="{:C('SITE_KEYWORDS')}" />
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wshop.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/WE_ticket.css?v=__VR__" rel="stylesheet" type="text/css" />
<load href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css" />
<js href="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"/>
<js href="__PUBLIC__/Js/global.js?v=__VR__"/>
<js  href="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default" />
<js href="__PUBLIC_LOCAL__/Js/My97DatePicker/WdatePicker.js?v=__VR__"/>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/ajaxfileupload.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/Mypartner.js?v=__VR__"></script>
<js href="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__" />
<js href="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__" />
</head>
<body>
	<div id="wrapper">
		<include file="./Home/Tpl/Public/Public_header.html" />
<div class="shopNav">
<include file="./Home/Tpl/WangcaiPc/NumGoods_topMenu.html" topmenuid="fxzs"/>
</div>
		<div id="container">
			<div id="main" class="rel">
				<div class="sidenav"> 
					<include file="Hall/Mypartner/leftMenu" leftmenuid="wdfxs"/>
				</div>
				<div class="subcon fn">
                    <div class="main-name fn">
                        <h4>合作关系绑定</h4>
                    </div>
					<div class="eticket-d-sales">
						<div class="f-tip">
							<p style="font-size:15px;">友情提示：</p>
							<p>为保障供采双方利益，建议先完成线下签约后，再进行合作关系绑定。</p>
							<p style="font-size:15px;padding-top:10px;">操作指南：</p>
							<p>Step1 供、采双方成功开通“分销助手”模块功能；</p>
							<p>Step2 联系您的客户经理或旺财客服，提交供、采双方的企业名称、旺号等信息；</p>
							<p>Step3 接到客服通知后，在分销助手模块，选择采购方，进行合作关系绑定；</p>
							<p>Step4 向采购方发货；</p>		
							<p>Step5 查看结算数据，进行资金结算。</p>

						</div>
						<div class="eTicket_form">
							<form action="<?php echo U('Hall/Mypartner/addpartner');?>" method="post" id="thisone">
                                <div class="Gform eTicket">
                                     <ul class="d-sales-label">基础信息设置</ul>
                                      <!-- <ul>
                                        <li class="Gnmae">*&nbsp;采购方类型：</li>
                                        <li class="Ginput">
                                        <div class="switch yff">
                                        	<input type="radio" name="partnerType" value="1" checked="checked" />
                                        	<div class="newRadio">
                                            	<span class="valfirst hover" data-val="1" onclick="javascript:$('#showChange2').hide();$('#showChange1').show();$('#stanull').html('&nbsp;&nbsp;请填写合作协议中明确的合作期限');">旺财用户</span>
                                            	<span class="vallast" data-val="0" onclick="javascript:$('#showChange2').show();$('#showChange1').hide();$('#stanull').html('&nbsp;&nbsp;请填写您希望与该电商平台合作的期限');">第三方电商平台</span>
                                        	</div>
                                    	</div>
                                        </li>
                                    </ul>  -->
                                   <!--  <div id="showChange1"> -->
                                    <ul>
                                        <li class="Gnmae">*&nbsp;采购方名称：</li>
                                        <li class="Ginput">
                                               <select name="voucher_node_id" id="voucher_node_id" class="validate[required] textbox w220 ml5">
                                               	<option value="">--请选择采购方--</option>
                                               	<volist name="saleList" id="vo">
                                               	<option value="{$key}">{$vo}</option>
                                                </volist>
                                               </select>
                                            <span id="falC" style="display:none; color:red; font-size:12px;">×你所选择的商户暂未开通旺财标准版,请联系对方核实开通情况!</span>
                                        </li>
                                    </ul>
                                   <!-- </div> -->
                                   
                                    <!-- <div id="showChange2" style="display:none;">
                                     <ul>
                                        <li class="Gnmae">*&nbsp;平台名称：</li>
                                        <li class="Ginput">
                                               <select class="validate[required] textbox w220">
                                               	<option>请选择</option>
                                               </select>
                                        </li>
                                     </ul>
                                      <span id="stanull">&nbsp;&nbsp;请填写您希望与该电商平台合作的期限</span>
                                   </div> -->
                                       <ul>
                                        <li class="Gnmae">*&nbsp;合作期限：</li>
                                        <li class="Ginput">
                                        <div class="Gtime1 fn l">
                                            <p><input type="text" name="start_time" id="start_time" onClick="WdatePicker({maxDate:'#F{$dp.$D(\\'end_time\\')}',minDate:'<?php echo date('Y-m-d',time());?>'})" value="{$Think.request.start_time}" class="validate[required] textbox w100 ml5" />
                                        	<em></em>
                                        </div> 
                                        <div class="Gtime2 noIcon">   
                                            	<em style="border-left:0">至</em>
                                        </div> 
                                      <div class="Gtime1 fn l">
                                        	<input type="text" name="end_time" id="end_time" onClick="WdatePicker({minDate:'#F{$dp.$D(\\'start_time\\')}'})" value="{$Think.request.end_time}" class="validate[required] textbox w100" />
                                        	<em></em>
                                      </div>
                                      <span id="stanull" class="font-12-cc ml5">&nbsp;&nbsp;&nbsp;&nbsp;请填写合作协议中明确的合作期限</span>
                                       </li>
                                   </ul>
                                   <!-- <ul>
                                        <li class="Gnmae">*&nbsp;分销商旺号：</li>
                                        <li class="Ginput">
                                            <p>
                                                <input type="text" name="client_id" id="client_id" class="validate[required] textbox w220" value="" /> <span class="tipsd red" id="ynnull" style="display:none"></span><span id="clinull">请填写分销商在旺财平台的企业旺号</span>
                                            </p>
                                        </li>
                                    </ul>
                                     <ul>
                                        <li class="Gnmae">*&nbsp;分销商名称：</li>
                                        <li class="Ginput">
                                            <select name="voucher_node_id" id="voucher_node_id" class="validate[required] selectbox w220">
                                           	    <option value="1">-请选择-</option> 
                                    		</select>
                                    		<span id="falC" style="display:none; color:red; font-size:12px;">×对不起你所选择的商户暂未开通旺财标准版,请联系对方核实开通情况!</span>
                                        </li>
                                    </ul>
                                    -->
                                      <ul>
                                        <li class="Gnmae">&nbsp;采购方联系人：</li>
                                        <li class="Ginput">
                                            <p>
                                                <input type="text" name="b_contact_name" id="b_contact_name" class="textbox w220" autocomplete="off"/>
                                                <span class="font-12-cc">&nbsp;&nbsp;&nbsp;&nbsp;平台默认采购方预留信息，可重新编辑</span>
                                            </p>
                                        </li>
                                    </ul>
                                    <ul>
                                        <li class="Gnmae">&nbsp;采购方联系电话：</li>
                                        <li class="Ginput">
                                            <p>
                                                <input type="text" name="b_contact_phone" id="b_contact_phone" class="textbox w220" /> 
                                                <span class="font-12-cc">&nbsp;&nbsp;&nbsp;&nbsp;平台默认采购方预留信息，可重新编辑</span>
                                            </p>
                                        </li>
                                    </ul>
                                     <ul>
                                        <li class="Gnmae">&nbsp;供货方联系人：</li>
                                        <li class="Ginput">
                                            <p>
                                                <input type="text" name="a_contact_name" id="a_contact_name" class="textbox w220" value="{$nodeList['contact_name']}"/>
                                                <span class="font-12-cc">&nbsp;&nbsp;&nbsp;&nbsp;平台默认供货方预留信息，可重新编辑</span>
                                            </p>
                                        </li>
                                    </ul>
                                    <ul>
                                        <li class="Gnmae">&nbsp;供货方联系电话：</li>
                                        <li class="Ginput">
                                            <p>
                                                <input type="text" name="a_contact_phone" id="a_contact_phone" class="textbox w220" value="{$nodeList['contact_phone']}"/>
                                                <span class="font-12-cc">&nbsp;&nbsp;&nbsp;&nbsp;平台默认供货方预留信息，可重新编辑</span>
                                            </p>
                                        </li>
                                    </ul>
                                    <p class="d-sales-label">预付费管控设置<span id="detl-yffgk">（什么是预付费管控？）</span></p>
                                    <ul>
									<li class="Gnmae">*&nbsp;协议结算方式：</li>
									<li class="Ginput">
                                    <div class="switch">
                                        <input type="radio" name="qsfs" value="1" checked="checked" />
                                        <div class="newRadio ml5">
                                            <span class="valfirst hover" data-val="1">按采购方使用量</span>
                                            <span class="vallast" data-val="2">按供货方验证量</span>
                                        </div>
                                        <div class="newRadio-default fn" style="float:none">
                                        	<div class="switch auto">
                                            	<p class="font-12-cc  ml5" style="line-height:26px;">（以采购方发送卡券的数量为依据进行结算）</p>
                                        	</div>
                                        </div>
                                        <div class="newRadio-input" style="float:none">
                                        	<div class="switch auto">
                                            	<p class="font-12-cc" style="line-height:26px;">（以供货方验证卡券的数量为依据进行结算）</p>
                                        	</div>
                                        </div>
                                    </div>
                                    </li>
									</ul>
                                   <!-- <ul>
									<li class="Gnmae">*&nbsp;设置预付费管控：</li>
									 <li class="Ginput">
                                    	<div class="switch yff">
                                        	<input type="radio" name="gkbz" value="1" checked="checked" />
                                        	<div class="newRadio">
                                            	<span class="valfirst hover" data-val="1">是</span>
                                            	<span class="vallast" data-val="0">否</span>
                                        	</div>
                                    	</div>
                                    </li> 
									</ul> -->
                                <div id="gk">
                                     <ul>
                                        <li class="Gnmae">*&nbsp;预付费金额：</li>
                                        <li class="Ginput">
                                            <p>
                                                <input type="text" class="validate[required] textbox w220" name="bail" id="bail" onkeyup="this.value=this.value.replace(/[^\d]/g,'')" autocomplete="off"/><span class="maxTips forInput">元</span>
                                                <span id="tipsname" class="font-12-cc">&nbsp;&nbsp;&nbsp;&nbsp;请按实收金额填写,金额不得低于500元</span>				 
                                            </p>
                                        </li>
                                    </ul>
                                     <!-- 
                                     <ul>
                                        <li class="Gnmae">*&nbsp;最大可分销额度：</li>
                                        <li class="Ginput">
                                            <p>
                                              	<input type="text" class="textbox w220" name="maxamt" id="maxamt" value="" onkeyup="this.value=this.value.replace(/[^\d]/g,'')"/>&nbsp;元 
                                              	<span id="tipsname">填写金额不得低于500元</span>
                                            </p>
                                        </li>
                                    </ul>
                                     -->
                                    <ul>
                                        <li class="Gnmae">*&nbsp;预警额度：</li>
                                        <li class="Ginput">
                                            <p>
                                                <input type="text" class="validate[required] textbox w220" name="warning_amt" id="warning_amt" value="" onkeyup="this.value=this.value.replace(/[^\d]/g,'')" autocomplete="off"/><span class="maxTips forInput">元</span> <span class="tips" id="tipsmoney" style="color:red;display:none" onkeyup="this.value=this.value.replace(/[^\d]/g,'')">*预警金额必须小于最大可分销额度</span>
                                            	<span id="warnull" class="font-12-cc">&nbsp;&nbsp;&nbsp;&nbsp;当已使用额度达到预警金额时，将触发短信预警</span> 
                                            </p>
                                        </li>
                                    </ul>
                                    <ul>
                                        <li class="Gnmae">*&nbsp;供货方预警号码：</li>
                                        <li class="Ginput">
                                            <p>
                                                <input type="text" class="textbox w220" name="myphone" id="myphone" value="{$nodeList['contact_phone']}"/>
                                            	<span id="phone_null" class="font-12-cc">&nbsp;&nbsp;&nbsp;&nbsp;暂不支持多个号码填写</span>
                                            </p>
                                        </li>
                                    </ul>
                                    <ul>
                                        <li class="Gnmae">*&nbsp;采购方预警号码：</li>
                                        <li class="Ginput">
                                            <p>
                                                <input type="text" class="textbox w220" name="custphone" id="custphone" value=""/>
												<input type="hidden" id="sunmit_2" value=""/>
												<span id="cust_null" class="font-12-cc">&nbsp;&nbsp;&nbsp;&nbsp;暂不支持多个号码填写</span>
                                            </p>
                                        </li>
                                    </ul>
                                </div>
                                    <ul class="mb40">
                                        <li class="Gnmae"></li>
                                        <li class="Ginput mt20 ml20">
                                        <input type="hidden" name="mz" value="{$meizu}" />
                                            <a href="javascript:void(0)" title="确认" class="btn-all w110" id="submit_1">确认</a>
                                            <a href="javascript:history.go(-1)" title="取消" class="btn-all-del w110 ml20">取消</a>
                                    </li>
                                </ul>
                                </div>
                            </form>
                            <div class="dn showsaloonmsg mt70 tc">
                    		<p class="font-18-99 pt50">添加成功！</p>
                    		<div class="fn tc mt50">
                        	<a href="{:U('Hall/Mypartner/addpartner')}" class="btn-all w120 btn-ok ml20">继续绑定合作关系</a>
                        	<a href="{:U('Hall/Mypartner/index')}" class="btn-all w120 btn-ok ml20">返回列表</a>
                    		</div>
                		</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<include file="./Home/Tpl/Public/Public_footer.html" /> 
	</div>
	<div class="service"></div>
</body>
</html>
<script>
$(function(){
	var cont=["<h1 style='font-size:16px;color:#aaa;'>什么是预付费管控？</h1>","<p style='font-size:14px;line-height:1.8;text-indent:2em;'>预付费管控是指采购方向供货方预存一笔金额，供货方根据此金额进行风险评估，供货方设置采购方的“最大可分销额度”，当已使用额度达到最大可分销额度时，采购方的交易将被停止，供货方通过清算的方式来调整采购方的已使用额度，借此方式来实现供应方、采购方资金利用率最大化的目的。（已使用额度=应结算金额-已结算金额）</p>","<h1 style='font-size:16px;color:#aaa;'>平台面向供货方及采购方提供两种结算方法：</h1>","<p style='font-size:14px;line-height:1.8;'>1）发码：是指在卡券生成环节进行计算，采购方每发出一张卡券，按照卡券的分销价格（双方协议的结算价）进行应结算金额统计；</p>","<p style='font-size:14px;line-height:1.8;'> 2）验码：是指在卡券核销环节进行计算，采购方销售给消费者的卡券在进行核销时，每核销一笔交易，按照交易金额*折扣率进行可用额度的扣减；</p>","<h1 style='font-size:16px;color:#aaa;'>应结算金额计算公式：</h1>","<p style='font-size:14px;line-height:1.8;'> 1）协议结算方式为“发码”：</br> 应结算金额=卡券张数*卡券分销价格       </br>  2）协议结算方式为“验码”:</br> 应结算金额=交易金额*（分销价格/卡券面值） </p>"].join('');
	$('#detl-yffgk').click(function(){
		art.dialog({
			title:'预付费管控',
			width:600,
			height:350,
			lock:true,
			content:cont,
			cancel:true,
			cancelVal:"取消"
		})
	});
	
  $("#voucher_node_id").blur(function(){
	 var nodeid=$("#voucher_node_id").val();
	 var notqx="对不起你所选择的商户暂未开通旺财标准版,请联系对方核实开通情况!";
	 if(nodeid!=''){
	 $.getJSON("<?php echo U('Hall/Mypartner/ck_type');?>",{node_id:nodeid},function(data){
			if(data==1){
				 art.dialog({
					 title:"提示",
					 icon:'error',
					 content:notqx,
					 width:300,
					 height:100,
					 lock:true,
					 ok:true,
					 okVal:"确定"
				 })
				 $("#falC").html("×你所选择的商户暂未开通旺财标准版,请联系对方核实开通情况!");
				 $("#falC").show();
		 	}else{
				$('#b_contact_name').val(data.contact_name);
				$('#b_contact_phone').val(data.contact_phone);
				$('#custphone').val(data.contact_phone);
		 		$("#falC").hide();
		 	} 
	 })
	 }else{
		 $("#falC").html("采购方名称不能为空");
		 $("#falC").show();
	 }
 }); 
 /* 
 $("#submit_1").click(function(){
	 var start=$("#start_time").val();
	 var end=$("#end_time").val();
	 var client_id=$("#client_id").val();
	 var nodeid=$("#voucher_node_id").val();
	 var maxnum=$("#maxamt").val();
	 var warn=$("#warning_amt").val();
	 if(start=='' || end==''){
		 art.dialog({
			 title:"提示",
			 content:"带*号项为必填项，请核实！",
			 width:300,
			 height:100,
			 lock:true,
			 ok:true,
			 okVal:"确定"
		 })
		 return false;
	 }else{
		 $("#stanull").css("color","#999");
	 }
	 if(client_id==''){
		 $("#clinull").css("color","red");
		 return false;
	 }else{
		 $("#clinull").css("color","#999");
	 }
	 if(nodeid==''){
		 $("#falC").css("color","red");
		 return false;
	 }else{
		 $("#falC").css("color","#999");
	 }
	 var con_flag=$('input[name="gkbz"]:checked').val();
	 if(con_flag==1){
		 if(maxnum=='' || warn==''){
			 art.dialog({
				 title:"提示",
				 content:"带*号项为必填项，请核实！",
				 width:300,
				 height:100,
				 lock:true,
				 ok:true,
				 okVal:"确定"
			 })
			 return false;
		 }
	 }
   if($('#sunmit_2').val() != 1 ){return false};
  $('#thisone').submit();
 });
   */
   
   $("#submit_1").click(function(){
	   var dialog;
       if($("form").validationEngine('validate')){
	   $("#thisone").ajaxSubmit({
		   beforeSubmit:function(){
			 dialog=art.dialog ({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0}); 
		   },
		   success:function(data){
			   if(data.status=='1'){
				   dialog.close();
				   $(".Gform").hide();
				   $(".showsaloonmsg").show();
				   return false;
			   }else{
                   dialog.time(5).content("<div class='msg-all-error'>"+data.info+"</div>");
               }
		   },
		   dataType:'json'
	   });
	   return false;
       }
   });
   
  $('#client_id').blur(function(){
	 var cid=$(this).val();
	 var flasestr="　　对不起，平台未检索到您所填写的企业账号，请核实后重新填写，如商户还未开通旺财，可复制以下链接邀请商户开通。www.wangcaio2o.com";
	 var righttext = "√";
	 var nulltext="*商户旺号必须是小于或等于6位数以下的纯数字！";
	 var _this = $(this).closest("li").find(".tipsd");
	 _this.text('');
		 if(cid>999999){
			 art.dialog({
				 title:"提示",
				 content:nulltext,
				 width:300,
				 height:100,
				 lock:true,
				 ok:true,
				 okVal:"确定"
			 })
		 }else{ 
			 $.get("<?php echo U('Hall/Mypartner/ck_name');?>&cid="+cid,"",function(data){
		    	 if(data!=''){
					/* var html = '';
					for(d in data){
						html += '<option value="'+d+'">'+data[d]+'</option>';
					}  */
					/* if(data.status==1){
						 _this.text(righttext).css({'color':'green','font-size':'18px','font-weight':'bold'}).show();
					} */
					$('#voucher_node_id').html(data);
					 $("#sunmit_2").val('1');
					 _this.text(righttext).css({'color':'green','font-size':'18px','font-weight':'bold'}).show();
				}else{
					art.dialog({
						 title:"提示",
						 content:flasestr,
						 width:300,
						 height:100,
						 lock:true,
						 ok:true,
						 okVal:"确定"
					 }) 
					 $("#client_id").val("");
					 $("#b_contact_name").val("");
					 $("#b_contact_phone").val("");
					 $("#voucher_node_id").empty();
					 $("#sunmit_2").val('2');
				}
		     });	
	 }
 }); 

  /*
 $('#client_id').blur(function(){
	 var cid=$(this).val();
	 var falsetext = "*所选用户版本不支持此功能，请等待对方开通";
	 var righttext = "√";
	 var _this = $(this).closest("li").find(".tipsd");
	 alert('123');
     $.get("<?php echo U('Hall/Mypartner/ck_name');?>&cid="+cid,"",function(data){
    	$.each(data,function(k,v){
    		alert('000');
    		alert(v);
    		alert(k);
    	});
     },'json');	 
 });  */
/*  
 $('#start_time').blur(function(){
	var start=$(this).val();
	if(start==''){
		$("#stanull").show();
	}
 });
 $('#end_time').blur(function(){
	var end=$(this).val();
	if(end==''){
		$("#stanull").show();
	}
 });
  */
 $('#bail').blur(function(){
	 var valmax=$(this).val();
	 if(valmax < 500){
		$("#tipsname").css('color','red');
	 }else{
		$("#tipsname").css('color','#999');
	 }
 });
 $("#myphone").blur(function(){
	 var phoneVal=$("#myphone").val();
	 if(phoneVal==''){
		 $("#phone_null").css("color","red").html("&nbsp;&nbsp;&nbsp;&nbsp;管控时，您的预警手机号必填！");
	 }else{
		 $("#phone_null").css("color","#999").html("&nbsp;&nbsp;&nbsp;&nbsp;暂不支持多个号码填写");
	 } 
 });
 $("#custphone").blur(function(){
	 var custVal=$("#custphone").val();
	 if(custVal==''){
		 $("#cust_null").css("color","red").html("&nbsp;&nbsp;&nbsp;&nbsp;管控时，采购方预警手机号必填！");
	 }else{
		 $("#cust_null").css("color","#999").html("&nbsp;&nbsp;&nbsp;&nbsp;暂不支持多个号码填写");
	 } 
 });
  
 $("#warning_amt").blur(function(){
	 var valmoney=$(this).val();
	 var valmax=$("#bail").val();
	 if(parseInt(valmoney) > parseInt(valmax)){
		 $("#warnull").text("预警金额不得大于预付费金额！");
		 $("#warnull").css("color","red");
	 }else{
		 $("#warnull").text("当已使用额度达到预警金额时，将触发短信预警");
		 $("#warnull").css("color","#999");
	 }
 });
 $('.yff .valfirst').click(function(){
		$('#gk').show();
	})
	$('.yff .vallast').click(function(){
		$('#gk').hide();
	})
})
    function sorn(index){
        switch (index){
            case 1:$("#gk").hide(); 
                break;
            default:$("#gk").show();
        }
    }
/* function goodsCheck(){
    if($("#goods_id").val() == ''){
        return "请选择代金券";
    }
} */
</script>