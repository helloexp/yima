<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>我的分销商_代金券分销助手_翼码旺财</title>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Css/main.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Css/layout.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Css/module.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Css/Wcanal.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Css/Wnumgoods.css"/>
<script src="__PUBLIC__/Js/jquery-1.7.1.min.js"></script>
<js href="__PUBLIC__/Js/global.js"/>
<js href="__PUBLIC__/Js/Wcanal.js"/>
<script src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js"></script>
<load href="__PUBLIC_LOCAL__/Js/My97DatePicker/WdatePicker.js"/>
<style>
	.global-input1 .global-input1-name{width:150px;}
	.global-input1-input span{color:#999;}
</style>
</head>
<body>
    <div id="wrapper" class="bgeee">
        <include file="./Home/Tpl/Public/Public_header.html" />
<div class="shopNav">
<include file="./Home/Tpl/WangcaiPc/NumGoods_topMenu.html" topmenuid="fxzs"/>
</div>
        <div id="container" class="bgfff">
            <div id="main" class="rel">
              <div class="bread">
                    <div class="bread-con fn">
                        <div class="bread-area">
                            <i class="icon-bread"></i>
                            <p><a href="{:U('Home/Index/index')}">首页</a></p>
                            <p>></p>
							<p><a href="index.php?g=Hall&m=Mypartner&a=index">代金券分销助手</a></p>
							<p>></p>
							<p>添加分销商</p>
                        </div>
                        <div class="bread-history">
                            <i class="icon-history"></i>
                            <p><a href="javascript:void(0)" class="ind-bread">返回</a></p>
                        </div>
                    </div>
                </div>
                <div class="sidenav">
                    <!--引入左边栏-->
					<include file="Hall/Mypartner/left" leftmenuid="wdfxs"/>
                </div>
                <div class="subcon fn">
                    <div class="Wcanal-tab">
                        <div class="Wcanal-tab-title fn"> 
                            <h4 class="bd-b-565656 fn">
                                添加分销商
                            </h4>
                            <a href="{:U('Hall/Mypartner/index',array('type'=>0))}" class="db r" style="margin-top:-26px;">返回列表</a>
                        </div>
                        <div class="Wcanal-tab-list" style="border:none;">
                            <form action="<?php echo U('Hall/Mypartner/addpartner');?>" method="post" id="thisone">
                                <div class="global-input1 fn">
                                     <ul class="numgoods-form-title">基础信息设置</ul>
                                    <ul>
                                        <li class="global-input1-name">*&nbsp;分销商旺号：</li>
                                        <li class="global-input1-input">
                                           <p> {$list['client_id']}</p>
                                        </li>
                                    </ul>
                                     <ul>
                                        <li class="global-input1-name">*&nbsp;分销商名称：</li>
                                        <input type="hidden" name="voucher_node_id" value="{$list['relation_node_id']}" />
                                        <li class="global-input1-input">
                                           <p> {$list['node_name']}</p>
                                        </li>
                                    </ul>
                                    <ul>
                                        <li class="global-input1-name">*&nbsp;合作期限：</li>
                                        <li class="global-input1-input">
                                            <p><input type="text" name="start_time" id="start_time" onClick="WdatePicker({maxDate:'#F{$dp.$D(\\'end_time\\')}'})" value="{$list['begin_time']|dateformat=###,'Ymd'}" class="textbox w100" />-<input type="text" name="end_time" id="end_time" onClick="WdatePicker({minDate:'#F{$dp.$D(\\'start_time\\')}'})" value="{$list['end_time']|dateformat=###,'Ymd'}" class="textbox w100" /><span id="stanull">&nbsp;&nbsp;请填写双方协定的有效期限</span></p>
                                        </li>
                                    </ul>
                                      <ul>
                                        <li class="global-input1-name">&nbsp;分销商联系人：</li>
                                        <li class="global-input1-input">
                                            <p>
                                                <input type="text" name="b_contact_name" id="b_contact_name" class="textbox w220" value="{$list['party_b_linkman']}"/>
                                                <span>平台默认分销商预留信息，可重新编辑</span>
                                            </p>
                                        </li>
                                    </ul>
                                    <ul>
                                        <li class="global-input1-name">&nbsp;联系人手机：</li>
                                        <li class="global-input1-input">
                                            <p>
                                                <input type="text" name="b_contact_phone" id="b_contact_phone" class="textbox w220" value="{$list['party_b_linkman_phone']}"/> 
                                                <span>平台默认分销商预留信息，可重新编辑</span>
                                            </p>
                                        </li>
                                    </ul>
                                     <ul>
                                        <li class="global-input1-name">&nbsp;供货方联系人：</li>
                                        <li class="global-input1-input">
                                            <p>
                                                <input type="text" name="a_contact_name" id="a_contact_name" class="textbox w220" value="{$list['party_a_linkman']}"/>
                                                <span>平台默认供货方预留信息，可重新编辑</span>
                                            </p>
                                        </li>
                                    </ul>
                                    <ul>
                                        <li class="global-input1-name">&nbsp;联系人手机：</li>
                                        <li class="global-input1-input">
                                            <p>
                                                <input type="text" name="a_contact_phone" id="a_contact_phone" class="textbox w220" value="{$list['party_a_linkman_phone']}"/>
                                                <span>平台默认供货方预留信息，可重新编辑</span>
                                            </p>
                                        </li>
                                    </ul>
                                    <ul class="numgoods-form-title"> 预付费管控<span title="点击了解预付费管控" id="detl-yffgk" class="ml10" style="font-size:14px;color:#999;cursor:pointer;">点击了解预付费管控</span></ul>
                                     <ul>
                                        <li class="global-input1-name">协议清算方式：</li>
                                        <li class="global-input1-input">
                                            <p>
                                            <?php if($list['control_type']==1){ ?>
                                                <input name="qsfs" type="radio" checked="checked"  value="1"/>&nbsp;&nbsp;发码<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                                <input name="qsfs" type="radio" value="2"/>&nbsp;&nbsp;验码<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                            <?php }else{ ?>
                                            	<input name="qsfs" type="radio" value="1"/>&nbsp;&nbsp;发码<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                                <input name="qsfs" type="radio"  checked="checked" value="2"/>&nbsp;&nbsp;验码<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                            <?php } ?>
                                            </p>
                                        </li>
                                    </ul>
                                     <ul>
                                        <li class="global-input1-name">是否设置管控：</li>
                                        <li class="global-input1-input">
                                        <input type="hidden" id="con_flag" value="{$list['control_flag']}">
                                            <p>
                                            	<?php if($list['control_flag']==1){ ?>
                                                <input name="gkbz" type="radio" onclick="sorn(-1)" checked="checked" value="1"/>&nbsp;&nbsp;是<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                                <input name="gkbz" type="radio" onclick="sorn(1)" value="0"/>&nbsp;&nbsp;否<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                            	<?php }else{ ?>
                                            	<input name="gkbz" type="radio" onclick="sorn(-1)" value="1"/>&nbsp;&nbsp;是<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                                <input name="gkbz" type="radio" onclick="sorn(1)" checked="checked" value="0"/>&nbsp;&nbsp;否<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                            	<?php }?>
                                            </p>
                                        </li>
                                    </ul>
                                <div id="gk">
                                    <ul>
                                        <li class="global-input1-name">实收预付费：</li>
                                        <li class="global-input1-input">
                                            <p>
                                                <input type="text" class="textbox w220" name="bail" id="bail" value="{$list['bail']}" onkeyup="this.value=this.value.replace(/[^\d]/g,'')"/>&nbsp;元
                                                <span>请按实收金额填写</span>
                                            </p>
                                        </li>
                                    </ul>
                                     <ul>
                                        <li class="global-input1-name">*&nbsp;最大可分销额度：</li>
                                        <li class="global-input1-input">
                                            <p>
                                              	<input type="text" class="textbox w220" name="maxamt" id="maxamt" value="{$list['max_amt']}" onkeyup="this.value=this.value.replace(/[^\d]/g,'')"/>&nbsp;元 
                                              	<span id="tipsname">填写金额不得低于500元</span>
                                            </p>
                                        </li>
                                    </ul>
                                    <ul>
                                        <li class="global-input1-name">*&nbsp;设置预警额度：</li>
                                        <li class="global-input1-input">
                                            <p>
                                                <input type="text" class="textbox w220" name="warning_amt" id="warning_amt" value="{$list['warning_amt']}"/>&nbsp;元 <span class="tips" id="tipsmoney" style="color:red;display:none" onkeyup="this.value=this.value.replace(/[^\d]/g,'')">*预警金额必须小于最大可分销额度</span>
                                            	<span id="warnull">当已使用额度达到预警金额时，将触发短信预警</span>
                                            </p>
                                        </li>
                                    </ul>
                                    <ul>
                                        <li class="global-input1-name">我的预警通知号码：</li>
                                        <li class="global-input1-input">
                                            <p>
                                                <input type="text" class="textbox w220" name="myphone" id="myphone" value="{$list['party_a_phone']}"/>
                                            	<span>&nbsp;&nbsp;&nbsp;&nbsp;暂不支持多个号码填写</span>
                                            </p>
                                        </li>
                                    </ul>
                                    <ul>
                                        <li class="global-input1-name">分销商预警通知号码：</li>
                                        <li class="global-input1-input">
                                            <p>
                                                <input type="text" class="textbox w220" name="custphone" id="custphone" value="{$list['party_b_phone']}"/>
												<input type="hidden" id="sunmit_2" value=""/>
												<span>&nbsp;&nbsp;&nbsp;&nbsp;暂不支持多个号码填写</span>
                                            </p>
                                        </li>
                                    </ul>
                                </div>
                                    <ul class="mb40">
                                        <li class="global-input1-name"></li>
                                        <li class="global-input1-input mt40">
                                        <input type="hidden" name="meizu" value="4" />
                                            <a href="javascript:void(0)" title="确认" class="btn-all w110" id="submit_1">确认</a>
                                            <a href="javascript:history.go(-1)" title="取消" class="btn-all-del w110 ml20">取消</a>
                                    </li>
                                 </ul>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
	    <include file="./Home/Tpl/Public/Public_footer.html" />
    </div>
    <div class="service"></div>
   
</body>
<script>
$(function(){
	var control_flog=$("#con_flag").val();
	if(control_flog==0){
		sorn(1);
	}else{
		sorn(-1);
	} 
	
	var cont=["<h1 style='font-size:16px;color:#aaa;'>什么是预付费管控？</h1>","<p style='font-size:14px;line-height:1.8;text-indent:2em;'>预付费管控是指分销商向供货方预存一笔金额，供货方商根据此金额进行风险评估，设定允许分销商可以设置“最大可分销额度”，当已使用额度达到最大可分销额度时，分销商的交易将被停止，供货方通过清算的方式来调整分销商的已使用额度，借此方式来实现供货方、分销商资金利用率最大化的目的。（已使用额度=应清算金额-已清算金额）</p>","<h1 style='font-size:16px;color:#aaa;'>平台面向供货方及分销商提供两种清算方法：</h1>","<p style='font-size:14px;line-height:1.8;'>1）发码：是指在代金券生成环节进行计算，分销商每发出一张代金券，按照代金券的分销价格（双方协议的结算价）进行应结算金额统计；</p>","<p style='font-size:14px;line-height:1.8;'> 2）验码：是指在代金券核销环节进行计算，分销商销售给消费者的代金券在进行核销时，每核销一笔交易，按照交易金额*折扣率进行可用额度的扣减；</p>","<h1 style='font-size:16px;color:#aaa;'>应清算金额计算公式：</h1>","<p style='font-size:14px;line-height:1.8;'> 1）协议清算方式为“发码”：</br> 应清算金额=代金券张数*代金券分销价格       </br>  2）协议清算方式为“验码”:</br> 应清算金额=交易金额*（分销价格/代金券面值） </p>"].join('');
	$('#detl-yffgk').click(function(){
		art.dialog({
			title:'预付费管控',
			width:600,
			height:350,
			lock:true,
			content:cont,
			cancel:true,
			cancelVal:"取消"
		})
	});
	
 $("#voucher_node_id").blur(function(){
	 var nodeid=$("#voucher_node_id").val();
	 var notqx="　　对不起你所选择的商户暂未开通旺财标准版,请联系对方核实开通情况!";
	 $.getJSON("<?php echo U('Hall/Mypartner/ck_type');?>&node_id="+nodeid,"",function(data){
			if(data==1){
				 art.dialog({
					 title:"提示",
					 content:notqx,
					 width:300,
					 height:100,
					 lock:true,
					 ok:true,
					 okVal:"确定"
				 })
				 $("#falC").show();
		 	}else{
				$('#b_contact_name').val(data.contact_name);
				$('#b_contact_phone').val(data.contact_phone);
				$('#custphone').val(data.contact_phone);
		 		$("#falC").hide();
		 	} 
	 })
	 
 });
 $("#submit_1").click(function(){
	 var start=$("#start_time").val();
	 var end=$("#end_time").val();
	 var client_id=$("#client_id").val();
	 var nodeid=$("#voucher_node_id").val();
	 var maxnum=$("#maxamt").val();
	 var warn=$("#warning_amt").val();
	 if(start=='' || end=='' || client_id=='' || nodeid==''){
		 art.dialog({
			 title:"提示",
			 content:"带*号项为必填项，请核实！",
			 width:300,
			 height:100,
			 lock:true,
			 ok:true,
			 okVal:"确定"
		 })
		 return false;
	 }
	 var con_flag=$('input[name="gkbz"]:checked').val();
	 if(con_flag==1){
		 if(maxnum=='' || warn==''){
			 art.dialog({
				 title:"提示",
				 content:"带*号项为必填项，请核实！",
				 width:300,
				 height:100,
				 lock:true,
				 ok:true,
				 okVal:"确定"
			 })
			 return false;
		 }
	 }
  /*  if($('#sunmit_2').val() != 1 ){return false}; */
  $('#thisone').submit();
 });
  
  $('#client_id').blur(function(){
	 var cid=$(this).val();
	 var flasestr="　　对不起，平台未检索到您所填写的企业账号，请核实后重新填写，如商户还未开通旺财，可复制以下链接邀请商户开通。www.wangcaio2o.com";
	 var righttext = "√";
	 var nulltext="*商户旺号不能为空！";
	 var _this = $(this).closest("li").find(".tipsd");
	 _this.text('');
		if(cid==''){
			 art.dialog({
				 title:"提示",
				 content:nulltext,
				 width:300,
				 height:100,
				 lock:true,
				 ok:true,
				 okVal:"确定"
			 })
		 }else{
			 $.get("<?php echo U('Hall/Mypartner/ck_name');?>&cid="+cid,"",function(data){
				 $('#voucher_node_id').html(data);
		    	 if(data != ''){
					/* var html = '';
					for(d in data){
						html += '<option value="'+d+'">'+data[d]+'</option>';
					}  */
					/* if(data.status==1){
						 _this.text(righttext).css({'color':'green','font-size':'18px','font-weight':'bold'}).show();
					} */
					 $("#sunmit_2").val('1');
					 _this.text(righttext).css({'color':'green','font-size':'18px','font-weight':'bold'}).show();
				}else{
					art.dialog({
						 title:"提示",
						 content:flasestr,
						 width:300,
						 height:100,
						 lock:true,
						 ok:true,
						 okVal:"确定"
					 })
					 $("#sunmit_2").val('2');
				}
		     });	
	 }
 }); 

  /*
 $('#client_id').blur(function(){
	 var cid=$(this).val();
	 var falsetext = "*所选用户版本不支持此功能，请等待对方开通";
	 var righttext = "√";
	 var _this = $(this).closest("li").find(".tipsd");
	 alert('123');
     $.get("<?php echo U('Hall/Mypartner/ck_name');?>&cid="+cid,"",function(data){
    	$.each(data,function(k,v){
    		alert('000');
    		alert(v);
    		alert(k);
    	});
     },'json');	 
 });  */
/*  
 $('#start_time').blur(function(){
	var start=$(this).val();
	if(start==''){
		$("#stanull").show();
	}
 });
 $('#end_time').blur(function(){
	var end=$(this).val();
	if(end==''){
		$("#stanull").show();
	}
 });
  */
 $('#maxamt').blur(function(){
	 var valmax=$(this).val();
	 if(valmax < 500){
		$("#tipsname").css('color','red');
	 }else{
		$("#tipsname").css('color','#999');
	 }
 });
 
 $("#warning_amt").blur(function(){
	 var valmoney=$(this).val();
	 var valmax=$("#maxamt").val();
	 if(parseInt(valmoney) >= parseInt(valmax)){
		 $("#warnull").text("预警金额必须小于最大可使用额度！");
		 $("#warnull").css("color","red");
	 }else{
		 $("#warnull").text("当已使用额度达到预警金额时，将触发短信预警");
		 $("#warnull").css("color","#999");
	 }
 });
})

	
    function sorn(index){
        switch (index){
            case 1:$("#gk").hide(); 
                break;
            default:$("#gk").show();
        }
    }
</script>
<!--
<script type="text/javascript" src="js/Service.js"></script>
  -->
</html>