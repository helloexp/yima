<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>卡券验证助手</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="Keywords" content="{:C('SITE_KEYWORDS')}" />
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wcanal.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wnumgoods.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Waccount.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wshop.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wshopconfig.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/WonlineSales.css?v=__VR__" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/Wcanal.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC_LOCAL__/Js/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<script type="text/javascript">
$(document).ready(function(e) {
  $("#search").click(function() {
		$("form").submit();
		});
});
</script>
</head>
<body>
<div id="wrapper">
  <include file="./Home/Tpl/Public/Public_header.html" />
  <div class="shopNav">
  <include file="./Home/Tpl/WangcaiPc/NumGoods_topMenu.html" topmenuid="yzzs"/>
</div>
<div id="container" class="bgfff">
	<div id="main" class="rel">
    	<div class="sidenav">
		<ul id="accordion" class="accordion">
          <li><div class="title">卡券验证助手</div></li>
          <li id="xdxx" class="open2"><div class="link"><a href="{:U('WangcaiPc/TicketHelper/validate')}">验证</a></div></li>
          <li id="wxxx"><div class="link"><a href="{:U('WangcaiPc/TicketHelper/cancel')}">撤销</a></div></li>
        </ul>
        </div>
		<div class="subcon fn">
			<div class="main-name fn">
				<h4>验证</h4>
				<div class="tip_yz">
		               <p>注：卡券验证助手为免费功能，可以对卡券进行线下核销。但并不提供账单记录，多门店管理等功能。如需开通此功能，请
                       <a href="{:U('Home/Store/Wapply_terminal')}" target="_blank">开通付费版EPOS系统</a>。已有账号？<a href="{:C('EPOS_LOGIN_URL').'&posId='.$v['pos_id']}" target="_blank">登录EPOS</a></p>
		        </div>
			</div>
            <div class="cl"></div>
			<div class="Wcanal-tab" id="Wcanal-tabon">
				<div class="Wcanal-tab-validationleft">
                    <div class="leftyz">
                        <div class="leftyz_v1">
                        <form action="{:U('WangcaiPc/TicketHelper/checkCode')}" method="POST" id="theForm">
                        <span>辅助码</span><input type="text" maxlength="16" id="assist_con" name='assist_con' value="">
                        <input type="submit" value='验证' class='sub_yz' >
                        </form>
                        </div>
                        <div class="leftyz_v2">请输入卡券上的16位辅助码</div>
                    </div>
                    <div class='yz_description'>
                        <p>1、验证成功后，该卡券将作废。</p>
                        <p>2、如验证失败，请联系卡券发放方，查询卡券状态。</p>
                    </div>
                </div>
                <div class="Wcanal-tab-validationright">
                   <ul class="yzrt1">
                       <li>商户名称： <span id="szNodeName"></span></li>
                       <li>门店名称：<span id="szStoreName"></span></li>
                       <li>卡券名称：<span id="szTicketName"></span></li>
                       <li>辅助码： <span id="nAssistCode"></span></li>
                   </ul>
                   <ul class="yzrt2">
                       <li>终端号： <span id="nPosId"></span></li>
                       <li>交易日期： <span id="szTransDate"></span></li>
                       <li>交易时间： <span id="szTransTime"></span></li>
                       <li>交易类型： <span id="szTransType"></span></li>
                       <li id="wantmod">交易次数：<span id="nTransNum"></span></li>
                       <li>流水号： <span id="nSeq"></span></li>
                       <li>操作员：<span id="szUserName"></span></li>
                       <li>手机号： <span id="nPhoneNo"></span></li>
                       <li>用户签名：</li>
                   </ul>
                   <ul class="yzrt3">
                       <li>翼码卡券商户服务热线：</li>
                       <li>400-882-7770</li>
                   </ul>
                </div>
			 </div>
         </div>
	 </div>
   </div>
  <include file="./Home/Tpl/Public/Public_footer.html" />
</div>
<div class="service"></div>
<!--交易验证弹窗-->
<div style="display: none;">
	<div class="trade_yz">
       <ul>
          <li class="trade_li1"><span class="trade_sp1">余额</span><span class="trade_num"></span>元</li>
          <li class="trade_li2"><span class="trade_jy">交易金额</span> 
          <input type="text" name='tradeprice' id="pricess" onkeyup='yzprices()'>
          <span class='trade_yuan'>元</span></li>
          <p  class="trade_p"><span style="display:none" id="money_errtip">超出余额，请重新输入</span></p>
          <li class="trade_li3"><a class="Diabtn-all " href="javascript:void(0)" id="sure_price">确认</a>
          <a href="javascript:void(0)" class="Diabtn-all-del" id='annul'>取消</a></li>
       </ul>
    </div>
    <div class="yz_fail"><p id="error_tip" style="width:270px;"></p></div>
</div>

<script type="text/javascript">
$(function(){
	$('.sub_yz').click(function(){
        var dialog;
        $("#theForm").ajaxSubmit({
            beforeSubmit:function(){
                dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
            },
            success:function(data){
                if(data.status == '1'){
                    $("#szNodeName").html(data.msg.node_name);
                    $("#szStoreName").html(data.msg.store_name);
                    $("#szTicketName").html(data.msg.ticket_name);
                    $("#nAssistCode").html('************'+$("input[name=assist_con]").val().substr(12,4));
                    $("#nPosId").html(data.msg.pos_id);
                    $("#szTransDate").html(data.msg.transDate);
                    $("#szTransTime").html(data.msg.transTime);
                    $("#szTransType").html('次数验证');
                    $("#wantmod").html('剩余次数：<span>'+data.msg.remain_times+'</span>');
                    $("#nSeq").html(data.msg.pos_seq);
                    $("#szUserName").html(data.msg.user_name);
                    $("#nPhoneNo").html(data.msg.phone_no);
                    dialog.time(2).content("<div class='msg-all-succeed'>"+data.info+"</div>");
                }else{
                    dialog.close();
                    if(data.err == 1){
                        $(".trade_num").html(data.remain_amt);
                        $('.trade_p  span').css('display','none');
                        art.dialog({
                            title:'交易验证',
                            id:'tradeid',
                            width:'500px',
                            content:'<div class="trade_yz_tc">'+$('.trade_yz').html() +'</div>',
                            lock: true
                        });
                    }else{
                        $("#error_tip").html(data.info);
                        art.dialog({
                            title:'提示',
                            width:'400px',
                            height:'92px',
                            content:'<div class="yz_fail_tc">'+$('.yz_fail').html() +'</div>',
                            lock: true,
                            ok:function(){
                               art.dialog.close();
                               location.reload();
                            },
                        });
                    }
                }
            },
            dataType:'json'
        });
        return false;
	});
		
    $("body").on('click',"#annul",function(){
        art.dialog.list['tradeid'].close();
    });
	   
    $("body").on('click','#sure_price',function(){
        var assist_con = $("#assist_con").val();
        var pricess = $("#pricess").val();
        var remain_amt = $(".trade_num").html();
        if(pricess <= 0){
            $("#money_errtip").html("输入金额有误");
            $("#money_errtip").show();
            return false;
        }
        if(parseInt(pricess)>parseInt(remain_amt)){
            $("#money_errtip").html("超出余额，请重新输入");
            $("#money_errtip").show();
            return false;
        }
        var dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交</div>",fixed: true,padding:0});
        $.ajax({
            type:'POST',
            url:"{:U('WangcaiPc/TicketHelper/checkCode')}",
            data:{assist_con:assist_con,tx_amt:pricess},
            success:function(data){
                if(data.status == 1){
                    art.dialog.list['tradeid'].close();
                    $("#szNodeName").html(data.msg.node_name);
                    $("#szStoreName").html(data.msg.store_name);
                    $("#szTicketName").html(data.msg.ticket_name);
                    $("#nAssistCode").html('************'+$("input[name=assist_con]").val().substr(12,4));
                    $("#nPosId").html(data.msg.pos_id);
                    $("#szTransDate").html(data.msg.transDate);
                    $("#szTransTime").html(data.msg.transTime);
                    $("#szTransType").html('金额验证');
                    $("#wantmod").html('剩余金额：<span>'+data.msg.remain_amt+'</span>');
                    $("#nSeq").html(data.msg.pos_seq);
                    $("#szUserName").html(data.msg.user_name);
                    $("#nPhoneNo").html(data.msg.phone_no);
                    dialog.time(2).content("<div class='msg-all-succeed'>"+data.info+"</div>");
                }else{
                    dialog.time(5).content("<div class='msg-all-error'>"+data.info+"</div>");
                }
            },
            dataType:'json'
        });
        return false;
		//art.dialog.list['tradeid'].content("sfsdfsdfsdf");
	});
		
})
</script>
</body>
</html>
