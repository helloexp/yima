<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>卡券爱拍特供卡券</title>

<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wnumgoods.css?v=__VR__" rel="stylesheet" type="text/css" />
<load href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css" />
<js href="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"/>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<js  href="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default" />
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<js href="__PUBLIC_LOCAL__/Js/My97DatePicker/WdatePicker.js?v=__VR__"/>
<script type="text/javascript" src="__PUBLIC__/Js/ajaxfileupload.js?v=__VR__"></script>
<js href="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__" />
<js href="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__" />
<script>
function create_store(){
	parent.location = "?g=Home&m=Store&a=index";
}
function changedata(){
	ai_end_date = $("#ai_end_date").val();
	end_time1 = ai_end_date.substr(0,4);
	end_time2 = ai_end_date.substr(4,2);
	end_time3 = ai_end_date.substr(6,2);
	end_times = end_time1+"-"+end_time2+"-"+end_time3;
	$("#Amsg-date").text(end_times);
}
$(function(){
$("#batch_des").keyup(function(){
	batch_des = $("#batch_des").val();
	$("#Amsg-con").text(batch_des);
});

$("#node_phone").keyup(function(){
	node_phone = $("#node_phone").val();
	$("#Amsg-tel").text(node_phone);
});
    $("#smb").click(function(){
        var dialog;
        if($("form").validationEngine('validate')){
            $("form").ajaxSubmit({
                beforeSubmit:function(){
                    dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
                },
                success:function(data){
                     if(data.status == '1'){
                           dialog.time(2).content("<div class='msg-all-succeed'>"+data.info+"</div>");
                           setTimeout("parent.window.location.reload();art.dialog.close();",4000);
                           return false;
                      }else{
                            dialog.time(3).content("<div class='msg-all-error'>"+data.info+"</div>");
                              }
                      },
                dataType:'json'
            });
        }

    });
    $("input[name='type']").change(function(){
        var selectaddnum=$(this).val();
            if(selectaddnum==0){
                $("#select-addnum2").css("display","none");
                $("#select-addnum1").css("display","block");
                $("#select-addnum3").css("display","none");
                $("#Wform").css("display","block");
                $("#Aform").css("display","none");
            }else if(selectaddnum==1){
                $("#select-addnum1").css("display","none");
                $("#select-addnum2").css("display","block");
                $("#select-addnum3").css("display","none");
                $("#Wform").css("display","block");
                $("#Aform").css("display","none");
            }else if(selectaddnum==2){
                $("#select-addnum1").css("display","none");
                $("#select-addnum2").css("display","none");
                $("#select-addnum3").css("display","none");
                $("#Wform").css("display","block");
                $("#Aform").css("display","none");
            }else if(selectaddnum==3){
                $("#select-addnum1").css("display","none");
                $("#select-addnum2").css("display","none");
                $("#select-addnum3").css("display","block");
                $("#Wform").css("display","block");
                $("#Aform").css("display","none");
            }else{
                $("#Wform").css("display","none");
                $("#Aform").css("display","block");
                $("#select-addnum3").css("display","none");
            }
    });
    $(".icon-del").click(function(){
        $(this).closest(".numgoodsList-item").detach();
    });
    $("#choose-shop").click(function(){
            art.dialog.open("选择门店.html",{
                title: '选择门店',
                okVal: '选择',
                cancel:true,
                width:'400px',
                height:'70%'
            });
    });
    $(".message-show").click(function(){
        var message=$("#using_rules").val();
        var html=
        ['<div class="aipai-iphone">',
          '<div class="aipai-iphone-text">',
              message,
          '</div>',
          '</div>'].join('');
          art.dialog({
            padding: 20,
            title: '短信预览',
            content: html,
            lock: true
        });
    });
    $("#verify_begin_date").click(function(){
        $("input[name='verify_begin_type'][value='0']").attr("checked",true);
    });
    $("#verify_begin_days").click(function(){
        $("input[name='verify_begin_type'][value='1']").attr("checked",true);
    });
    $("#verify_end_date").click(function(){
        $("input[name='verify_end_type'][value='0']").attr("checked",true);
    });
    $("#verify_end_days").click(function(){
        $("input[name='verify_end_type'][value='1']").attr("checked",true);
    });
    $("input[name='discount']").click(function(){
        $("input[name='prt_type'][value='1']").attr("checked",true);
    });
    $("input[name='prt_price']").click(function(){
        $("input[name='prt_type'][value='2']").attr("checked",true);
    });
    $("input[name='shop']").change(function(){
        if($(this).val()==1){
            $("#chooseShop").css("display","none");
        }else{
            $("#chooseShop").css("display","block");
        }
    });
    $("input[name='shop2']").click(function(){
        if($(this).val()==1){
            $("#chooseShop2").css("display","none");
        }else{
            $("#chooseShop2").css("display","block");
        }
    });
    $(':radio[name="shop2"][checked]').click();
    
})
function checkImg(){
    if($("#resp_img").val() == '')
        {
            return "请上传营销图片";
        }
}
//文件上传
function ajaxFileUpload(imgid,hiddenid,showid,url){
var dialog = art.dialog({title:false,fixed: true,padding:0});
$.ajaxFileUpload({
    url:url,
    secureuri:false,
    fileElementId:imgid,
    dataType: 'json',
    data:{name:'logan', id:'id'},
    success: function (data, status){
        if(typeof(data.error) != 'undefined'){
            if(data.error != ''){
                dialog.time(3).content("<div class='msg-all-error'>"+data.error+"</div>");
            }else{

                var resp = data.msg;
                if(resp != '0000'){
                    dialog.time(3).content("<div class='msg-all-error'>上传失败！</div>");
                    return false;
                }else{
                    dialog.time(3).content("<div class='msg-all-succeed'>上传成功！</div>");
                }
                $('#'+hiddenid).val(data.imgurl);
            }
        }
    },
    error: function (data, status, e){
        dialog.time(3).content("<div class='msg-all-error'>"+e+"</div>");
    }
})

return false;
}
</script>
</head>
<body class="bgfff">
<div style="width:800px; padding-left:30px;">

                    <div class="main-name fn">
                        <h4 class="bd-b-565656">编辑卡券</h4>
                    </div>
                    
                    
                    <div class="numgoods-info">
                        <li>按照模板字段填写卡券内容，“<span>*</span>”为必填字段</li>
                    </div>
                    
                    <div class="global-input6 fn">
                        <form method="post" action="<?php echo U('NumGoods/aiPaiEdit');?>">
                            <ul class="numgoods-form-title">卡券基本内容</ul>
                            <!--爱拍卡券表单-->
                            <input type="hidden" value="5" name="type" />
                            <div id="Aform">
                            <input type="hidden" value="{$info['batch_no']}" name="batch_no">
                            <ul>
                                <li class="global-input6-name">*&nbsp;卡券名称：</li>
                                <li class="global-input6-input"><input name="ai_name" id="ai_name" type="text" onkeyup="check_lenght(20,'ai_name_msg',this);" value="{$info['batch_short_name']}" class="validate[required,maxSize[20]] textbox w380"/><br /><p id="ai_name_msg" class="font-12-cc">最多可以输入20个字</p></li>
                            </ul>
                            <!-- <ul>
                                <li class="global-input6-name">*&nbsp;卡券是否验证：</li>
                                <li class="global-input6-input"><input name="is_verify" value="0" <?php if($info['verify_type']=='0'){?> checked="checked" <?php }?> type="radio"/><p class="ml5 mr20">需验证</p><input name="is_verify" <?php if($info['verify_type']=='1'){?> checked="checked" <?php }?> value="1" type="radio"/><p class="ml5">无需验证</p></li>
                            </ul> -->
                            <ul>
                                <li class="global-input6-name">*&nbsp;金额：</li>
                                <li class="global-input6-input"><input name="ai_price" value="{:substr($info['batch_amt'],0,-3)}"  type="text"  class="validate[custom[integer],min[0],required] textbox w240"/></li>
                            </ul>
                            <ul>
                                <li class="global-input6-name">*&nbsp;卡券描述：</li>
                                <li class="global-input6-input"><textarea name="batch_des" id= "batch_des" class="validate[required,maxSize[25]] texttextarea w380" onkeyup="check_lenght(25,'ai_desc',this);">{$info['use_rule']}</textarea><br /><p class="font-12-cc">用于显示在下发短信中，限25字以内，<span id="ai_desc">还可以输入25个字</span></p></li>
                            </ul>
                            <ul>
                                <li class="global-input6-name">&nbsp;备注：</li>
                                <li class="global-input6-input"><textarea name="prize_desc_info" class="validate[maxSize[200]] texttextarea w380" onkeyup="check_lenght(200,'ai_desc_info',this);">{$info['join_rule']}</textarea><br /><p class="font-12-cc">用于显示在Wap卡券详情页面中，限200字以内，<span id="ai_desc_info">还可以输入200个字</span></p></li>
                            </ul>
                            <ul>
                                <li class="global-input6-name">*&nbsp;有效期：</li>
                                <li class="global-input6-input"><input name="ai_begin_date" id="ai_begin_date" onClick="WdatePicker({maxDate:'#F{$dp.$D(\\'ai_end_date\\')}'})" value="{:substr($info['begin_time'],0,8)}" type="text" class="validate[required] textbox w172"/><span class="mlr5">至</span><input name="ai_end_date" id="ai_end_date" value="{:substr($info['end_time'],0,8)}" onClick="WdatePicker({minDate:'#F{$dp.$D(\\'ai_begin_date\\')}'})" type="text" class="validate[required] textbox w172" onchange="changedata()"/></li>
                            </ul>
                            <ul>
                                <li class="global-input6-name">&nbsp;营销图片：</li>
                                <li class="global-input6-input">
                                    <input id="img_show"  type="text" value="请上传图片"  id="" class="textbox w160 l"/>
                                    <div class="rel l">
                                    <input type="file"  style="left:-172px;" name="goods_image" id="goods_image" onchange="$('#img_show').val($(this).val());return ajaxFileUpload('goods_image','resp_img','','{:U('WangcaiPc/NumGoods/uplodImg')}');" class="upload_file"/>
                                    <a href="javascript:void(0);" title="浏览" class="btn-all w60 ml10">浏览</a>
                                    <input type="hidden" value="" name="resp_img" id="resp_img"/>
                                    </div>
                                <img src="__AIPAI__/{$info['batch_img']}"/>
								<br /><p class="font-12-cc">请上传1M以内的gif,jpg,jpeg,bmp,png图片</p>
                                </li>
                            </ul>
                            <ul class="numgoods-form-title">选择卡券可验证门店</ul>
                            <ul>
                                <li class="global-input6-name">&nbsp;卡券可验证门店：</li>
                                <li class="global-input6-input">
                                    <input name="shop2" id="shop2" value="1" disabled="disabled" <if condition="$info.node_pos_type eq 1">checked="checked"</if> type="radio" />
                                    <p class="ml5 mr20">所有子门店可用</p>
                                    <input name="shop2" id="shop2" value="2" disabled="disabled" <if condition="$info.node_pos_type eq 2">checked="checked"</if> type="radio" />
                                    <p class="ml5 mr20">自己选择可用门店</p>
                                    <div id="chooseShop2" class="fn dn">
                                    <div class="numgoodsList mt10" id="shop_content2">
                                    <volist name="prize_area_relation" id="vo">
                                    	<div class="numgoodsList-item">{$vo.store_short_name}</div>
                                    	</volist>
                                    </div>
                                    </div>
                                </li>
                            </ul>
                            <ul class="numgoods-form-title">卡券发送到用户手机短彩信预览</ul>
                            <ul>
                                <li class="global-input6-name">*&nbsp;彩信标题：</li>
                                <li class="global-input6-input"><p>二维码里有奖品</p></li>
                            </ul>
                            <ul>
                                <li class="global-input6-name">*&nbsp;彩信内容：</li>
                                <li class="global-input6-input"><p>亲，恭喜您参与上海翼码“爱拍赢大奖”活动并中奖！奖品由商家：<span class="font-14-ed" id="Amsg-name">{$userInfo['node_name']}</span>提供，奖品为：<span class="font-14-ed" id="Amsg-con">{$info['use_rule']}</span>。可在<span class="font-14-ed" id="Amsg-date">{:date_str($info['end_time'])}</span>前领取奖品。奖品的解释权归商家，奖品提供商家的服务热线<span class="font-14-ed" id="Amsg-tel"><?php if($info['service_hotline']!=''){echo $info['service_hotline'];}else{echo $node_info['node_service_hotline']; }?></span>。</p>
                                <span class="font-12-cc">红色字段为商户在卡券基本内容中填写的信息，如有错误，请返回更改。</span>
                                </li>
                            </ul>
                            </div>
                            <!--爱拍卡券表单-->
                            
                            
                            <ul>
                                <li class="global-input6-name"></li>
                                <li class="global-input6-input"><a href="javascript:void(0);" title="确认" id="smb" class="btn-all w110">提交</a></li>
                            </ul>
                        </form>
                    </div>
                    </div>
</body>
<!--
<script type="text/javascript" src="js/Service.js"></script>
  -->
</html>