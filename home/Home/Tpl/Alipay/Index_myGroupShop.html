<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>我的团购商品_翼码旺财</title>
    <link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/Wcanal.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/Wnumgoods.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/Wshop.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/Wshopconfig.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Css/Walipay.css?v=__VR__" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.8.2.min.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC_LOCAL__/Js/My97DatePicker/WdatePicker.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/ajaxfileupload.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__"></script>
    <script type="text/javascript" src="__PUBLIC__/Js/jquery-ui-1.11.2.custom/template.js?v=__VR__"></script>
</head>
<body>
<div id="wrapper">
    <include file="./Home/Tpl/Public/Public_header.html" />
    <div class="shopNav">
        <include file="./Home/Tpl/Alipay/Alipay_public_header.html" topmenuid="alipay"/>
    </div>
    <div id="container">
        <div id="main" class="rel bgfff">
            <div class="sidenav">
                <include file="./Home/Tpl/Alipay/Index_left_menuNew.html" leftmenuid="myGroupShop"/>
            </div>
            <div class="subcon fn">
                <div class="main-name fn">
                    <h4>我的团购商品</h4>
                </div>

                <div class="tipNormal mb15">
                    <dl>
                        <dd>1、绑定糯米账户需填入您在糯米平台登录邮箱；美团及点评账户暂只支持非餐饮类的商户；</dd>
                        <dd>2、您可以在旺财自行设定团购商品的商品名称、市场价及结算价；设置后，便于您在团购收单台进行查账/对账使用；</dd>
                        <dd>3、美团/点评账户暂只支持非餐饮类的商户；淘宝及掌上生活的在线开通 即将上线</dd>
                    </dl>
                </div>

                <table cellpadding="0" cellspacing="0" class="W-table">
                    <tr>
                        <th nowrap="nowrap" width="300">团购平台</th>
                        <th nowrap="nowrap">绑定状态</th>
                        <th nowrap="nowrap">商品数</th>
                        <th nowrap="nowrap" width="300">操作</th>
                    </tr>
                    <volist name="info" id="vo">
                    <tr>
                        <td>{$vo.code_type}</td>
                        <td>{$vo.status}</td>
                        <td>{$vo.count}</td>
                        <td>
                            <!--type: 1是绑定 0是解绑
                            terrace: 1是百度糯米 0是美团点评-->
                        <if condition="$vo['type'] eq 1">
                            <if condition="$vo['terrace'] eq 1">
                                <a href="javascript:void(0);" data-terrace={$vo.terrace} data-type={$vo.type} class="jsBind" onclick="Bind({$vo.terrace},this,1)">{$vo.handle}</a>
                            <else />
                                <a href="javascript:void(0);" data-terrace={$vo.terrace} data-type={$vo.type} class="jsBind" onclick="Bind({$vo.terrace},this,1)">{$vo.handle}</a>
                            </if>
                        <else />
                            <a href="javascript:void(0);" data-terrace={$vo.terrace} data-type={$vo.type} class="jsunBind" onclick="Bind({$vo.terrace},this,0)">{$vo.handle}</a>
                            <a href="javascript:void(0);"  data-terrace={$vo.terrace} class="jsManagePro" onclick="ManagePro({$vo.terrace})">{$vo.shop}</a>
                        </if>
                        </td>
                    </tr>
                    </volist>
                    <tr>
                        <td>淘宝</td>
                        <td>未绑定</td>
                        <td>/</td>
                        <td>即将支持</td>
                    </tr>
                    <tr>
                        <td>掌上生活</td>
                        <td>未绑定</td>
                        <td>/</td>
                        <td>即将支持</td>
                    </tr>
                    <empty name="info">
                        <tr>
                            <td colspan="4">
                                <div class="nonedata"></div>
                            </td>
                        </tr>
                    </empty>

                </table>
                <div class="page">{$page}</div>

            </div>
        </div>
    </div>
</div>
<include file="./Home/Tpl/Public/Public_footer.html" />
</div>
<div class="service"></div>
</body>


</html>
<script>
function Bind(type, obj,terrace) {
	var t=$(obj);
    var terrace=t.attr("data-terrace");
    var type=t.attr("data-type");
    if(type == 1){ //绑定
        var EditData = {type:type,terrace:terrace}
        if(terrace == 1){
            var content = template("BindNomi",EditData);
            art.dialog({
                title:"绑定团购",
                content:content,
                width:500,
                ok:function(){
                    if($("#theform").validationEngine('validate')){
                        $.post("{:U('Alipay/Index/Binding')}", $('form').serialize(), function(data) {
                            //return false;
                            if (data == 1) {
                                Diasucceed("绑定成功");
                                setTimeout(function(){
                                    location.href = "{:U('Index/myGroupShop')}";
                                }, 1000);
                            } else {
                                Diasucceed("绑定失败");
                            }
                        }, 'json');
                    }else{
                        return false;
                    }
                },
                okVal:"确定",
                cancel:true,
                cancelVal:"取消"
            });
        }else{
            art.dialog.open("{:U('Alipay/Index/myGroupConfig')}",{
                title:"绑定团购",
                width:500
            });
        }
        
	}
	if(type == 0){ //解除绑定
        if(terrace==0){
        	terraceName = "美团点评"
        }else if(terrace==1){
        	terraceName = "百度糯米"
        }
        var EditData = {type:type,terrace:terrace,terraceName:terraceName};
        var content = template("Unbind",EditData);
        art.dialog({
            title:"解除绑定",
            content:content,
            width:400,
            ok:function(){
                    $.post("{:U('Alipay/Index/Binding')}", $('form').serialize(), function(data) {
                        //return false;
                        if (data == 1) {
                            Diasucceed("解除成功");
                            setTimeout(function(){
                                location.href = "{:U('Index/myGroupShop')}";
                            }, 1000);
                        } else {
                            Diasucceed("解除失败");
                        }
                    }, 'json');
            },
            okVal:"解除绑定",
            cancel:true,
            cancelVal:"取消"
        });
	}
}

function ManagePro(terrace) {
    $.ajax({
        type: "POST",
        dataType:"json",
        url: "{:U('Alipay/Index/returnShopInfo')}",
        data:{'terrace':terrace},
        success: function(result) {
            //return false;
            var EditData = {terrace:terrace};
            var content = template("ProManage",result);
            art.dialog({
                id:"ProList",
                title:"管理商品",
                content:content,
                width:800
            });
        }
    });
}

function ProDel(id,obj){
	var t=$(obj);
	var id=t.attr("data-id");
    art.dialog.confirm('你确定要删除吗？', 
        function () {
            $.ajax({
                type: "POST",
                dataType:"json",
                url: "{:U('Alipay/Index/myGroupShopDelete')}",
                data:{'id':id},
                success: function(result) {
                    //return false;
                    Diasucceed(resp.info);
                }
            } );
            t.closest("tr").remove();
        }, 
        function () {
            art.dialog.close();
    	});
}

function ProEdit(id,obj){
	var t=$(obj);
	var id=t.attr("data-id");
    var dataName = t.attr("data-name");
    var dataPrice = t.attr("data-price");
    var datasettlePrice = t.attr("data-settlePrice");
    var EditData = {id:id,dataName:dataName,dataPrice:dataPrice,datasettlePrice:datasettlePrice};
	var content = template("edit",EditData);
	art.dialog({
		title:"编辑团购商品",
		content:content,
		width:400,
		ok:function(){
			var dialog;
			if($("#theform").validationEngine('validate')){
				$("#theform").ajaxSubmit({
					beforeSubmit:function(){
						dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
					},
					success:function(data){
						if(data == '1'){
							Diasucceed("团购信息修改成功");
							setTimeout(function(){
								top.location.href = top.location.href;
							}, 1500);
							return false;
						}else{
							dialog.time(3).content("<div class='msg-all-error'>"+data+"</div>");
						}
					},
					dataType:'json'
				});
			}	
		},
		okVal:"确定",
		cancel:true,
		cancelVal:"取消"
	})
    art.dialog.list['ProList'].close();
}
</script>
<script type="text/html" id="BindNomi">
<form id="theform" action="" method="post">
<input type="hidden" name="terrace" id="terrace" value={{terrace}} />
<input type="hidden" name="type" id="type" value={{type}} />
<div class="Gform" style="margin-left:-60px">
    <ul>
        <li class="Gname">登陆邮箱</li>
        <li class="Ginput"><input type="text" name="email" id="email" class="validate[required,custom[email]]" value="">
        <span class="txtTips">请输入您在百度糯米平台的登陆邮箱，输入后即可受理糯米卡券。</li>
    </ul>

</div>
</form>
</script>

<script type="text/html" id="Tuangou3">
<form id="theform" action="" method="post">
<input type="hidden" name="terrace" id="terrace" value={{terrace}} />
<input type="hidden" name="type" id="type" value={{type}} />
<div class="DiatipsCon">
餐饮行业客户，需将旺财平台的门店信息与团购平台的门店信息对应后，上传至团购平台
</div>
<div class="mt30 mb30">
<input type="checkbox" checked> <a href="javascript:void(0);">我已下载模板，并填写完团购平台门店信息，上传至团购平台</a>
</div>
</form>
</script>
<script type="text/html" id="Unbind">
    <form id="theform" action="" method="post">
        <input type="hidden" name="terrace" id="terrace" value={{terrace}} />
        <input type="hidden" name="type" id="type" value={{type}} />
        <div class='loadStatus tip'>
            <dl>
                <dt>请确认是否解除旺财与{{terraceName}}的绑定？</dt>
                <dd>解除后，终端将不可验证{{terraceName}}卡券。</dd>
            </dl>
        </div>
    </form>
</script>

<script type="text/html" id="ProManage">
<table cellpadding="0" cellspacing="0" class="W-table">
<tbody><tr>
    <th nowrap="nowrap" width="200">商品名称</th>
    <th nowrap="nowrap" width="100">商品ID</th>
    <th nowrap="nowrap" width="200">有效期</th>
    <th nowrap="nowrap" width="100">市场价格</th>
    <th nowrap="nowrap" width="100">结算价格</th>
    <th nowrap="nowrap" width="100">操作</th>
</tr>
{{each list as value i}}
<tr>
<td>{{value.goods_name}}</td>
<td>{{value.goods_id}}</td>
<td>{{value.end_time}}</td>
<td>{{value.goods_price}}</td>
<td>{{value.settle_price}}</td>
<td><a href="javascript:void(0);" data-id="{{value.id}}" data-name="{{value.goods_name}}" data-price="{{value.goods_price}}" data-settlePrice="{{value.settle_price}}" class="js_edit p110 pr10" onclick="ProEdit({{value.id}},this)">编辑</a>
</tr>
{{/each}}
</tbody>
</table>           
</script>

<script type="text/html" id="edit">
<form id="theform" action="{:U('Alipay/Index/myGroupShopEdit')}" method="post">
<input type="hidden" name="id" id="id" value={{id}} />
<div class="Gform w1">
	<ul>
		<li class="Gname">商品名称</li>
		<li class="Ginput"><input type="text" name="goods_name" class="" value={{dataName}}></li>
	</ul>
    <ul>
        <li class="Gname">商品市场价</li>
        <li class="Ginput"><input type="text" name="goods_price_orig" class="validate[custom[number]]" value={{dataPrice}}></li>
    </ul>
	<ul>
		<li class="Gname">商品销售价</li>
		<li class="Ginput"><input type="text" name="goods_price" class="validate[custom[number]]" value={{dataPrice}}></li>
	</ul>
	<ul>
		<li class="Gname">商品结算价</li>
		<li class="Ginput"><input type="text" name="settle_price" class="validate[custom[number]]" value={{datasettlePrice}}></li>
	</ul>
</div>
</form>
</script>