<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>分销管理_旺分销</title>
<meta name="Keywords" content="{:C('SITE_KEYWORDS')}" />
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wcanal.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wnumgoods.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Waccount.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wshop.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wfx.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css?v=__VR__" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.cookie.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/Wcanal.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/dtree/dtree.js"></script>
<script type="text/javascript" src="__PUBLIC__/Js/Wproduct.js?v=__VR__"></script>
<style>
.sidenav { height:70% !important;}
</style>
<script>

$(function(){
    // 判断是否首次加载页面，如果是首次，清除cookie
    if("{$firstload}" == '1'){
        $.cookie('toggle','');
    }
    if($.cookie('toggle') == 'saler'){
        $("#p1").removeClass("Wcanal-tab-hover");
        $("#p2").addClass("Wcanal-tab-hover");
        $("#salerB").attr('style','display: block;');
        $("#agencyA").attr('style','display: none;');
    }

	$(".js_addfx").click(function(e) {
		art.dialog.open("{:U('Wfx/Fxgl/add')}",{
            id:"Fxgladd",
			title:"新增经销商/销售员",
			width:"600px",
			height:"700px",
			lock:true
		});
    });
	
	$(".agency_edit").click(function(e) {
        var id = $(this).parent().attr("agencyid");
		art.dialog.open("{:U('Wfx/Fxgl/edit')}"+"&role=2&id="+id,{
            id:"Fxgleditagency",
			title:"编辑经销商",
			width:"600px",
			height:"650px",
			lock:true
		});
    });
    $(".agency_reedit").click(function(e) {
        var id = $(this).parent().attr("agencyid");
        art.dialog.open("{:U('Wfx/Fxgl/edit')}"+"&role=2&id="+id+"&flag=1",{
            id:"Fxgleditagency",
            title:"编辑经销商",
            width:"600px",
            height:"650px",
            lock:true
        });
    });
    $(".saler_edit").click(function(e) {
        var id = $(this).parent().attr("salerid");
        art.dialog.open("{:U('Wfx/Fxgl/edit')}"+"&role=1&id="+id,{
            id:"Fxgleditsaler",
            title:"编辑销售员",
            width:"600px",
            height:"530px",
			lock:true
        });
    });
    $(".saler_reedit").click(function(e) {
        var id = $(this).parent().attr("salerid");
        art.dialog.open("{:U('Wfx/Fxgl/edit')}"+"&role=1&id="+id+"&flag=1",{
            id:"Fxgleditsaler",
            title:"编辑销售员",
            width:"600px",
            height:"530px",
            lock:true
        });
    });
	
	$(".js_import").click(function(e) {
		art.dialog.open("index.php?g=Wfx&m=Fxgl&a=download",{
			title:"导入/导出",
			width:"600px",
			height:"420px",
			lock:true
		});
    });

	$(".viewdetail").click(function(e) {
        var roleid = $(this).attr("roleid");
        var strArr = new Array();
        strArr     = roleid.split("-");
        var role   = strArr[0];
        var id     = strArr[1];
        $.cookie('v_toggle','detail');
		art.dialog.open("{:U('Wfx/Fxgl/viewDetails')}"+"&role="+role+"&id="+id,{
            id:"viewDetails",
			title:"查看详情",
			width:"800px",
			height:"550px",
			lock:true
		});
    });

    $(".viewfxyj").click(function(e) {
        var roleid = $(this).attr("roleid");
        var strArr = new Array();
        strArr     = roleid.split("-");
        var role   = strArr[0];
        var id     = strArr[1];
        $.cookie('v_toggle','vxyj');
        art.dialog.open("{:U('Wfx/Fxgl/viewDetails')}"+"&role="+role+"&id="+id,{
            id:"viewDetailss",
            title:"查看详情",
            width:"800px",
            height:"550px",
            lock:true
        });
    });

    $(".reEdit").click(function(e) {
        var roleid = $(this).attr("roleid");
        var strArr = new Array();
        strArr     = roleid.split("-");
        var role   = strArr[0];
        var id     = strArr[1];
        $.cookie('v_toggle','vxyj');
        art.dialog.open("{:U('Wfx/Fxgl/edit')}"+"&role="+role+"&id="+id,{
            id:"viewDetailss",
            title:"查看详情",
            width:"800px",
            height:"550px",
            lock:true
        });
    });
	
    $(".agency_js_move").click(function(e) {
        var id = $(this).parent().attr("agencyid");
        art.dialog.open("{:U('Wfx/Fxgl/move')}"+"&id="+id+"&role=2",{
            id:"agencymove",
            title:"转移经销商到其他经销商下",
            width:"500px",
            height:"230px",
            lock:true
        });
    });
	$(".saler_js_move").click(function(e) {
        var id = $(this).parent().attr("salerid");
		art.dialog.open("{:U('Wfx/Fxgl/move')}"+"&id="+id+"&role=1",{
            id:"saler_move",
			title:"转移销售员到其他经销商下",
			width:"500px",
			height:"230px",
			lock:true
		});
    });
	$(".agency_js_start").click(function(e) {
        var id = $(this).parent().attr("agencyid");
        art.dialog.open("{:U('Wfx/Fxgl/start')}"+'&id='+id+'&role=2',{
            id:"agency_start",
            title:"启用",
            width:"500px",
            height:"240px",
            lock:true
        });
    });
	$(".saler_js_start").click(function(e) {
        var id = $(this).parent().attr("salerid");
		art.dialog.open("{:U('Wfx/Fxgl/start')}"+'&id='+id+'&role=1',{
            id:"saler_start",
			title:"启用",
			width:"500px",
			height:"240px",
			lock:true
		});
    });
	$(".agency_js_stop").click(function(e) {
        var id = $(this).parent().attr("agencyid");
        art.dialog.open("{:U('Wfx/Fxgl/stop')}"+'&id='+id+'&role=2',{
            id:"agency_stop",
            title:"停用",
            width:"500px",
            height:"400px",
            lock:true
        });
    });
	$(".saler_js_stop").click(function(e) {
        var id = $(this).parent().attr("salerid");
		art.dialog.open("{:U('Wfx/Fxgl/stop')}"+'&id='+id+'&role=1',{
            id:"saler_stop",
			title:"停用",
			width:"500px",
			height:"400px",
			lock:true
		});
    });

	
    $(".checkAgencyStatus").click(function(e){
        var id = $(this).parent().attr("agencyid");
        art.dialog.open("{:U('Wfx/Fxgl/checkStatus')}&role=2&id="+id,{
            id:"agency_check",
            title:"审核经销商",
            width:"600px",
            height:"200px",
            lock:true
        });
    });
    $(".checkSalerStatus").click(function(e){
        var id = $(this).parent().attr("salerid");
        art.dialog.open("{:U('Wfx/Fxgl/checkStatus')}&role=1&id="+id,{
            id:"saler_check",
            title:"审核销售员",
            width:"600px",
            height:"300px",
            lock:true
        });
    });
    $("#agency_sub_button").click(function(){
        $("#agency_form").submit();
    });
    $("#saler_sub_button").click(function(){
        $("#saler_form").submit();
    });

	$(".js_check").click(function(){
        art.dialog.open("{:U('Wfx/Fxgl/checkAllStatus')}",{
            id:"all_check",
            title:"批量审核",
            width:"600px",
            height:"250px",
            lock:true
        });
    });
})
    function saler(){
        $.cookie('toggle','saler');
    }
    function agency(){
        $.cookie('toggle','agency');
    }
    function treeTrans(id){
        if(id == '0'){
            window.location.href="{:U('Wfx/Fxgl/index')}";
        }else{
            window.location.href="{:U('Wfx/Fxgl/index')}&id="+id;
        }
        
    }
    function stopSaler(stoptype,id){
        var url = "{:U('Wfx/Fxgl/stopsaler')}&stop="+stoptype+"&id="+id;
        $("#tempform").attr('action',url).ajaxSubmit({
            beforeSubmit:function(){
                dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
            },
            success:function(data){
                if(data.status == '1'){
                    dialog.time(1).content("<div class='msg-all-succeed'>"+data.info+"</div>");
                    window.location.reload(-1);
                    return false;
                }else{
                    dialog.time(2).content("<div class='msg-all-error'>"+data.info+"</div>");
                }
            },
            dataType:'json',
        });
    }
    $(function(){
        productIntroduce(10,"wfx","{:U('Wfx/Index/index')}");}
    );


</script>
<style type="text/css">
.noInfo{ background:#f5f5f5; display:block; font-size:14px; line-height:24px; color:#666666; padding:20px 25px;}
.exclamation{ width:22px; height:22px; background:url(__PUBLIC__/Image/Wfx/exclamation.png) no-repeat; display:inline-block; vertical-align:middle; margin-right:5px;}
.grade{ background:#f15755; font-size:10px; color:#FFF; font-style:normal; padding:0 5px; line-height:16px; border-radius:2px; position:relative; margin-right:5px; font-weight:100}
.grade:after{top: 4px;right: -7px;border: solid transparent;content: " ";height: 0;width: 0;position: absolute;pointer-events: none;border-color: rgba(255, 255, 255, 0);border-left-color: #f15755;border-width: 4px;margin-left: -4px;}
.viewdetail{color:#3D86BA;}
.viewdetail:hover{cursor:pointer;color:#F15755;}
</style>

</head>
<body>
    <div id="wrapper">
    	<include file="./Home/Tpl/Public/Public_header.html" />  
        <!--开始引入头部菜单-->                   
        <div class="shopNav">
        <include file="./Home/Tpl/Wfx/topMenu.html" topmenuid="wfxindex"/> 
        </div>
        <div id="container" class="bgfff" style="margin-top:10px;">
            <div id="main" class="rel">
                
                <div class="sidenav" style="margin-top:0">
                <if condition="!empty($salerLevelInfo)">
					<script> 
                    $(function(){

                        a = new dTree('a');  
                        a.add(0,-1,'<span style="display:inline-block;margin-bottom:-9px;line-height:36px;text-overflow:ellipsis;overflow:hidden;width:160px;">{$tree_node_name}</span>',"javascript:treeTrans(0)");
                        <volist name="salerLevelInfo" id="vo">
                            a.add({$vo.id},{$vo.parent_id},'<span data-placement="right" title="{$vo.name}(ID:{$vo.id})">{$vo.name}</span>',"javascript:treeTrans({$vo['id']})");
                        </volist>
                        var html = a.toString();
                        $(".sidenav").append(html);
                        if($(".sidenav").length>=1){
                            window.windowheight = function(){
                                var windowheight=$(window).height()-140;
                                $("#main").height("auto");
                                $(".subcon").height("auto");
                                var leftMenuheiht=$(".dtree").height()+30;
                                    $(".sidenav").height(leftMenuheiht)
                                if($(".subcon").height()<leftMenuheiht){
                                    $(".subcon").height(leftMenuheiht);
                                }
                                if($("#main").height()<windowheight){
                                    $("#main").height(windowheight); 
                                }else{
                                    $("#main").height("auto"); 
                                }
                            }
                            windowheight();
                        }
                    })
                    </script>
                <else />
                    <div class="noInfo">
                        <p><i class="exclamation"></i>您暂无经销商信息</p>
                        <p class="tc">请先<a href="javascript:void(0)" class="js_addfx">录入经销商</a></p>
                    </div>
                </if>
                </div>
                <div class="subcon fn">
                	<div class="main-name fn">
                    <h4>{$node_name}<a class="btn-add first js_addfx" href="javascript:void(0)"><i></i>经销商/销售员</a><a href="javascript:void(0)" class="btn-import js_import">导入/导出</a><a href="javascript:void(0)" class="btn-export js_check">批量审核</a></h4>
                </div>
                <div class="additionalTip">
                	<span>共有经销商 {$agencyCount} 个 ，销售员 {$salerCount} 个。(已审核)</span>
                </div>
                <div class="Wcanal-tab" id="Wcanal-tabon">
                	
					<div class="Wcanal-tab-title fn">
                        <p id="p1" class="Wcanal-tab-hover" onclick="agency()"><a href="javascript:void(0);">经销商</a></p>
                        <p id="p2" class="" onclick="saler();"><a href="javascript:void(0);">销售员</a></p>
                    </div>
					<div class="Wcanal-tab-list" id ="agencyA">
                    	<div class="cl pt20"></div>
                        <div class="SearchArea fn">
                            <form id="agency_form" action="{:U('Wfx/Fxgl/index',array('pa'=>1))}" method="post">
                                <input type="hidden" name="postFrom" value="agency" />
                                <div class="SearchAreaLeft">
                                    <label>
                                    <span>经销商名称</span><input type="text" name="agency_name" id="agency_name" value="{$agency_name}">
                                    </label>
                                    <label><span>状态</span><select name="agency_status">
                                        <option value="">全部</option>
                                        <option <eq name="agency_status" value="3">selected="selected"</eq> value="3">正常</option>
                                        <option <eq name="agency_status" value="1">selected="selected"</eq> value="1">审核中</option>
                                        <option <eq name="agency_status" value="2">selected="selected"</eq> value="2">未通过</option>
                                    </select>
                                    </label>
                                    <label>
                                    <span>手机号码</span><input type="text" name="agency_phone_no" id="agency_phone_no" value="{$agency_phone_no}"></label>
                                    </div>
                                    <div class="SearchAreaRight">
                                        <a href="javascript:void(0);" class="searchBtn" id="agency_sub_button">查询</a>
                                    </div>
                            </form>
                        </div>
                        <div class="shopCon">
                            <table cellpadding="0" cellspacing="0" class="shopTable">
                                    <tbody>
                                    <tr class="th">
                                        <th width="22%" class="first">经销商名称</th>
                                        <th width="12%">手机号码</th>
                                        <th width="17%">上级经销商</th>
                                        <th width="13%">直管销售员</th>
                                        <th width="12%">创建时间</th>
                                        <th width="10%">状态</th>
                                        <th width="14%">操作</th>
                                    </tr>
                                    <if condition="!empty($agencyList)">
                                    <volist name="agencyList" id="alist">
                                    <tr>
                                        <td class="viewdetail" roleid="2-{$alist.id}" style="text-align: left;" title="{$alist.name}(ID:{$alist.id})"><span style="display:block;word-break:break-all;">{$alist.show_name}</span></td>
                                        <td>{$alist.phone_no}</td>
                                        <td>{$alist.parent_name}</td>
                                        <td>{$alist.sonsaler_amt}</td>
                                        <td>{$alist.add_user_name}<br />{$alist.add_time|strtotime|date="Y-m-d",###}</td>
                                        <td>{$alist.status}</td>
                                        <td agencyid="{$alist.id}">
                                        <if condition="$alist['status'] eq '未通过审核'">
                                            <a href="javascript:void(0)" class="db agency_reedit">修改并重新审核</a>
                                        <elseif condition="$alist['status'] eq '停用'"/>
                                            <a href="javascript:void(0)" class="agency_js_start">启用</a>
                                        <elseif condition="$alist['status'] eq '审核中'"/>
                                            <a href="javascript:void(0)" class="checkAgencyStatus">审核</a>
                                        <else/>
                                            <a href="javascript:void(0)" class="agency_edit">修改</a>
                                            <a href="javascript:void(0)" class="agency_js_move">转移</a>
                                            <a href="javascript:void(0)" class="agency_js_stop">停用</a><br/>
                                            <a href="javascript:void(0)" roleid="2-{$alist.id}" class="viewfxyj">查看分销业绩</a>
                                        </if>
                                        </td>
                                    </tr>
                                    </volist>
                                    <else />
                                    <tr>
                                        <td colspan="7"><div class="nonedata"></div></td>
                                    </tr>
                                    </if>
                                </table>
                                <div class="page">{$pageA}</div>
                        </div>
                    </div>

                    <div class="Wcanal-tab-list dn" id="salerB" style="display: none;">
                    	<div class="cl pt20"></div>
                        <div class="SearchArea fn">
                        <form id="saler_form" action="{:U('Wfx/Fxgl/index',array('ps'=>1))}" method="post">
                            <input type="hidden" name="postFrom" value="saler" />
                            <div class="SearchAreaLeft">
                            <label><span>销售员名称</span><input type="text" name="saler_name" id="saler_name" value="{$saler_name}"></label>
                            <label><span>状态</span><select name="saler_status" >
                                    <option value="">全部</option>
                                    <option <eq name="saler_status" value="3">selected="selected"</eq> value="3">正常</option>
                                    <option <eq name="saler_status" value="4">selected="selected"</eq> value="4">停用</option>
                                    <option <eq name="saler_status" value="1">selected="selected"</eq> value="1">审核中</option>
                                    <option <eq name="saler_status" value="2">selected="selected"</eq> value="2">未通过</option>
                                </select>
                                </label>
                            <label><span>手机号码</span><input type="text" name="saler_phone_no" id="saler_phone_no" value="{$saler_phone_no}"></label>
                            </div>
                            <div class="SearchAreaRight">
                            <a href="javascript:void(0);" class="searchBtn" id="saler_sub_button">查询</a>
                            </div>
                        </form>
                        </div>
                        <form id="tempform" action="" method="get">
                        </form>
                        <div class="shopCon">
                            <table cellpadding="0" cellspacing="0" class="shopTable">
                                    <tbody><tr class="th">
                                        <th class="first" width="22%">销售员名称</th>
                                        <th width="12%">手机号码</th>
                                        <th width="17%">销售编号</th>
                                        <th width="13%">所属经销商</th>
                                        <th width="12%">创建时间</th>
                                        <th width="10%">状态</th>
                                        <th width="14%">操作</th>
                                    </tr>
                                    <if condition="!empty($salerList)">
                                    <volist name="salerList" id="slist">
                                    <tr>
                                        <td class="viewdetail" roleid="1-{$slist.id}">{$slist.name}</td>
                                        <td>{$slist.phone_no}</td>
                                        <td>{$slist.custom_no}</td>
                                        <td>{$slist.parent_agency}</td>
                                        <td>{$slist.add_user_name}<br />{$slist.add_time|strtotime|date="Y-m-d",###}</td>
                                        <td>{$slist.status}</td>
                                        <td salerid="{$slist.id}" tcinfo="{$slist.custom_no}-{$slist.default_sale_percent}">
                                        <if condition="$slist['status'] eq '未通过审核'">
                                            <a href="javascript:void(0)" class="db saler_reedit">修改并重新审核</a>
                                        <elseif condition="$slist['status'] eq '停用'"/>
                                            <a href="javascript:void(0)" class="saler_js_start">启用</a>
                                        <elseif condition="$slist['status'] eq '审核中'"/>
                                            <a href="javascript:void(0)" class="checkSalerStatus">审核</a>
                                        <else/>
                                            <a href="javascript:void(0)" class="saler_edit">修改</a><a href="javascript:void(0)" class="saler_js_move">转移</a><a href="javascript:void(0)" class="saler_js_stop">停用</a><br/>
                                            <a href="javascript:void(0)" roleid="1-{$slist.id}" class="viewfxyj">查看分销业绩</a>
                                        </if>
                                        </td>
                                    </tr>
                                    </volist>
                                    <else />
                                    <tr>
                                        <td colspan="7"><div class="nonedata"></div></td>
                                    </tr>
                                    </if>
                                </table>
                                <div class="page">{$pageS}</div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="service"></div>
    <include file="./Home/Tpl/Public/Public_footer.html" />
</body>
</html>