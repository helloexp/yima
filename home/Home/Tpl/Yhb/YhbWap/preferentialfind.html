<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>找优惠</title>
<meta name="viewport" content="width=320, maximum-scale=1, user-scalable=no">
<meta content="O2O,O2O营销,二维码,旺财,市场调研" name="Keywords">
<meta content="telephone=no" name="format-detection" />
<meta content="email=no" name="format-detection" />
<meta name="apple-touch-fullscreen" content="NO">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Label/Css/wap_yhb.css?v=__VR__">
<script type="text/javascript" src="__PUBLIC__/Label/Js/jquery-2.1.1.min.js?v=__VR__"></script>
	<script src="__PUBLIC__/Label/Js/jquery.lazyload.min.js?v=__VR__" type="text/javascript"></script>
	<style type="text/css">
		#header { position: fixed; top: 0; left: 0; z-index: 102;}
		.mainTop { width: 100%; background: #ffffff; position: fixed; top: 45px; left: 0; z-index: 102;}
		#mainCon .item:first-child { border-top: 0;}
		#mainCon { background: #ffffff; padding-top: 125px;}
		.choose ul li.fn { border-right: 0;}
		.choose ul li .county a.all { width: auto; color: #333333; position: relative; border-bottom: 1px #e5e5e5 solid;}
		/*.choose ul li .county a.all.active { color: #ed3f41; font-weight: bold;}*/
		.choose ul li .county .all.active i { border-width: 2px 0 0 2px; margin-bottom: -8px;}
		.choose ul li .county .third {  background: #eee;}
		.choose ul li .county .third a {/* width: 50%;*/padding-left: 10px; text-indent: 15px;background: #eee; margin-left: 0;}
		.choose ul li .all i { right: 15px;}
		.choose ul li#sequence { border-right: 0;}
		.choose ul li.sequence .item { display: block;}
		.choose ul li.sequence { background: none;}
		.choose ul li.sequence .county { background: #ffffff; margin-left: 0; width: 100%; box-shadow: -1px 0 1px rgba(0,0,0,0.1); right: -1px; top: 0px;}
		.choose ul li.sequence .item a { margin: 0; text-align: left; text-indent: 20px;}
		.choose ul li.sequence:before { display: none;}
	</style>
</head>
<body>
<div id="wrapper">
    <div id="container">
        <div id="header" class="userCenter fn">
        	<div class=""></div>
            <div class="logo"><!--<i>惠</i>--><span>找优惠</span></div>
        </div>
        <div id="main">
           <div class="mainTop">
                <div class="search">
                	<div class="searchForm">
                    	<!--<div class="searchTitle">搜索</div>-->
                    	<form action="{:U('')}" id="theform" method="get">
							<input type="hidden" name="g" value="Yhb">
							<input type="hidden" name="m" value="YhbWap">
							<input type="hidden" name="a" value="preferentialfind">
							<input type="hidden" name="area_code" id="area_code" value="{$area_code}">
							<input type="hidden" name="area_val" id="area_val" value="{$area_val}">
							<input type="hidden" name="cate_code" id="cate_code" value="{$cate_code}">
							<input type="hidden" name="cate_val" id="cate_val" value="{$cate_val}">
							<input type="hidden" name="sort_by" id="sort_by" value="{$sort_by}">
                        <a href="javascript:void(0)" class="btn-search"><i></i></a>
						<input type="search" name="keyword"  id="keyword" class="search-input" value="" onfocus="this.placeholder=''" placeholder="<?php if($keyword){echo $keyword;}else{ ?>翼惠宝相关的优惠<?php } ?>" />
                        </form>
                        <input type="hidden" name="town_code" id="town_code" value="{$town_code}">
						<input type="hidden" name="city_code" id="city_code" value="{$city_code}">
                    </div>
                </div>
                <div class="choose">
                	<ul>
                		<li id="city"><p>{$area_val}</p><i></i></li>
                		<li class="fn">
		                	<ul class="city_box">
		                		<li value="" class="sa">全部商区</li>
		                		<li class='001' value='001'>黄埔区</li>
		                		<li class='002' value='002'>卢湾区</li>
		                		<li class='003' value='003'>徐汇区</li>
		                		<li class='004' value='004'>长宁区</li>
		                		<li class='005' value='005'>静安区</li>
		                		<li class='006' value='006'>普陀区</li>
		                		<li class='007' value='007'>闸北区</li>
		                		<li class='008' value='008'>川沙区</li>
		                		<li class='009' value='009'>上海县</li>
		                		<li class='010' value='010'>闵行区</li>
		                		<li class='011' value='011'>嘉定区</li>
		                		<li class='012' value='012'>浦东新区</li>
		                		<li class='013' value='013'>金山区</li>
		                		<li class='014' value='014'>松江区</li>
		                		<li class='015' value='015'>青浦区</li>
		                		<li class='016' value='016'>南汇区</li>
		                		<li class='017' value='017'>奉贤区</li>
		                		<li class='018' value='018'>崇明区</li>
		                		<li class='019' value='019'>杨浦区</li>
		                		<li class='020' value='020'>宝山区</li>
		                		<li class='021' value='021'>虹口区</li>
		                	</ul>
		                	<ul class="county" id="sq_list">
		                	</ul>
	                	</li>
	                	<li id="classify"><p>{$cate_val}</p><i></i></li>
	                	<li class="fn ca">
		                	
	                	</li>
	                	<li id="sequence"><p>{$sort_val}</p><i></i></li>
	                	<li class="fn sequence">
		                	<ul class="county">
		                		<li class="item">
		                			<a href="javascript:;" id='zn' class="all" data-value="0">智能排序</a>
			                		<a href="javascript:;" id='zx' data-value="1">最新更新</a>
									<a href="javascript:;" id='rm' data-value="2">热门优惠</a>
		                		</li>
		                	</ul>
		                	<!-- <select class="select_order" style="display: none;">
                                {$show_opt}
                            </select> -->
	                	</li>
                    </ul>
                </div>                                                                           
            </div>
            <div id="mainCon">
                <div id="masonry">
                    <include file="pre_list"/>
                    <!--循环-->
        </div>
        <div class="get-more" data-url="{$nextUrl}"><i></i><a href="javascript:;">往上拉查看更多</a></div>
    </div>
</div>
</div>
<section style="display: none;" class="fullHtml loadingBox" id="loadingBox"><i></i><span></span></section>

</body>
<script type="text/javascript">
	_street_list = {};
	_in_ajax = false;
	$(document).ready(function() {
		$("img.lazy").lazyload();
		$("img.lazy").show().lazyload();
		$("img.lazy").lazyload({ threshold : 200 });
		$(function() {
			$("img:below-the-fold").lazyload({
				event : "sporty"
			});
		});
		$("img.lazy").lazyload({
			effect : "fadeIn"
		});
		var loadhtml = '<div id="infscr-loading" style="text-align: center; display:none;"><img src="__PUBLIC__/Label/Image/Item/loading.gif"><div><em>加载中...</em></div></div>';
		$("#masonry").append(loadhtml);
		$("body").append("<div id='masonry2' style='display:none;'></div>");
		$(window).scroll(function () {
			setTimeout(function(){
				if ($(document).scrollTop() + $(window).height() >= $(document).height()) {
					if(_in_ajax) return ;
					_in_ajax = true;
					if($("masonry2").hasClass("erro")){return false;}
					$("masonry2").addClass("erro");
					var url = $('.get-more').attr("data-url");
					$("#infscr-loading").show();
					$('#masonry2').load(url + ' ' + ".box", null, function(data,status){
						var l = $("#masonry2 .box").length;
						if (l == 0) {
							$("#infscr-loading em").text("没有更多数据了");
							$("#infscr-loading img").hide();
							setTimeout(function(){
								$("#infscr-loading").hide();
							},2000);
							$('.get-more').hide();
						}else{
							$('#masonry').append($('#masonry2').html());
							$("#infscr-loading").fadeOut(500);
						}
						var newpath = newPath(url);
						$(".get-more").attr("data-url",newpath);
						$("masonry2").removeClass("erro");

						_in_ajax = false;
					});
				};
			},500);
		});

//城市选择tab切换

		var wrapperWdith = $("#wrapper").width();
		$(".third").hide();
		$("#city").on("click",function(){
			$("#city").next("li.fn").width(wrapperWdith);
			$("#city").next("li.fn").toggle();
			$("#classify,#sequence").next("li.fn").hide();
			var town_code = $('#town_code').val();
			var area_code = $('#area_code').val();
			var flag_town = $('.'+ town_code +'');
			$(".city_box").find(flag_town).addClass("active");
		 	$.post("{:U('Yhb/YhbWap/sq_info')}",{"town_code":town_code ,"area_code":area_code},function(data){
				_street_list[town_code] = data
				$('#sq_list').html(_street_list[town_code])
				$(".item").show();
		 	}, 'html');
			$(this).find("i,p").toggleClass("active");
			$("#classify,#sequence").find("i,p").removeClass("active");
			$("body").css("position","fixed");
		});

		$("#city").next("li.fn").on("click",".city_box li",function(){
			$("#city").next("li.fn").find(".city_box li").removeClass('active');
			$(this).addClass("active");
			var town_code = $(this).attr('value');
			$("#town_code").val(town_code);
			if(_street_list[town_code] != undefined){
				 $('#sq_list').html(_street_list[town_code]);
				$(".item").show();
			 }else{
			 	$.post("{:U('Yhb/YhbWap/sq_info')}",{"town_code":town_code},function(data){
					_street_list[town_code] = data

					$('#sq_list').html(_street_list[town_code])
					$(".item").show();
			 	}, 'html');
			 }
		});
		$("#city").next("li.fn").on("click",".county .all",function(){
			$(".item").show();
			$('.third').hide();
			$("#sq_list").find(".all").removeClass('active');
			$(this).toggleClass("active");
			$(this).next(".third").toggle();

		});

		$('.choose').on('click', '.sa', function(){
			$('#area_code').val($(this).data('code'));
			var text = $(this).text();
			$("#area_val").val(text);
			$('#theform').submit();
			$("body").css("position","relative");
		});
		$("#city").next("li.fn").find(".county .third a").click(function(){
			var text = $(this).text();
			$("#city p").text(text);
			$("li.fn").hide();
			$("#city").next("li.fn").find(".county .third a").removeClass("active");
			$(this).addClass("active");
			$("#city").find("i,p").removeClass("active");
			$("body").css("position","relative");
		});
		
		//分类选择tab切换
		var wrapperWdith = $("#wrapper").width();
		$("#classify").on("click",function(){
			var cate_code = $('#cate_code').val();
			if(_street_list['all'] != undefined){
					$('.ca').html(_street_list['all'])
				}else{
					$.post("{:U('Yhb/YhbWap/cata_info')}",{"cate_code":cate_code},function(data){
					_street_list['all'] = data
					$('.ca').html(_street_list['all'])
				 	}, 'html');
				}
			$("#classify").next("li.fn").width(wrapperWdith);
			$("#classify").next("li.fn").toggle();
			$("#city,#sequence").next("li.fn").hide();
			$(this).find("i,p").toggleClass("active");
			$("#city,#sequence").find("i,p").removeClass("active");
			$("body").css("position","fixed");
		});

		$("#classify").next("li.fn").on("click", '.city_box li',function(){
			$("#classify").next("li.fn").find(".county .item").hide();
			var key = $(this).data('code');
			$("#classify").next("li.fn").find(".city_box li").removeClass('active');
			$(this).addClass("active");
			$(".county #cc_"+ key +"").show();
		});

		$('.choose').on('click', '.sc', function(){
			$('#cate_code').val($(this).data('code'));
			var text = $(this).text();
			$("#cate_val").val(text);
			$('#theform').submit();
			$("body").css("position","relative");
		});

		$("#classify").next("li.fn").find(".county a").click(function(){
			var text = $(this).text();
			$("#classify p").text(text);
			$("li.fn").hide();
			$(this).find("i").removeClass("active");
			$("#classify").find("i,p").removeClass("active");
			$("body").css("position","relative");
		});

		//排序选择tab切换
		var wrapperWdith = $("#wrapper").width();
		$("#sequence").on("click",function(){
			$("#sequence").next("li.fn").width(wrapperWdith);
			$("#sequence").next("li.fn").toggle();
			$("#city,#classify").next("li.fn").hide();
			$(this).find("i,p").addClass("active");
			$("#city,#classify").find("i,p").removeClass("active");
			$("body").css("position","fixed");
		});
		$("#sequence").next("li.fn").on("click",".county a",function(){
			var text = $(this).data('value');
			$("#sort_by").val(text);
			var text = $(this).text();
			var dataVal = $(this).attr("data-value");
			$(".sequence").find("select").val(dataVal);
			$("#sequence p").text(text);
			$("li.fn").hide();
			$(this).find("i").removeClass("active");
			$("#sequence").find("i,p").removeClass("active");
			$('#theform').submit();
			$("body").css("position","relative");
		});
	});

	function newPath(path){
		path = path.split("p=");
		var p = path[1]*1+1;
		newpath = path[0]+"p="+p;
		return newpath;
	};
</script>
</html>