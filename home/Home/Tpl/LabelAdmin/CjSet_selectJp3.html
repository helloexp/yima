<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>抽奖_营销活动_翼码旺财</title>
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wprize.css?v=__VR__" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC_LOCAL__/Js/My97DatePicker/WdatePicker.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<load href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css" />
<js href="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__" />
<js href="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__" />

<script>
	var isopencusMsg = "{$startUp}"; //1：设置了短信内容自定义 0：未设置自定义
	var _hbtpybx_flag = <?php echo $hbtpybx_flag ? 'true' : 'false';?>;
	var sendPrice = {:json_encode($sendPrice)};
	//var goods_type = "{$jp_arr['goods_type']}";
	var isWx = "{$isWx}";            // 0 -不是微信卡券    、 1 -是微信卡券
//选择卡券
$(function(){
	Gform();
	// $(".showSendtype").hide();
	// $("#phone").hide();
	$("#form4").validationEngine({binded:true});
	var isedit = $('#cj_batch_id').val();
	var card_id = '{$jp_arr['card_id']}';
	var subHref = "{:U('Common/SelectJp/jpAdd')}";
	if(card_id != ''){
		$('.source').hide();
	}
	var batch_type = '{$jp_arr['batch_type']}';
    if(batch_type =='6'){
        $('.source').hide();
    }
	var batch_class = '{$jp_arr['batch_class']}';
	if(batch_class == '12' || batch_class == '7'){
		$('.source').hide();
	}
	
	if(isedit!=''){
		sourceV = "{$jp_arr['source']}";
		if(sourceV == '2'){
			$(".source input").attr("disabled","disabled");
 			$(".source textarea").attr("disabled","disabled");
		}
		subHref = "{:U('Common/SelectJp/jpEdit')}";
		var verify_begin_type = "{$jp_arr['verify_begin_type']}";
		if(verify_begin_type == '1'){
			$('#date_type_1').trigger('click');
		}
		var Editjp_type = "{$jp_arr['card_id']}";
		var goodType = "{$jp_arr['goods_type']}";
		var goods_name_a = $('#goods_name_a').text();
		if(isopencusMsg==1){
			if(batch_type == 0 && Editjp_type=='' && goods_name_a != ''){
				$(".showSendtype").show();
				$(".typemsg").addClass("hover").removeClass("dn");
				$(".typewxcard").removeClass("hover").addClass("dn");
				$("#tipStr").show();
				$('.imvBox-show').show();
				$("#phone").show();
				$(".nocusMsg").hide();
			 	$(".cusMsg").show();
			}else if(batch_type == 0 && Editjp_type!='')
			{
				$(".showSendtype").show();
				$(".cusMsg").hide();
				$(".typewxcard").addClass("hover").removeClass("dn");
				$(".typemsg").removeClass("hover").addClass("dn");
				$("#tipStr").hide();
				$("#phone").hide();
				$(".usgexplain").hide();
				$("#tipStr").hide();
			}else
			{
				$(".showSendtype").hide();
				$("#phone").hide();
			}
		}

		if(isopencusMsg!=1){
			if(batch_type == 0 && Editjp_type=='' && goods_name_a != ''){
				$(".showSendtype").show();
				$(".typemsg").addClass("hover").removeClass("dn");
				$(".typewxcard").removeClass("hover").addClass("dn");
				$("#tipStr").show();
				$('.imvBox-show').show();
				$("#phone").show();
				$(".nocusMsg").show();
				$(".cusMsg").hide();
			}else if(batch_type == 0 && Editjp_type!='' )
			{
				$(".showSendtype").show();
				$(".cusMsg").hide();
				$(".typewxcard").addClass("hover").removeClass("dn");
				$(".typemsg").removeClass("hover").addClass("dn");
				$("#tipStr").hide();
				$("#phone").hide();
				$(".usgexplain").hide();
				$("#tipStr").hide();
			}else
			{
				$(".showSendtype").hide();
				$("#phone").hide();
			}
		}
		if(goodType == 8){
			$(".showSendtype").hide();
			$(".showSendtype.usgexplain").show();
			$("#phone").show();
			$('#mms_text').attr("readonly","readonly");
		}
		if (goodType == 14 || goodType == 7) {
			$(".showSendtype").hide();
			$("#phone").hide();
			$(".cusMsg").hide();
		}
		if (goodType == 12) {
			$(".showSendtype").hide();
			$("#phone").hide();
		}
		if (goodType == 15) {
			$(".showSendtype").hide();
			$("#phone").hide();
			$('.source').hide();
			$(".cusMsg").hide();
		}
		$("#mms_text").focus(function(){
			if(goodType==7 || goodType==8){
				$("#phone").hide();
				$(".prizeConfig_usage").addClass("dn");
			}else{
				$("#phone").hide();
				$(".prizeConfig_usage").removeClass("dn");
			}
		})
		
		$("#mms_text").blur(function(){
			if(goodType==7 || goodType==8){
				$("#phone").hide();
			}else{
				$(".prizeConfig_usage").addClass("dn");
				$("#phone").show();
			}
		})
		
		$("#shortMsg_config").focus(function(){
			if(goodType==7 || goodType==8){
				$("#phone").hide();
				$(".prizeConfig_usage").addClass("dn");
			}else{
				$(".prizeConfig_usage").removeClass("dn");
				$("#phone").show();
			}
		})

		$("#shortMsg_config").blur(function(){
			if(goodType==7 || goodType==8){
				$("#phone").hide();
			}else{
				$(".prizeConfig_usage").addClass("dn");
				$("#phone").show();
			}
		})


	}
	
	//添加奖项
	 $("#prizetype").on("click",".Gform .switch .newRadio span",function(){
		 $(this).attr("data-val")==0 ? $("#newprizetype").show() : $("#newprizetype").hide();
	 });
	 //选择抽奖
	    $('#bind_cj').click(function(){
            var  name = "&callback=selectJpcallback&batch_id={$batch_id}&show_source=0,1,3,4&show_type=0,1,2,3,7,8,11,15";
    	    art.dialog.open("{:U('Common/SelectJp/index')}"+name,{
    	    	id: 'closeJp',
    	    	width: 800,
    	    	title:'选择卡券'
    	    })
        });
		$('#bind_fixbonus').click(function(){
	        var  name = '&callback=selectJpcallback&batch_id={$batch_id}&show_type=12&show_source=0';
    	    art.dialog.open("{:U('Common/SelectJp/index')}"+name,{
    	    	id: 'closeJp',
    	    	width: 800,
    	    	title:'选择定额红包'
    	    })
        });
        $('#bind_weChatbonus').click(function(){
	        var  name = '&callback=selectJpcallback&batch_id={$batch_id}&show_type=0&show_source=6';
    	    art.dialog.open("{:U('Common/SelectJp/index')}"+name,{
    	    	id: 'closeJp',
    	    	width: 800,
    	    	title:'选择微信红包'
    	    })
        });
        //奖品设置
        $('#btn4').click(function(){
        	if($("#form4").validationEngine('validate')){

        	var verify_time_type = 0;
        	if($("input[name='verify_time_type']:checked").val() == '1'){
        		 verify_time_type = 1;
        	}
        	if(parseInt($('#day_count').val()) >parseInt($('#goods_count').val())){
        		art.dialog.msg({content:'每日奖品限量不能大于奖品总数!'});
        		return false;
        	}
        	if(isedit == ''){
	        	if(!confirm('奖品添加过后不可删除！请确认？')){
	        			return false;
	        	}
        	}
			var cjtype = $("[data-callback='cjtype']").children('input[type="radio"]:eq(0)').val();
			if (cjtype == 2) {
				//选择积分作为奖品
				//$('#jp_type').val(2);
				$('#goods_id').val('gw1400000000');
			}
			var data = {
				js_cate_id : $('#js_cate_id').val(),
				cj_batch_id : $('#cj_batch_id', '#form4').val(),
				goods_id : $('#goods_id', '#form4').val(),
				day_count : $('#day_count', '#form4').val(),
				goods_count : $('#goods_count', '#form4').val(),
				mms_title : $('#mms_title', '#form4').val(),
				mms_text : $('#mms_text', '#form4').val(),
				verify_time_type : verify_time_type,
				verify_begin_date : $('#verify_begin_date', '#form4').val(),
				verify_end_date : $('#verify_end_date', '#form4').val(),
				verify_begin_days : $('#verify_begin_days', '#form4').val(),
				verify_end_days : $('#verify_end_days', '#form4').val(),
				batch_id : $('#batch_id', '#form4').val(),
				jp_type : $('#jp_type').val(),
				wx_card_id : $('#wx_card_id').val(),
				cate_name : $('#cate_name').val(),
				int_count : $('#int_count').val(),
				version : 3,
				cusMsg:$('#cusMsg', '#form4').val(),
			}

			if(_hbtpybx_flag){
				data.send_type = $('#send_type').val();
			}

			dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0,lock:true});

			$.post(subHref, data, function(resp){
                if(resp.status=='1'){
					obj = {data:resp.data};
                	window.parent.refresh_jp(obj);
            	}
            	dialog.close();
				art.dialog.msg({
					content:resp.info,
					ok: function () {
						if(resp.status=='1'){
							art.dialog.close();
						}
					}
				});
			}, 'json');
		  };
		});

	$('#js_cate_id').val($('#prizetype span:eq(0)').data('val'));
	$('#prizetype span:eq(0)').trigger('click');


 $('#form2').hide();
 $('#form1').show();
 //初始化时判断是否要disable
 initDisableCount();

 
});

function initDisableCount() {
	if ($('#goods_name').val() == '' || $('#bonus_name').val() == '') {
		$('#goods_count').attr('disabled', 'disabled');
		$('#day_count').attr('disabled', 'disabled');
	}
	if ($('#int_count').val() != 0) {
		$('#goods_count').removeAttr('disabled');
		$('#day_count').removeAttr('disabled');
	}
}
//打开窗口的回调函数
var selectJpcallback = function (d) {
	//奖品类型，默认的为非微信卡券
	$('#jp_type').val(0);
	var goods_type = d.goods_type;

	$('#mms_text').removeAttr("readonly");
	//修改示例图中的短信内容
	var surplus = "{$storeDifference}";
	// var sample = $("#sample").html();
	var sample = "{$smsContent}";
	var cardName = '';
	if(surplus<0){
		if(d.goods_name.length>11){
			cardName = d.goods_name.substr(0,10)+'...';
		}else{
			cardName = d.goods_name.substr(0,11);
		}
	}else if(surplus>0){
		if(d.goods_name.length>11){
			cardName = d.goods_name.substr(0,(10+Math.abs(surplus)))+'...';
		}else{
			cardName = d.goods_name.substr(0,(11+Math.abs(surplus)));
		}
	}else{
		if(d.goods_name.length>11){
			cardName = d.goods_name.substr(0,10)+'...';
		}else{
			cardName = d.goods_name.substr(0,11);
		}
	}
	$("#sample").html(sample+cardName);
	//console.log(d)
	var batch_type = $("[data-callback='cjtype']").children('input[type="radio"]:eq(0)').val();

	// alert("isopencusMsg:" + isopencusMsg);
	// alert("goods_type:" + d.goods_type);
	// alert("batch_type:"+batch_type);
	// alert("d.source" + d.source);
	var isWX = d.wx_flag;
	if(batch_type == 0)
	{
		if(isopencusMsg==1)
		{
			if(d.goods_type == 0 || d.goods_type == 1 || d.goods_type == 2 || d.goods_type == 3)
			{
				$(".showSendtype").show();
				if(isWX == d.card_id){
					$("#phone").hide();
					$(".typewxcard").addClass("hover").removeClass("dn");
					$(".typemsg").removeClass("hover").addClass("dn");
					$(".usgexplain").hide();
					$("#tipStr").hide();
					$(".showSendtype.usgexplain").hide();
					$('.source').show();
					$('.imvBox-show').hide();
					$(".cusMsg").hide();
					$(".nocusMsg").hide();
					$('#jp_type').val(1);
					$('#wx_card_id').val(d.card_id);
				}else
				{
					$(".typewxcard").removeClass("hover").addClass("dn");
					$(".typemsg").addClass("hover").removeClass("dn");
					$(".usgexplain").show();
					$("#tipStr").hide();
					$(".showSendtype.usgexplain").show();
					$('.source').show();
					$('.imvBox-show').show();
					$("#phone").show();
					$(".cusMsg").show();
					$(".nocusMsg").hide();
					$("ul.cusMsg").find("textarea[name='cusMsg']").val("");
					$(".Gshow-cusMsg").html("");
					$("#mms_text").val("");
				}
			}


			if (goods_type == 2) { //如果是提领券
				$(".showSendtype").show();
				$(".typewxcard").removeClass("hover").addClass("dn");
				$(".typemsg").addClass("hover").removeClass("dn");
				$(".usgexplain").show();				
				$("#tipStr").show();
				$('.imvBox-show').show();
				$(".cusMsg").hide();
			    $(".nocusMsg").show();
			    $.post("{:U('Common/SelectJp/checkOnlineWithdraw')}", {'goodsId':d.goods_id}, function(type){
			        if(type =='"1"'){
			            $('#mms_title').val('');
			            $('#mms_text').val('本券支持线上提领');
			        }else{
			            $('#mms_text').val(d.mms_text);
			            $('#mms_title').val(d.mms_title);
			        }
			    });
			}

			if(d.goods_type == 7){
				$('.imvBox-show').hide();
				$("#phone").hide();
				$('.source').hide();
				$(".showSendtype").hide();
				$(".cusMsg").hide();
				$(".nocusMsg").hide();
			}
			
			if(d.goods_type == 8){
				var note = "您已获得"+parseInt(d.goods_amt)+"元Q币，点击[#GET_URL],即可领取！领取截止时间：[#END_DATE]。";
				$('#mms_text').val(note);
				$('#mms_title').val(parseInt(d.goods_amt)+"元Q币");
				$('#mms_text').attr("readonly","readonly");
				$('#mms_title').attr("readonly","readonly");
				$('.imvBox-show').hide();
				$("#phone").hide();
				$('.source').show();
				$(".cusMsg").hide();
				$(".nocusMsg").hide();
				$(".showSendtype").show();
				$(".typewxcard").removeClass("hover").addClass("dn");
				$(".typemsg").addClass("hover").removeClass("dn");
				$(".showSendtype.usgexplain").show();
			}
			
			if(d.goods_type == 12){
				$(".showSendtype").hide();
				$('.source').hide();
				$('.imvBox-show').hide();
			}

			if(d.goods_type == 15) { //流量包
				$(".showSendtype").hide();
				$('.source').hide();
				$('.imvBox-show').hide();
				$(".showSendtype.usgexplain").hide();
			}
		}
		
		if(isopencusMsg!=1){
			if(d.goods_type == 0 || d.goods_type == 1 || d.goods_type == 2 || d.goods_type == 3)
			{
				$(".showSendtype").show();
				if(isWX == d.card_id){
					$("#phone").hide();
					$(".typewxcard").addClass("hover").removeClass("dn");
					$(".typemsg").removeClass("hover").addClass("dn");
					$(".usgexplain").hide();
					$("#tipStr").hide();
					$(".showSendtype.usgexplain").hide();
					$('.source').show();
					$('.imvBox-show').hide();
					$(".cusMsg").hide();
					$(".nocusMsg").hide();
					$('#jp_type').val(1);
					$('#wx_card_id').val(d.card_id);
				}else
				{
					$("#phone").show();
					$(".typewxcard").removeClass("hover").addClass("dn");
					$(".typemsg").addClass("hover").removeClass("dn");
					$("#tipStr").hide();
					$(".showSendtype.usgexplain").show();
					$('.source').show();
					$('.imvBox-show').show();
					$(".cusMsg").hide();
					$("ul.cusMsg").find("textarea[name='cusMsg']").val("");
					$(".Gshow-cusMsg").html("");
					$(".nocusMsg").show();
					$("#mms_text").val("");
				}
				
			}

			if(d.goods_type == 7){
				$('.imvBox-show').hide();
				$("#phone").hide();
				$('.source').hide();
				$(".showSendtype").hide();
				$(".cusMsg").hide();
				$(".nocusMsg").hide();
			}

			if (d.goods_type == 2) { //如果是提领券
				$(".showSendtype").show();
				$(".typewxcard").removeClass("hover").addClass("dn");
				$(".typemsg").addClass("hover").removeClass("dn");
				$(".usgexplain").show();				
				$("#tipStr").show();
				$('.imvBox-show').show();
				$(".cusMsg").hide();
			    $(".nocusMsg").show();
			    $.post("{:U('Common/SelectJp/checkOnlineWithdraw')}", {'goodsId':d.goods_id}, function(type){
			        if(type =='"1"'){
			            $('#mms_title').val('');
			            $('#mms_text').val('本券支持线上提领');
			        }else{
			            $('#mms_text').val(d.mms_text);
			            $('#mms_title').val(d.mms_title);
			        }
			    });
			}
			
			if(d.goods_type == 8){
				var note = "您已获得"+parseInt(d.goods_amt)+"元Q币，点击[#GET_URL],即可领取！领取截止时间：[#END_DATE]。";
				$('#mms_text').val(note);
				$('#mms_title').val(parseInt(d.goods_amt)+"元Q币");
				$('#mms_text').attr("readonly","readonly");
				$('#mms_title').attr("readonly","readonly");
				$('.imvBox-show').hide();
				$('.source').show();
				$(".cusMsg").hide();
				$(".nocusMsg").hide();
				$(".showSendtype").show();
				$(".showSendtype.usgexplain").show();
				$(".typewxcard").removeClass("hover").addClass("dn");
				$(".typemsg").addClass("hover").removeClass("dn");
			}

			if(d.goods_type == 15) { //流量包
				$(".showSendtype").hide();
				$('.source').hide();
				$('.imvBox-show').hide();
				$(".showSendtype.usgexplain").hide();
			}
		}

		$("#mms_text").focus(function(){
			if(d.goods_type==7 || goods_type==8){
				$("#phone").hide();
				$(".prizeConfig_usage").addClass("dn");
			}else{
				$("#phone").hide();
				$(".prizeConfig_usage").removeClass("dn");
			}
		})
		$("#mms_text").blur(function(){
			if(d.goods_type==7 || goods_type==8){
				$("#phone").hide();
			}else{
				$(".prizeConfig_usage").addClass("dn");
				$("#phone").show();
			}
		})
		
		$("#shortMsg_config").focus(function(){
			if(d.goods_type==7 || d.goods_type==8){
				$("#phone").hide();
				$(".prizeConfig_usage").addClass("dn");
			}else{
				$(".prizeConfig_usage").removeClass("dn");
				$("#phone").show();
			}
		})
		$("#shortMsg_config").blur(function(){
			if(goods_type==7 || goods_type==8){
				$("#phone").hide();
			}else{
				$(".prizeConfig_usage").addClass("dn");
				$("#phone").show();
			}
		})
		windowheight();


	}

	$('#goods_desc').val(d.goods_desc);
	$('#goods_id').val(d.goods_id);
	$('#goods_name').val(d.goods_name);
	$('#goods_name_a').text(d.goods_name);
	$('#bonus_name').val(d.goods_name);
	$('#bonus_name_a').text(d.goods_name);
	$('#wechart_name').val(d.goods_name);
    $('#wechart_name_a').text(d.goods_name);
	//$('#goods_type').val(d.goods_type);
	$('#goods_count').removeAttr('disabled').val('');
	$('#day_count').removeAttr('disabled').val('');

	if (d.storage_type == '1') {
		$(".remain_num").html(d.remain_num);
		$('#goods_count').attr('class', 'validate[required,funcCall[checkNum],custom[integer],max['+d.remain_num+']]');
		$('#day_count').attr('class', 'validate[required,funcCall[checkNum],custom[integer],max['+d.remain_num+']]');
	} else {
		$(".remain_num").html('不限');
		$('#goods_count').attr('class', 'validate[required,funcCall[checkNum],custom[integer]');
		$('#day_count').attr('class', 'validate[required,funcCall[checkNum],custom[integer]');
	}

	// if (d.source == '3') {
	// 	$('#jp_type').val(1);
	// 	$('#wx_card_id').val(d.card_id);
	// 	$('.source').hide();
		
	//     var str = '每张卡券将收取'+sendPrice.wx+'元微信卡券下发费用';
	//     $('#tipStr').text(str);
	    
	// }else if(d.source == '6'){
 //        $('#jp_type').val(3);
 //        $('.source').hide();
 //    }
	// else {
	// 	$('.source').show();
	// 	$('#jp_type').val(0);
	// 	$('#wx_card_id').val('');
		// if (d.source == '2') {
		// 	$(".source input").attr("disabled", "disabled");
		// 	$(".source textarea").attr("disabled", "disabled");
		// }

		$('#verify_time_type').val(d.verify_time_type);
/*
		//提示及说明
	    var str = '每张卡券将收取'+sendPrice.buy+'元异业卡券下发费';
	    if(d.source == 0){
	      str = '每张卡券将收取'+sendPrice.self+'元卡券下发费用';
	    }
	    $('#tipStr').text(str);
*/
		art.dialog({id: 'closeJp'}).close();
		$("body").click();
		check_lenght(10, 'title_text', $('#mms_title'));
		check_lenght(100, 'text', $('#mms_text'));
	// }
	
}
function cjtype(t){
	var val = t.attr("data-val");
	//alert("val:"+val);
	if(val=="0"){
		$(".source").show();
		$("div[id*='show']").hide();
		$(".name3").hide();
		$(".name0").show();
		$("#show"+val).show();
		$(".moren").show();
	    $(".weChatHb").hide();	
	    $('#int_amount').hide();
	}
	if(val=="1"){
		$("div[id*='show']").hide();
		$("#show"+val).show();
		$(".source").hide();
		$(".weChatHb").hide();
		$(".moren").show();
		$(".name3").hide();
		$(".name0").show();
		$('#int_amount').hide();
		$(".showSendtype").hide();
		$("#phone").hide();
		$(".cusMsg").css("display","none");
	}
	
	if (val == '2') {
		$("div[id*='show']").hide();
		$('#int_amount').show();
		$(".source").hide();
		$(".name3").hide();
		$(".name0").hide();
		$(".showSendtype").hide();
		$("#phone").hide();
		$(".cusMsg").css("display","none");
	}
	if (val == '3') {
		$(".moren").show();
		$('#int_amount').hide();
		$("div[id*='show']").hide();
		$("#show"+val).show();
		$(".source").hide();
		$(".name3").show();
		$(".name0").hide();
		$(".showSendtype").hide();
		$("#phone").hide();
		$(".cusMsg").css("display","none");
	}
	//切换的时候清空数据防止用户误操作提交(编辑的时候没有切换，不用清空)
	if ($('#bind_cj').length != 0 || $('#bind_fixbonus').length != 0 || $('#bind_weChatbonus').length != 0) {
		$('#goods_name').val('');
		$('#bonus_name').val('');
		$('#wechart_name').val('');
		$('#goods_name_a').html('');
		$('#wechart_name_a').html('');
		$('#bonus_name_a').html('');
	}
	//不是积分的时候
	if (val != 2 && $('#goods_name').val()=="") {
		$('#goods_count').attr('disabled', 'disabled');
		$('#day_count').attr('disabled', 'disabled');
		$('#storage_tips').show();
	} else {
		//切换到积分的时候
		$('#goods_count').attr('class', 'validate[required,funcCall[checkNum],custom[integer]');
		$('#day_count').attr('class', 'validate[required,funcCall[checkNum],custom[integer]');
		$('#goods_count').removeAttr('disabled');
		$('#day_count').removeAttr('disabled');
		$('#storage_tips').hide();
	}
	//添加时的界面，切换时清空
	if (!$('#cj_batch_id').val()) {
		$('#goods_count').val('');
		$('#day_count').val('');
	}
}

Date.prototype.Format = function(fmt)   
{  
  var o = {   
    "M+" : this.getMonth()+1,                 
    "d+" : this.getDate(),                    
    "h+" : this.getHours(),                   
    "m+" : this.getMinutes(),                
    "s+" : this.getSeconds(),                 
    "q+" : Math.floor((this.getMonth()+3)/3), 
    "S"  : this.getMilliseconds()             
  };   
  if(/(y+)/.test(fmt))   
    fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));   
  for(var k in o)   
    if(new RegExp("("+ k +")").test(fmt))   
  fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));   
  return fmt;   
}

function createDatePickerWithLimit() {
	var min_date=$('#goods_begin_date').val();
	var year = min_date.substr(0, 4);
	var month = min_date.substr(4, 2);
	var day = min_date.substr(6, 2);
	min_date = year + '-' + month + '-' + day;
	var max_date=$('#goods_end_date').val();
	year = max_date.substr(0, 4);
	month = max_date.substr(4, 2);
	day = max_date.substr(6, 2);
	max_date = year + '-' + month + '-' + day;
	WdatePicker({minDate:min_date,maxDate:max_date});
}
function createDatePickerWithLimitEnd() {
	var max_date=$('#goods_end_date').val();
	var year = max_date.substr(0, 4);
	var month = max_date.substr(4, 2);
	var day = max_date.substr(6, 2);
	max_date = year + '-' + month + '-' + day;
	WdatePicker({minDate:'#F{$dp.$D(\\'verify_begin_date\\')}',maxDate:max_date});
}
function checkNum(field, rules, i, options){
	var a = parseInt($("#goods_count").val()),b = parseInt($("#day_count").val());
	if(a<b){return "总奖品数量必须大于日奖品数量";}
}
function checkSendDay(field, rules, i, options) {
	var min_date_str=$('#goods_begin_date').val();
	var max_date_str=$('#goods_end_date').val();
	min_date_str = min_date_str.substr(0, 8);
	max_date_str = max_date_str.substr(0, 8);
	var now = new Date();
	var nowStr = now.Format("yyyyMMdd");
	if (nowStr > max_date_str) {
		return "奖品已过期";
	}
	if (nowStr > min_date_str) {
		min_date_str = nowStr;
	}
	var nowDate = new Date(nowStr.substr(0, 4), (parseInt(nowStr.substr(4, 2)) - 1), nowStr.substr(6, 2));
	var minDate = new Date(min_date_str.substr(0, 4), (parseInt(min_date_str.substr(4, 2)) - 1), min_date_str.substr(6, 2));
	var maxDate = new Date(max_date_str.substr(0, 4), (parseInt(max_date_str.substr(4, 2)) - 1), max_date_str.substr(6, 2));
	var minLimit = parseInt(Math.abs(minDate - nowDate) / 1000 / 60 / 60 /24);
	var maxLimit = parseInt(Math.abs(maxDate - nowDate) / 1000 / 60 / 60 /24);
	var fieldName = field.attr('name');
	if (field.val() < minLimit || field.val() > maxLimit) {
		return "设置天数在" + minLimit + '和' + maxLimit + '之间';
	}
	var beginTime = parseInt($('.Gtime1 [name="verify_begin_days"]').val());
	var endTime = parseInt($('.Gtime1 [name="verify_end_days"]').val());
	if (beginTime > endTime) {
		return "使用开始时间不能大于使用结束时间";
	}
}
</script>
</head>
<body>
<div class="fn" id="one_div">
    <div class="imvBox" style="float:left">
    <div class="imvBox-edit">
        <div class="cl"></div>
        <div id="" class="fn">
            <div class="Gform fn">
                <!--旺财卡券表单1-->
                <div id="Wform">
                    <ul>
                        <li class="Gname"><span>*</span>&nbsp;设置奖项</li>
                        <li class="Ginput">
                            <div id="prizetype" class="switch auto">
                                <php>if($cj_batch_id){</php>
                                <div class="newRadio">
                                    <span class="hover">{$cate_arr[$jp_arr['cj_cate_id']]}</span>
                                </div>
                                <php>}else{</php>
                                <input type="radio" id="js_cate_id" value="0">
                                <div class="newRadio">
                                    <php>$i = 0;</php>
                                    <foreach name="cate_arr" item="vo" key="k">
                                        <php>
                                            if($jp_arr){
                                            $hover = $k == $jp_arr['cj_cate_id'] ? 'hover' : '';
                                            }
                                            else{
                                            $hover = $i == 0 ? 'hover' : '';
                                            }
                                            $i++;
                                        </php>
                                        <span class="{$hover}" data-val="{$k}">{$vo}</span>
                                    </foreach>
                                    <span class="" data-val="0">新奖项</span>
                                </div>
                                <php>}</php>
                            </div>
                        </li>
                    </ul>
                    <ul id="newprizetype" class="dn">
                        <li class="Gname">&nbsp;</li>
                        <li class="Ginput">
                            <input type="text" name="cate_name" id="cate_name" class="validate[required]" maxlength="6" placeholder="新奖项名称，如：一等奖" /><span class="maxTips forInput" data-max="6">0/6</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="cl"></div>
        <form method="post" id="form4">
        <div id="form1" class="fn">
            <input type="hidden" id="goods_id"/>
            <input type="hidden" id="begin_time"/>
            <input type="hidden" id="end_time"/>
            <input type="hidden" id="cj_batch_id" value="{$cj_batch_id}"/>
            <input type="hidden" id="batch_id" value="{$batch_id}"/>
            <!-- <input type="hidden" id="js_cate_id" value="{$cj_cate_id}"/> -->
            <input type="hidden" id="jp_type" value="0"/>
            <input type="hidden" id="wx_card_id"/>
            
            <div class="Gform fn">
                <!--旺财卡券表单1-->
                <div id="Wform">
                    <php>if($hbtpybx_flag){</php>
                    <ul>
                        <li class="Gname">&nbsp;是否下发凭证</li>
                        <li class="Ginput">
                            <div class="switch" data-show="ul_jointype_0_0">
                                <input type="radio" value="{$jp_arr['send_type']}" checked="checked" name="send_type" id="send_type">
                                <div class="newRadio">
                                    <span class="valfirst" data-val="0">下发</span>
                                    <span class="vallast" data-val="1">不下发</span>
                                </div>
                                <span class="txtTips important" id="ul_jointype_0_0">不下发，活动仅有中奖记录</span>
                            </div>
                        </li>
                    </ul>
                    <php>}</php>
                    <ul>
                        <li class="Gname"><span>*</span>&nbsp;奖品类型</li>
                        <li class="Ginput">
                            <div class="switch <notempty name="cj_batch_id">disabled</notempty>" data-callback="cjtype">
                                <input type="radio" name="" value='<if condition="$jp_arr.batch_class eq 12">1<elseif condition="$jp_arr.batch_class eq 14" />2<elseif condition="$jp_arr.batch_type eq 7 or $jp_arr.batch_type eq 8" />3<else />0</if>' checked="checked">
                                <div class="newRadio">
                                    <span class="valfirst" data-val="0">卡券</span>
                                    <span class="vallast" data-val="1">定额红包</span>
                                    <eq name="hasOpenIntegral" value="1"><span class="vallast" data-val="2">积分</span></eq>
                                    <span class="vallast" data-val="3">微信红包</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul id="select_jp">
                        <li class="Gname name0"><span>*</span>&nbsp;选择奖品</li>
                        <li class="Gname name3 dn"><span>*</span>&nbsp;选择红包</li>
                        <li class="Ginput">
                            <div class="Gchoose" id="show0">
                                <input type="text" class="validate[required]" id="goods_name" readonly="readonly" value="{$jp_arr['batch_name']}" />
                                <a href="javascript:void(0)" id="goods_name_a">{$jp_arr['batch_name']}</a>
                                <?php if(!$cj_batch_id){?>
                                <a href="javascript:void(0)" id="bind_cj" class="Gbtn-card" title="选择卡券"><i></i></a>
                                <?php }?>
                            </div>
                           <div class="Gchoose dn" id="show1">
                                <input type="text" class="validate[required]" id="bonus_name" readonly="readonly" value="{$jp_arr['batch_name']}" />
                                <a href="javascript:void(0)" id="bonus_name_a">{$jp_arr['batch_name']}</a>
                                <?php if(!$cj_batch_id){?>
                                <a href="javascript:void(0)" id="bind_fixbonus" class="Gbtn-card" title="选择定额红包"><i></i></a>
                                <?php }?>
                            </div>
                            <div class="Gchoose dn" id="show3">
                                <input type="text" class="validate[required]" id="wechart_name" readonly="readonly" value="{$jp_arr['batch_name']}" />
                                <a href="javascript:void(0)" id="wechart_name_a">{$jp_arr['batch_name']}</a>
                                <?php if(!$cj_batch_id){?>
                                <a href="javascript:void(0)" id="bind_weChatbonus" class="Gbtn-card" title="选择微信红包"><i></i></a>
                                <?php }?>
                            </div>
                        </div>
                        </li>
                    </ul>
                    <ul id="int_amount" class="dn">
                        <li class="Gname"><span>*</span>积分值</li>
                        <li class="Ginput">
                            <input type="text" class="validate[required,custom[integer]]" id="int_count" value="{:intval($jp_arr['batch_amt'])}">
                            <span class="txtTips">每次中奖获得的积分数量</span>
                        </li>
                    </ul>
                    <ul class="moren">
                        <li class="Gname"><span>*</span>奖品份数</li>
                        <li class="Ginput">
                            <input type="text" class="validate[required,funcCall[checkNum],custom[integer]<if condition="$jp_arr['goods_remain_num'] neq '-1'">,max[{:($jp_arr['goods_remain_num']+$jp_arr['total_count'])}]</if>]" id="goods_count" value="{$jp_arr['total_count']}">
                            <span class="txtTips" id="storage_tips">您的库存为:<span class="remain_num red"><present name="jp_arr['goods_remain_num']"><if condition="$jp_arr['goods_remain_num'] neq '-1'">{$jp_arr['goods_remain_num']}<else />不限</if></present></span></span>
                        </li>
                    </ul>
                    <ul class="moren">
                        <li class="Gname"><span>*</span>每日奖品限量</li>
                        <li class="Ginput"><input type="text" class="validate[required,funcCall[checkNum],custom[integer]<if condition="$jp_arr['goods_remain_num'] neq '-1'">,max[{:($jp_arr['goods_remain_num']+$jp_arr['total_count'])}]</if>]" id="day_count" value="{$jp_arr['day_count']}"></li>
                    </ul>
                                        
                    <ul class="source">
                        <li class="Gname"><span>*</span>卡券使用时间</li>
                        <li class="Ginput">
                            <php>
                            $time_flag = $jp_arr['verify_begin_type'] == '0';
                            </php>
                            <div class="switch">
                                <input type="radio" name="verify_time_type" value="{$jp_arr['verify_begin_type']}" checked="checked">
                                <div class="newRadio">
                                    <span class="valfirst hover" data-val="0">按日期设置</span>
                                    <span class="vallast {$hover2}" data-val="1" id="date_type_1">按天数设置</span>
                                </div>
                                <php>
                                $begin_date = $end_date = '';
                                if($time_flag){
                                    $begin_date = dateformat($jp_arr['verify_begin_date'],'Ymd');
                                    $end_date = dateformat($jp_arr['verify_end_date'],'Ymd');
                                }
                                </php>
                                <div class="newRadio-default">
                                    <div class="Gtime1 fn special mt10">
                                        <em class="em1">使用开始时间</em>
                                        <input type="text" name="verify_begin_date" id="verify_begin_date" onclick="WdatePicker({minDate:'%y-%M-%d',maxDate:'#F{$dp.$D(\\'verify_end_date\\')}'});" class="validate[required,condRequired[verify_begin_type1]]" value="{$begin_date}" maxlength="8">
                                    </div>
                                    <div class="Gtime1 fn special mt10">
                                        <em class="em1">使用结束时间</em>
                                        <input type="text" name="verify_end_date" id="verify_end_date" onclick="WdatePicker({minDate:'#F{$dp.$D(\\'verify_begin_date\\')||\\'%y-%M-%d\\'}'});" class="validate[required,condRequired[verify_begin_type1]]" value="{$end_date}">
                                    </div>
                                    <span class="txtTips important">自定义验码开始的日期,如:"4月1号至6月1号"</span>
                                </div>
                                <php>
                                $begin_day = $end_day = '';
                                if(!$time_flag){
                                    $begin_day = $jp_arr['verify_begin_date'];
                                    $end_day = $jp_arr['verify_end_date'];
                                }
                                </php>
                                <div class="newRadio-input">
                                   <div class="Gtime1 fn special mt10">
                                        <em class="em1">发送卡券后</em>
                                        <input name="verify_begin_days" id="verify_begin_days" type="text" class="validate[required,custom[integer],condRequired[verify_begin_type2]]" value="{$begin_day}">
                                        <em class="em2">天开始使用</em>
                                    </div>
                                    <div class="Gtime1 fn special mt10">
                                        <em class="em1">发送卡券后</em>
                                        <input name="verify_end_days" id="verify_end_days" type="text" class="validate[required,custom[integer],condRequired[verify_begin_type2]]" value="{$end_day}">
                                        <em class="em2">天结束使用</em>
                                    </div>
                                    <span class="txtTips important">自定义验码时间,如:"发送卡券后3天开始使用,5天结束使用"</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="showSendtype dn">
                    <li class="Gname"><span>*</span>&nbsp;奖品发送方式</li>
                    <li class="Ginput">
                    <div class="switch" data-callback="cjSendtype">
                        <input type="radio" name="sendType" value='0' checked="checked">
                        <div class="newRadio">
                            <span class="valfirst typemsg" data-val="0">短信</span>
                            <span class="valfirst typewxcard" data-val="1">微信卡券</span>
                        </div>
                        <div class="cl"></div>
                        <p class="dn" id="tipStr"></p>
                    </div>
                    </li>
                    </ul>
                    <ul class="cusMsg dn">
                        <li class="Gname"><span>*</span>&nbsp;短信内容</li>
                        <li class="Ginput">
                            <textarea maxlength="40" name="cusMsg" id="cusMsg"  class="validate[required,maxSize[40]] Gview-cusMsg" placeholder="您收到哈根达斯100元代金券">{$jp_arr['sms_text']}</textarea>
                            <span class="maxTips forArea" data-max="40">0/40</span>
                        </li>
                    </ul>
                    <ul class="showSendtype usgexplain dn">
                        <li class="Gname"><span>*</span>&nbsp;使用说明</li>
                        <li class="Ginput">
                            <textarea maxlength="100" name="mms_text" id="mms_text"  class="validate[required,maxSize[100]]" >{$prizeData['use_rule']}</textarea>
                            <span class="maxTips forArea" data-max="100">0/100</span>
                            <span class="txtTips">使用说明将显示在短信详情页面</span>
                        </li>
                    </ul>
                    
                    <div class="DiabtnCon">
                        <a href="javascript:void(0);" title="确认" id="btn4" class="Diabtn-all">确定</a>
                        <a href="javascript:art.dialog.close();" class="Diabtn-all-del" id="cancel">取消</a>
                    </div>
                </div>
        </div>
        </form>
    </div>
    <div class="imvBox-show dn" style="margin-top:15px; height:528px">
        <div id="phone" style="background:#FFF">
        <div class="phonetop"></div>
        <div id="phoneCon">
            <div class="wx-show">
                <img src="__PUBLIC__/Image/shortMsg-top.png">
                <div class="wx-sc-content" style=" font-size:13px; line-height:18px; color:#000; margin:0 10px; padding:0 8px; background:#e5e5ea; width:204px;">
                	<div class="nocusMsg">
                    <p>【翼码科技】辅助码：00000000000000</p>
                    <p>您收到<span class="shname" id="sample">{$smsContent}</span></p>
                    </div>
                    <div class="cusMsg">
                    <p>【翼码科技】<span class="Gshow-cusMsg" style="word-break:break-all">{$jp_arr['sms_text']}</span></p>
                    </div>
                    <p>详见<a href="javascript:void(0)">ym06.cn/fln3Qb</a></p>
                </div>
                <img src="__PUBLIC__/Image/shortMsg-bottom.png">
            </div>
        </div>
    </div>
    </div>
    </div>
    <img src="__PUBLIC__/Image/prizeConfig_usage.png" class="prizeConfig_usage dn" style="position: relative; float:left; left:0px; top:15px;">
</div>

</body>
</html>
<script>
function cjSendtype(t){
 //    var val = t.val("data-val");
	// //alert(val);
 //    if(val=="0"){
	// 	$("#phone").css("display","block");
	// 	$(".usgexplain").show();
	// 	$("#tipStr").show();
 //    }
 //    if(val=="1"){
 //        $(".usgexplain").hide();
	// 	$("#phone").css("display","none");
	// 	$("#tipStr").hide();
 //    }
}
$(function(){
  //   $("#shortMsg_config").focus(function(){
  //       $(".prizeConfig_usage").removeClass("dn");
  //   })
  //   $("#shortMsg_config").blur(function(){
  //       $(".prizeConfig_usage").addClass("dn");
  //   })

  //   $("#mms_text").focus(function(){
		// $("#phone").hide();
  //       $(".prizeConfig_usage").removeClass("dn");
  //   })
  //   $("#mms_text").blur(function(){
		// $(".prizeConfig_usage").addClass("dn");
		// $("#phone").show();
  //   })
})
</script>