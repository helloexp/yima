<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>市场调研_营销活动中心_翼码旺财</title>
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<js href="__PUBLIC__/Js/jquery-1.7.2.min.js?v=__VR__"/>
<js href="__PUBLIC__/Js/global.js?v=__VR__"/>
<js  href="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default" />
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=2bae04b8f7143fbf22546a6495396cdc"></script>
<style>
.HgdsMap {}
.HgdsMap-search { margin-top:20px;}
.HgdsMap-search p { line-height:30px;}
.w400 { width:400px;}
.HgdsMap-Main { border:solid 1px #dcdcdc; margin-top:20px;}
.HgdsMap-list { position:relative; float:left; margin-right:-241px; width:240px; height:600px; overflow-y:auto; border-right:solid 1px #dcdcdc; z-index:2;}
.HgdsMap-list dl { padding:0 10px;}
.HgdsMap-list dl dt { padding:10px 0 10px 10px; border-bottom:solid 1px #dcdcdc;}
.HgdsMap-list .label { padding:10px 0; display:block; cursor:pointer;}
.HgdsMap-list dl dd .label { white-space:nowrap; overflow: hidden;text-overflow: ellipsis; padding-left:10px;}
.HgdsMap-list dl dd .label:hover { overflow: visible;}
.HgdsMap-list dl dt input { display:none;}
.HgdsMap-list dl dd input { display:none;}
.HgdsMap-list dl dt input,.HgdsMap-list .label span { vertical-align:middle; height:17px; font-size:14px;}
.HgdsMap-list dl dd:hover,.HgdsMap-list dl dt:hover { background:#f6f6f6;}
.HgdsMap-Con { width:100%; float:right;}
.HgdsMap-Map { margin-left:242px;}
.HgdsMap-Map #allmap { width:100%; height:100%;}
.HgdsMap-list dt .label i { margin-right:5px; width:16px; height:16px;display:inline-block;*display:inline;*zoom:1; vertical-align:middle; background:url(__PUBLIC__/Image/base_z.png) no-repeat 0 -3259px;}
.HgdsMap-list dt .label i.checked { background:url(__PUBLIC__/Image/base_z.png) no-repeat 0 -3285px;}
.HgdsMap-list dd .label i { margin-right:5px; width:18px; height:27px;display:inline-block;*display:inline;*zoom:1; vertical-align:middle; background-image:url(__PUBLIC__/Label/Image/Item/hgds-07.png); background-repeat:no-repeat;}
.HgdsMap-list .label i.list1 { background-position:0 -198px;}
.HgdsMap-list .label i.list2 { background-position:-24px -198px;}
.HgdsMap-list .label i.list3 { background-position:-48px -198px;}
.HgdsMap-list .label i.list4 { background-position:-72px -198px;}
.HgdsMap-list .label i.list5 { background-position:-96px -198px;}
.HgdsMap-list .label i.list6 { background-position:-120px -198px;}
.HgdsMap-list .label i.list7 { background-position:-144px -198px;}
.HgdsMap-list .label i.list8 { background-position:-168px -198px;}
.HgdsMap-list .label i.list9 { background-position:-192px -198px;}
.HgdsMap-list .label i.list10 { background-position:-216px -198px;}
.HgdsMap-list .label:hover i.list1 { background-position:0 -263px;}
.HgdsMap-list .label:hover i.list2 { background-position:-24px -263px;}
.HgdsMap-list .label:hover i.list3 { background-position:-48px -263px;}
.HgdsMap-list .label:hover i.list4 { background-position:-72px -263px;}
.HgdsMap-list .label:hover i.list5 { background-position:-96px -263px;}
.HgdsMap-list .label:hover i.list6 { background-position:-120px -263px;}
.HgdsMap-list .label:hover i.list7 { background-position:-144px -263px;}
.HgdsMap-list .label:hover i.list8 { background-position:-168px -263px;}
.HgdsMap-list .label:hover i.list9 { background-position:-192px -263px;}
.HgdsMap-list .label:hover i.list10 { background-position:-216px -263px;}
.HgdsMap-list .label i.list1.checked { background-position:0 -230px;}
.HgdsMap-list .label i.list2.checked { background-position:-24px -230px;}
.HgdsMap-list .label i.list3.checked { background-position:-48px -230px;}
.HgdsMap-list .label i.list4.checked { background-position:-72px -230px;}
.HgdsMap-list .label i.list5.checked { background-position:-96px -230px;}
.HgdsMap-list .label i.list6.checked { background-position:-120px -230px;}
.HgdsMap-list .label i.list7.checked { background-position:-144px -230px;}
.HgdsMap-list .label i.list8.checked { background-position:-168px -230px;}
.HgdsMap-list .label i.list9.checked { background-position:-192px -230px;}
.HgdsMap-list .label i.list10.checked { background-position:-216px -230px;}
</style>
<script>
var marker = {};
var marker_q = {};
var map = null;
$(document).ready(function(e) {
	//适应
	
	var arr = <?php echo json_encode($store_arr);?>;
	var f_lbs_x = '<?php echo $lbs['lbs_x'];?>';
	var f_lbs_y = '<?php echo $lbs['lbs_y'];?>';
	// 百度地图API功能
	map = new BMap.Map("allmap");            // 创建Map实例
	/*if(f_lbs_x == '' || f_lbs_y == '')
	{
		map.centerAndZoom('上海',10);
	}else{
		map.centerAndZoom(new BMap.Point(f_lbs_y,f_lbs_x),11);                     // 初始化地图,设置中心点坐标和地图级别。
	}*/
	map.centerAndZoom('上海',10);
	map.addControl(new BMap.NavigationControl());  //添加默认缩放平移控件
	map.addControl(new BMap.ScaleControl());                    // 添加默认比例尺控件
	map.enableScrollWheelZoom();                            //启用滚轮放大缩小
 
 
 	//自定义标注图片
	var point = new BMap.Point(121.4, 31.2); 
	var myIcon = new BMap.Icon("__PUBLIC__/Label/Image/Item/hgds-08.png", new BMap.Size(30, 32), {    
	   offset: new BMap.Size(0, 0),     
	   imageOffset: new BMap.Size(0, 0)   // 设置图片偏移    
	 });  
	 
	for(i in arr)
	{
		var point = new BMap.Point(arr[i]['lbs_y'],arr[i]['lbs_x']);
		marker[i] = new BMap.Marker(point,{icon: myIcon});
		if(arr[i]['question_id'])
		{
			marker_q[i] = {};
			for(k in arr[i]['question_id'])
			 {
			 	marker_q[i][k] = {};
				for(m in arr[i]['question_id'][k])
				{
					var point = new BMap.Point(arr[i]['question_id'][k][m]['lbs_x'],arr[i]['question_id'][k][m]['lbs_y']);
					marker_q[i][k][m] = new BMap.Marker(point);
				}
			 }
		 }
	}
	//console.log(marker_q);
     
					
	$("#allmap").height($(".HgdsMap-list").height())
	
	//单选
	$("dd .label").click(function(){
		var _thisckeck = $(this).find("input").attr("checked");
		var question_id = $("#map_question").find("option:selected").val();
		var store_id = $("#"+$(this).find('input').attr('id')).val();
		if(_thisckeck){
			$(this).find("input").attr("checked",false)
			$(this).find("i").removeClass("checked");
			map.removeOverlay(marker[store_id]);
			if(marker_q[store_id])
			{
				for(add_one in marker_q[store_id][question_id])
				{
					map.removeOverlay(marker_q[store_id][question_id][add_one]);
				} 
			}
			//add_point($(this).find("input").attr("id"));
		}else{
			$(this).find("input").attr("checked",true)
			$(this).find("i").addClass("checked");
			map.addOverlay(marker[store_id]);
			if(marker_q[store_id])
			{
				for(add_one in marker_q[store_id][question_id])
				{
					map.addOverlay(marker_q[store_id][question_id][add_one]);
				} 
			}
		}
		
	})
	
	//全选
	$("dt .label").click(function(e){
	
		var _thisckeck = $(this).find("input").attr("checked");
		var question_id = $("#map_question").find("option:selected").val();
		if(typeof(_thischeck) == 'undefined') _thischeck = false;
		if(_thisckeck){
			$(this).find("input").attr("checked",false)
			$(".HgdsMap-list").find("input").attr("checked",false);
			$(".HgdsMap-list").find("i").removeClass("checked");
			map.clearOverlays();
			//add_point(e);
		}else{
			$(this).find("input").attr("checked",true);
			$(".HgdsMap-list").find("input").attr("checked",true);
			$(".HgdsMap-list").find("i").addClass("checked");
			for(add_all_store in arr)
			{
				map.addOverlay(marker[add_all_store]);
				if(marker_q[add_all_store])
				{
					for(add_all in marker_q[add_all_store][question_id])
					{
						map.addOverlay(marker_q[add_all_store][question_id][add_all]);
					} 
				}
			}
		}
		
	})
	
	
	$("#map_question").change(function(){
		$(".HgdsMap-list").find("input").attr("checked",false);
		$(".HgdsMap-list").find("i").removeClass("checked");
		map.clearOverlays();
	});
	
});

                    
 </script>
								
</head>
<body>
    <div id="wrapper" class="bgfff">
        <include file="./Home/Tpl/Public/Public_header.html" />
        <div id="container" class="bgfff">
            <div id="main" class="rel">
            	<div class="bread">
                    <div class="bread-con fn">
                        <include file="./Home/Tpl/LabelAdmin/Path_index.html" />
                        <div class="bread-history">
                            <i class="icon-history"></i>
                            <p><a href="javascript:void(0)" class="ind-bread">返回</a></p>
                        </div>
                    </div>
                </div>
                <div class="HgdsMap fn">
                	<div class="HgdsMap-search fn">
                    	<p class="l">选择您调研的问题:</p>
                        <p class="l ml5">
                        	<select class="selectbox w400" name="map_question" id="map_question">
							<?php foreach($list as $key=>$val){?>
								<option value="<?=$val['id']?>"><?=$val['questions']?></option>
							<?php }?>
                            </select>
                        </p><!--
                        <p class="l ml10"><a href="javascript:void(0)" class="btn-all w90">确定</a></p>-->
                    </div>
                    <div class="HgdsMap-Main fn">
                    	<div class="HgdsMap-list">
                        	<dl>
							 	<dt><div class="label"><i class="list0"></i><input type="checkbox" id="store_all_checked" class="" /><span class="ml10">选择全部（共<?=count($channel_arr)?>家店）</span></div></dt>
							<?php 
								$i = 0;
							foreach($store_arr as $key=>$val){
									
							?>
								<dd><div class="label"><input type="checkbox" class="" id="store_id_<?=$i++?>" value="<?=$key?>"/><span><i class="list<?=$i?>"></i><?=$val['store_name']?></span></div></dd>
							<?php } ?>
                            	
                            </dl>
                        </div>
                        <div class="HgdsMap-Con">
                        	<div class="HgdsMap-Map">
                            	<div id="allmap"></div>
							
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <include file="./Home/Tpl/Public/Public_footer.html" />
    </div>
    <div class="service"></div>
</body>
</html>