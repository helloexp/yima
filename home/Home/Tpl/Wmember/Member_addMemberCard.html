<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>添加会员卡</title>
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wcanal.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wshopconfig.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Whygl.css?v=__VR__" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.8.2.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/Wcanal.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__" ></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__" ></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC_LOCAL__/Js/ueditor/ueditor.config.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC_LOCAL__/Js/ueditor/ueditor.all.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jsScroll.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jscolor/jscolor.js?v=__VR__"></script>
<style type="text/css">
	.cardCon { top: 0;}
</style>

<script>
var clickMb1 = function(e) {
    $("#tp2 .mb1").removeClass("current");
	$(this).addClass("current");
	var bgimg=$(this).children("img").attr("src");
	$(".cardCon").css("background-image","url(" + bgimg + ")");
	$('#bg_img').val(bgimg);
	var index = $(this).index() + 1;
	$('#bg_style').val(index);
}
$(function(){

	$(".cardCon").css("background-image","url(__PUBLIC__/Image/Whygl/mb_top_bg1.png)");
	$("#tp1 .mb1").click(function(e) {
        $("#tp1 .mb1").removeClass("current");
		$(this).addClass("current");
		var id = $(this).attr('id');
		id = id.substr(-1);
		$('#template').val(id);
    });	
	$("#tp2 .mb1").click(clickMb1);
	
	$("#mb1").click(function(e) {
        $("#cardCon-one").fadeIn(0);
		$("#cardCon-one").addClass("selected");
		$("#cardCon-two").fadeOut(0);
		$("#cardCon-two").removeClass("selected");
		$("#cardCon-three").fadeOut(0);
		$("#cardCon-three").removeClass("selected");
    });
	
	$("#mb2").click(function(e) {
        $("#cardCon-two").fadeIn(0);
		$("#cardCon-two").addClass("selected");
		$("#cardCon-one").fadeOut(0);
		$("#cardCon-one").removeClass("selected");
		$("#cardCon-three").fadeOut(0);
		$("#cardCon-three").removeClass("selected");
    });
    
	$("#mb3").click(function(e) {
        $("#cardCon-three").fadeIn(0);
		$("#cardCon-three").addClass("selected");
		$("#cardCon-one").fadeOut(0);
		$("#cardCon-one").removeClass("selected");
		$("#cardCon-two").fadeOut(0);
		$("#cardCon-two").removeClass("selected");
    });
	
})
function add()
{
        var opt = {
            cropPresets:'640x340',
            callback:uploadCallback
        };
        open_img_uploader(opt);
 }
function uploadCallback(data){
	console.log($('#tp2 .Ginput .mb1').length);
    //显示预览
    if ($('#tp2 .Ginput .mb1').length == 3) {
    	$('#tp2 .Ginput .mb1:eq(2)').after('<div class="mb1 fl"><img src="'+data.src+'" width="100"></div>');
    } else {
    	$('#tp2 .Ginput .mb1:eq(3)').replaceWith('<div class="mb1 fl"><img src="'+data.src+'" width="100"></div>');
    }
    $("#tp2 .mb1").click(clickMb1);
    $('#tp2 .mb1:eq(3)').click();
}

</script>
</head>
<body>
<div id="wrapper">
    <include file="./Home/Tpl/Public/Public_header.html" />
        <div class="" id="container">
        	<div class="rel" id="main">
        		<include file="Wmember/Member/leftMenu" leftmenuid="hyk" />
        		<div class="subcon fn">
                	<div class="main-name fn">
                    <h4>添加会员卡</h4>
                    </div>
                    <div class="fn member-management">
                    	<div class="subconLeft l">
                    		<div class="cardBox">
	                    		<div class="cardCon cardCon-one" id="cardCon-one">
	                    			<div class="user-name fn"><img src="{$node_logo}" class="photo imgType" /><p><span class="name nNameType">张三</span><span class="phone">13554254786</span></p><img src="__PUBLIC__/Image/{$card_code}" class="code" /></div>
	                    			<div class="user-id"><p style="float:right;"><span class="cardType">白金会员</span><span class="cardId">9999 9999</span></p></div>
	                    		</div>
	                    		<div class="cardCon cardCon-two dn" id="cardCon-two">
	                    			<div class="user-name fn"><img src="{$node_logo}" class="photo" /><p><span class="name">张三</span><span class="phone">13554254786</span></p></div>
	                    			<div class="user-id fn"><img src="__PUBLIC__/Image/{$card_code}" class="code" /><p><span class="cardType">白金会员</span><span class="cardId">9999 9999</span></p></div>
	                    		</div>
	                    		<div class="cardCon cardCon-three dn" id="cardCon-three">
	                    			<div class="user-name fn"><img src="{$node_logo}" class="photo" /><p><span class="name">张三</span><span class="phone">13554254786</span></p><img src="__PUBLIC__/Image/{$card_code}" class="code" /></div>
	                    			<div class="user-id fn"><p style="float:left;"><span class="cardType">白金会员</span><span class="cardId">9999 9999</span></p></div>
	                    		</div>
                    		</div>
                    	</div>
                    	<div class="subconRight l">
                    		<form method="POST" action="" id="theform" enctype="multipart/form-data">
                    		<input type="hidden" id="sub_type" name="sub_type" value="0" />
                    		<input type="hidden" id="template" name="template" value='1' />
							<input type="hidden" id="bg_img" name="bg_img" value='__PUBLIC__/Image/Whygl/mb_top_bg1.png' />
                        	<input type="hidden" id="bg_style" name="bg_style" value='1' />
		                    <div class="Wcanal-tab" id="Wcanal-tabon">
		                    <div class="steps">基础信息</div>
		                    <div class="eTicket_form">
	                            <div id="Wform" class="Gform eTicket" style="margin: 0;width: 100%;">
	                                <ul>
	                                    <li class="Gname">会员卡名称</li>
	                                    <li class="Ginput"><input name="card_name" id="card_name" type="text" onkeyup="check_lenght(5,'name_text',this);" class="validate[required,maxSize[5]] textbox w380" maxlength="5" placeholder=""/>
	                                    </li>
	                                </ul>

	                            	<!-- <div class="steps mt20">商户信息</div>
				                    <ul>
			                            <li class="Gname">商户名称：</li>
			                            <li class="Ginput">
			                                <input type="text" maxlength="8" class="Gview-text validate[required]" style="width:305px" value="{$node_name}" id="node_name" name="node_name">
			                            </li>
		                            </ul>
		                            
		                            <ul>
				                        <li class="Gname">商户logo：</li>
				                        <li class="Ginput">
				                            <div class="Gchoose Gview-img"  style="width:305px">
				                                <input type="text" value="{$node_logo}" id="node_logo" name="node_logo">
				                                <a href="javascript:void(0)" class="Gbtn-pic" title="选择图片" data-rel="{width:160,height:160}"><i></i></a>
				                            <div class="Gchoose-opr an" style="display: none;"><div class="Gchoose-opr-img"><img src="" style="width:100px;"></div><div class="Gchoose-opr-opr"><a href="javascript:void(0)" class="Gchoose-opr-edit"></a><a href="javascript:void(0)" class="Gchoose-opr-del"></a></div><span class="Gchoose-opr-jt"></span></div><div class="Gchoose-oprbg"></div></div>
				                        </li>
				                    </ul> -->

	                        		<div class="steps mt20">会员卡设计</div>
	                                <ul id="tp1">
				                        <li class="Gname">会员卡风格</li>
				                        <li class="Ginput">
				                           <div class="mb1 fl current" id="mb1"><img src="__PUBLIC__/Image/Whygl/mb_1.png" width="100"></div>
				                           <div class="mb1 fl" id="mb2"><img src="__PUBLIC__/Image/Whygl/mb_2.png" width="100"></div>
				                           <div class="mb1 fl" id="mb3"><img src="__PUBLIC__/Image/Whygl/mb_3.png" width="100"></div>
				                        </li>
			                        </ul>
			                        <ul id="tp2">
				                        <li class="Gname">会员卡背景图</li>
				                        <li class="Ginput">
				                        	<div class="fn">
				                        		<div class="mb1 fl current"><img src="__PUBLIC__/Image/Whygl/mb_top_bg1.png" width="100"></div>
				                            	<div class="mb1 fl"><img src="__PUBLIC__/Image/Whygl/mb_top_bg2.png" width="100"></div>
				                            	<div class="mb1 fl"><img src="__PUBLIC__/Image/Whygl/mb_top_bg3.png" width="100"></div>
				                        	</div>
				                            <div class="add_set_bg" onclick="add()">+上传</div> 
				                        </li>
				                    </ul>
				                    
	                                <ul>
	                                    <li class="Gname">权益说明</li>
	                                    <li class="Ginput" id="equity_tip">
	                                    	<!-- <textarea id="equity" name="equity" onkeyup="check_lenght(50,'name_text',this);" class="validate[required,minSize[4],maxSize[100]] textbox w380" placeholder="将在会员中心我的权益中显示"></textarea> -->
	                                    	<textarea name="equity" id="equity"></textarea>
	                                    	<span class="txtTips">将在会员中心我的权益中显示</span>
	                                    </li>
	                                </ul>
	                                
	                                <ul>
	                                    <li class="Gname">小票打印内容</li>
	                                    <li class="Ginput"><textarea id="receipt" name="receipt" onkeyup="check_lenght(50,'name_text',this);" class="validate[required,minSize[4],maxSize[100]] textbox w380" placeholder="使用带打印机的终端扫描会员卡二维码，打印此内容"></textarea>
	                                    </li>
	                                </ul>
	                                <ul>
	                                    <li class="Gname"></li>
	                                    <li class="Ginput mt5">
	                                    <a href="javascript:void(0);" title="确认" id="smb" class="btn-all w110">确定</a>
	                                    <a href="javascript:history.go(-1);" title="取消" id="reset" class="btn-all-del w110 ml10">取消</a>
	                                    </li>
	                                </ul> 
	                               </div>
		                    </div>
		                    </div>
                    		</form>
                    	</div>
                    </div>
                </div>
            </div>
        </div>
        
        <include file="./Home/Tpl/Public/Public_footer.html" /> 
    </div>
</div>	
</body>
</html>

<script type="text/javascript">
var n_name = "{$node_name}";
$(document).ready(function (e) {
	var ue = UE.getEditor('equity',{
	    imageUrl:"{:U('LabelAdmin/Upfile/editoImageSave')}",
	    imagePath:"__UPLOAD__",
	    catcherUrl:"{:U('LabelAdmin/Upfile/getRemoteImage')}",
	    catcherPath:"__UPLOAD__",
	    initialFrameWidth:340,
	    initialFrameHeight:280
	});

	$("#card_name").on('input',function(e){  
		var c_name = $("#card_name").val();
		if(c_name != '') {
			$(".cardType").text(c_name);
		} else {
			$(".cardType").text("白金会员");
		}
	});

	$("#smb").click(function() {
		if(!ue.getContent()){
            $('#equity_tip').validationEngine('showPrompt', '不能为空','error','topRight',true);
            return false;
        }else{
            $('#equity_tip').validationEngine('hide');
        }
		if($("#theform").validationEngine('validate')){
			$("#theform").ajaxSubmit({
				beforeSubmit:function(){
					dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
				},
				success:function(data){
					if (data.status == '1'){
						dialog.close();
						window.location.href="{:U('Wmember/Member/memberCard')}";
					} else {
				  		dialog.time(2).content("<div class='msg-all-error'>"+data.info+"</div>");
					}
				},
				url:"{:U('Wmember/Member/mCardAdd')}",
				dataType:'json'
			});
		}
		return false;
	});
});
</script>
