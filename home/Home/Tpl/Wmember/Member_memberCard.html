<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>会员卡</title>
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wcanal.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Whygl.css?v=__VR__" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.8.2.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/Wcanal.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__" ></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__" ></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC_LOCAL__/Js/ueditor/ueditor.config.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC_LOCAL__/Js/ueditor/ueditor.all.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jsScroll.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jscolor/jscolor.js?v=__VR__"></script>
<style type="text/css">
	.subconRight.Gform { width: 550px;}
	.Gform .Ginput .txtTips { width: 318px; text-align: justify;}
</style>
<script>
var clickMb1 = function(e) {
    var order = $(this).children("img").attr("data-order");
    $(".bg_sel_"+order+" .mb1").removeClass("current");
    $(this).addClass("current");
    var bgimg = $(this).children("img").attr("src");
    $(".box-"+order+" .cardCon").css("background-image","url(" + bgimg + ")");
    $('#cardForm-'+order+' #bg_img').val(bgimg);
    var index = $(this).index() + 1;
	$('#cardForm-'+order+' #bg_style').val(index);
}
$(function(){
	$("#tp1 .mb1").click(function(e) {
        var idV = $(this).attr('id');
        var id = idV.substr(2, 1);
        var order = idV.substr(-1);
        $(".page_sel_"+order+" .mb1").removeClass("current");
        $(this).addClass("current");
		$('#cardForm-'+order+' #template').val(id);
    });	
	$("#tp2 .mb1").click(clickMb1);
	
	$("#mb1-1").click(function(e) {
		$(".box-1 .cardCon").fadeOut(0);
		$(".box-1 .cardCon").removeClass("selected");
        $("#cardCon-1-1").fadeIn(0);
		$("#cardCon-1-1").addClass("selected");
    });
	$("#mb2-1").click(function(e) {
		$(".box-1 .cardCon").fadeOut(0);
		$(".box-1 .cardCon").removeClass("selected");
        $("#cardCon-1-2").fadeIn(0);
		$("#cardCon-1-2").addClass("selected");
    });
	$("#mb3-1").click(function(e) {
		$(".box-1 .cardCon").fadeOut(0);
		$(".box-1 .cardCon").removeClass("selected");
        $("#cardCon-1-3").fadeIn(0);
		$("#cardCon-1-3").addClass("selected");
    });
    
    
	$("#mb1-2").click(function(e) {
		$(".box-2 .cardCon").fadeOut(0);
		$(".box-2 .cardCon").removeClass("selected");
        $("#cardCon-2-1").fadeIn(0);
		$("#cardCon-2-1").addClass("selected");
    });
	$("#mb2-2").click(function(e) {
		$(".box-2 .cardCon").fadeOut(0);
		$(".box-2 .cardCon").removeClass("selected");
        $("#cardCon-2-2").fadeIn(0);
		$("#cardCon-2-2").addClass("selected");
    });
	$("#mb3-2").click(function(e) {
		$(".box-2 .cardCon").fadeOut(0);
		$(".box-2 .cardCon").removeClass("selected");
        $("#cardCon-2-3").fadeIn(0);
		$("#cardCon-2-3").addClass("selected");
    });
    
    
	$("#mb1-3").click(function(e) {
		$(".box-3 .cardCon").fadeOut(0);
		$(".box-3 .cardCon").removeClass("selected");
        $("#cardCon-3-1").fadeIn(0);
		$("#cardCon-3-1").addClass("selected");
    });
	$("#mb2-3").click(function(e) {
		$(".box-3 .cardCon").fadeOut(0);
		$(".box-3 .cardCon").removeClass("selected");
        $("#cardCon-3-2").fadeIn(0);
		$("#cardCon-3-2").addClass("selected");
    });
	$("#mb3-3").click(function(e) {
		$(".box-3 .cardCon").fadeOut(0);
		$(".box-3 .cardCon").removeClass("selected");
        $("#cardCon-3-3").fadeIn(0);
		$("#cardCon-3-3").addClass("selected");
    });
    
    
	$("#mb1-4").click(function(e) {
		$(".box-4 .cardCon").fadeOut(0);
		$(".box-4 .cardCon").removeClass("selected");
        $("#cardCon-4-1").fadeIn(0);
		$("#cardCon-4-1").addClass("selected");
    });
	$("#mb2-4").click(function(e) {
		$(".box-4 .cardCon").fadeOut(0);
		$(".box-4 .cardCon").removeClass("selected");
        $("#cardCon-4-2").fadeIn(0);
		$("#cardCon-4-2").addClass("selected");
    });
	$("#mb3-4").click(function(e) {
		$(".box-4 .cardCon").fadeOut(0);
		$(".box-4 .cardCon").removeClass("selected");
        $("#cardCon-4-3").fadeIn(0);
		$("#cardCon-4-3").addClass("selected");
    });
    
    
	$("#mb1-5").click(function(e) {
		$(".box-5 .cardCon").fadeOut(0);
		$(".box-5 .cardCon").removeClass("selected");
        $("#cardCon-5-1").fadeIn(0);
		$("#cardCon-5-1").addClass("selected");
    });
	$("#mb2-5").click(function(e) {
		$(".box-5 .cardCon").fadeOut(0);
		$(".box-5 .cardCon").removeClass("selected");
        $("#cardCon-5-2").fadeIn(0);
		$("#cardCon-5-2").addClass("selected");
    });
	$("#mb3-5").click(function(e) {
		$(".box-5 .cardCon").fadeOut(0);
		$(".box-5 .cardCon").removeClass("selected");
        $("#cardCon-5-3").fadeIn(0);
		$("#cardCon-5-3").addClass("selected");
    });
	
	$(".cardBox").eq(0).addClass("active");
	$(".cardBox").click(function(){
		var _this = $(this).index();
		$(".cardBox").removeClass("active");
		$(this).addClass("active");
		$(".cardForm").fadeOut(0);
		$(".cardForm").eq(_this).fadeIn(0);
		$(".cardForm").eq(_this).find("input:first-child").focus();
	});
    $("textarea[name^='equity']").each(function(index){
        UE.getEditor('equity'+(index+1),{
            imageUrl:"{:U('LabelAdmin/Upfile/editoImageSave')}",
            imagePath:"__UPLOAD__",
            catcherUrl:"{:U('LabelAdmin/Upfile/getRemoteImage')}",
            catcherPath:"__UPLOAD__",
            initialFrameWidth:340,
            initialFrameHeight:280
        });
    });
    
    $(".sub").click(function() {
        var ue = UE.getEditor('equity'+1,{
            imageUrl:"{:U('LabelAdmin/Upfile/editoImageSave')}",
            imagePath:"__UPLOAD__",
            catcherUrl:"{:U('LabelAdmin/Upfile/getRemoteImage')}",
            catcherPath:"__UPLOAD__",
            initialFrameWidth:340,
            initialFrameHeight:280
        });
        var num = $(this).attr("data-f");
        if(!ue.getContent()){
            $('#equity_tip').validationEngine('showPrompt', '不能为空','error','topRight',true);
            return false;
        }else{
            $('#equity_tip').validationEngine('hide');
        }
        if($("#cardForm-"+num).validationEngine('validate')){
            $("#cardForm-"+num).ajaxSubmit({
                beforeSubmit:function(){
                    dialog = art.dialog({title:false,content:"<div class='msg-all-succeed'>正在提交...</div>",fixed: true,padding:0});
                },
                success:function(data){
                    if (data.status == '1'){
                        dialog.close();
                        window.location.reload();
                    } else {
                        dialog.time(2).content("<div class='msg-all-error'>"+data.info+"</div>");
                    }
                },
                url:"{:U('Wmember/Member/mCardAdd')}",
                dataType:'json'
            });
        }
        // return false;
    });
});
var add_order = 1;
function add(order)
{
    add_order = order;
    var opt = {
        cropPresets:'640x340',
        callback:uploadCallback
    };
    open_img_uploader(opt);
 }
function uploadCallback(data){
    //显示预览
    if ($('.bg_sel_'+add_order+' .Ginput .mb1').length == 3) {
        $('.bg_sel_'+add_order+' .Ginput .mb1:eq(2)').after('<div class="mb1 fl"><img src="'+data.src+'" data-order="'+add_order+'" width="100"></div>');
    } else {
        $('.bg_sel_'+add_order+' .Ginput .mb1:eq(3)').replaceWith('<div class="mb1 fl"><img src="'+data.src+'" data-order="'+add_order+'" width="100"></div>');
    }
    $(".bg_sel_"+add_order+" .mb1").click(clickMb1);
    $('.bg_sel_'+add_order+' .mb1:eq(3)').click();
}

</script>
</head>
<body>
<div id="wrapper">
    <include file="./Home/Tpl/Public/Public_header.html" />
	<div class="container">
        <div class="" id="container">
        	<div class="rel" id="main">
        		<include file="Wmember/Member/leftMenu" leftmenuid="hyk" />
        		<div class="subcon fn">
                	<div class="main-name fn">
                    <h4>会员卡</h4>
                    </div>
                    <div class="tipNormal mb15"><i></i>系统默认为您创建1张会员卡，请完善相关信息。最多创建5张会员卡。</div>
                    <div class="fn member-management">
                    	<div class="subconLeft l">
                    		<volist name="list" id="vo">
                                <div class="cardBox box-{$vo.order}">
                                    <div class="cardCon cardCon-one <neq name='vo.page_style' value='1'>dn</neq>" style="<eq name='vo.page_style' value='1'>display:block;</eq> background-image:url({$vo.bg_pic})" id="cardCon-{$vo.order}-1">
                                    <div class="user-name fn"><img src="{$vo.node_logo}" class="photo" /><p><span class="name">张三</span><span class="phone">13554254786</span></p><img src="__PUBLIC__/Image/{$card_code}" class="code" /></div>
                                    <div class="user-id fn"><p style="float:right;"><span class="cardType" id="cardN{$vo.order}">{$vo.card_name}</span><span class="cardId">9999 9999</span></p></div>
                                    </div>
                                    <div class="cardCon cardCon-two <neq name='vo.page_style' value='2'>dn</neq>" style="<eq name='vo.page_style' value='2'>display:block;</eq> background-image:url({$vo.bg_pic})" id="cardCon-{$vo.order}-2">
                                        <div class="user-name fn"><img src="{$vo.node_logo}" class="photo" /><p><span class="name">张三</span><span class="phone">13554254786</span></p></div>
                                        <div class="user-id fn"><img src="__PUBLIC__/Image/{$card_code}" class="code" /><p><span class="cardType" id="cardN{$vo.order}">{$vo.card_name}</span><span class="cardId">9999 9999</span></p></div>
                                    </div>
                                    <div class="cardCon cardCon-three <neq name='vo.page_style' value='3'>dn</neq>" style="<eq name='vo.page_style' value='3'>display:block;</eq> background-image:url({$vo.bg_pic})" id="cardCon-{$vo.order}-3">
                                        <div class="user-name fn"><img src="{$vo.node_logo}" class="photo" /><p><span class="name">张三</span><span class="phone">13554254786</span></p><img src="__PUBLIC__/Image/{$card_code}" class="code" /></div>
                                        <div class="user-id fn"><p style="float:left;"><span class="cardType" id="cardN{$vo.order}">{$vo.card_name}</span><span class="cardId">9999 9999</span></p></div>
                                    </div>
                                    <div class="operation fn"><a href="javascript:void(0);" class="edit" data-e="{$vo.order}"><i></i></a></div>
                                </div>
                            </volist>
                            <if condition="$card_num lt 5">
                    		  <div class="cardAdd"><a href="{:U('addMemberCard')}" class="cardAdd-btn">+添加会员卡</a></div>
                            </if>
                    	</div>
                    	<div class="subconRight l Gform">
                            <volist name="list" id="vo">
                                <form method="POST" action="" id="cardForm-{$vo.order}" class="cardForm">
                                    <input type="hidden" id="card_id" name="card_id" value="{$vo.id}" />
                                    <input type="hidden" id="sub_type" name="sub_type" value="1" />
                                    <input type="hidden" id="template" name="template" value='{$vo.page_style}' />
                                    <input type="hidden" id="bg_img" name="bg_img" value='{$vo.bg_pic}' />
                                    <input type="hidden" id="bg_style" name="bg_style" value='{$vo.bg_style}' />
                                    <input type="hidden" id="equity_type" name="equity_type" value="{$vo.order}" />
                                    <div class="Wcanal-tab" id="Wcanal-tabon">
                                        <div class="main-name fn">
                                            <h4>{$vo.card_name}<eq name='vo.order' value='1'> （默认）</eq></h4>
                                        </div>
                                        <ul class="h3">基础信息</ul>
                                        <div class="eTicket_form">
                                            <div id="Wform" class="Gform eTicket" style="margin: 0;width: 100%;">
                                                <ul>
                                                    <li class="Gname">会员卡名称</li>
                                                    <li class="Ginput"><input name="card_name" id="card_name" type="text" onkeyup="check_lenght(5,'name_text',this);" class="validate[required,maxSize[5] textbox w380" maxlength="5" placeholder="" value="{$vo.card_name}"/>
                                                    <eq name='vo.order' value='1'>
                                                    <span class="txtTips">参与营销活动、在线上商城购物、线下条码支付付款的消费者，会自动成为该会员卡成员</span>
                                                    </eq>
                                                    </li>
                                                </ul>

                                                <!-- <div class="steps mt20">商户信息</div>
                                                <ul>
                                                    <li class="Gname">商户名称</li>
                                                    <li class="Ginput">
                                                        <input type="text" maxlength="8" class="Gview-text validate[required]" value="{$vo.node_name}" id="node_name" name="node_name">
                                                    </li>
                                                </ul>
                                                
                                                <ul>
                                                    <li class="Gname">商户logo</li>
                                                    <li class="Ginput">
                                                        <div class="Gchoose Gview-img">
                                                            <input type="text" value="{$vo.node_logo}" id="node_logo" name="node_logo">
                                                            <a href="javascript:void(0)" class="Gbtn-pic" title="选择图片" data-rel="{width:160,height:160}"><i></i></a>
                                                        <div class="Gchoose-opr an" style="display: none;"><div class="Gchoose-opr-img"><img src="{$vo.node_logo}" style="width:100px;"></div><div class="Gchoose-opr-opr"><a href="javascript:void(0)" class="Gchoose-opr-edit"></a><a href="javascript:void(0)" class="Gchoose-opr-del"></a></div><span class="Gchoose-opr-jt"></span></div><div class="Gchoose-oprbg"></div></div>
                                                    </li>
                                                </ul> -->
                                                <ul class="h3 mt20">会员卡设计</ul>
                                                <ul id="tp1" class="page_sel_{$vo.order}">
                                                    <li class="Gname">会员卡风格</li>
                                                    <li class="Ginput">
                                                       <div class="mb1 fl <eq name='vo.page_style' value='1'>current</eq>" id="mb1-{$vo.order}"><img src="__PUBLIC__/Image/Whygl/mb_1.png" width="100"></div>
                                                       <div class="mb1 fl <eq name='vo.page_style' value='2'>current</eq>" id="mb2-{$vo.order}"><img src="__PUBLIC__/Image/Whygl/mb_2.png" width="100"></div>
                                                       <div class="mb1 fl <eq name='vo.page_style' value='3'>current</eq>" id="mb3-{$vo.order}"><img src="__PUBLIC__/Image/Whygl/mb_3.png" width="100"></div>
                                                    </li>
                                                </ul>
                                                
                                                <ul id="tp2" class="bg_sel_{$vo.order}">
                                                    <li class="Gname">会员卡背景图</li>
                                                    <li class="Ginput">
                                                        <div class="fn">
                                                            <div class="mb1 fl <eq name='vo.bg_style' value='1'>current</eq>"><img src="__PUBLIC__/Image/Whygl/mb_top_bg1.png" data-order="{$vo.order}" width="100"></div>
                                                            <div class="mb1 fl <eq name='vo.bg_style' value='2'>current</eq>"><img src="__PUBLIC__/Image/Whygl/mb_top_bg2.png" data-order="{$vo.order}" width="100"></div>
                                                            <div class="mb1 fl <eq name='vo.bg_style' value='3'>current</eq>"><img src="__PUBLIC__/Image/Whygl/mb_top_bg3.png" data-order="{$vo.order}" width="100"></div>
                                                            <eq name="vo.bg_style" value="4">
                                                                <div class="mb1 fl current"><img src="{$vo.bg_pic}" data-order="{$vo.order}" width="100"></div>
                                                            </eq>
                                                        </div>
                                                        <div class="add_set_bg" onclick="add({$vo.order})">+上传</div> 
                                                    </li>
                                                </ul>
                                                
                                                <ul>
                                                    <li class="Gname">权益说明</li>
                                                    <li class="Ginput" id="equity_tip">
                                                        <!-- <textarea id="equity" name="equity" onkeyup="check_lenght(50,'name_text',this);" class="validate[required,minSize[4],maxSize[50]] textbox w380" placeholder="将在会员中心我的权益中显示">{$vo.equity}</textarea> -->
                                                        <textarea name="equity{$vo.order}" id="equity{$vo.order}">{$vo.equity}</textarea>
                                                        <span class="txtTips">将在会员中心我的权益中显示</span>
                                                    </li>
                                                </ul>
                                                
                                                <ul>
                                                    <li class="Gname">小票打印内容</li>
                                                    <li class="Ginput"><textarea id="receipt" name="receipt" onkeyup="check_lenght(50,'name_text',this);" class="validate[required,minSize[4],maxSize[50]] textbox w380" placeholder="使用带打印机的终端扫描会员卡二维码，打印此内容">{$vo.receipt}</textarea>
                                                    </li>
                                                </ul>
                                                <ul>
                                                    <li class="Gname"></li>
                                                    <li class="Ginput mt5">
                                                    <a href="javascript:void(0);" title="确认" data-f="{$vo.order}" class="btn-all w110 sub">确定</a>
                                                    <a href="javascript:history.go(-1);" title="取消" id="reset" class="btn-all-del w110 ml10">取消</a>
                                                    </li>
                                                </ul> 
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </volist>
                    	</div>
                    </div>
                </div>
            </div>
        </div>

        <include file="./Home/Tpl/Public/Public_footer.html" /> 
    </div>
</div>
<div class="service"></div>
</body>
</html>