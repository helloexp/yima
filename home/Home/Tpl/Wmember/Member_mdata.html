<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>会员管理-会员数据统计</title>
<meta name="Keywords" content="{:C('SITE_KEYWORDS')}" />
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wcanal.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wnumgoods.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Waccount.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wshop.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/WE_ticket.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wmember.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css?v=__VR__" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/Wcanal.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/highcharts.js"></script>
<script type="text/javascript" src="__PUBLIC__/Js/My97DatePicker/WdatePicker.js?v=20150603"></script>

<script type="text/javascript" src="__PUBLIC__/Js/Wmember_raphael-min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Js/Wmember_chinaMapConfig.js"></script>
<script type="text/javascript" src="__PUBLIC__/Js/Wmember_map.js"></script>
<style type="text/css">
	.member_data_summery .data-box .down { width:100%;}
	.Gform.eTicket { width: 312px;}
</style>
<script>
$(function () {
	Highcharts.setOptions({
        colors: ['#54a8f9', '#68bc36', '#f4da28']
    });

	/*会员整体数据统计*/
    $('#report1').highcharts({
        chart: {
                type: 'line'
            },
        title: {
            text: ''
        },
        
        subtitle: {
                text: ''
            },
           xAxis: {
           categories:[{$xydata['ydata']}],
           labels: {
                    rotation: -30,
                    align: 'right'
               }

       },
       yAxis: {
                title: {
                    text: ''
                },
                min: 0
            },
       
        series: [
            {
                name: '新增会员数',
                data: [{$xydata.xdata12}]
            },
            // {
            //     name: '活动参与次数',
            //     data: [{$xydata.xdata11}]
            // }
        ]
    });

   //  $('#report1').highcharts({
   //      title: {
   //          text: '',
   //          x: 0 //center
   //      },
   //      subtitle: {
   //          text: '',
   //          x: 0
   //      },
   //      xAxis: { categories: [{$xydata['ydata']}]},
   //      yAxis: [{
   //          title: {
   //              text: ''
   //          },
   //         labels:{
			// 	style:{
			// 		color:Highcharts.getOptions().colors[0]
			// 	}
   //              },
   //          allowDecimals:false,
   //          min:0,
   //          plotLines: [{
   //              value: 0,
   //              width: 1,
   //              color: '#808080'
   //          }]
   //      },
   //      {
   //          title: {
   //              text: ''
   //          },
   //          labels:{
			// 	style:{
			// 		color:Highcharts.getOptions().colors[1]
			// 	}
   //              },
   //          allowDecimals:false,
   //          min:0,
   //          plotLines: [{
   //              value: 0,
   //              width: 1,
   //              color: '#808080'
   //          }]
   //      },{
   //          title: {
   //          text: ''
   //      },
   //      labels:{
			// style:{
			// 	color:Highcharts.getOptions().colors[2]
			// }
   //          },
   //      allowDecimals:false,
   //      min:0,
   //      plotLines: [{
   //          value: 0,
   //          width: 1,
   //          color: '#808080'
   //      }]
   //  }],
   //      legend: {
   //          layout: 'horizontal',
   //          align: 'center',
   //          borderWidth: 0,
			// symbolWidth: 14
   //      },
   //        series: [{
   //          name: '活动参与次数',
   //          data: [{$xydata.xdata11}],
   //          yAxis: 0,
			// marker: {                                                     
   //          	lineWidth: 2,                                               
   //          	lineColor: Highcharts.getOptions().colors[0],               
   //          	fillColor: 'white'                                          
   //          }
   //      }, /*{
   //          name: '总会员数',
   //          data: [{$xydata.xdata13}],
   //          yAxis: 1,
			// marker: {                                                     
   //          	lineWidth: 2,                                               
   //          	lineColor: Highcharts.getOptions().colors[1],               
   //          	fillColor: 'white',  
			// 	symbol: 'circle'                                     
   //          }    
   //      }, */{
   //          name: '新增会员数',
   //          data: [{$xydata.xdata12}],
   //          yAxis: 2,
			// marker: {                                                     
   //          	lineWidth: 2,                                               
   //          	lineColor: Highcharts.getOptions().colors[2],               
   //          	fillColor: 'white',
			// 	symbol: 'circle'                                         
   //          }    
   //      }]})
	//会员渠道分析
	$('#report3').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false
        },
        title: {
            text: ''
        },
        tooltip: {
    	    pointFormat: '{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: false,
                    color: '#000000',
                    connectorColor: '#000000',
                    format: '{point.percentage:.1f} %'
                }
            }
        },
        series: [{
            type: 'pie',
            name: '',
            data: [
                   <volist name="chainal[1]" id="v">
					['{$v['tname']}',{$v['c']*100}/{$chainal[0]}],
                   </volist>
            ]
        }]
    });
});
				
</script>
<style type="text/css">
.filter input{
	/**
	 * .filter > input 直接子元素
	 */
	cursor: pointer;
	
}
.stateTip, #StateTip{display:none; position:absolute; padding:8px; background:#fff; border:2px solid #2385B1; -moz-border-radius: 4px; -webkit-border-radius: 4px; border-radius: 4px; font-size:12px; font-family:Tahoma; color:#333;}

.mapInfo i{ display:inline-block; width:15px; height:15px; margin-top:5px; line-height:15px; font-style:normal; background:#aeaeae; color:#fff; font-size:11px; font-family: Tahoma; -webkit-border-radius:15px; border-radius:15px; text-align:center}
.mapInfo i.active{background:#E27F21;}
.mapInfo span{ padding:0 5px 0 3px;}
.mapInfo{width:135px;}
.shopTable td{text-align:left !important}
.Gform .Ginput .Gtime1 em:before { top: 3px; left: -23px;}
#msdate,#mndate,#csdate,#cndate { width: 136px; padding-right: 0;}
</style>
<script>
$(function(){
   var data = {$citydata};
    var mapObj_1 = {};
$('#ChinaMap4').SVGMap({
        external: mapObj_1,
        mapName: 'china',
        stateData: data,
        // stateTipY: 0,
		stateTipHtml: function (mapData, obj) { 
			var _value = mapData[obj.id].value; 
            var _str='';
            if(_value!=null && _value.allsum!=0)  
            _str+='现有会员:'+_value.allsum;
            else 
             _str+='现有会员:0'; 

			var tipStr = '<div class="mapInfo"><span style="display:inline-block;color:red">' + obj.name + '</span><span style="display:inline-block">' + _str + '</span></div>';
			return tipStr;
		},
        clickCallback: function(mapData, obj){
                var _value = mapData[obj.id].value;  
                $('#ckcity').text(obj.name);
                 if(_value!=null && _value.allsum!=0)  
                    $('#ckall strong').text(_value.allsum);
                else  $('#ckall strong').text(0) ;

       }
});
})

</script>
<style>
.member_data_summery .data .data-box{ width:19.9%; height:60px;}
.redo_data .data .data-box{float:left;height: 44px; width:105px; border-right:1px #cccccc dashed; text-align:center}
.redo_data .data-box:last-child{border-right:0px #cccccc dashed}
.no5 {  background-position: -60px -800px;}
.data_show .show .table .shopTable th { background: #f7f7f7; color: #333333;}
.data_show .show .shopTable tr.title { background: #ffffff;}
</style>
<script type="text/javascript">
function jump(input,value){
		if(value==4){
				if(input=='mtype'){
					if($('input[id=msdate]').val()==''||$('input[id=mndate]').val()==''){
						alert('请选择完整的时间区域');return false;
					}
				}
			    else if(input=='ctype'){
				    	if($('input[id=csdate]').val()==''||$('input[id=cndate]').val()=='')
				    	{
							alert('请选择完整的时间区域');
							return false;
				    	}
			    }
		} 
		$('input[name='+input+']').val(value);
		$('form').submit();  
		 
}
</script>
</head>
<body>
    <div id="wrapper"> 
        <include file="./Home/Tpl/Public/Public_header.html" />

        <div id="container" class="bgfff"> 
            <div id="main" class="rel"> 
                <include file="Wmember/Member/leftMenu" leftmenuid="hysjtj"/> 
                <div class="subcon fn">
                <form action="{:U('Member/mdata')}" method="post">
                	<input name="mtype"  value="{$data.mtype|default=1}" type="hidden"/>
                	<input name="ctype"  value="{$data.ctype|default=1}" type="hidden"/>
                	<div class="main-name fn">
                        <h4>会员数据统计</h4>
                    </div>
                    
 			<div class="member_data_summery">
                    <div class="data mb35 fn" style="padding: 15px 0px;">
                            <div class="data-box">
                                <p class="up">
                                    <i class="icon1 mr5"></i>
                            	        <span>
										 <if condition="$member_stat['total_num'] gt 0">
		                                    {$member_stat['total_num']}
		                                    <else/>
		                                    0
                                          </if>
								</span>
                                </p>
                                <!-- <p class="compareUp mt10">
                                    <i class="icon1 mr5"></i>
                                    <span>&nbsp;</span>
                                </p> -->
                                <p class="down mt10">会员总数</p>
                            </div>
                            <div class="data-box">
                                <p class="up">
                                    <i class="icon2 mr5"></i>
                                    <span>
                                     <if condition="$member_stat['add_num'] gt 0">
		                                    {$member_stat['add_num']}
		                                    <else/>
		                                    0
                                          </if></span>
                                </p>
                                <!-- <p class="compareUp mt10">
                                    <i class="icon1 mr5"></i>
                                    <span>&nbsp;</span>
                                </p> -->
                                <p class="down mt10">昨日新增会员</p>
                            </div>
                            
                            <div class="data-box">
                                <p class="up">
                                    <i class="icon1 mr5"></i>
                                    <span>
											<if condition="$totaldata['join_cnt'] gt 0">
		                                    {$totaldata['join_cnt']}
		                                    <else/>
		                                    0
                                            </if>

									</span>
                                </p>
                                <!-- <p class="compareUp mt10">
                                    <i class="icon1 mr5"></i>
                                    <span>昨天+
                                         <if condition="$newdata['join_cnt'] gt 0">
		                                    {$newdata['join_cnt']}
		                                    <else/>
		                                    0
                                            </if>
                                          </span>
                                </p> -->
                                <p class="down mt10">活动参与次数</p>
                            </div>
                            <div class="data-box">
                                <p class="up">
                                    <i class="icon2 mr5"></i>
                                    <span>
										<if condition="$totaldata['send_cnt'] gt 0">
		                                    {$totaldata['send_cnt']}
		                                    <else/>
		                                    0
                                            </if>	
	
									</span>
                                </p>
                                <!-- <p class="compareUp mt10">
                                    <i class="icon1 mr5"></i>
                                    <span>昨天+  
                                    <if condition="$newdata['send_cnt'] gt 0">
		                                    {$newdata['send_cnt']}
		                                    <else/>
		                                    0
                                            </if>
                                    
                                    </span>
                                </p> -->
                                <p class="down mt10">发码量</p>
                            </div>
                            <div class="data-box">
                                <p class="up">
                                    <i class="icon2 mr5"></i>
                                    <span>
										 <if condition="$totaldata['verify_cnt'] gt 0">
		                                    {$totaldata['verify_cnt']}
		                                    <else/>
		                                    0
                                            </if>
										
										</span>
                                </p>
                                <!-- <p class="compareUp mt10">
                                    <i class="icon1 mr5"></i>
                                    <span>昨天+ <if condition="$newdata['verify_cnt'] gt 0">
		                                    {$newdata['verify_cnt']}
		                                    <else/>
		                                    0
                                            </if></span>
                                </p> -->
                                <p class="down mt10">验码量</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="main-name fn">
                        <h4>会员整体数据统计
                        <a href="{:U('Member/download',array('downtype'=>1,'mtype'=>$data['mtype'],'ndate'=>$data['date']['mndate'],'sdate'=>$data['date']['msdate']))}" class="btn-down first">
                        			<i></i>下载活动数据 
                        </a>
                        </h4>
                    </div>
                    <div class="data_show">
                    	<div class="filter">
                        	<dl class="martix1 l">
                                <dd <if condition="$data.mtype eq 1"> class="current"</if>>
                                <input type="button"  onclick="jump('mtype',1)" value="最近7日" /></dd>
                                <dd  <if condition="$data.mtype eq 2"> class="current"</if>><input type="button"  onclick="jump('mtype',2)" value="最近30日"/></dd>
                                <dd  <if condition="$data.mtype eq 3"> class="current"</if>><input type="button" onclick="jump('mtype',3)" value="最近一年"/></dd>
                            </dl>
                            
                            <dl class="martix2">
                            	<dd>时间区域</dd>
                                <dd>
                                    <ul class=" Gform eTicket">
                                        <li class="Ginput">
                                            <div class="Gtime1 fn l">
                                            <input type="text" id='msdate' class="validate[required]" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" name="sdate[]" value="{$data.date.msdate}">
                                            <em></em>
                                            </div>
                                            <div class="Gtime2 noIcon">
                                                <em style="border-left:0">至</em>
                                            </div>
                                            <div class="Gtime1 fn l">
                                            <input id='mndate' type="text" class="validate[required]" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" name="ndate[]" value="{$data.date.mndate}" style="width:136px;">
                                            <em></em>
                                            </div>
                        </li>
                                    </ul>
                                </dd>
                                <dd><input type="button" onclick="jump('mtype',4)" class="btn_inner" value="查询"/></dd>
                            </dl>
                        </div>
                        <div class="show" style="width:100%;">
                        	<div class="graph" style="width:100%;">
                           	  <!-- <div id="report1" style="  height:300px;"></div> -->
                                <div id="report1" style="height: 300px; margin: 0 auto"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="main-name fn">
                        <h4>会员属性分析
                       <a href="{:U('Member/download',array('downtype'=>2))}" class="btn-down first">
                    		   <i></i>下载活动数据 
                    		   </a>
                        </h4>
                    </div>
                    <div class="data_show">
                        <div class="show">
                        	<div class="graph">
                           	  <!--<div id="report2" style="width:540px; height:300px;"></div>-->
                              <div class="skillbar clearfix " data-percent="{$sex_data['msex']*100}%">
                                  <div class="skillbar-bar"></div>
                              </div>
                              <script>
                              	jQuery(document).ready(function(){
									jQuery('.skillbar').each(function(){
										jQuery(this).find('.skillbar-bar').animate({
											width:jQuery(this).attr('data-percent')
										},100);
									});
								});
                              </script>
                            </div>
                            <div class="table" >
                                <table class="shopTable" cellspacing="0" cellpadding="0">
                                	<tbody>
                                    <tr class="th">
                                        <th colspan="2">会员属性分析</th>
                                    </tr>
                                    <tr class="title">
                                        <td>男会员</td>
                                        <td>{$sex_data['msex']*100}%</td>
                                    </tr>
                                    <tr class="title">
                                        <td>女会员</td>
                                        <td>{$sex_data['wsex']*100}%</td>
                                    </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                    
                    <div class="main-name fn">
                        <h4>会员地域分析
                       <a href="{:U('Member/download',array('downtype'=>3))}" class="btn-down first">
                        		<i></i>下载活动数据
                        </a>
                        </h4>
                    </div>
                    <div class="data_show">
                    	<div class="filter"></div>
                        <div class="show">
                        	<div class="graph"><div id="ChinaMap4"></div></div>
                            <div class="table">
                                <table class="shopTable" cellspacing="0" cellpadding="0">
                                	<tbody>
                                    <tr class="th">
                                        <th colspan="2">会员地域分布图</th>
                                    </tr>
                                    <!-- <tr class="title" style="border-top:0">
                                        <td id='ckcity' colspan="2" style="text-align: center !important;" align="center">{$citylist[$firstactivy['province_code']]|default="其他"}</td>
                                    </tr> -->
                                    <tr class="title">
                                        <td>
                                        <p style="text-align: center;">现有会员</p>
                                        <p id='ckall' style="text-align: center;"><strong> 
                                        <if condition="$firstactivy['allsum'] gt 0">{$member_sum}<else/>0</if>
                                        </strong></p>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <table class="shopTable" cellspacing="0" cellpadding="0">
                                <tbody>
                                <tr class="title">
                                    <td>省份</td>
                                    <td>现有会员</td> 
                                </tr>
                                <volist name='memberactivy' id='v' offset='0' length='6'>
	                                <tr class="title">
	                                    <td>
	                                    <if condition="array_key_exists($v['province_code'],$citylist)">
	                                    {$citylist[$v['province_code']]}
	                                    <else/>
	                             			       其他
	                                    </if>
	                                    </td>
	                                    <td>  <if condition="$v['allsum'] gt 0">{$v['allsum']}<else/>0</if></td> 
	                                </tr>
                                </volist>
                                </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                    
                    <div class="main-name fn">
                        <h4>会员渠道分析
                               <a href="{:U('Member/download',array('downtype'=>4,'mtype'=>$data['ctype'],'ndate'=>$data['date']['cndate'],'sdate'=>$data['date']['csdate']))}" class="btn-down first">
                        		<i></i>下载活动数据
                        		</a>
                        </h4>
                    </div>
                    <div class="data_show">
                    	<div class="filter">
                        	<dl class="martix1 l">
                                <dd <if condition="$data.ctype eq 1"> class="current"</if>>
								<input type="button"  onclick="jump('ctype',1)" value="最近7日" />
								  </dd>
                                <dd <if condition="$data.ctype eq 2"> class="current"</if>><input type="button"  onclick="jump('ctype',2)" value="最近30日" /></dd>
                                <dd <if condition="$data.ctype eq 3"> class="current"</if>><input type="button"  onclick="jump('ctype',3)" value="最近一年" /></dd>
                            </dl>
                            
                            <dl class="martix2">
                            	<dd>时间区域</dd>
                                <dd>
                                    <ul class=" Gform eTicket">
                                        <li class="Ginput">
                                            <div class="Gtime1 fn l">
                                            <input type="text"  id='csdate' name="sdate[]" value="{$data.date.csdate}"  class="validate[required]" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})"   >
                                            <em></em>
                                            </div>
                                            <div class="Gtime2 noIcon">
                                                <em style="border-left:0">至</em>
                                            </div>
                                            <div class="Gtime1 fn l">
                                            <input type="text" id='cndate' name="ndate[]" value="{$data.date.cndate}"  class="validate[required]" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})"   style="width:136px;">
                                            <em></em>
                                            </div>
                        </li>
                                    </ul>
                                </dd>
                                <dd><input type="button" onclick="jump('ctype',4)" class="btn_inner" value="查询"></dd>
                            </dl>
                        </div>
                        <div class="show">
                        	<div class="graph"><div id="report3" style="width:540px; height:300px;"></div></div>
                            <div class="table" style="max-height:500px; border-top: solid 1px #e3e2e2; border-bottom: solid 1px #e3e2e2; overflow-y:auto;overflow-x:hidden; SCROLLBAR-TRACK-COLOR:#F8F4F4;padding: 0">
                                <table class="shopTable" cellspacing="0" cellpadding="0" style="text-align: left;">
                                	<tbody>
                                    <tr class="th">
                                        <th colspan="2" style=" border-top: solid 0px #e3e2e2;">会员渠道数据</th>
                                    </tr>
                                    
                              <volist name="chainal[1]" id="v">
									 <tr class="title">
                                        <td>{$v[tname]}</td>
                                        <td>{:round($v[c]*100/$chainal[0],4)}%</td>
                                    </tr>
			                   </volist>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
   					 </form>                
                </div>
            </div>
        </div>
		<include file="./Home/Tpl/Public/Public_footer.html" /> 
    </div>
    <div class="service"></div>
</body>
</html>