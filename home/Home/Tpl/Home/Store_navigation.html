<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>门店管理-设置门店导航</title>
<meta name="Keywords" content="{:C('SITE_KEYWORDS')}" />
<link href="__PUBLIC__/Css/main.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/layout.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/module.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wcanal.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wnumgoods.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Waccount.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wshop.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Css/Wshopconfig.css?v=__VR__" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css?v=__VR__" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/Wcanal.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/global.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/Js/artDialog4.1.6/plugins/iframeTools.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/citycode.js?v=__VR__"></script>
<style>
.extend{ text-align:right; padding-right:12px; padding-left:0;}
.shoplist{ height:113px;}
</style>
</head>
<body>
    <div id="wrapper"> 
    	<include file="./Home/Tpl/Public/Public_header.html" /> 
     
        <div id="container" class="bgfff"> 
            <div id="main" class="rel"> 
                <div class="new_sidenav">
                    <include file="Store:sidenav" leftmenuid="dhsz"/>             
                </div> 
                <div class="subcon fn">
                	<div class="main-name fn">
                        <h4>设置门店导航</h4>
                    </div>
                	<div class="tipNormal">
                        <dl>
                            <dd>门店导航可以为您的客户提供门店地址、电话信息列表，并自动搜索离客户最近的门店，一键导航到指定门店。<a href="javascript:void(0);" title="<img src='__PUBLIC__/Image/eshopconfig/shopCase.png'>"  class="js_case">门店导航案例</a>
                            </dd>
                            <dd>1、已定位过的门店才能加入门店导航。</dd>
                            <dd>2、如门店的定位数据不准确，请到门店列表中选择“导航定位”操作，调整门店在地图中的位置。</dd>
                        </dl>
                    </div>
                    <div class="SettingArea">
                        <div id="phone">
                            <div class="phonetop"></div>
                            <div id="phoneCon">
                                <div class="pContent editModel">
                                    <div class="content">
                                        <h1 class="Gshow-storeName">{$navigation[0]['node_name']}</h1>
                                        <div class="dn" id='dn'>
                                            <img src="__PUBLIC__/Image/noshop.png" />
                                        </div>
                                        <div class="db empty" id='emp'>
                                        	<img src="__PUBLIC__/Image/member/nodata2.gif" />
                                        	<p>您尚未添加可以导航的门店，<br />请在右侧添加门店后获取预览</p>
                                        </div>
                                    </div>
                                    <div class="mask">
                                        <a href="">
                                        <div class="editOpr">
                                            <i><img src="__PUBLIC__/Image/eshopconfig/shopCase.png"></i>
                                            扫码二维码预览<br />门店导航活动案例
                                        </div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="Gform l pl30">
                            <h3>基本设置</h3>
                            <ul class="first">
                                <li class="Gname"><span>*</span>页面标题</li>
                                <li class="Ginput">
                                    <input type="text" class="Gview-storeName" name="wep_title" id="wep_title" value="{$wap_title}" />
                                    <span class="txtTips">设置门店导航的页面标题</span>
                                </li>
                            </ul>
                            <ul>
                                <li class="Gname"><span>*</span>添加门店</li>
                                <li class="Ginput">
                                    <div class="switch">
                                        <input type="radio" value="1" checked="checked" id="checktype">
                                        <div class="newRadio">
                                            <span class="valfirst" data-val="0" id="getAllStores">所有门店</span>
                                            <span class="vallast" data-val="1" id="selectShop">指定门店</span>
                                        </div>
                                        <div class="cl fn"></div>
                                        <div class="newRadio-input">
                                            <div class="sweet_tips2" id="htmlss">您总共选择了<span id="number">{$opened_stores_count}</span>家门店&nbsp;&nbsp;<a href="javascript:void()" id="editStore"  name="choose_shop">点击查看</a></div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                            <h3 class="mt15">已添加门店（<span class="redfont">{$count}</span>）<span class="extend extendspan"><a href="javascript:void();" class='afblue js_extend_one'>查看全部<i></i></a></span></h3>
                            <div class="added">
                            <div class="notice" style="margin-bottom:0">点击门店名称，可将其从门店导航中移除。<i class="js_close"></i></div>
                            <div style="width:500px; overflow:hidden">
                                <ul class="shoplist n2" style="margin-right:-100px">
                                <?php foreach ($navigation as $key => $value):?>
                                    <li class="notCheck" title="{$value['province']} {$value['city']} {$value['town']}">
                                    {$value['store_short_name']}
                                    <input type="checkbox" name="storeCheckStatus[]" class="storeCheckStatus" value="{$value['store_id']}" style="display:none;" checked="checked">
                                    </li>
                                <?php endforeach;?>
                                </ul>
                                <div class="extend"><a href="javascript:void();" class='afblue js_extend_one'>查看全部<i></i></a></div>
                            </div>
                            </div>
                            	<input type="hidden" id="openStores" name="openStores" value="{$opened_stores}"/>
                            	<input type="hidden" id="closeStores" name="closeStores" value=""/>
                                <input type="hidden" id="notice" name="notice" value=""/>
                            <div class="tc btngp">
                            <a class="btn-all js_preview" href="javascript:void(0);">保存设置</a>
                            <a class="btn-all-del" href="{:U('LabelAdmin/BindChannel/index',array('batch_id'=>$batch_arr['batch_id'],'batch_type'=>'17'))}">发布到渠道</a>
                           </div>
                        </div>
                        <div class="cl fn"></div>
                    </div>
                </div>
            </div>
        </div>
		<include file="./Home/Tpl/Public/Public_footer.html" /> 
    </div>
    <div class="service"></div>
</body>
</html>
<script>
$(function(){
	$("#selectShop").click(function(e){
        //指定门店
		art.dialog.open("{:U('Home/Store/toActivity',array('type'=>9))}",{
			title: '选择门店',
			width:'800px'
		});
		//$(".newRadio-default").show();
	});
	
	$("#editStore").click(function(){
        //点击查看
        art.dialog.open("{:U('Home/Store/toActivity',array('type'=>9,'dingwei'=>1))}",{
            title: '选择门店',
            width:'800px'
        });
		/*art.dialog.open("{:U('Home/Store/toNavigation')}",{
			title: '选择门店',
			width:'800px'
		});*/
	});





	$(".js_case").hoverDelay(function() {
		$(".showCase").fadeIn();
	}, function() {
		$(".showCase").fadeOut();
	});
})
</script>

<script type="text/javascript">
    $(function(){
        var notice = "{$notice}";

        if(notice){
            $('.notice').remove();
        }
        $("body").on("click",".js_close",function(){
                $(this).parent().remove();
                $('#notice').val('true');
        })
    })
</script>

<script>
$(function(){
	if(($(".shoplist").height()<113)||($(".shoplist li").length<7)){
		$(".extend").hide();
	}
	
    var stores_is = '';
    var batch_arr = "{$batch_arr['batch_id']}";
    var isPopup   = "{$isPopup}";
    var countStores = "{$count}";

    if(countStores <= 0){
        $('#getAllStores').click();
        //$('#getAllStores').removeClass('hover');
	    //$("#selectShop").addClass('hover');
		//$("#checktype").val(1);
		//$(".newRadio-input").removeClass("newRadio-input").addClass("newRadio-default");
		
    }else
	{
		//$(".added").hide();
		
	}

    if(isPopup){
        showcod(batch_arr);
    }

    var isSee = parseInt($('.redfont').text());
    if(isSee > 0){
        $('#dn').removeClass('dn');
        $('#dn').addClass('db');
        $('#emp').removeClass('db empty');
        $('#emp').addClass('dn');
    }

	$(".frm_checkbox_label").click(function(){
		if ($(this).hasClass("selected"))
		{
			$(this).removeClass("selected");
			$(this).find(".frm_checkbox").attr("checked",false);
			$(".shoplist li").removeClass("selected");
			$(".notCheck").children(":checkbox").attr("checked",false);
		}else{
			$(this).removeClass("selected").addClass("selected");
			$(this).find(".frm_checkbox").attr("checked",true);
			$(".shoplist li").addClass("selected");
			$(".notCheck").children(":checkbox").attr("checked",'checked');
		}
	});	
	
	$(".shoplist li").hover(function(){
		$(this).addClass("hover");
		$(this).children("div.tip").show();
	},function(){
		$(this).removeClass("hover");
		$(this).children("div.tip").hide();
	});
	
	$(".js_extend_one").click(function(e) {
        var isactive = $(".js_extend_one i").hasClass("active");
		if(isactive){
			$(".js_extend_one i").removeClass("active");
			$(".shoplist").css("height","76px");
			$(".js_extend_one").html("查看全部<i></i>");
			
		}else
		{
			$(".shoplist").css("height","auto");
			$(".js_extend_one").html("收起<i></i>");
			$(".js_extend_one i").addClass("active");
			
		}
		if($(".shoplist").height()>300)
		{
			$(".btngp").addClass("fixBtn");
		}
		else{
			$(".btngp").removeClass("fixBtn");
		}
    });
	
	$(".notCheck").click(function(){
        stores_is += ','+$(this).find('input:hidden').val();
        $("#closeStores").val(stores_is.substring(1,stores_is.length));
        var storeNum = parseInt($('.redfont').text());
        $('.redfont').text(storeNum-1);
        $(this).remove();
    });

    $(".js_preview").click(function(){
        var openStores = '';
        if($('#getAllStores').hasClass("hover")){
            openStores = 'allStores';
        }else{
            openStores = $('#openStores').val();
        }
        var closeStores = $('#closeStores').val();
        var titleName = $('#wep_title').val();
        var notice = $('#notice').val();
        var batch_arr = "{$batch_arr['batch_id']}";
        $.post("{:U('Home/Store/setNavigation')}",{'openStores':openStores,'closeStores':closeStores,'titleName':titleName,'notice':notice,'batch_id':batch_arr},function(data){
            if (data.status) {
                if(batch_arr==0)
                {
                    m_id=data.info.batch_id;
                    window.location.href ="{:U('Home/Store/navigation',array('node_id'=>$node_id))}"+'&m_id='+m_id+'&isPopup=true';
                }else{
                    window.location.href ="{:U('Home/Store/navigation',array('node_id'=>$node_id,'m_id'=>$batch_arr['batch_id']))}"+'&isPopup=true';
                }
                
            }else{
                showcod(batch_arr);
            }
        },'JSON');
	});
    //生成二维码
    function showcod(id){
    var id = id;
    var type = 17;
    var url2 = './index.php?g=LabelAdmin&m=CjSetShow&a=code&batch_id=' + id + '&batch_type=' + type;
        art.dialog({
            title: '扫码预览',
            content: "<img src='"+url2+"' border='0'>"
        });
    }

    if (parseInt($('#number').text()) == 0) {
        $('#openStores').val('');
    }
    if (parseInt($('.redfont').text()) == 0) {
        $('#closeStores').val('');
    }
})

</script>

