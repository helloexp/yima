
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,maximum-scale=1,user-scalable=no,minimal-ui">
        <meta content="telephone=no" name="format-detection" />
        <meta content="email=no" name="format-detection" />
        <meta name="apple-touch-fullscreen" content="NO">
        <title>我的积分</title>
        <link rel="stylesheet" href="__PUBLIC__/Label/Css/wap_jfyxShop.css?v=__VR__">
        <script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
        <script type="text/javascript" src="__PUBLIC__/Label/Js/wap_jfyxShop.js?v=__VR__"></script>
        <style type="text/css">
        	.msgPopCon { padding: 20px 10px;}
        	.cjForm li { height: auto;}
        	.cjForm li strong { font-size: 16px;}
        	.cjForm li .yes { display: inline-block; width: 29px; height: 29px; background: url(__PUBLIC__/Label/Image/jfyx/Shop/jfyxShop-icon1.png) no-repeat; background-size: 100%; vertical-align: middle; margin-right: 10px;}
        	.cjForm li p { width: 100%; text-align: left; line-height: 16px; font-size: 15px; height: auto;}
        	.cjForm li p span { font-size: 15px; color: #0072c2;}
        	
        	.userHeader { padding:20px 0; height:60px;background: url(__PUBLIC__/Label/Image/jfyx/Shop/userbg.jpg) no-repeat center bottom; background-size:100% auto;}
			.userHeader .red { color: #ed3f41;}
			.userHeader>img { float:left; margin-left:20px; width:56px; height:56px; border-radius:50%; border:solid 2px #fff;}
			.userHeader>p { line-height:20px; text-align:left; text-indent:10px;}
			.userHeader>a { position:absolute; top:50px; right:5px; width:80px; height:26px; text-align:center; line-height:26px; border:solid 1px #ed3f41; color:#fff; background: #ed3f41; border-radius:3px; font-size:12px;}
			.userHeader>a.active { background: none; color: #333333; border-color: #333333;}
			
			.month select { width: 49%; border-width: 1px 0; border-radius: 0; height: 44px; color: #333; font-size: 15px; text-indent: 5px;}
			.item .infoMain { display: block;}
			/* 加载更多 */
			.get-more { padding: 10px 0 20px 0; margin:0 15px;}
			.get-more i { display: block; width: 12px; height: 12px; margin: 0 auto; background: url(../Image/jfyx/jfyx-icon2.png) no-repeat; background-size: 100%;}
			.get-more a { display:block; height:30px; line-height:30px; color:#999;}
			
			.yearMonth { display: inline-block; width: 100%;}
			.yearMonth .year,.yearMonth .month { width: 20%; position: relative;}
			.yearMonth i { display: block; position: absolute; right: 5px; top: 50%; margin-top: -3px; width: 12px; height: 6px; z-index: -1; background: url(__PUBLIC__/Label/Image/Item/balco-11.png) no-repeat; background-size:100%;}
			.yearMonth select { width: 100%; border-width: 0; background: none; border-radius: 0; height: 44px; color: #333; font-size: 15px; text-indent: 5px;}
			.item .infoMain { display: block;}
        </style>
    </head>
    <body>
        <div id="wrapper" class="bgf5f5f5">
            <div id="container">
                <div id="header" class="fn">
				    <div class="back"><a href="javascript:;" onClick="link_to('{:U('Label/Member/index',array('node_id'=>$node_id))}')" ><i></i></a></div>
				    <div class="headerorder" onClick="link_to('{:U('Label/Member/index',array('node_id'=>$node_id))}')"></div>
				    <div class="title">我的{:L('INTEGRAL_NAME')}</div>
				</div>
                <div id="main">
                    <div id="mainCon" class="mainCon fn m0">
                        <div class="userHeader">
                            <div class="msgArea" onClick="link_to('')">
                            </div>
                            <?php if ($wx_info['nickLogo'] == null) { ?>
                                    <img src="__PUBLIC__/Label/Image/jfyx/integralWx.png" />
                                <?php }else{ ?>
                                    <img src="{$wx_info.nickLogo}" />
                                <?php } ?>
							
							<p>{$wx_info.nickname}</p>
							<p><span>{$wx_info.phone_no}</span></p>
                            <p>可用{:L('INTEGRAL_NAME')}：<span class="red">{$wx_info.point}</span></p>
                        </div>
                        <div class="m-center">
			                <div class="tabList">
			                    <ul class="fn list3">
			                        <li class="<?php if ( $type_integral == '1' || $type_integral == null ) { echo 'hover';} ?> min" type_data="1"><a href="javascript:;">全部明细</a></li>
			                        <li class="<?php if ( $type_integral == '2' ) { echo 'hover';} ?> min" type_data="2"><a href="javascript:;" >收入明细</a></li>
			                        <li class="<?php if ( $type_integral == '3' ) { echo 'hover';} ?> min" type_data="3"><a href="javascript:;" >使用明细</a></li>
			                    </ul>
			                </div>
			                <form action="" id="theForm" name="searchForm" method="get">
	                    	<input type="hidden" name="g" value="Label">
							<input type="hidden" name="m" value="Member">
							<input type="hidden" name="a" value="integral_detail">
							<input type="hidden" name="node_id" value="{$node_id}"/>
							<input type="hidden" name="mo" id="mo" value="{$mo}" />
							<input type="hidden" name="yea" id="yea" value="{$yea}" />
			                <input type="hidden" name="type_integral" id="type_integral" value="{$type_integral}" />
                        	</form>
		                	<div class="yearMonth fn">
		                	<div class="year l">
		                		<select id="yeachange">
		                		<?php for ($i=$year_flag - 1; $i <= $year_flag ; $i++) { ?>
		                			<option <?php if ($yea == $i) { echo 'selected="selected"';} ?> value="<?php echo $i; ?>"><?php echo $i; ?>年</option>
		                		<?php } ?>
		                		
		                		</select>
		                		<i></i>
							</div>
							<div class="month l">
		                		<select id="mochange">
		                			<?php for ($i=1; $i <= $month_flag ; $i++) { ?>
		                			<option <?php if ($mo == $i) { echo 'selected="selected"';} ?> value="<?php echo $i; ?>"><?php echo $i; ?>月</option>
		                			<?php } ?>
		                		</select>
		                	<i></i>
							</div>
				 		</div>
				</div>
							<div class="item">
							<include file="integral_List"/>
							</div>
                        </div>
        				<div class="get-more" data-url="{$nextUrl}"><i></i><a href="javascript:;">往上拉查看更多</a></div>
                    </div>
                </div>
            </div>
<section style="display: none;" class="fullHtml loadingBox" id="loadingBox"><i></i><span></span></section>
</body>
</html>
<script type='text/javascript'>
    $(document).ready(function(e) {
    	_street_list = {};
		_in_ajax = false;
		_load_over = false;
		var loadhtml = '<div id="infscr-loading" style="text-align: center; display:none;"><img src="__PUBLIC__/Label/Image/Item/loading.gif"><div><em>加载中...</em></div></div>';
		$(".item").append(loadhtml);
		$("body").append("<div id='masonry2' style='display:none;'></div>");
		$(window).scroll(function () {
		    setTimeout(function(){
			    if ($(document).scrollTop() + $(window).height() >= $(document).height()) {
			    	if (_in_ajax) return ;
			    	_in_ajax = true;
		    		if($("masonry2").hasClass("erro")){return false;}
					$("masonry2").addClass("erro");
					var url = $('.get-more').attr("data-url");
					$("#infscr-loading").show();
					$('#masonry2').load(url + ' ' + ".infoMain", null, function(data,status){
						var l = $("#masonry2 .infoMain").length;
						if (l == 0) {
							$("#infscr-loading em").text("没有更多数据了");
							$("#infscr-loading img").hide();
							setTimeout(function(){
								$("#infscr-loading").hide();
							},2000);
							$('.get-more').hide();
						}else{
							$('.item').append($('#masonry2').html());
							$("#infscr-loading").fadeOut(500);
						}
						var newpath = newPath(url);
						$(".get-more").attr("data-url",newpath);
						$("masonry2").removeClass("erro");
						_in_ajax = false;
					});
			   };
		    },500);
		});

    	$('#mochange').change(function(){
    		var mo = $(this).val();
    		$('#mo').val(mo);
    		$('#theForm').submit();
    	});

    	$('#yeachange').change(function(){
    		var yea = $(this).val();
    		$('#yea').val(yea);
    		$('#theForm').submit();
    	})

    	$('.min').click(function(){
    		var type_integral = $(this).attr('type_data');
    		$('#type_integral').val(type_integral);
    		$('.min').removeClass('hover');
    		$(this).addClass('hover');
    		$('#theForm').submit();
    	});

	});

	function newPath(path){
		path = path.split("p=");
		var p = path[1]*1+1;
		newpath = path[0]+"p="+p;
		return newpath;
	};
</script>