
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,maximum-scale=1,user-scalable=no,minimal-ui">
        <meta content="telephone=no" name="format-detection" />
        <meta content="email=no" name="format-detection" />
        <meta name="apple-touch-fullscreen" content="NO">
        <title>我的积分</title>
        <link rel="stylesheet" href="__PUBLIC__/Label/Css/wap_jfyxShop.css?v=__VR__">
        <script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js?v=__VR__"></script>
        <script type="text/javascript" src="__PUBLIC__/Label/Js/wap_jfyxShop.js?v=__VR__"></script>
        <style type="text/css">
            .msgPopCon { padding: 20px 10px;}
            .mainCon { padding-bottom: 0;}
            .cjForm li { height: auto;}
            .cjForm li strong { font-size: 16px;}
            .cjForm li .yes { display: inline-block; width: 29px; height: 29px; background: url(__PUBLIC__/Label/Image/jfyx/Shop/jfyxShop-icon1.png) no-repeat; background-size: 100%; vertical-align: middle; margin-right: 10px;}
            .cjForm li p { width: 100%; text-align: left; line-height: 16px; font-size: 15px; height: auto;}
            .cjForm li p span { font-size: 15px; color: #0072c2;}

            .userHeader { padding:20px 0; height:60px;background: url(__PUBLIC__/Label/Image/jfyx/Shop/userbg.jpg) no-repeat center bottom; background-size:100% auto;}
            .userHeader .red { color: #ed3f41;}
            .userHeader>img { float:left; margin-left:20px; width:56px; height:56px; border-radius:50%; border:solid 2px #fff;}
            .userHeader>p { line-height:20px; text-align:left; text-indent:10px;}
            .userHeader>a { position:absolute; top:50px; right:5px; width:80px; height:26px; text-align:center; line-height:26px; border:solid 1px #ed3f41; color:#fff; background: #ed3f41; border-radius:3px; font-size:12px;}
            .userHeader>a.active { background: none; color: #333333; border-color: #333333;}

            .yearMonth { display: inline-block; width: 100%;}
            .yearMonth .year,.yearMonth .month { padding: 0 20px 0 8px; position: relative;}
            .yearMonth i { display: block; position: absolute; right: 5px; top: 50%; margin-top: -3px; width: 12px; height: 6px; z-index: -1; background: url(__PUBLIC__/Label/Image/Item/balco-11.png) no-repeat; background-size:100%;}
            .yearMonth select { width: 100%; border-width: 0; background: none; border-radius: 0; height: 44px; color: #333; font-size: 15px;}
            .item .infoMain { display: block;}
            .item .infoCon a span.green { color: #50ac6b;}
            .item .infoMain .info:last-child { border-bottom: 1px #dddddd solid;}
            /* 加载更多 */
            .get-more { padding: 10px 0 20px 0; margin:0 15px;}
            .get-more i { display: block; width: 12px; height: 12px; margin: 0 auto; background: url(__PUBLIC__/Label/Image/jfyx/jfyx-icon2.png) no-repeat; background-size: 100%;}
            .get-more a { display:block; height:30px; line-height:30px; color:#999;}

            .gap-line { width: 100%; height: 15px; background: #eeeeee;}
        </style>
    </head>
    <body>
        <div id="wrapper" class="bgf5f5f5">
            <div id="container">
                <div id="header" class="fn">
                    <div class="back"><a href="javascript:;" onClick="link_to('{:U('Label/Member/index',array('node_id'=>$node_id))}')" ><i></i></a></div>
                    <div class="headerorder" onClick="link_to('{:U('Label/Member/index',array('node_id'=>$node_id))}')"></div>
                    <div class="title">我的{:L('INTEGRAL_NAME')}</div>
                </div>
                <div id="main">
                    <div id="mainCon" class="mainCon fn m0">
                        <div class="userHeader">
                            <div class="msgArea" onClick="link_to('')">
                            </div>
                            <if condition="$wx_info['nickLogo'] neq '' ">
                                <img src="{$wx_info.nickLogo}" />
                                <else />
                                <img src="__PUBLIC__/Label/Image/jfyx/integralWx.png" />
                            </if>	
                            <p>{$wx_info.nickname}</p>
                            <p>可用{:L('INTEGRAL_NAME')}：<span class="red">{$wx_info.point}</span></p>
                        </div>
                        <div class="m-center" id="masonry">
                            <div class="tabList">
                                <ul class="fn list2">
                                    <li class="hover"><a href="{:U('Label/Member/youdou', array('node_id'=>$node_id))}">{:L('INTEGRAL_NAME')}明细</a></li>
                                    <li><a href="{:U('Label/Member/integralChangeDetail', array('node_id'=>$node_id))}">查看兑换记录</a></li>
                                </ul>
                            </div>
                            <form action="" id="theForm" name="searchForm" method="get">
                                <input type="hidden" name="g" value="Label" />
                                <input type="hidden" name="m" value="Member" />
                                <input type="hidden" name="a" value="youdou" />
                                <input type="hidden" name="node_id" value="{$node_id}"/>
                                <input type="hidden" name="mo" id="mo" value="{$mo}" />
                                <input type="hidden" name="yea" id="yea" value="{$yea}" />
                            </form>
                            <div class="yearMonth fn">
                                <div class="year l">
                                    <select id="yeachange">
                                        <for start="2014" end="date('Y')" comparison="elt" name="j">
                                            <option <if condition="$yea eq $j"> selected="selected" </if> value="{$j}">{$j}年</option>
                                        </for>
                                    </select>
                                    <i></i>
                                </div>
                                <div class="month l">
                                    <select id="mochange">
                                        <for start="1" end="13">
                                            <if condition="$mo eq $i">
                                                <option  selected="selected" value="{$i}">{$i}月</option>
                                            <elseif condition="$mo elt $i AND $yea eq date('Y')" />
                                                <option value="{$i}" class="dn">{$i}月</option>
                                            <else />
                                                <option value="{$i}">{$i}月</option>
                                            </if>
                                        </for>
                                    </select>
                                    <i></i>
                                </div>
                            </div>
                            <div class="item">
                                <div class="infoMain" id="itemInfo">
                                    <volist name='list' id='item'>
                                        <div class="info">
                                            <div class="infoCon">
                                                <a href="javascript:;">{$item['remark']}</br>
                                                    <span>{:dateformat($item['trace_time'])}</span>
                                                    <if condition="$item['after_num'] gt $item['before_num'] ">
                                                    <p><span class="green">+{$item['change_num']}</span>&nbsp;{:L('INTEGRAL_NAME')}</p>
                                                    <else />
                                                    <p><span class="red">-{$item['change_num']}</span>&nbsp;{:L('INTEGRAL_NAME')}</p>
                                                    </if>
                                                </a>
                                            </div>
                                        </div>
                                    </volist>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="get-more" data-url="{$nextUrl}"><i></i><a href="javascript:;">往上拉查看更多</a></div>
            </div>
        </div>
    <script type="text/javascript">
        $(document).ready(function () {
            var couldGetData = true;
            var loadhtml = '<div id="infscr-loading" style="text-align: center; display:none;"><img src="__PUBLIC__/Label/Image/Item/loading.gif"><div><em>加载中...</em></div></div>';
            $("#masonry").append(loadhtml);
            $("body").append("<div id='masonry2' style='display:none;'></div>");
            $(window).scroll(function () {
                if ($(document).scrollTop() + $(window).height() >= $(document).height()) {
                    if ($("#masonry2").hasClass("erro")) {
                        return false;
                    }
                    $("#masonry2").addClass("erro");
                    var url = $('.get-more').attr("data-url");
                    $("#infscr-loading").show();
                    $('#masonry2').load(url + ' ' + ".box", null, function (data, status) {
                        var newpath = newPath(url);
                        $(".get-more").attr("data-url", newpath);
                        if (data == '' || data == 'undefined') {
                            $("#infscr-loading em").text("没有更多数据了");
                            $("#infscr-loading img").hide();
                            $('.get-more').addClass('dn');
                            setTimeout(function () {
                                $("#infscr-loading").hide();
                            }, 2000);
                        } else if(couldGetData) {
                            $('#itemInfo').append(data);
                            $("#infscr-loading").fadeOut(500);
                            $("#masonry2").removeClass("erro");
                        }
                    });
                }
            });
        });
        
        function newPath(path) {
            path = path.split("p=");
            var p = path[1] * 1 + 1;
            newpath = path[0] + "p=" + p;
            return newpath;
        }
        
        $('#yeachange').change(function(){
            var yeaVal = $(this).val();
            $('#yea').val(yeaVal);
            $('#theForm').submit();
        });
        
        $('#mochange').change(function(){
    		var mo = $(this).val();
    		$('#mo').val(mo);
    		$('#theForm').submit();
    	});

        $('.back').click(function () {
            history.go(-1);
        });
    </script>
</html>
