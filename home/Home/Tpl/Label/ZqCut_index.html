<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>{$marketInfo['name']}</title>
<meta name="viewport" content="width=320, maximum-scale=1, user-scalable=no,minimal-ui">
<meta content="O2O,O2O营销,二维码,旺财,市场调研" name="Keywords">
<meta content="telephone=no" name="format-detection" />
<meta content="email=no" name="format-detection" />
<meta name="apple-touch-fullscreen" content="NO">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Label/Css/activity/wap_20150927.css?v=__VR__">
<script type="text/javascript" src="__PUBLIC__/Label/Js/jquery-2.1.1.min.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery-ui-1.11.2.custom/template.js?v=__VR__"></script>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Label/Js/wap_Shop.js?v=__VR__"></script>
<script>
var wxShareData = {:json_encode($shareData)};
if(wxShareData) {
    wx.config({
        //debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
        appId: wxShareData.appId,  //必填，公众号的唯一标识
        timestamp: wxShareData.timestamp, // 必填，生成签名的时间戳
        nonceStr: wxShareData.nonceStr, // 必填，生成签名的随机串
        signature: wxShareData.signature,// 必填，签名，见附录1
        jsApiList: [
            'onMenuShareTimeline',
            'onMenuShareAppMessage'
        ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
    });
}
$(document).ready(function(e) {
	wx.ready(function () {
            wx.showOptionMenu();
		var title = "挥斧砍价，{$marketInfo['goods_name']}拿回家，小伙伴快来帮我一把。";
		var link = "{$shareUrl}";
		var imgUrl = "{$wxInfo['headimgurl']}";
		wx.onMenuShareTimeline({
		    title: title, // 分享标题
		    link: link, // 分享链接
		    imgUrl: imgUrl, // 分享图标
		});
		wx.onMenuShareAppMessage({
		    title: "挥斧砍低价！{$wxInfo['nickname']}请求你再来一斧头。", // 分享标题
		    desc: "{$marketInfo['goods_name']}拿回家，挥斧砍低价，麻麻再也不担心我乱花钱啦！", // 分享描述
		    link: '{$shareUrl}', // 分享链接
		    imgUrl: '{$wxInfo['headimgurl']}', // 分享图标
		});
    })
	var loadImg = 0;
    var imgNum = $(".loadimg").length-1;
    $(".loadimg").one('load', function () {
        loadImg++;
        if (loadImg == imgNum) {
            $("#loading").hide();
            $("#wrapper").addClass("begin");
        }
    }).each(function () {
        if (this.complete) $(this).load();
    });
});
function login_to(url){
    var id={$id};
    $.post("{:U('Label/ZqCut/checkPhoneLogin')}",{'id':id},function(data){
        if(data.status==1){
            link_to(url);
        }else{
            /*setTimeout(function(){
                $('#loadingBox').show();
            },1);
            setTimeout(function(){$('#loadingBox').hide();},1000);
            setTimeout(function(){$(".loginForm").show();$(".loginForm").animate({top:"0%"},500);},1000);
            setTimeout(function(){$(".dn-bg").show();},1000);
            $("#jump_url").val(url);
            */
            //var surl = "<?php echo urlencode('http://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']);?>";
            var surl = urlencode(url);
            location.href = "{:U('O2OLogin/index')}"+"&id="+{$id}+"&surl="+surl;
        }
    },'json');
}
</script>
</head>
<body>
<div id="loading">
    <div class="loadingbox">
        <h4>{$nodeName}</h4>
        <div><i></i>
            <img src="{:get_upload_url($marketInfo['log_img'])}" />
        </div>
        <h5>Loading...</h5>
        <h6>吴刚砍树我砍价</h6>
    </div>
    <img src="__PUBLIC__/Label/Image/20150927/bg.jpg" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/tree.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/boy.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/cloud2.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/cloud3.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/title1.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/title2.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/title3.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/title4.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/btnbg1.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/btnbg2.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/btnbg3.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/btnbg4.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150927/poptitlebg.png" class="loadimg" />
</div>
<div id="wrapper">
    <div id="container">
        <div id="main">
            <div id="header">
                <div class="logo"><div class="logoimg"><img src="{:get_upload_url($marketInfo['log_img'])}"></div><p>{$nodeName}</p></div>
                <img src="__PUBLIC__/Label/Image/20150927/bg.jpg" class="bg" />
                <img src="__PUBLIC__/Label/Image/20150927/tree.png" class="tree1" />
                <img src="__PUBLIC__/Label/Image/20150927/boy.png" class="boy" />
                <img src="__PUBLIC__/Label/Image/20150927/cloud3.png" class="cloud3" />
                <div class="title">
                <img src="__PUBLIC__/Label/Image/20150927/title1.png" class="title1" />
                <img src="__PUBLIC__/Label/Image/20150927/title2.png" class="title2" />
                <img src="__PUBLIC__/Label/Image/20150927/title3.png" class="title3" />
                <img src="__PUBLIC__/Label/Image/20150927/title4.png" class="title4" />
                </div>
                <div class="con">
                    <p><img src="{$wxInfo['headimgurl']}" /><span>{$wxInfo['nickname']}</span>的商品还可以砍掉：<span>{$cutingPrice}</span>元</p>
                    <if condition="$due eq '2'">
                    <div class="product erro2">
                    <elseif condition="$due eq '1'"/>
                    <div class="product erro3">
                    <elseif condition="$marketInfo['remain_num'] eq '0'"/>
                    <div class="product erro1">
                    <else />
                    <div class="product">
                    </if>
                        <a href="{:U('Label/ZqCut/goodsInfo',array(id=>$id))}">
                        <div class="img"><img src="__UPLOAD__/{$marketInfo['goods_image']}" /></div>
                        <div class="text">
                            <p>{$marketInfo['goods_name']|msubstr=###,0,20}</p>
                            <p class="protext">{$marketInfo['memo']}</p>
                            <p class="price"><span>￥{$totalCutedPrice}</span><if condition="$marketInfo['storage_num'] neq -1"><em>剩余<span>{$marketInfo['remain_num']}</span>份</em></if></p>
                            <if condition="$marketInfo['market_price'] neq 0">
                            <p class="beforeprice">原价￥{$marketInfo['market_price']}</p>
                            </if>
                        </div>
                        </a>
                    </div>
                    <p>
                    <if condition="$wxCutedPrice neq '0'">
                                                                         你出手砍掉了<span>{$wxCutedPrice}</span>元<neq name="cutingPrice" value="0">，还可召唤小伙伴来协助哦</neq>
                    <elseif condition="$isHelp and $marketInfo['remain_num'] neq '0' and $due neq '2' and $due neq '1' and $marketInfo['defined_six_name'] gt 0 and $cutCount egt $marketInfo['defined_six_name']" />
                                                                         斧头已经用光,您不能再帮小伙伴砍价了
                    </if>
                    </p>
                    <div class="btn-opr">
                    <if condition="$isHelp"><!-- 帮砍 -->
                        <if condition="$orderStatus eq '2' and $marketInfo['remain_num'] neq '0' and $due neq '2' and $due neq '1'"><!-- 已购买 -->
                            <a href="{:U('Label/ZqCut/index',array(id=>$id))}" class="btn-green">我也要砍</a>
                        <elseif condition="$cutingPrice eq '0' and $marketInfo['remain_num'] neq '0' and $due neq '2' and $due neq '1'" /><!-- 价格砍到底 -->
                            <a href="{:U('Label/ZqCut/index',array(id=>$id))}" class="btn-green">我也要砍</a>
                        <elseif condition="$marketInfo['remain_num'] neq '0' and $due neq '2' and $due neq '1' and $marketInfo['defined_six_name'] gt 0 and $cutCount egt $marketInfo['defined_six_name']" /><!-- 帮砍次数用完 -->
                            <a href="{:U('Label/ZqCut/index',array(id=>$id))}" class="btn-green">我也要砍</a>
                            <a href="javascript:void(0)" onClick="$('.out-box').show();" class="btn-green">召唤小伙伴</a>
                        <elseif condition="$wxCutedPrice eq '0' and $marketInfo['remain_num'] neq '0' and $due neq '2' and $due neq '1'" /><!-- 未砍时 -->
                            <a href="<?php echo U('Label/ZqCut/cuting',array('id'=>$id)); ?>" class="btn-coffee">帮他砍价</a>
                            <a href="{:U('Label/ZqCut/index',array(id=>$id))}" class="btn-green">我也要砍</a>
                        <elseif condition="$wxCutedPrice gt '0' and $marketInfo['remain_num'] neq '0' and $due neq '2' and $due neq '1'" /><!-- 已砍 -->
                            <a href="{:U('Label/ZqCut/index',array(id=>$id))}" class="btn-green">我也要砍</a>
                            <a href="javascript:void(0)" onClick="$('.out-box').show();" class="btn-green">召唤小伙伴</a>
                        </if>
                    <else/>                 <!-- 自己砍 -->
                        <if condition="$orderStatus eq '2'"><!-- 已购买 -->
                            <a href="javascript:void(0);" onClick="login_to('{:U('Label/MyOrder/index',array('node_id'=>$marketInfo['node_id'],'id'=>$id))}')" class="btn-coffee">查看订单</a>
                        <elseif condition="$cutingPrice eq '0' and $marketInfo['remain_num'] neq '0' and $due neq '2' and $due neq '1'" /><!-- 价格砍到底 -->
                            <a href="{:U('Label/ZqCut/goodsInfo',array(id=>$id))}" class="btn-coffee">立即购买</a>
                        <elseif condition="$wxCutedPrice eq '0' and $marketInfo['remain_num'] neq '0' and $due neq '2' and $due neq '1'" /><!-- 未砍时 -->
                            <a href="{:U('Label/ZqCut/cuting',array('id'=>$id))}" class="btn-coffee">我要砍价</a>
                        <elseif condition="$wxCutedPrice gt '0' and $marketInfo['remain_num'] neq '0' and $due neq '2' and $due neq '1'" /><!-- 已砍 -->
                            <a href="{:U('Label/ZqCut/goodsInfo',array(id=>$id))}" class="btn-coffee">立即购买</a>
                            <a href="javascript:void(0)" onClick="$('.out-box').show();" class="btn-green">召唤小伙伴</a>
                        </if>
                    </if>
                    </div>
                    <!--
                    <div class="btn-opr">
                        <a href="游戏.html" class="btn-coffeebig">我要砍价</a>
                    </div>
                    -->
                    <div class="btn-opr">
                        <a href="javascript:void(0)" class="btn-introduce l">活动说明</a>
                        <a href="tel:{$node_service_hotline}" class="btn-tel r">服务热线</a>
                    </div>
                </div>
            </div>
            <div class="frindList">
                <ul>
                    <volist name="cutList" id="vo">
                    <li>
                        <div class="frindMsg">
                            <img src="{$vo['headimgurl']}" />
                            <p>{$vo['nickname']}<if condition="$vo['from_user_id'] eq session('CutWxInfo.openId')">(自己)</if></p>
                        </div>
                        <div class="frindMsgP">花了吃奶的力气砍掉了<span>{$vo['cut_amt']}</span>元</div>
                    </li>
                    </volist>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="out-box" onClick="$(this).hide();">
    <img src="__PUBLIC__/Label/Image/tip-share.png" class="img">
</div>
<include file="Public:Cutfooter"/>
</body>
</html>

<script>
var _global = {
        onsub:false,
        g:true
    }
$(document).ready(function(e) {
    $(".btn-introduce").click(function(){
        var html = template("js-tmpl-rule");
        cj.content({
            title:"活动规则",
            msg:html
        });
    })
});
var cj = {
    basic:function(msg){
        cj.close();
        if(!msg.title){var notitle="notitle";msg.title="";}else{var notitle="hastitle"}
        if(msg.isclose){var closehtml = '<a href="javascript:void(0)" class="close-msgPop"><i><span>+</span></i></a>'}else{var closehtml = "";}
        var html = ['<div class="msgPop bg" id="'+msg.id+'">',
            '<div class="msgBg">',
            '<div class="msgTitle '+notitle+'">'+msg.title+closehtml+'</div>',
            '<div class="msgCon">'+msg.html+'</div>',
            '</div>',
            '</div>'].join('');
        $("body").append(html);
        if(typeof(msg.start) == 'string'){
            window[msg.start].call(this,$(this));
        }else if(typeof(msg.start) == 'function'){
            msg.start.call(this,$(this));
        }
        $("body").find(".msgBg",html).on("click",".cjBtn-back",function(){
            var index = $(this).index();
            if(typeof(msg.btn[index].callback) == 'string'){
                window[msg.btn[index].callback].call(this,$(this));
            }else if(typeof(msg.btn[index].callback) == 'function'){
                msg.btn[index].callback.call(this,$(this));
            }else{
                msg.repeat ? (cj.close(),cj.login({repeat:msg.repeat})) : cj.close();
                if($(this).attr("href")!="javascript:void(0)"){
                    window.location.href = $(this).attr("href");
                }
            }
        });
        $("body").find(".msgBg",html).on("click",".close-msgPop",function(){
            if(typeof(msg.after) == 'string'){
                window[msg.after].call(this,$(this));
            }else if(typeof(msg.after) == 'function'){
                msg.after.call(this,$(this));
            }
            msg.repeat ? (cj.remove(),cj.login({repeat:msg.repeat})) : cj.remove();
        });
        $("body").on("click","input",msg.html,function(){
            $(this).removeClass("erro");
        });
    },
    tip:function(msg){
        $(".cjTip").remove();
        var txt = ["10秒钟内点的越多，砍掉的价格越高"];
        var codeRandom = Math.floor(Math.random()*txt.length);
        if(!msg){msg = txt[codeRandom]};
        if(msg==1){return false;}
        var html = '<div class="cjTip"><div class="cjTipTxt"><i></i><p>'+msg+'</p></div><div class="cjTipbg"></div></div>';
        $("body").append(html);
    },
    content:function(msg){
        msg = $.extend(true, {}, cj.msg,msg);
        msg.html = template("js-tmpl-msg",msg);
        cj.basic(msg);
    },
    remove:function(msg){
        _global.g = true;
        $(".gameCon").removeClass("end");
        $(".msgPop").remove();
        var _MsgPopglobal = {
            refurbish:false,
            repeat:true
        }
        msg = $.extend(true, {}, _MsgPopglobal,msg);
        if(msg.refurbish){
            location.href = location.href ;
        }
    },
    close:function(msg){
        _global.g = true;
        $(".gameCon").removeClass("end");
        var _MsgPopglobal = {
            refurbish:false,
            repeat:true
        }
        msg = $.extend(true, {}, _MsgPopglobal,msg);
        $(".msgPop").not("[id!='']").remove();
        if(msg.refurbish){
            location.href = location.href ;
        }
    },
    msg:{
        id:"",
        title:false,//标题
        html:false,//内容
        refurbish:false,//是否刷新
        msg:"未知错误",//内容
        icon:false,//图标
        repeat:false,//重新填出登陆框
        btn:[
            {
                text:"返回",//按钮文字
                url:"javascript:void(0)",//按钮链接
                callback:function(){
                    cj.close();
                }
            }
        ],
        isclose:true,
        start:false,//弹出之后callback
        after:false//关闭之后callback
    }
}
</script>
<script type="text/html" id="js-tmpl-msg">
<div class="cjText">
    {{if !html}}
    <div class="cjText-con">
        {{if !icon}}
            <div class="cjText-text noicon">{{#msg}}</div>
        {{else}}
            <div class="cjText-text">{{#msg}}</div>
            <div class="cjText-img">
                {{if icon==1}}
                <img src="__PUBLIC__/Label/Image/qianji/Item/qj-6.png" width="64">
                {{else}}
                <img src="__PUBLIC__/Label/Image/qianji/Item/qj-19-{{icon}}.png" width="100">
                {{/if}}
            </div>
        {{/if}}
    </div>
    {{else}}
    {{#html}}
    {{/if}}
</div>
<div class="cjBtn">
{{each btn as value i}}
    <a href="{{value.url}}" class="cjBtn-back {{if btn.length>1}}{{if i==0}}sm{{/if}}{{/if}}">{{value.text}}</a>
{{/each}}
</div>
</script>
<script type="text/html" id="js-tmpl-rule">
<div class="gameRule">
    <div class="divRule">
        <p><b>活动时间：</b>{$marketInfo.start_time|dateformat=###,'Y.m.d'}至{$marketInfo.end_time|dateformat=###,'Y.m.d'}</p>
        <p><b>活动说明：</b><br/>&nbsp;&nbsp;&nbsp;&nbsp;1.游戏中，每次点击屏幕都有可能提高你的砍价金额。所以在规定的游戏时间内，你的手速越快，点击屏幕次数越多，砍价金额就会越高哦
                         <br/>&nbsp;&nbsp;&nbsp;&nbsp;2.每人只能参与游戏砍价一次，你可以召唤小伙伴们参与游戏一起帮你砍价。能不能狠“宰”一刀，就看小伙伴们给不给力啦
                         <php>
                            if(in_array($marketInfo['node_id'],C('WG_CUT_NODE_ID'))){
                                echo '<br/>&nbsp;&nbsp;&nbsp;&nbsp;3.活动商品只能在砍到最低价时，方可购买';
                            }else{
                                echo '<br/>&nbsp;&nbsp;&nbsp;&nbsp;3.点击商品可根据当前价格进行购买';
                            }
                         </php>
                         <br/>&nbsp;&nbsp;&nbsp;&nbsp;4.翼码科技仅为该活动的技术服务支撑商，如消费者与商家产生纠纷，翼码科技不介入协调且不为此承担责任,本次活动不支持退款<if condition="$marketInfo['defined_six_name'] gt 0">
                         <br/>&nbsp;&nbsp;&nbsp;&nbsp;5.本次活动一共可以帮助小伙伴砍价［{$marketInfo['defined_six_name']}］次</if></p>
    </div>
</div>
</script>