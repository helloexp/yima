<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>妈妈我爱你</title>
<meta name="viewport" content="width=320, maximum-scale=1, user-scalable=no,minimal-ui">
<meta content="O2O,O2O营销,二维码,旺财,市场调研" name="Keywords">
<meta content="telephone=no" name="format-detection" />
<meta content="email=no" name="format-detection" />
<meta name="apple-touch-fullscreen" content="NO">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Label/Css/activity/wap_20150510.css">
<link href="__PUBLIC__/Js/validationEngine/css/validationEngine.jquery.css?v=__VR__" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/Label/Js/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/languages/jquery.validationEngine-zh_CN.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/validationEngine/jquery.validationEngine.js?v=__VR__"></script>
<script type="text/javascript" src="__PUBLIC__/Js/jquery.form.js?v=__VR__"></script>
<script>
	window.global = window.global || {};
	global.isSzpaMamaSjb = '{$isSzpaMamaSjb}';
	global.szpaGoto = '{:C("szpa.mamaBatchGoto")}';
$(document).ready(function(e) {
	var loadImg = 0 ;
	var imgNum = 4;
	$(".loadimg").one('load', function() {
			loadImg++;
			if(loadImg==imgNum){
				$("#loading").fadeOut();
			}
		}).each(function() {
		if(this.complete) $(this).load();
	});
});

function fleshVerify(){ 
    //重载验证码
    var time = new Date().getTime();
        document.getElementById('verifyImg').src= '{:U("Home/VerifyCode/index")}&time='+time;
 } 
</script>
</head>
<body>
<div id="loading">
    <div class="loadingbox">
        <h4>{$marketInfo.node_name}</h4>
        <div><i></i><img src="<?php 
	    if($marketInfo['log_img'] != ''){ 
			echo get_upload_url($marketInfo['log_img']);
	    }else{ ?>
		__PUBLIC__/Label/Image/defaultlogo-sOne.png
		<?php } ?>"></div>
        <h5>Loading...</h5>
        <h6>妈妈我爱你</h6>
    </div>
    <img src="__PUBLIC__/Label/Image/20150510/bg.jpg" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150510/bg2.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150510/bg3.jpg" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150510/flower.png" class="loadimg" />
    <img src="__PUBLIC__/Label/Image/20150510/love.png" class="loadimg" />
</div>
<div id="wrapper" ontouchstart="autoaudio()">
    <div id="container">
    	<div id="main">
        	<div id="page1">
                <div id="header">
                    <img src="__PUBLIC__/Label/Image/20150510/bg.jpg" class="headerbg" />
                    <img src="__PUBLIC__/Label/Image/20150510/love.png" class="headerbg2" />
                    <div class="headerbg3"></div>
                    <!--logo 商户名称-->
                    <img src="<?php 
	    if($marketInfo['log_img'] != ''){ 
			echo get_upload_url($marketInfo['log_img']);
	    }else{ ?>
		__PUBLIC__/Label/Image/defaultlogo-sOne.png
		<?php } ?>" class="logo" />
                    <h1>{$marketInfo.node_name}</h1>
                    <!--logo 商户名称-->
                    <div class="headerOpr">
                        <div class="flower1"></div>
                        <div class="flower2"></div>
                        <div class="r">
							<a href="http://t.ym06.cn/g3iYrYjB" class="btn-view"><i></i><span>贺卡预览</span></a>
                            <!-- <a href="http://test.wangcaio2o.com/index.php?g=Label&m=MamaLook&a=index&id=7717&wc=wctest&cardId=YaMAxji1gp4=" class="btn-view"><i></i><span>贺卡预览</span></a> -->
                        </div>
                        <a href="javascript:void(0)" class="btn-make"><i></i><span>给妈妈制作贺卡</span></a>
						<?php if($jpnum >0){ ?>
                        <p>礼品库还剩：<span><?php echo $jpnum; ?></span>份</p>
						<?php } ?>
                    </div>
                    <div class="music on" onClick="audio()"><span></span><i></i><em></em></div>
                    <audio src="__PUBLIC__/Label/Image/20150510/Mother_BGM.mp3" autoplay="true" loop id="audio" style="display:none; width:0; height:0; overflow:hidden;"></audio>
                </div>
                <div id="mainCon">
						  <?php if($heheJp){ ?>
                    <div class="prize">
                        <div class="flash fn">
                            <ul class="swiper-wrapper">    
                                <?php foreach($heheJp as $jp){?>
                                <li class="swiper-slide"><img src="__UPLOAD__/<?php echo $jp['batch_img']; ?>" /><h2><p><?php echo $jp['batch_name'];?></p></h2><p>剩余数：<span><?php echo $jp['remain_num'];?></span>份</p></li>
                                <?php }?>
                            </ul>
                        </div>
                        <div class="flasnext"></div>
                        <div class="flaspre"></div>
                    </div>
						 <?php } ?>
                    <div class="txtCon">
                        <pre>{$marketInfo['wap_info']}</pre>
                    </div>
                </div>
            </div>
            <div id="page2" class="dn">
                <img src="__PUBLIC__/Label/Image/20150510/bg3.jpg" />
            	<div class="fn">
                    <div class="bread"><i></i><span>贺卡内容设置</span></div>
                    <div class="mainCon">
                        <div class="baseForm">
                        	 <form action="{:U('Label/MamaSjb/gCsubmit')}" method="post" enctype="multipart/form-data" id="theone"/>
							<input type="hidden" name="id" value="{$id}" />
                        	<li><p>您的手机号</p><div class="baseForm-input"><input type="tel" placeholder="&nbsp;用于领取礼品" maxlength="11" name="sonNum" class="validate[required,minSize[11]]"></div></li>
                            <li><p>您的昵称</p><div class="baseForm-input"><input type="text" name="sonPetName" maxlength="11" class="validate[required]"></div></li>
                        	<li><p>您的生日</p><div class="baseForm-input"><input type="date" value="1988-06-15" onClick="javascript:$(this).css('color','#333');" name="shengri" class="validate[required,maxSize[20]]"></div></li>
                            <li><p>想对妈妈说的话</p><div class="baseForm-input"><textarea maxlength="80" name="smsContent" class="validate[required,minSize[1]]"></textarea></div></li>
                            <li><p>妈妈的手机号</p><div class="baseForm-input"><input type="tel" placeholder="&nbsp;将贺卡发送给妈妈"  maxlength="11" name="mamaNum" class="validate[required,maxSize[11]]"></div></li>
                            <li><p>选择照片</p><div class="baseForm-input tl"><img class="imgfile dn"><input type="file" accept="image/*" name="jpgUrl" class="validate[required]"><input type="hidden" value="" id="j_thumb" name="j_thumb"/>
							<!--
							<form action="" method="" enctype="multipart/form-data" id="thetwo">
							<input type="hidden" value="{$id}" name="id" />
							<input type="file" accept="image/*" name="jpgUrl" class="validate[required]">
							<input type="hidden" value="" id="j_thumb" name="j_thumb"/>
							</form>
							-->
							</div></li>                               
						<li><p>验证码</p><div class="baseForm-input"><input name="verify" class="validate[required]" type="text" style=" float:left; width:98px;;margin-right:10px;" id="mamama" onKeyUp="this.value=this.value.replace(/\D/g,'')"/><img id="verifyImg" src="<?php echo U('Label/VerifyCode/index/')?>" onClick="fleshVerify()"class="l" style="width:60px; height:30px;"></div></li>
                            <li><a class="btn-update" id="submit_view">预览</a><a class="btn-update" id="submit_gc">发布</a></li>
							</form>
                        </div>
                    </div>
                </div>
            </div>
            <div id="page3" class="dn">
                <img src="__PUBLIC__/Label/Image/20150510/bg3.jpg" />
            	<div class="fn">
                    <div class="bread"><span>恭喜您获得</span></div>
                    <div class="prizeList">
                        <ul>
                            <li>
                                <img src="__PUBLIC__/Label/Image/aipai-yima.jpg">
                                <h2>哈根达斯50元代金券</h2>
                                <h3>商品说明商品说明商品说 明商品说明商品说明</h3>
                            </li>
                        </ul>
                    </div>
                    <p>您可以将您制作的卡片发送到朋友圈，让更多人看到您对母亲的爱~ </p>
                </div>
            </div>
             <div style="text-align:center">
                <include file="Public:footer"/>
            </div>
        </div>
    </div>
</div>
<div class="canvasCut dn">
	<div class="canvasCutCon">
        <a href="javascript:void(0)">确认</a>
    </div>
</div>
<div id="card" class="dn">
    <div class="cardCon">
    	<div class="cardpage1">
        	<div class="webdd-title"><img src="__PUBLIC__/Label/Image/20150510/card-text0.png"></div>
            <div class="webdd-slogan"><img src="__PUBLIC__/Label/Image/20150510/card-text1.png" class="abs"><img src="__PUBLIC__/Label/Image/20150510/card-text2.png"></div>
            <div class="cardheartdiv"><div><img src="__PUBLIC__/Label/Image/20150510/card4.png" class="cardheart"></div></div>
            <div class="webdd-happy"><img src="__PUBLIC__/Label/Image/20150510/card-text3.png"></div>
        </div>
    	<div class="cardpage2">
        	<div class="webdd-year" data-date=""><span class="year">1900</span>年<span class="month">1</span>月<span class="day">1</span>日</div>
            <div class="webdd-slogan mt20"><img src="__PUBLIC__/Label/Image/20150510/card-text4.png" class="abs"><img src="__PUBLIC__/Label/Image/20150510/card-text5.png"></div>
            <div class="cardbabydiv">
                <div>
            	<img src="__PUBLIC__/Label/Image/20150510/card7.png" class="cardbabymusic1">
                <img src="__PUBLIC__/Label/Image/20150510/card8.png" class="cardbabymusic2">
                <img src="__PUBLIC__/Label/Image/20150510/card7.png" class="cardbabymusic3">
                <img src="__PUBLIC__/Label/Image/20150510/card5.png" class="cardbaby">
                </div>
            </div>
        </div>
    	<div class="cardpage3">
            <div class="webdd-slogan mt20"><img src="__PUBLIC__/Label/Image/20150510/card-text6.png" class="abs"><img src="__PUBLIC__/Label/Image/20150510/card-text7.png"></div>
            <div class="cardboydiv">
                <div>
            	<img src="__PUBLIC__/Label/Image/20150510/card10.png" class="cardboylove1">
                <img src="__PUBLIC__/Label/Image/20150510/card11.png" class="cardboylove2">
                <img src="__PUBLIC__/Label/Image/20150510/card9.png" class="cardboy">
                </div>
            </div>
        </div>
    	<div class="cardpage5">
            <div class="webdd-slogan mt20"><img src="__PUBLIC__/Label/Image/20150510/card-text8.png" class="abs"><img src="__PUBLIC__/Label/Image/20150510/card-text9.png"></div>
            <div class="cardolddiv">
                <div>
                <img src="__PUBLIC__/Label/Image/20150510/card12.gif" class="cardold">
                </div>
            </div>
        </div>
    	<div class="cardpage4">
            <div class="cardimg" style="opacity:0;">
            	<img src="__PUBLIC__/Label/Image/20150510/card3.png" class="topcut">
                <img src="__PUBLIC__/Label/Image/20150510/card3.png" class="botcut">
                <img src="" class="img">
            </div>
            <div class="webdd-end"><img src="__PUBLIC__/Label/Image/20150510/card-text10.png" class="abs"><img src="__PUBLIC__/Label/Image/20150510/card-text11.png"></div>
        </div>
    </div>
    <div class="cardOpr">
    	<div class="cardpage4">
            <div class="cardimg">
            	<img src="__PUBLIC__/Label/Image/20150510/card3.png" class="topcut">
                <img src="__PUBLIC__/Label/Image/20150510/card3.png" class="botcut">
                <img src="" class="img">
            </div>
            <div class="say">
            	<h3>亲爱的妈妈：</h3>
                <pre>我爱您！祝您健康，永远美丽！ 母亲节快乐！</pre>
				<p class="tr" style="padding:10px 0;">----您的**</p>
                <div class="cardbtn tc" style="height:50px;">
                	<a href="javascript:vodi(0)" class="btn-all resave">返回</a>
                </div>
            </div>
        </div>
    </div>
   
</div>
</body>
</html>
<script type="text/javascript" src="__PUBLIC__/Label/Js/idangerous.swiper.min.js"></script>
<script>
$(document).ready(function(e) {
	if($(".prize").length==1){
		var	flashSwiper = new Swiper('.flash',{
			paginationClickable: true,
			slidesPerView: 3
		});
	}
	$(".btn-make").click(function(){
		$("#page1").hide();
		$("#page2").show();
	})
	$("input[type='file']").click(function(){
		$(this).addClass("loading");
	})
	$("input[type='file']").change(function(){
		$(".canvasCut").height($("#wrapper").height())
		$(".canvasCut").show();
		var val = $(this).prop('files')[0],
			src = createObjectURLfun(val),
			newimg = new Image();
			newimg.src = src;
			newimg.onload = function() {
			var h = 310/this.width*this.height;
			$('#canvas').remove();
			$(".canvasCutCon a").before('<canvas id="canvas" height="'+h+'"></canvas>')
			this.height = h;
			this.width = 310;
			var canvas = $('#canvas')[0],
				ctx = canvas.getContext("2d");
			ctx.clearRect(0,0,640,640);
            ctx.drawImage(this,0,0,300,h);
        };
		$(this).removeClass("loadimg");
		$(this).addClass("change");
		/*
		$.post("{:U('Label/MamaSjb/commitFile')}",$("#thetwo").serialize(),function(da){
		alert(da.info);
		     $(".imgfile").attr('src',da.info);
			 $(".imgfile").removeClass("dn");
		});
		*/
	})
	var commit=false;
	$("#submit_view").click(function(){
		if($("#theone").validationEngine('validate')){
			$("#card").show();
			$("#wrapper").hide();
			begin();
	     }
	})
	$("#submit_gc").click(function(){
		 if(commit == true) return false;
		 if($("#theone").validationEngine('validate')){
		 	commit=true;
		 	$(this).text("正在发布...");
	         $.post("{:U('Label/MamaSjb/gCsubmit')}",$("#theone").serialize(),function(d){
			    fleshVerify();
				/*MsgPop({
					title:"提示",
					html:'<p>'+d.info+'</p><p><a href="javascript:vodi(0)" class="btn-all" onClick="location.reload()">前去查看</a></p>'
				});*/
				commit=false;
		 		$("#submit_gc").text("发布");
			    if(d.status == 1){
					if(global.isSzpaMamaSjb == '1'){
						//判断“中奖”
						if(d.info.award_flag == 1){
							MsgPop({
								html:'<p>'+ d.info.msg +'</p>'
							});
                            $('.msgTitle i').remove();
							setTimeout(function(){
								window.location.href = global.szpaGoto ;
							}, 2000);
							return ;
						}
					}

					MsgPop({
						title:"提示",
						html:'<p>'+d.info.msg+'</p><p><a href="javascript:vodi(0)" class="btn-all" onClick="location.reload()">查看贺卡</a></p>'
					});
				 }else{
					 MsgPop({
						title:"提示",
						html:'<p>'+d.info+'</p><p><a href="javascript:vodi(0)" class="btn-all" onClick="closeMsgPop()">返回</a></p>'
					});
				 }
		     },'json');
	     }
	});
	$(".canvasCut a").click(function(){
		$(".canvasCut").hide();
		var base64 = $("#canvas")[0].toDataURL('image/png');
		$('#j_thumb').val(base64);
		$(".imgfile").show();
		$(".imgfile").attr("src",base64);
		$(".cardpage4 .img").attr("src",base64);
	})
	$(".resave").click(function(){
		$("#card").hide();
		$("#card").removeClass("topage4");
		$("#wrapper").show();
	})
});
function autoaudio(){
	$("#loading").hide();
	var audio = document.getElementById('audio');
	if(audio.paused){
		audio.play();
		$(".music").addClass("on");
	}
}
function audio(){
	var audio = document.getElementById('audio');
	if(audio.paused){
		audio.play();
		$(".music").addClass("on");
	}else{
		audio.pause();
		$(".music").removeClass("on");
	}
}
//弹窗基础
function closeMsgPop(){
	$(".msgPop").remove();
}
function MsgPop(msg){
	if(!msg.title){msg.title="消息"};
	if(!msg.icon){msg.icon=""}else{msg.icon="<i class='"+msg.icon+"'></i>"};
	var html = ['<div class="msgPop bg">',
					'<div class="msgBg">',
						'<div class="msgTitle">'+msg.title+'<a href="javascript:void(0)" class="close-msgPop" onClick="closeMsgPop()"><i><span>+</span></i></a></div>',
						'<div class="msgCon">'+msg.icon+msg.html+'</div>',
					'</div>',
				'</div>'].join('');
	$("body").append(html)
}
function createObjectURLfun(file) {
	if (window.navigator.userAgent.indexOf("Chrome") >= 1 || window.navigator.userAgent.indexOf("Safari") >= 1) {
		return window.webkitURL.createObjectURL(file);
	} else {
		return window.URL.createObjectURL(file);
	}
};
</script>

<script>
function begin(){
	$(".webdd-year").attr("data-date",$("[name='shengri']").val());
	$(".say .tr").text("----您的"+$("[name='sonPetName']").val());
	$("#card").height($(".cardOpr .cardpage4").height());
	$("#card").addClass("topage1");
	setTimeout(function(){
		$("#card").removeClass("topage1");$("#card").addClass("topage2");
		var code = $(".webdd-year").attr("data-date"),
		code = code.split("-"),
		speed = 5,
		beginyear = 1600,
		Int = setInterval(function(){
			$(".webdd-year .year").text(parseInt(beginyear));
			var check = beginyear+=speed;
			if(check>=code[0]){
				$(".webdd-year .year").text(code[0]);
				clearInterval(Int);
				return false;
			}else{
				beginyear+=speed;
			}
			console.log(1)
		},30);
		$(".webdd-year .month").text(code[1]);
		$(".webdd-year .day").text(code[2]);
	},8000);
	setTimeout('$("#card").removeClass("topage2");$("#card").addClass("topage3");',17000);
	setTimeout('$("#card").removeClass("topage3");$("#card").addClass("topage5");',26400);
	setTimeout('$("#card").removeClass("topage5");$("#card").addClass("topage4");',35000);
}
</script>

<!--分享-->
<script>
	var wxShareData = {:json_encode($shareData)};
</script>
<include file="Label/Public/_shareWx"/>