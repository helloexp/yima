
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,maximum-scale=1,user-scalable=no,minimal-ui">
        <meta content="telephone=no" name="format-detection" />
        <meta content="email=no" name="format-detection" />
        <meta name="apple-touch-fullscreen" content="NO">
        <title>我的积分</title>
        <link rel="stylesheet" href="__PUBLIC__/Label/Css/wap_jfyxShop.css">
        <script type="text/javascript" src="__PUBLIC__/Js/jquery-1.7.1.min.js"></script>
        <script type="text/javascript" src="__PUBLIC__/Label/Js/wap_jfyxShop.js"></script>
        <style type="text/css">
            .msgPopCon { padding: 20px 10px;}
            .mainCon { padding-bottom: 0;}
            .cjForm li { height: auto;}
            .cjForm li strong { font-size: 16px;}
            .cjForm li .yes { display: inline-block; width: 29px; height: 29px; background: url(__PUBLIC__/Label/Image/jfyx/Shop/jfyxShop-icon1.png) no-repeat; background-size: 100%; vertical-align: middle; margin-right: 10px;}
            .cjForm li p { width: 100%; text-align: left; line-height: 16px; font-size: 15px; height: auto;}
            .cjForm li p span { font-size: 15px; color: #0072c2;}

            .userHeader { padding:20px 0; height:60px;background: url(__PUBLIC__/Label/Image/jfyx/Shop/userbg.jpg) no-repeat center bottom; background-size:100% auto;}
            .userHeader .red { color: #ed3f41;}
            .userHeader>img { float:left; margin-left:20px; width:56px; height:56px; border-radius:50%; border:solid 2px #fff;}
            .userHeader>p { line-height:20px; text-align:left; text-indent:10px;}
            .userHeader>a { position:absolute; top:50px; right:5px; width:80px; height:26px; text-align:center; line-height:26px; border:solid 1px #ed3f41; color:#fff; background: #ed3f41; border-radius:3px; font-size:12px;}
            .userHeader>a.active { background: none; color: #333333; border-color: #333333;}

            .yearMonth { display: inline-block; width: 100%;}
            .yearMonth .year,.yearMonth .month { padding: 0 20px 0 8px; position: relative;}
            .yearMonth i { display: block; position: absolute; right: 5px; top: 50%; margin-top: -3px; width: 12px; height: 6px; z-index: -1; background: url(__PUBLIC__/Label/Image/Item/balco-11.png) no-repeat; background-size:100%;}
            .yearMonth select { width: 100%; border-width: 0; background: none; border-radius: 0; height: 44px; color: #333; font-size: 15px;}
            .item .infoMain { display: block;}
            .item .infoCon a span.green { color: #50ac6b;}
            /* 加载更多 */
            .get-more { padding: 10px 0 20px 0; margin:0 15px;}
            .get-more i { display: block; width: 12px; height: 12px; margin: 0 auto; background: url(__PUBLIC__/Label/Image/jfyx/jfyx-icon2.png) no-repeat; background-size: 100%;}
            .get-more a { display:block; height:30px; line-height:30px; color:#999;}

            .box { position: relative;}
            .box .order-num { text-align: left; font-size: 15px; line-height: 24px; margin-bottom: 5px; color: #666666;}
            .box .proItem-msg .phone { display: inline-block; position: absolute; right: 0; top: 50%; z-index: 100; margin-top: -25px; width: 25px; height: 25px; background: url(__PUBLIC__/Label/Image/jfyx/jfyx-icon1.png) no-repeat; background-size: 100%;}
            .box .proItem-msg h2 { padding: 5px 0 2px 0; color: #666666;}
            .box .proItem-msg h2 .red { color: #ed3f41; font-size: 16px; font-weight: bold;}
            .box .proItem-msg h2 .gray { text-decoration:line-through;}
            .box .proItem-msg a.vote { display: block; height: 30px; position: absolute; right: 15px; bottom: 5px; z-index: 100; font-size: 14px; line-height: 30px; text-align: center;}
            .box .proItem-msg a.voting { display: block; height: 30px; position: absolute; right: 15px; bottom: 5px; z-index: 100; font-size: 14px; line-height: 30px; text-align: center; color: #999999; cursor: default;}

            .gap-line { width: 100%; height: 15px; background: #eeeeee;}
            .m-center { background: #ffffff;}
        </style>
    </head>
    <body>
        <div id="wrapper" class="bgf5f5f5">
            <div id="container">
                <div id="header" class="fn">
                    <div class="back"><i></i></div>
                    <div class="headerorder" onClick="link_to('{:U('Label/Member/index',array('node_id'=>$node_id))}')"></div>
                    <div class="title">我的{:L('INTEGRAL_NAME')}</div>
                </div>
                <div id="main">
                    <div id="mainCon" class="mainCon fn m0">
                        <div class="userHeader">
                            <div class="msgArea" onClick="link_to('')">
                            </div>
                            <if condition="$wx_info['nickLogo'] neq '' ">
                                <img src="{$wx_info.nickLogo}" />
                                <else />
                                <img src="__PUBLIC__/Label/Image/jfyx/integralWx.png" />
                            </if>
                            <p>{$wx_info.nickname}</p>
                            <p>可用{:L('INTEGRAL_NAME')}：<span class="red">{$wx_info.point}</span></p>
                        </div>
                        <div class="m-center" id="masonry">
                            <div class="tabList">
                                <ul class="fn list2">
                                    <li><a href="{:U('Label/Member/youdou', array('node_id'=>$node_id))}">{:L('INTEGRAL_NAME')}明细</a></li>
                                    <li class="hover"><a href="{:U('Label/Member/integralChangeDetail', array('node_id'=>$node_id))}">查看兑换记录</a></li>
                                </ul>
                            </div>
                            <div class="gap-line"></div>
                            <volist name='list' id='orderItem'>
                                <div class="box">
                                    <a href="javascript:;">
                                        <div class="order-num">流水号：{$orderItem['order_id']}</div>
                                        <img src="{:get_upload_url($orderItem['goods_image'])}" />
                                        <div class="proItem-msg">
                                            <h1>{$orderItem['goods_name']}</h1>
                                            <h2><span class="red">-{$orderItem['order_amt']}</span>&nbsp;{:L('INTEGRAL_NAME')}</h2>
                                            <if condition="$orderItem['delivery_status'] eq '1' ">
                                                <a href="javascript:void(0);" class="voting">未发货</a>
                                            <elseif condition="$orderItem['delivery_status'] eq '4'" />
                                                <a href="javascript:void(0);" class="voting">领取信息已发送至您手机</a>
                                            <else />
                                                <a href="javascript:void(0);" rel="{$orderItem['order_id']}" class="vote">查看物流</a>
                                            </if>
                                        </div>
                                    </a>
                                </div>
                            </volist>
                        </div>
                    </div>
                </div>
                <div class="get-more" data-url="{$nextUrl}"><i></i><a href="javascript:void(0);">往上拉查看更多</a></div>
            </div>
        </div>

    </body>
    <script type="text/javascript">
        $(document).ready(function () {
            var loadhtml = '<div id="infscr-loading" style="text-align: center; display:none;"><img src="__PUBLIC__/Label/Image/Item/loading.gif"><div><em>加载中...</em></div></div>';
            $("#masonry").append(loadhtml);
            $("body").append("<div id='masonry2' style='display:none;'></div>");
            $(window).scroll(function () {
                if ($(document).scrollTop() + $(window).height() >= $(document).height()) {
                    if ($("#masonry2").hasClass("erro")) {
                        return false;
                    }
                    $("#masonry2").addClass("erro");
                    var url = $('.get-more').attr("data-url");
                    $("#infscr-loading").show();
                    $('#masonry2').load(url + ' ' + ".box", null, function (data, status) {
                        var newpath = newPath(url);
                        $(".get-more").attr("data-url", newpath);
                        
                        if (data == '' || data == 'undefined') {
                            $("#infscr-loading em").text("没有更多数据了");
                            $("#infscr-loading img").hide();
                            setTimeout(function () {
                                $("#infscr-loading").hide();
                            }, 2000);
                            $('.get-more').hide();
                        } else {
                            $('#masonry').append(data);
                            $("#infscr-loading").fadeOut(500);
                        }
                        $("#masonry2").removeClass("erro");
                    });
                }
            });
        });
        
        $(document).on('click', '.vote', function(){
            var order = $(this).attr('rel');
            $.post("{:U('Common/Express/updateShippingInfo')}", {'order':order, 'type':'5'}, function(data){
                data = eval('('+data+')');
                if(data){
                    window.location.href = "{:U('Label/Member/shippingInfo',array('node_id'=>$node_id))}"+'&order='+order;
                }
            });
        });
        
        function newPath(path) {
            path = path.split("p=");
            var p = path[1] * 1 + 1;
            newpath = path[0] + "p=" + p;
            return newpath;
        }
        
        $('.back').click(function () {
            history.go(-1);
        });
    </script>
</html>
